parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"KWog":[function(require,module,exports) {
window.createChartObject=function createChartObject(){var chartObject={bifocalScale:function(t,e,n,r){var a=d3.scaleIdentity(),i=t-r,l=e-r,s=i/n;function o(t,e,n){return function(){var r=n.apply(e,arguments);return r===e?t:r}}function c(t){var e=a(t),n=c.pivots;n[n.length-1].x;if(e<=0)return 0;if(e>=l)return i;for(var r=1;r<n.length&&n[r].x<e;)r++;var s=n[r-1].x,o=n[r-1].y,u=n[r].x;return o+(n[r].y-o)*(e-s)/(u-s)}return c.setup=function(t,e){if(c.pivots=[{x:0,y:0}],l>i){var n=(i-s)/(l-s);if(e){var r=(a=Math.min(i-s,Math.max(0,t-s/2)))+s;a>0&&c.pivots.push({y:a,x:a/n}),r<i&&c.pivots.push({y:r,x:l-(i-r)/n})}else{var a;r=(a=Math.min(l-s,Math.max(0,t-s/2)))+s;a>0&&c.pivots.push({x:a,y:a*n}),r<l&&c.pivots.push({x:r,y:i-(l-r)*n})}}c.pivots.push({x:l,y:i})},c.findItem=function(t){c.focus(t,!0);var e=c.invert(t);return Math.floor(e/r+.5)},c.invert=function(t){var e=c.pivots;if(t<=0)return 0;if(t>=i)return l;for(var n=1;n<e.length&&e[n].y<t;)n++;var r=e[n-1].x,a=e[n-1].y;return r+(e[n].x-r)*(t-a)/(e[n].y-a)},c.focus=function(t,e){return c.setup(t,e),c},c.nice=a.nice,c.ticks=a.ticks,c.tickFormat=a.tickFormat,c.setup(0),function(t,e){for(var n,r=1,a=arguments.length;++r<a;)t[n=arguments[r]]=o(t,e,e[n]);return t}(c,a,"domain","range")},binData:function(t,e){var n=[];function r(t,e){return(t.minOpen?e>t.min:e>=t.min)&&(t.maxOpen?e<t.max:e<=t.max)}for(var a=0;a<e.length;a++){var i=e[a];n.push({min:i.min,max:i.max,values:t.filter(function(t){return r(i,t)})})}return n},buildTable:function buildTable(definitions,tableOptions){var chart=this,data=this.data,dataMin=this.dataMin,dataMax=this.dataMax,dataRange=this.dataRange,dataQuantum=this.dataQuantum;this.clearTable=function(){this.tableGroup.selectAll("*").remove()},this.clearHistogram=function(){this.histGroup.selectAll("*").remove()},this.clearTable(),delete chart.estimatedBinMax,delete chart.countScaleMax;var binMax=this.estimateMaxBinSize(),binMaxDensity=this.estimateMaxBinDensity(),varDefs={},orderedVarNames=[],choiceGroups={},chosen={};definitions.forEach(function(t){var e=t.name;if(orderedVarNames.push(e),varDefs[e]=t,t.extra&&t.extra.forEach(function(e,n){0===parseFloat(e)&&"-"===e[0]&&(t.extra[n]=e.slice(1))}),t.choiceGroup){var n=choiceGroups[t.choiceGroup];n||(n=choiceGroups[t.choiceGroup]={choices:[]}),n.choices.push(e),t.default&&(n.chosen=e)}});var resultCache={};function resultHash(t,e){return orderedVarNames.map(function(e){return t[e]}).join(":")+":"+Object.keys(chosen).map(function(t){return chosen[t]}).join(":")}var compute=eval('(function(data, varExpressions, opts) {\n        // there are two ways to run this:\n        // 1. from scratch\n        // 2. with a pre-computed result set, supplied as opts.precomputed\n\n        var varNames = Object.keys(varExpressions);\n        // whenever a value is looked up, quantize to some reasonable number of places\n        var quantumLevel = 100000;\n        function quantize(v) {\n            if (typeof v !== "number") return v;\n            return Math.round(v*quantumLevel)/quantumLevel;\n        }\n        function RANGE(start, end, step) {\n            if (step===0 || Math.sign(step) !== Math.sign(end-start)) return [];\n            // the end value is meant to be non-inclusive.  don\'t let it get included just through JavaScript imprecision (e.g., 0.89999999 being accepted as less than 0.9).\n            var fuzzyEnd = end - step/1000; // close enough\n            var vals = [];\n            for (var v=start; v<fuzzyEnd; v+=step) vals.push(v);\n            return vals;\n        }\n        function COUNT(arr) { return arr.length }\n        function SUM(arr) { var s=0; arr.forEach(function(v) { return s+=v }); return s }\n        function FILTER_FN(arr, fn) { return arr.filter(fn) }\n        function G(nBins) { return chart.computeG(nBins) }\n        function RPrettyBreaks(dataMin, dataMax, n) { return chart.rPretty([dataMin, dataMax], n) }\n        function Sturges(data) { return Math.ceil(Math.log(data.length)/Math.log(2))+1 }\n        function ALL_BUT_FIRST(array) { return array.slice(1) }\n        function ALL_BUT_LAST(array) { return array.slice(0, -1) }\n        function PAIRS(array) { return lively.lang.arr.range(1,array.length-1).map(function(i) { return [quantize(array[i-1]), quantize(array[i])] }) }\n        function FILTER(data, lefts, rights, leftTests, rightTests, open) {\n            var leftFns = { ">": function(left, v) { return v>left }, "≥": function(left, v) { return v>=left } };\n            var rightFns = { "<": function(right, v) { return v<right }, "≤": function(right, v) { return v<=right } };\n            return lefts.map(function(left, i) {\n                var right = rights[i];\n                var subset = FILTER_FN(data, function(v) { return leftFns[leftTests[i]](left, v) && rightFns[rightTests[i]](right, v) });\n                subset.stringyValueParts = open==="L" ? [ "⋯", right ] : [ left, "⋯" ];\n                return subset;\n                })\n        }\n        function iterations(vn) { var val=eval(vn); return lively.lang.arr.isArray(val) ? val.length : 0 }\n        var valStore = {};\n        function lookup(vn,index) {\n            var vals=valStore[vn];\n            var oneVal = lively.lang.arr.isArray(vals) ? vals[index] : vals; // assumes all array vars in a given expression have same number of elements\n            return quantize(oneVal);\n        }\n        var iterationsInForce = 0; // the size of the latest array result\n        function iterateIfNeeded(exprOrFn, reduce) {\n            var expr = typeof exprOrFn === "function" ? exprOrFn(chosen) : exprOrFn;\n            // if it\'s a template, parse it into tokens now\n            var replacementTokens = null;\n            if (expr.indexOf("{")>=0) {\n                // odd-numbered tokens are variable refs\n                replacementTokens = (" "+expr).split(/[{}]/);\n            }\n            function contextualEval() {\n                return eval(replacementTokens ? replacementTokens.map(function(t,i) { t.length===0 ? "" : (i&1 ? eval(t) : t)}).join("") : expr);\n            }\n            var varsInvolved = [];\n            var iterationsNeeded = 0;\n            if (!reduce) {\n                var tokens = expr.split(/\\W/); // all contiguous alphanumerics (needs extra slash because of being in a template)\n                if (tokens.indexOf("i")>=0) iterationsNeeded = iterationsInForce;\n                else {\n                    varNames.forEach(function(vn) {\n                        if (tokens.indexOf(vn)>=0) {\n                            varsInvolved.push(vn);\n                            iterationsNeeded = Math.max(iterationsNeeded, iterations(vn));\n                        }\n                        });\n                if (iterationsNeeded) iterationsInForce = iterationsNeeded;\n                }\n            }\n            if (iterationsNeeded) {\n                varsInvolved.forEach(function(vn) { valStore[vn] = eval(vn) });\n                var result = [], iMax = iterationsNeeded-1;\n                for (var i=0; i<iterationsNeeded; i++) {\n                    varsInvolved.forEach(function(vn) {\n                      var val = lookup(vn, i);\n                      eval(vn+"=val");\n                      });\n                    result.push(contextualEval());\n                }\n                varsInvolved.forEach(function(vn) { eval(vn+"=valStore."+vn) });\n                return result;\n            } else {\n                var val = contextualEval();\n                if (lively.lang.arr.isArray(val)) iterationsInForce = val.length;\n                return val;\n            }\n        }\n        '.concat(orderedVarNames.map(function(t){return"var "+t+";"}).join(" "),';\n        var pre, choiceSortedVars = [];\n        orderedVarNames.forEach(function(vn) {\n            if (choiceSortedVars.indexOf(vn)===-1) { // not added by a choice sibling\n                if (varDefs[vn].choiceGroup) {\n                    var group = choiceGroups[varDefs[vn].choiceGroup], choices = group.choices, chosen = group.chosen;\n                    choiceSortedVars.push(chosen);\n                    choices.forEach(function(cn) {\n                        if (cn!==chosen) {\n                            choiceSortedVars.push(cn);\n                            varExpressions[cn] = varDefs[cn].derivedMain;\n                        }\n                        });\n                } else choiceSortedVars.push(vn);\n            }\n            });\n        choiceSortedVars.forEach(function(vn) {\n            var val = opts.precomputed && (pre = opts.precomputed[vn]) !== undefined ? pre : iterateIfNeeded(varExpressions[vn], varDefs[vn].reduce);\n            eval(vn+"=val");\n            });\n        var result = { ').concat(orderedVarNames.map(function(t){return t+": "+t}).join(", ")," };\n        if (opts.measure) result.measure = iterateIfNeeded(opts.measure, true);\n        return result;\n    })"));function runComputation(t,e,n){Object.keys(choiceGroups).forEach(function(t){var e=choiceGroups[t];chosen[t]=e.chosen});var r=resultHash(e,contextVar),a=resultCache[r];if(a&&(!n||a.hasOwnProperty("measure"+n)))return a;var i={};n&&(i.measure=n),a&&(i.precomputed=a);var l=compute(t,e,i);if(!a){var s=lively.lang.obj.clone(l);n&&(s["measure"+n]=s.measure),orderedVarNames.forEach(function(t){varDefs[t].noCache&&delete s[t]}),resultCache[r]=s}return l}this.findClosestResult=function(t,e,n){var r={};orderedVarNames.forEach(function(t){r[t]=varDefs[t].main});var a=[],i=varDefs[n].extra;i.forEach(function(e){var i=lively.lang.obj.clone(r);i[n]=String(e),a.push(runComputation(data,i,t))});var l,s=9999;a.forEach(function(t,n){var r=Math.abs(t.measure-e);r<s&&(s=r,l=n)});var o=i[l];return varDefs[n].main!=o?(varDefs[n].main=o,o):null};var fixups=[],contextVar;function defer(t,e){fixups.push(lively.lang.fun.curry(function(t,n){t.transition(n).call(e)},t))}function runDeferred(t){var e=d3.transition().duration(t);fixups.forEach(function(t){t(e)}),fixups=[]}function toggleContextSpec(t){contextVar=contextVar===t?null:t,scheduleEvent("",0,function(){return refreshTable({force:!0},500)})}var edges=[10,90,450,840],boxSize=10,boxGap=boxSize+8,xInset=20,yInset=20,rowHeight=22,fontHeight=13,spreadBackground="#eee",tableGroup=this.tableGroup,transformString=this.transformString;function keyString(t){return t.varName+t.reason}function showChange(t){t.interrupt().style("fill","red").transition().ease(d3.easeExpIn).duration(1e3).style("fill",function(t){return t.fill||"black"})}function stringyValue(t,e){if(null===t)return"";if(t.stringyValueParts)return t.stringyValueParts.map(function(t){return stringyValue(t,e)}).join("");var n=t;if(!isNaN(t)){var r=varDefs[e].rounding;void 0!==r&&(n=Number(t).toFixed(r))}return String(n)}var eventQueue=[],eventTimeout;function scheduleEvent(t,e,n){eventTimeout&&(clearTimeout(eventTimeout),eventTimeout=null),flushEventQueue(t),eventQueue.push({type:t,fn:n}),e?eventTimeout=setTimeout(runEvents,e):runEvents()}function flushEventQueue(t){eventQueue=eventQueue.filter(function(e){return e.type!==t})}function runEvents(){eventQueue.forEach(function(t){return t.fn()}),eventQueue=[]}function objectsEqual(t,e){var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(var a=0;a<n.length;a++){var i=n[a];if(!e.hasOwnProperty(i))return!1;if(e[i]!==t[i])return!1}return!0}var lastRefresh={};function refreshTable(t,e){t.isDragging=chart.isDragging,t.useDensity=chart.useDensity,tableOptions.widthControl&&(chart.estimatedBinMax||(chart.estimatedBinMax=chart.estimateMaxBinSize(varDefs.width.main/chart.dataRange*100)),binMax=t.estimatedBinMax=chart.estimatedBinMax);var n=t.force;if(delete t.force,n||!objectsEqual(t,lastRefresh)){lastRefresh=t,contextVar?chart.histGroup.select("g.fader").style("opacity",1):(chart.histGroup.select("g.fader").style("opacity",0),chart.recordBinState("primary"));var r={},a=!!t.focusVar&&t.focusVar===contextVar,i=a?t.focusIndex:null,l=!!t.focusVar&&!a;orderedVarNames.forEach(function(e){r[e]=l&&t.focusVar===e?varDefs[e].extra[t.focusIndex]:varDefs[e].main});var s=runComputation(data,r),o=m(s),c=o.length,u=[],h=[];if(contextVar)varDefs[contextVar].extra.forEach(function(t){var e=lively.lang.obj.clone(r);e[contextVar]=String(t),u.push(runComputation(data,e))}),u.forEach(function(t,e){var n=m(t,e);h.push(n),c=Math.max(c,n.length)});if(chart.drawBins(o,h,{useDensity:t.useDensity,binMax:t.useDensity?binMaxDensity:binMax,highlight:i,extraAxisAnnotations:!!tableOptions.extraAxisValues,scaleToFitAxis:!!tableOptions.widthControl}),contextVar||chart.highlightBinDifferences("primary",!t.isDragging),!tableOptions.noVisibleTable){if(!tableOptions.noRanges){var d={primary:o,context:[]};a&&(d.context=h[i]),chart.drawRanges(d)}function f(t){return lively.lang.obj.isArray(t)&&t.length<c?t.concat(lively.lang.arr.withN(c-t.length,null)):t}var p=contextVar?varDefs[contextVar].extra.indexOf(varDefs[contextVar].main):null,v=[],y=[],x=0;v.push({varName:"dummy",reason:"rule",rowInDisplay:x}),orderedVarNames.forEach(function(t,e){var n=varDefs[t];if(!n.noDisplay){var r=n.main;"function"==typeof r&&(r=r(chosen));var a=!!n.choiceGroup,i=a&&choiceGroups[n.choiceGroup].chosen===t,l=a&&lively.lang.arr.last(choiceGroups[n.choiceGroup].choices)===t,o=n.extra;if(!o||a&&!i?v.push({varName:t,baseRow:e,rowInDisplay:x++,reason:"main",expr:a&&!i?"-":r,styledExpr:n.styled,data:f(s[t])}):(v.push({varName:t,baseRow:e,rowInDisplay:x++,reason:"main",hasExtras:!0,expr:o,data:f(s[t])}),t===contextVar&&y.push(t)),contextVar&&contextVar!==t){var c=r.split(/\W/);if(y.some(function(t){return c.indexOf(t)>=0})){y.push(t);var h=u.map(function(e){return e[t]});h.isContextArray=!0,v.push({varName:t,baseRow:e,rowInDisplay:x,reason:"extraShadow",expr:"",data:[]}),v.push({varName:t,baseRow:e,rowInDisplay:x,reason:contextVar+"extra",expr:"",data:[],context:h}),x++}}a&&!l||v.push({varName:t,reason:"rule",rowInDisplay:x})}});var g=tableGroup.selectAll(".row").data(v,keyString);g.exit().attr("class","defunctRow").call(defer,function(t){t.style("opacity",1e-6).remove()}),g.enter().append("g").attr("class","row").attr("transform",function(t){return transformString(xInset,yInset+rowHeight*t.rowInDisplay+1)}).style("opacity",function(t){return"main"===t.reason?1:0}).each(function(t){var e=d3.select(this);"rule"===t.reason?e.append("line").attr("class","rowSeparator").attr("x1",0).attr("y1",-1).attr("x2",lively.lang.arr.last(edges)).attr("y2",-1).style("stroke","grey").style("stroke-width",.75).style("opacity",1).style("pointer-events","none"):(e.append("rect").attr("class","rowBackground").attr("x",0).attr("y",0).attr("width",lively.lang.arr.last(edges)).attr("height",rowHeight-2).style("opacity",1),t.hasExtras&&e.append("rect").attr("class","extraToggle").attr("id",t.varName+"-extraToggle").attr("x",edges[1]).attr("y",(rowHeight-boxSize)/2-2).attr("width",boxSize).attr("height",boxSize).style("fill","green").style("fill-opacity",.3).style("stroke","green").style("stroke-opacity",.7).style("stroke-width",2).style("cursor","pointer").on("click",function(){return toggleContextSpec(t.varName)}),"main"===t.reason&&varDefs[t.varName].choiceGroup&&e.append("circle").attr("class","choiceToggle").attr("cx",edges[0]+boxSize/2).attr("cy",rowHeight/2-2).attr("r",boxSize/2).style("fill","green").style("fill-opacity",.3).style("stroke","green").style("stroke-opacity",.7).style("stroke-width",2).on("click",function(){choiceGroups[varDefs[t.varName].choiceGroup].chosen=t.varName,contextVar=null,refreshTable({force:!0},250)}))}),tableGroup.selectAll(".row").each(function(e){var n=d3.select(this),r=a&&e.reason===contextVar+"extra",l=e.varName,o=!!e.hasExtras,c=o&&l===contextVar;if(n.select("rect.rowBackground").style("fill","extraShadow"===e.reason||c?spreadBackground:"main"===e.reason?"white":"none"),defer(n,function(t){t.attr("transform",transformString(xInset,yInset+rowHeight*e.rowInDisplay)).style("opacity",1)}),"rule"!==e.reason){var u=!!varDefs[l].choiceGroup,h=u&&choiceGroups[varDefs[l].choiceGroup].chosen===l;n.select("rect.extraToggle").style("fill-opacity",c?1:0),u&&n.select("circle.choiceToggle").style("fill-opacity",h?1:0);var d=[];if("main"===e.reason&&d.push({category:"label",xOffset:edges[0],cells:[{rowSpec:e,text:l,x:u?boxGap:0}]}),""!==e.expr){var f={category:"expr",cells:g=[],xOffset:edges[1]};if("extraShadow"===e.reason)g.push({rowSpec:e,text:e.expr,x:32,fill:"green"});else if(lively.lang.obj.isArray(e.expr)){if(e.hasExtras)if(f.id=e.varName+"-extraGroup",t.focusVar===l)f.focusIndex=f.indexToHighlight=t.focusIndex;else{var v=varDefs[l];f.focusIndex=v.extra.indexOf(v.main),-1==f.focusIndex&&console.log("can't find focus value in def:",v)}var y=32,x=e.hasExtras?boxGap:0;lively.lang.obj.extend(f,{isFishy:!0,fishWidth:edges[2]-edges[1]-x-32,fishItemWidth:y}),f.xOffset+=x,e.expr.forEach(function(t,n){g.push({rowSpec:e,indexInGroup:n,width:y,text:stringyValue(t,l),x:n*y,anchor:"middle",mouseover:function(t){var e=t.rowSpec.varName,n=t.indexInGroup;scheduleEvent("probe",0,function(){refreshTable({focusVar:e,focusIndex:n},250),chart.resetBinHighlight()})},mouseout:function(t){scheduleEvent("probe",200,function(){refreshTable({},250),chart.resetBinHighlight()})},click:function(t){var e=t.rowSpec.varName,n=t.indexInGroup;varDefs[e].main=varDefs[e].extra[n],scheduleEvent("probe",0,function(){refreshTable({focusVar:e,focusIndex:n,force:!0},250),chart.resetBinHighlight()})}})})}else f.id=e.varName+"-expression",g.push({rowSpec:e,text:e.expr,x:0,styledText:e.styledExpr});g.length&&d.push(f)}y=44;if(lively.lang.obj.isArray(e.data)){var g;f={category:"data",cells:g=[],xOffset:edges[2],isFishy:!0,fishWidth:edges[3]-edges[2]-xInset,fishItemWidth:y,focusIndex:t.dataFocusIndex||0};if(t.isDragging&&e.data.length){var m=e.data.length;0!=s.offset&&m--;var b=d3.scaleLinear().domain([0,(m+1)*y]).range([y,f.fishWidth-y]);f.focusItemOffset=b((f.focusIndex+s.offset)*y),f.linearFocusOffset=(s.offset+1)*y}e.data.forEach(function(t,n){var a=lively.lang.obj.isArray(t)?"{"+t.length+"}":stringyValue(t,l),i={rowSpec:e,text:a,x:n*y,width:y,anchor:"middle",dataIndex:n,indexInGroup:n,isContext:r};r||(i.mouseover=function(t){scheduleEvent("probe",0,function(){refreshTable({dataFocusIndex:t.dataIndex,binHighlight:t.dataIndex},0)})},i.mouseout=function(t){scheduleEvent("probe",200,function(){refreshTable({binHighlight:null},0)})}),g.push(i)}),g.length&&d.push(f)}else{x=y/2;var w=stringyValue(e.data,l);d.push({category:"data",xOffset:edges[2]+x,cells:[{rowSpec:e,text:w,anchor:"middle",weight:"bold",x:0,isContext:r}]})}var M=n.selectAll(".cellGroup").data(d,function(t){return t.category});M.exit().remove(),M.enter().append("g").attr("class","cellGroup").merge(M).attr("transform",function(t){return transformString(t.xOffset,0)}).each(function(e){var n=d3.select(this),a=e.isFishy?"fishItem":"cellItem";e.id&&n.attr("id",e.id);var i=n.selectAll("."+a).data(e.cells,function(t){return t.indexInGroup});i.exit().attr("class","defunctCell").interrupt().each(function(e){var n=d3.select(this);n.select("text").attr("class","defunctText"),t.isDragging||e.isContext?n.remove():defer(n,function(t){t.style("opacity",1e-6).remove()})}),i.enter().append("g").attr("class",a).each(function(t){var n=d3.select(this);t.mouseover&&n.append("rect").attr("class",e.category+"MouseTrap").attr("y",1).attr("height",o?rowHeight-4:rowHeight).style("fill-opacity",e.isFishy?1:0).style("stroke","green").style("stroke-width",1).style("stroke-opacity",0).style("cursor",t.click?"pointer":"crosshair").on("mouseover",function(t){return t.mouseover(t)}).on("mouseout",function(t){return t.mouseout(t)}).on("click",function(t){t.click&&t.click(t)}),n.append("text").attr("class",e.category+"TextCell").attr("dy",chart.textOffsets.hanging).style("fill",function(t){return t.fill||"black"}).style("font-size",(r?fontHeight-4:fontHeight)+"px").style("font-weight",function(t){return t.weight||"normal"}).style("text-anchor",t.anchor||"start").style("opacity",e.isFishy?.2:1).style("pointer-events","none").style("-webkit-user-select","none")}),e.isFishy&&chart.spaceBifocally(n,e),d3.select(this).selectAll("."+a).each(function(t){var n=d3.select(this);e.isFishy||n.attr("transform",transformString(t.x,0));var a=n.select("text");if(a.attr("y",r?0:4),t.styledText){a.attr("dy",chart.textOffsets.hanging);var i=a.selectAll("tspan").data(t.styledText);i.exit().remove(),i.enter().append("tspan").merge(i).style("font-style",function(t){return t.style}).style("fill",function(t){return t.colour||"black"}).text(function(t){return t.text})}else{a.text()!==t.text&&a.call(showChange),a.text(t.text)}if(e.isFishy){var l=n.select("rect");l.style("fill",c?spreadBackground:"white"),e.indexToHighlight===t.indexInGroup?l.style("stroke",c?"black":"blue").style("stroke-opacity",1):l.style("stroke-opacity",0);var s=""===t.text?[!0]:[],o=n.selectAll("line").data(s);o.exit().remove(),o.enter().append("line").attr("y1",rowHeight/2).attr("y2",rowHeight/2).style("stroke","grey").style("stroke-width",1).merge(o).attr("x1",-2).attr("x2",2)}})});var A=0,k=[];if(e.context){for(var I=[],S=d3.max(e.context,function(t){return lively.lang.obj.isArray(t)?t.length:1}),O=[],G=0;G<S;G++){var C=O[G]=[];e.context.forEach(function(t){var e;e=lively.lang.obj.isArray(t)?t.length>G?t[G]:null:0===G?t:null,C.push(e)})}y=44;O.forEach(function(t,n){if(I.push({rowSpec:e,dataIndex:n,indexInGroup:n,x:n*y,width:y,values:t,mouseover:function(t){scheduleEvent("probe",0,function(){refreshTable({dataFocusIndex:t.dataIndex,calloutVar:t.rowSpec.varName,calloutIndex:t.dataIndex,binHighlight:t.dataIndex},0)})},mouseout:function(t){scheduleEvent("probe",200,function(){refreshTable({binHighlight:null},0)})}}),t.length&&t.some(function(t){return"number"==typeof t})){var r=d3.extent(t),a=r[1]-r[0];a>A&&(A=a)}});var z={cells:I,xOffset:edges[2],isFishy:!0,fishWidth:edges[3]-edges[2]-xInset,fishItemWidth:y,focusIndex:t.dataFocusIndex||0};if(e.varName===t.calloutVar){var E=t.calloutIndex;z.calloutItem={isCallout:!0,rowSpec:e,dataIndex:E,width:2.5*y,values:O[E]}}k.push(z)}var T=n.selectAll(".pictureCellGroup").data(k);T.exit().remove(),T.enter().append("g").attr("class","pictureCellGroup").merge(T).attr("transform",function(t){return transformString(t.xOffset,0)}).each(function(e){var n=d3.select(this),r=[];e.calloutItem&&r.push(e.calloutItem);var s=n.selectAll(".fishItem,.callout").data(e.cells.concat(r),function(t){return t.isCallout?"callout":t.indexInGroup});s.exit().remove(),s.enter().append("g").attr("class",function(t){return t.isCallout?"callout":"fishItem"}).style("opacity",function(t){return t.isCallout?1:0}).append("rect").attr("class","pictureMouseTrap").attr("x",function(t){return-t.width/2}).attr("y",0).attr("width",function(t){return t.width}).attr("height",function(t){return t.isCallout?3*rowHeight:rowHeight}).style("stroke","none").style("fill",function(t){return t.isCallout?"#d8d8d8":"none"}).style("cursor","crosshair").style("pointer-events","all"),chart.spaceBifocally(n,e);var o=d3.transition().duration(300).ease(d3.easeLinear),c=d3.transition().duration(0);n.selectAll(".fishItem,.callout").each(function(e,n,r){var s=e.isCallout,u=d3.select(this),h=u.select("rect");h.style("fill",e.rowSpec.varName===t.calloutVar&&e.dataIndex===t.calloutIndex?"#d8d8d8":"none");var d=s?2:1,f=h.attr("width"),v=s?14:3,y=h.attr("height")-v-(s?10:3),x=s?24:5,g=s?16:5,m=Math.max(1,f-x-g),b=(x-g)/2;if(s){var w=0;d3.selectAll(r).each(function(t){t.dataIndex===e.dataIndex&&"fishItem"===d3.select(this).attr("class")&&(w=this.transform.baseVal[0].matrix.e)}),u.attr("transform",transformString(w,rowHeight-1)),h.on("mouseout",function(t){scheduleEvent("probe",200,function(){refreshTable({},0),chart.resetBinHighlight()})}).on("mousemove",function(t){if(contextVar){var e=d3.mouse(this)[0];scheduleEvent("probe",0,function(){var n=0===j?0:Math.round((e-H)/j);n=Math.max(0,Math.min(n,F-1));var r=I[n].contextIndex;refreshTable({focusVar:contextVar,focusIndex:r,dataFocusIndex:t.dataIndex,calloutVar:t.rowSpec.varName,calloutIndex:t.dataIndex,binHighlight:null},0),chart.highlightBinNumber(t.dataIndex,r)})}}).on("click",function(e){if(t.focusIndex){var n=contextVar,r=t.focusIndex;varDefs[n].main=varDefs[n].extra[r];var a=lively.lang.obj.clone(t);a.force=!0,scheduleEvent("probe",0,function(){refreshTable(a,250)})}})}var M=e.values;if(0===M.length)u.selectAll("*").remove();else{var k=M.filter(function(t){return null!==t}),I=[],S=[],O=v+.5*y,G=k.some(function(t){return"number"==typeof t});if(G){var C=((N=d3.extent(k))[0]+N[1])/2;function z(t){return O-y*(0==A?0:(t-C)/A)}if(M.forEach(function(t,e){null!==t&&I.push({y:z(t),contextIndex:e})}),s)if(2===(S=(N[0]==N[1]?[N[0]]:N).map(function(t){return{text:stringyValue(t,e.rowSpec.varName),y:z(t)}})).length){var E=S[0].y-S[1].y;if(E<10){var T=(10-E)/2;S[0].y+=T,S[1].y-=T}}}else if(k.some(function(t){return"boolean"==typeof t})){M.forEach(function(t,e){null!==t&&I.push({y:O+(t?-2:2),contextIndex:e})})}else if(k.some(function(t){return"string"==typeof t})){var L=lively.lang.arr.uniq(k);L.sort();var D=0===(N=L.length-1)?0:Math.min(4,y/N);M.forEach(function(t,e){if(null!==t){var n=L.indexOf(t);I.push({y:O+D*(n-N/2),contextIndex:e})}})}else if(k.some(function(t){return t.hasOwnProperty("collection")||lively.lang.obj.isArray(t)})){var N,B=M.map(function(t){return null===t?null:JSON.stringify(t.collection?t.collection:t)}),V=lively.lang.arr.uniq(B);D=0===(N=V.length-1)?0:Math.min(4,y/N);B.forEach(function(t,e){if(null!==t){var n=V.indexOf(t);I.push({y:O-D*(n-N/2),contextIndex:e})}})}var F=I.length,j=F<=1?0:Math.min(m/(F-1),6*d),H=b-.5*(F-1)*j;I.forEach(function(t,e){t.x=H+e*j});var R=!(s||t.hasOwnProperty("focusIndex"));if(G){var P=u.selectAll("path").data([I]);P.enter().append("path").attr("class","spark").attr("d",d3.line().x(function(t){return t.x}).y(function(t){return t.y})).style("stroke","green").style("stroke-width",d).style("fill","none").style("pointer-events","none").merge(P).interrupt().transition(R?o:c).attr("d",d3.line().x(function(t){return t.x}).y(function(t){return t.y}))}else u.selectAll("path").remove();var W=G?[]:I.map(function(t){return{point:t,reason:"base"}}),Q=a&&I.find(function(t){return t.contextIndex===i});Q&&W.push({point:Q,reason:"highlight"});var Y=I.find(function(t){return t.contextIndex===p});Y&&W.push({point:Y,reason:"primary"});var J,U=s&&t.hasOwnProperty("focusIndex")?[stringyValue(M[t.focusIndex],l)]:[];(J=u.selectAll("text.readout").data(U)).exit().remove(),J.enter().append("text").merge(J).attr("class","readout").attr("x",0).attr("y",2).attr("dy",chart.textOffsets.hanging).style("fill",d3.hcl(73,100,75).darker(.5)).style("font-size",fontHeight+"px").style("font-weight","bold").style("text-anchor","middle").style("pointer-events","none").style("-webkit-user-select","none").text(String),(J=u.selectAll("text.sparkLabel").data(S)).exit().remove(),J.enter().append("text").merge(J).attr("class","sparkLabel").attr("x",4-f/2).attr("y",function(t){return t.y}).attr("dy",chart.textOffsets.middle).style("font-size",fontHeight-4+"px").style("pointer-events","none").style("-webkit-user-select","none").text(function(t){return t.text});var q=u.selectAll("circle").data(W);q.exit().remove(),q.enter().append("circle").attr("cx",function(t){return t.point.x}).attr("cy",function(t){return t.point.y}).merge(q).attr("r",function(t){return"base"===t.reason?d:1.5*d}).style("fill",function(t){return"highlight"===t.reason?"black":"primary"===t.reason?"blue":"green"}).style("stroke-width",0).style("pointer-events","none").interrupt().transition(R?o:c).attr("cx",function(t){return t.point.x}).attr("cy",function(t){return t.point.y})}})})}}),tableGroup.select(".callout").each(function(t){for(var e,n,r=this;r=r.parentNode,"row"!==(n=(e=d3.select(r)).attr("class"))&&"defunctRow"!==n;);"defunctRow"!==n&&e.raise()})}tableGroup.raise(),t.hasOwnProperty("binHighlight")&&(null===t.binHighlight?chart.resetBinHighlight():chart.highlightBinNumber(t.binHighlight)),runDeferred(e||0)}function m(t,e){var n=[];return t.bins.forEach(function(r,a){function i(e,n){var r=t[e];return lively.lang.obj.isArray(r)&&(r=r[a]),n?Number(stringyValue(r,e)):r}n.push({min:i("lefts",!0),minOpen:">"==i("leftTests"),max:i("rights",!0),maxOpen:"<"==i("rightTests"),values:r,scenario:e,dataIndex:a})}),n}}this.refreshTable=refreshTable,this.scheduleEvent=scheduleEvent;var group=this.histGroup,opacityHandler=function(t,e){chart.triangleSetting={x:t,y:e};var n=.01*t,r=.01*e;chart.primaryOpacity=r,chart.contextOpacity=.8*n,group.selectAll("rect.primary").style("opacity",chart.primaryOpacity),group.selectAll("rect.context").style("opacity",chart.contextOpacity)};if(!0!==tableOptions.noFader&&(this.drawFaderControl(lively.pt(260,tableOptions.noVisibleTable?70:45),lively.lang.fun.throttle(opacityHandler,100)),group.select("g.fader").style("opacity",0)),!0!==tableOptions.noDensity&&this.drawDensityControl(lively.pt(480,tableOptions.noVisibleTable?55:30),function(){return refreshTable({},250)}),tableOptions.widthControl){var widthValues=varDefs.width.extra,valueIndex=widthValues.indexOf(varDefs.width.main);this.drawBinWidthControl(lively.pt(420,51),widthValues,valueIndex,function(t){varDefs.width.main=t,delete chart.estimatedBinMax,refreshTable({force:!0},0)})}tableOptions.sweepControl&&this.drawSweepControl(lively.pt(0,55),function(){return toggleContextSpec("offset")}),refreshTable({force:!0,binHighlight:null},0)},computeG:function(t){var e=this.data,n=this.dataMin,r=(this.dataMax-n)/t,a=[],i=r/100;e.forEach(function(t){var e=Math.ceil((t-n)/i)+100-1,r=a[e];void 0===r?r=1:r++,a[e]=r});var l=[],s=100*t,o=[],c=100*(t-1);function u(t){return a[t]||0}var h=u(99);l.push(h);var d=lively.lang.arr.withN(100,0);d[0]+=h*h;for(var f=1,p=1;p<s;p++){if(h=h-u(p-1)+u(p+100-1),l.push(h),p>=100){var v=h-l[p-100];o.push(v),d[f]+=v*v,p>=c&&(d[f]+=h*h)}100==++f&&(f=0)}var y=d.slice();y.sort(function(t,e){return e-t});for(var x=0,g=0,m=1;m<=100;m++)g+=m*y[m-1],x+=d[m-1];return(2*g/x-1)/100},drawBalls:function(t){var e=[],n=[],r=0;t.valuesAndCountsDo(function(t,e){return r=Math.max(r,e)});var a=r<=10?1:Math.floor(r/10),i=2+Math.floor(Math.log(a)/Math.log(10));t.valuesAndCountsDo(function(t,r){for(var i=r/a,l=0;l<Math.ceil(i);l++)e.push({value:t,stagger:1.5*l,clipLimit:l+1>i?i-l:void 0});n.push({value:t,cutoff:i})});var l=this.xScale,s=this.dataGroup;s.selectAll("circle.ball").data(e).enter().each(function(t,e){t.clipLimit&&s.append("clipPath").attr("id","ballClipper"+e).append("rect").attr("x",l(t.value)-i).attr("y",-i*(t.clipLimit+2*t.stagger)).attr("width",2*i).attr("height",2*t.clipLimit*i)}).append("circle").attr("class","ball").attr("cx",function(t){return l(t.value)}).attr("cy",function(t){return-i*(1+2*t.stagger)}).attr("r",i).style("fill","black").style("stroke-width",.5).style("stroke","black").attr("clip-path",function(t,e){return t.clipLimit?"url(#ballClipper"+e+")":"none"}).on("mouseover",function(t){}).on("mouseout",function(t){})},drawBinAnnotations:function(t,e,n,r,a,i){var l=this,s=e.x,o=e.y,c=t.selectAll("text.histLabel").data(a,function(t){return t.labelType+t.text});c.exit().remove(),c.enter().append("text").attr("class","histLabel").style("font-size","10px").style("fill","grey").style("pointer-events","none").style("-webkit-user-select","none").each(function(t){var e=d3.select(this);i||e.style("opacity",1e-6).transition().duration(500).style("opacity",1)}).merge(c).attr("x",function(t){return t.x}).attr("y",function(t){return o+t.y}).attr("dy",function(t){return l.textOffsets[t.baseline||"central"]}).each(function(t){var e=d3.select(this),n=e.selectAll("tspan"),r=t.highlightOnChange&&(n.empty()||d3.select(n.node()).text()!==t.text);n.remove();var a=e.append("tspan").text(t.text).style("text-anchor",function(t){return t.anchor||"start"});if(t.suffix){var i=this.getBBox().x;a.style("text-anchor","start").attr("dx",i-t.x),e.append("tspan").text(t.suffix)}r&&e.style("fill","red").transition().duration(1e3).style("fill","grey")});var u=t.selectAll("line.tick").data(r);u.exit().remove(),u.enter().append("line").attr("class","tick").style("stroke","grey").style("stroke-width",1).merge(u).attr("x1",function(t){return t.x}).attr("x2",function(t){return t.x+t.dx}).attr("y1",function(t){return o+t.y}).attr("y2",function(t){return o+t.y+t.dy});var h=t.selectAll("line.yscale").data([n]);h.enter().append("line").attr("class","yscale").attr("x1",s).attr("x2",s).attr("y1",o).style("stroke-width","1px").style("stroke","grey").merge(h).attr("y2",function(t){return o-t})},drawBins:function(t,e,n){var r=this,a=this.xScale,i=n.binMax,l=n.useDensity,s=n.highlight,o=n.extraAxisAnnotations,c=this.rPretty([0,i],5),u=c[c.length-1];n.scaleToFitAxis&&(this.countScaleMax!==u&&r.histGroup.selectAll("text.histLabel").filter(function(t){return t.highlightOnChange}).interrupt().remove(),i=this.countScaleMax=u);var h=this.maxMainBinHeight,d=o?function(t){return t/i*h}:function(t){return 0===t?.01:t/i*h},f=this.histGroup,p=f.select(".binGroup");this.transformString;function v(t,n,i){var s,o=["primary","context","contextOutline"].indexOf(n),c=p.selectAll("rect."+n).data(t,function(t){return t.dataIndex});c.exit().remove(),"primary"===n&&c.size()&&(s=+c.nodes()[0].getAttribute("width"));var u=c.enter().append("rect").attr("class",n+" bin");if((c=c.merge(u)).attr("x",function(t){return a(t.min)}).attr("y",function(t){return-d(l?t.values.length/(r.data.length*(t.max-t.min)):t.values.length)}).attr("width",function(t){return a(t.max)-a(t.min)}).attr("height",function(t){return d(l?t.values.length/(r.data.length*(t.max-t.min)):t.values.length)}).style("fill",i).style("stroke",["blue","none","black"][o]).style("stroke-width",[e.length?1:.5,0,1][o]).style("stroke-opacity",[1,0,1][o]).style("opacity",[e.length?r.primaryOpacity:.5,r.contextOpacity,r.primaryOpacity][o]).attr("pointer-events",["all","none","none"][o]).style("cursor",r.binsAreDraggable?"ew-resize":"crosshair").each(function(){"primary"!==n&&"contextOutline"!==n||d3.select(this).raise()}),s){var h=+c.nodes()[0].getAttribute("width");lively.lang.num.roundTo(h,.1)!==lively.lang.num.roundTo(s,.1)&&r.dataGroup.selectAll("circle.ball").each(function(){delete this.oddEven})}}var y=[];e.forEach(function(t){y=y.concat(t)});var x=y.filter(function(t){return t.scenario===s}),g=this.contextBinFill;g.opacity=.15,v(y,"context",g.toString()),v(t,"primary",y.length?"none":this.restingBinFill),v(x,"contextOutline","none");var m=a(this.dataMax)+40,b=[{labelType:"title",x:m,anchor:"start",y:-d(u)-15,text:l?"density":"count"}],w=[{x:m,y:0,dx:-4,dy:0}];if(c.forEach(function(t){b.push({labelType:"yAxis",x:m+4+3,y:-d(t),text:String(t),highlightOnChange:!0}),w.push({x:m,y:-d(t),dx:4,dy:0})}),o){var M=this.rPretty([this.dataMin,this.dataMax],10);M.forEach(function(t){b.push({labelType:"xAxis",x:a(t),anchor:"middle",y:12,text:String(t)}),w.push({x:a(t),y:0,dx:0,dy:4})}),b[b.length-1].suffix=" "+this.dataUnits;var A=a(M[0]),k=a(M[M.length-1]);w.push({x:A,y:0,dx:k-A,dy:0})}else[{val:this.dataMin},{val:this.dataMax,suffix:" "+this.dataUnits}].forEach(function(t){b.push({labelType:"xAxis",x:a(t.val),anchor:"middle",y:12,text:String(t.val),suffix:t.suffix}),w.push({x:a(t.val),y:0,dx:0,dy:4})});this.drawBinAnnotations(f,{x:m,y:0},d(u),w,b,!0)},drawBinWidthControl:function(t,e,n,r){var a={x:t.x+75,y:t.y},i=8,l="black",s=this.histGroup.append("g").attr("class","switchGroup"),o=n,c=s.append("rect").attr("id","widthControl").attr("x",a.x).attr("y",a.y).attr("width",50).attr("height",32).style("border-width",1).style("stroke","#444").style("fill","none").style("pointer-events","none").attr("stroke-dasharray","2 4"),u=s.append("text").attr("class","readout").attr("x",a.x+25).attr("y",a.y+32/3).attr("dy",this.textOffsets.central).style("font-size","14px").style("text-anchor","middle").style("pointer-events","none").style("-webkit-user-select","none").style("fill",l),h=s.append("text").attr("class","minmax").attr("x",a.x+25).attr("y",a.y+24).attr("dy",this.textOffsets.central).style("font-size","9px").style("text-anchor","middle").style("pointer-events","none").style("-webkit-user-select","none").style("fill",l);function d(){u.interrupt().text(e[o]).style("fill","red").transition().duration(1e3).style("fill",l),h.text(0===o?"(MIN)":o===e.length-1?"(MAX)":"")}d();var f=s.append("rect").attr("class","draggable").attr("x",a.x).attr("y",a.y).attr("width",50).attr("height",32).style("fill","none").style("pointer-events","all").style("cursor","ew-resize").on("mousedown",function(){var t=d3.mouse(this),n=o,l=t[0]-a.x,s=t[1]-a.y,u=d3.select(window).on("mousemove",function(){var t=d3.mouse(c.node());f.attr("x",t[0]-l).attr("y",t[1]-s),h(t)}).on("mouseup",function(){u.on("mousemove",null).on("mouseup",null),f.attr("x",a.x).attr("y",a.y)});d3.event.preventDefault();var h=lively.lang.fun.throttle(function(a){var l=a[0]-t[0],s=Math.max(0,Math.min(e.length-1,n+Math.floor(l/i)));s!==o&&(o=s,d(),r(e[o]))},100)});s.append("text").attr("class","switchLabel").attr("x",t.x).attr("y",t.y+32/3).attr("dy",this.textOffsets.central).style("font-size","14px").style("pointer-events","none").style("-webkit-user-select","none").style("fill","#444").text("bin width"),s.append("text").attr("class","switchLabel").attr("x",t.x).attr("y",t.y+24).attr("dy",this.textOffsets.central).style("font-size","9px").style("pointer-events","none").style("-webkit-user-select","none").style("fill","#444").text("(drag to change)")},drawBreakValues:function(t){var e=this,n=!(!t||!t.instant),r=0+this.fallIntoBins,a=this.xScale,i=this.dataBinDecimals,l=[];e.demoGroup.selectAll("line.binbreak").each(function(t,e){d3.select(this);l.push({text:t.value.toFixed(i),value:t.value,index:e})});var s=e.demoGroup.selectAll("text.binbreak").data(l,function(t){return t.index});s.exit().remove(),s.enter().append("text").attr("class","binbreak").attr("y",r+10).attr("dy",this.textOffsets.hanging).style("font-size","12px").style("text-anchor","middle").style("pointer-events","none").style("-webkit-user-select","none").merge(s).attr("x",function(t){return a(t.value)}).text(function(t){return t.text}).each(function(){var t=d3.select(this);if(n)t.style("fill","grey");else{t.style("fill","red"),function e(){t.transition().duration(500).style("fill","gray").transition().duration(500).style("fill","red").on("end",e)}()}}),e.clearBreakValues=function(){e.demoGroup.selectAll("text.binbreak").remove()},e.setTimerInfo({cleanup:function(){e.demoGroup.selectAll("text.binbreak").interrupt().style("fill","gray")}})},drawCommandList:function(t,e){var n=this,r=this.commandListOrigin,a="rgb(0, 100, 0)",i=this.transformString,l=n.commandList.slice(0,Math.max(t,n.maximumScrolledIndex)+1),s=l.map(function(t,e){return{command:t.command,replayable:t.replayable,index:e}});l.length<n.commandList.length&&s.push({command:"...(keep scrolling)",replayable:!1,clickable:!1,index:l.length});var o=n.commandGroup.selectAll("g.command").data(s,function(t){return t.index+t.command});o.exit().remove(),o.enter().append("g").attr("class","command").attr("transform",function(t,e){return i(0,20*e)}).each(function(t,e){var r=d3.select(this),i=r.append("text").attr("x",0).attr("y",10).attr("dy",n.textOffsets.middle).style("font-size","13px").style("font-weight",600).style("fill",a).style("fill-opacity",.4).style("text-anchor","start").style("pointer-events","none").style("-webkit-user-select","none").text(t.command),l=i.node().getBBox().width;if(i.style("font-weight","normal"),i.node().nonBoldSpacing=(l-i.node().getBBox().width)/t.command.length,t.replayable){var s=l+6+8;r.append("circle").attr("class","replay").attr("cx",s).attr("cy",10).attr("r",8).style("fill","green").style("stroke","green").style("stroke-width",1).style("pointer-events","none"),r.append("path").attr("d",d3.symbol().type(d3.symbolTriangle).size(36)).attr("transform","translate("+s+" 10) rotate(90 0 0)").style("fill","white").style("stroke","green").style("stroke-width",1).style("pointer-events","none")}!1!==t.clickable&&r.append("rect").attr("x",0).attr("y",0).attr("width",l+(t.replayable?22:0)).attr("height",20).style("fill","none").style("pointer-events","all").style("cursor","pointer").on("click",function(t){n.jumpToStep(t.index)})}),n.commandGroup.selectAll("g.command").each(function(e,n){var r=n===t,i=n>t;d3.select(this).select(".replay").style("fill",r?"green":"white");var l=d3.select(this).select("text");l.text(function(t){return t.command}).interrupt().style("fill",r?"red":a).style("fill-opacity",i?.5:1).style("font-weight",r?600:"normal").attr("letter-spacing",r?"normal":l.node().nonBoldSpacing+"px"),r&&l.transition().duration(2e3).style("fill",a)}),n.commandGroup.raise(),e&&e();var c=this.lastScrolledIndex||0;this.drawHandPointer({x:r.x-4,y:r.y+20*(c+.5)+2})},drawColouredNumberLine:function(t){var e=this,n=!(!t||!t.instant),r=this.dataMin,a=this.dataMax,i=a-r,l=this.xScale,s=this.colourScale,o=this.plotOrigin.x,c=this.plotOrigin.y-this.fallAfterFlight+5,u=10,h=14,d=this.chartFixedCanvas.node().getContext("2d");x(r,"min");var f=0,p=40,v=1e3;function y(t){var e=Math.min(p,Math.round(t/v*p));e!==f&&(g(e),f===p&&x(a,"max"))}function x(t,e){d.font=h+"px Arial",d.fillStyle=s(t),d.textAlign="min"===e?"end":"start";var n=o+l(t)+("min"===e?-5:5);d.fillText(String(t),n,c+u)}function g(t){for(var e=f+1;e<=t;e++)m(e);f=t}function m(t){var e=i/p,n=s(r+(t-.5)*e,1),a=Math.floor(l(r+(t-1)*e));1===t&&a--;var h=Math.floor(l(r+t*e))-a;h++,d.fillStyle=n,d.beginPath(),d.rect(o+a,c,h,u),d.fill()}n?(g(p),x(a,"max")):this.startTimer({tick:function(t){y(t),f===p&&e.stopTimer(!1)},forceToEnd:function(){return y(v)}})},drawCyclingScenarios:function(t){var e,n,r=this,a=this.scenarioRecords.length,i=400,l=750,s=!1,o=!0,c=!1,u=null,h=150,d=20,f={x:this.commandListOrigin.x-this.plotOrigin.x,y:this.buttonRowOrigin.y-this.plotOrigin.y},p={x:f.x,y:f.y+d+10},v=this.fallIntoBins,y=this.demoGroup.append("g").attr("class","scenariocontrol");y.append("rect").attr("id","scenarioSwitcher").attr("x",f.x).attr("y",f.y).attr("width",h).attr("height",d).style("stroke","green").style("fill-opacity",1e-6).style("cursor","crosshair").on("mouseover",function(){c||(o=!1,M())}).on("mousemove",function(){if(!c){var t=d3.mouse(this.parentNode)[0]-f.x,n=Math.max(0,Math.min(Math.floor(a*t/h),a-1));n!==e&&w(n,!0)}}).on("mouseout",function(){c||(o=!0,g(0))});var x=null;function g(t){function r(){!c&&o&&(0===e?n=1:e===a-1&&(n=-1),w(e+n,!1))}x&&clearTimeout(x),x=null,t?x=setTimeout(r,t):r()}function m(e){y.selectAll("text.scenarioTitle").data([0]).enter().append("text").attr("class","scenarioTitle").attr("x",p.x).attr("y",p.y).attr("dy",r.textOffsets.hanging).style("font-size","14px");var n=y.select("text.scenarioTitle").selectAll("tspan").data(t(e));n.enter().append("tspan").style("fill","grey").style("-webkit-user-select","none").style("pointer-events","none").merge(n).each(function(t){var e=d3.select(this);e.interrupt(),t.highlightOnChange&&e.text()!==t.text&&e.style("fill","red").transition().duration(1e3).style("fill","grey")}).text(function(t){return t.text})}function b(t){var e=y.selectAll("text.scenarioNumber").data(lively.lang.arr.range(1,a));e.enter().append("text").attr("class","scenarioNumber").attr("x",function(t){return f.x+(t-.5)*h/a}).attr("y",f.y+d/2).attr("dy",r.textOffsets.middle).style("text-anchor","middle").style("font-size","16px").style("-webkit-user-select","none").style("pointer-events","none").merge(e).text(function(e){return e===t+1?"●":"○"});var n=y.selectAll("rect.scenarioHighlight").data([t]);n.enter().append("rect").attr("class","scenarioHighlight").attr("fill","lightgray").attr("width",h/a-2).attr("height",d-2).attr("y",f.y+1).merge(n).attr("x",function(t){return f.x+t*h/a+1}).lower()}function w(t,n){var a=d3.select(r.scenarioRecords[t].bins),h=[],d=a.selectAll("rect");d.each(function(t){var e=d3.select(this);h.push({binNum:t.binNum,x:+e.attr("x"),y:+e.attr("y"),width:+e.attr("width"),height:+e.attr("height"),indices:t.indices})});var f=d.nodes()[0],p=h[0].y+h[0].height,v=[],y=a.selectAll("text");y.each(function(t,e){var n=d3.select(this);v.push({text:n.text(),x:+n.attr("x"),index:e})});var x=y.nodes()[0],w=[],M=a.selectAll("line");M.each(function(t,e){var n=d3.select(this);w.push({x:+n.attr("x1"),index:e})});var A=M.nodes()[0];s=!0;var I=d3.transition().duration(n?0:i),S=u.selectAll("rect.movingclone"),O=d3.select(S.nodes()[0]),G=d3.select(S.nodes()[S.size()-1]),C=+O.attr("x"),z=+O.attr("width"),E=+G.attr("x")+Number(G.attr("width")),T=+h[0].x,L=+h[0].width,D=T+L*h.length,N=u.selectAll("rect.movingclone").data(h,function(t){return t.binNum});N.exit().attr("class","defunctclone").transition(I).on("start.defunctrect",function(){d3.select(this).style("stroke-opacity",1e-6).style("fill-opacity",.15)}).attr("x",function(t){return T+t.binNum*L}).attr("y",p).attr("height",0).style("opacity",1e-6).style("stroke-opacity",1e-6).remove(),N.enter().append(function(t){var e=f.cloneNode();return d3.select(e).datum(t),e}).attr("class","movingclone").style("opacity",1e-6).style("stroke-opacity",1e-6).attr("x",function(t){return C+t.binNum*z}).attr("y",function(t){return t.y+t.height}).attr("width",function(t){return t.width}).attr("height",0),u.selectAll("rect.movingclone").each(function(t){var e=d3.select(this);t.preY=+e.attr("y"),t.preHeight=+e.attr("height")}),u.selectAll("rect.movingclone").transition(I).on("start.rect",function(t){d3.select(this).style("stroke-opacity",1e-6).attr("y",function(t){return t.preY-1}).attr("height",function(t){return t.preHeight+1})}).attr("x",function(t){return t.x}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height+2}).attr("y",function(t){return t.y-2}).style("opacity",1).transition().duration(n?0:200).attr("y",function(t){return t.y}).attr("height",function(t){return t.height}).style("stroke-opacity",1);var B=u.selectAll("text.movingclone").data(v,function(t){return t.index});B.exit().attr("class","defunctclone").transition(I).attr("x",function(t){return T+t.index*L}).style("opacity",1e-6).remove(),B.enter().append(function(t){var e=x.cloneNode(!0);return d3.select(e).datum(t),e}).attr("class","movingclone").style("opacity",1e-6).attr("x",function(t){return C+t.index*z}).text("-"),u.selectAll("text.movingclone").transition(I).attr("x",function(t){return t.x}).style("opacity",1).on("end.text",function(t){d3.select(this).text(t.text)});var V=u.selectAll("line.movingclone").data(w,function(t){return t.index});V.exit().attr("class","defunctclone").transition(I).attr("x1",function(t){return T+t.index*L}).attr("x2",function(t){return T+t.index*L}).style("opacity",1e-6).remove(),V.enter().append(function(t){var e=A.cloneNode();return d3.select(e).datum(t),e}).attr("class","movingclone").style("opacity",1e-6).attr("x1",function(t){return C+t.index*z}).attr("x2",function(t){return C+t.index*z}),u.selectAll("line.movingclone").transition(I).attr("x1",function(t){return t.x}).attr("x2",function(t){return t.x}).style("opacity",1);var F=u.selectAll("line.base").data([0]);F.enter().append("line").attr("class","base").attr("y1",p).attr("y2",p).style("stroke-width",.5).style("stroke","grey").merge(F).attr("x1",C).attr("x2",E).transition(I).attr("x1",T).attr("x2",D),I.on("end",function(){c||(s=!1,e=t,m(r.scenarioRecords[t].value),b(t),k(),o&&g(l))})}function M(){x&&clearTimeout(x),x=null,u&&(u.selectAll("*").interrupt(),u.selectAll(".defunctclone").remove())}(u=d3.select(r.duplicateObjects(r.scenarioRecords[0].bins,"rect,text,line"))).selectAll("*").attr("class","movingclone"),u.style("opacity",1),u.selectAll("text,line").style("opacity",1),u.selectAll("rect").style("fill","lightgray").style("fill-opacity",.5).style("stroke-opacity",1),this.demoGroup.selectAll("rect.demobin,line.binbreak,text.binbreak").style("opacity",0).style("cursor","default").on("mouseover",null).on("mouseout",null);var A=null;function k(){if(null!==A){var t=[],e=u.selectAll("rect").select(function(){var t=Number(this.getAttribute("x")),e=Number(this.getAttribute("width"));return A>=t&&A<=t+e?this:null});e.size()&&(t=e.datum().indices),r.highlightPathIndices(t),r.highlightValueIndices(t,!0)}}this.demoGroup.append("rect").attr("class","demobinMousetrap").attr("x",-100).attr("y",0).attr("width",this.numberLineWidth+200).attr("height",v).style("fill","none").style("pointer-events","all").style("cursor","crosshair").on("mousemove",function(){A=d3.mouse(this.parentNode)[0],s||k()}).on("mouseleave",function(){A=null,r.highlightPathIndices([]),r.highlightValueIndices([])}),e=0,n=1,m(r.scenarioRecords[e].value),b(e),r.setTimerInfo({cleanup:function(){c=!0,M(),r.demoGroup.selectAll("tspan").interrupt(),r.demoGroup.selectAll("g.scenariocontrol,rect.demoBinMousetrap,g.groupclone").remove(),r.scenarioRecords=[],u.remove(),r.demoGroup.selectAll("rect.demobin,line.binbreak,text.binbreak").style("opacity",1)}}),g(l)}};return chartObject.drawDataSelector=function(t){var e=!(!t||!t.instant),n=this.datasetsForSwitching;-1===n.indexOf(this.dataName)&&this.loadData(n[0]),this.datasetsAvailable=Math.min(this.datasetsAvailable,n.length);var r=this,a=this.chartGroup,i=this.transformString,l=this.buttonRowOrigin.y+17.5,s=this.dataLabelColour,o=this.buttonRowOrigin.x,c=o+25;function u(t){return Object.keys(r.datasetShortDescriptions).find(function(e){return e.toLowerCase()===t})}var h=u(this.dataName),d=a.selectAll("text.datadesc").data([{x:o-5,anchor:"end",colour:"black",text:"dataset:"},{x:o,anchor:"start",colour:this.dataLabelColour,text:h+"—"+this.datasetShortDescriptions[h].replace(/\<br\/\>/m," ")}]);d.enter().append("text").attr("class","datadesc").attr("y",l+17.5+10).attr("dy",r.textOffsets.hanging).style("font-size","16px").style("pointer-events","none").style("-webkit-user-select","none").merge(d).attr("x",function(t){return t.x}).style("text-anchor",function(t){return t.anchor}).style("fill",function(t){return t.colour}).text(function(t){return t.text});var f=n.slice(0,this.datasetsAvailable).map(function(t){return{dataName:t,readableName:u(t)}}),p=a.selectAll("g.dataswitch").data(f,function(t){return t.dataName});function v(){d3.select("div.vistooltip").transition().duration(500).style("opacity",0)}function y(){var t=r.datasetsAvailable>1;a.selectAll("g.dataswitch rect").style("cursor",t?"pointer":"default").style("stroke-opacity",function(e){return t&&e.dataName===r.dataName?1:0})}p.exit().remove(),p.enter().append("g").attr("class","dataswitch").attr("transform",function(t,e){return i(c+80*e,l)}).style("opacity",1e-6).each(function(t,e){var n=d3.select(this);n.append("rect").attr("x",-25).attr("y",-17.5).attr("width",50).attr("height",35).style("fill","#e6830f").style("fill-opacity",.2).style("stroke",s).style("stroke-width",2).style("stroke-opacity",0).on("click",function(t){r.datasetsAvailable>1&&(v(),r.switchDataset(t.dataName))}).on("mouseover",function(t){!function(t,e){var n=t.getBoundingClientRect(),r=d3.select("div.vistooltip");r.html(e);var a=Number.parseInt(r.style("width"))+16,i=Number.parseInt(r.style("height"))+16;r.style("left",n.left+n.width/2-a/2+"px").style("top",n.top-i-1+"px"),r.transition().duration(200).style("opacity",1)}(this,"<b>"+t.readableName+"</b><br/>"+r.datasetShortDescriptions[t.readableName])}).on("mouseout",v),n.append("image").attr("width",35).attr("height",35).attr("xlink:href",function(t){return"data:image/svg+xml;base64,"+window.btoa(r.svgSource(t.dataName))}).attr("x",-17.5).attr("y",-12.5).style("pointer-events","none")}),y(),a.selectAll("g.dataswitch").transition().duration(e?0:1e3).style("opacity",1),r.privateSwitchDataset=function(t){var e=this;this.loadData(t,function(){y(),e.replaySteps()})}},chartObject.drawDataUnits=function(){var t=this.chartGroup,e=this.plotOrigin,n=e.x+this.valueListOrigin.x+10,r=e.y-this.fallAfterFlight+9,a=t.selectAll("text.dataunits").data([{x:n-5,anchor:"end",colour:"black",text:"unit:"},{x:n,anchor:"start",colour:this.dataLabelColour,text:this.dataUnits}]);a.enter().append("text").attr("class","dataunits").attr("y",r).attr("dy",this.textOffsets.middle).style("font-size","14px").style("pointer-events","none").style("-webkit-user-select","none").merge(a).attr("x",function(t){return t.x}).style("text-anchor",function(t){return t.anchor}).style("fill",function(t){return t.colour}).text(function(t){return t.text})},chartObject.drawDensityControl=function(t,e){var n=this;this.histOrigin;function r(t){d3.select(t).style("fill-opacity",n.useDensity?1:0)}this.histGroup.append("rect").attr("class","switch").attr("id","densitySwitch").attr("x",t.x).attr("y",t.y).attr("width",12).attr("height",12).style("border-width",1).style("stroke","#444").style("fill","#444").style("cursor","pointer").each(function(){r(this)}).on("click",function(t){n.useDensity=!n.useDensity,r(this),e()}),this.histGroup.append("text").attr("class","switchLabel").attr("x",t.x+12+8).attr("y",t.y+6).attr("dy",this.textOffsets.middle).style("font-size","14px").style("-webkit-user-select","none").style("fill","#444").text("plot as densities")},chartObject.drawFaderControl=function(t,e){var n=this.triangleSetting.x,r=this.triangleSetting.y,a=40,i=10,l=t.x,s=t.y-i,o=this.histGroup.append("g").attr("class","fader");function c(t){var e=l+a*t/100,n=o.selectAll("circle.faderKnob").data([0]);n.enter().append("circle").attr("class","faderKnob").attr("cy",s).attr("r",i).style("opacity",0).style("pointer-events","all").style("cursor","ew-resize").call(d3.drag().on("start",u).on("drag",h).on("end",d)).merge(n).attr("cx",e);var r=o.selectAll("path.fadeIndicator").data([{colour:"green",start:0,end:t*Math.PI*1.999/100,large:t<50?0:1},{colour:"blue",start:t*Math.PI*2/100,end:1.999*Math.PI,large:t<50?1:0}]);r.enter().append("path").attr("class","fadeIndicator").merge(r).attr("transform","translate("+e+","+s+")").attr("d",function(t){return"M0 0 L"+i*Math.sin(t.start)+" "+-i*Math.cos(t.start)+" A"+i+" "+i+" 0, "+t.large+", 1, "+i*Math.sin(t.end)+" "+-i*Math.cos(t.end)+" Z"}).style("stroke-width",0).style("fill",function(t){return t.colour}).style("opacity",.6).style("pointer-events","none")}function u(t){d3.select(this).raise().classed("active",!0)}function h(t){var n=d3.event.x-l;n<0?n=0:n>a&&(n=a);var r=Math.round(n/a*100),i=100-r;c(r),e(r,i)}function d(t){d3.select(this).classed("active",!1)}o.append("path").attr("d","M0 "+i+" A"+i+" "+i+" 0, 0, 1, 0 "+-i+" L"+a+" "+-i+" A"+i+" "+i+" 0, 0, 1, "+a+" "+i+" Z").attr("stroke","gray").attr("stroke-width",1).attr("fill","none").attr("transform","translate("+l+","+s+")"),c(n),e(n,r)},chartObject.drawHandPointer=function(t,e){var n,r,a=(n=t.x,r=t.y,"translate("+n+", "+r+") rotate("+45+")"),i=this.chartGroup.select("g.handpointer");if(i.empty())(i=this.chartGroup.append("g").attr("class","handpointer")).append("image").attr("xlink:href",this.pointerImageFlipped).attr("x",-26).attr("y",-2).attr("width",37).attr("height",39).style("pointer-events","none"),i.attr("transform",a),s();else{var l=i.attr("transform");l===a?s():i.transition().duration(400).attrTween("transform",function(){return d3.interpolateTransformSvg(l,a)}).on("end",s)}function s(){e&&e()}},chartObject.drawNumberLine=function(){this.dataGroup.selectAll(".numberline").remove(),this.dataGroup.append("line").attr("class","numberline").attr("x1",-50).attr("x2",this.numberLineWidth+50).attr("y1",0).attr("y2",0).style("stroke","grey").style("stroke-width",.5)},chartObject.drawRanges=function(t){var e=this.xScale,n=this.rangeGroup,r={char:"(",offset:-2},a={char:")",offset:-6.5},i={char:"[",offset:-3.5},l={char:"]",offset:-4.5};["primary","context"].forEach(function(s){for(var o=t[s],c=[],u=0;u<o.length;u++){var h=o[u];c.push(lively.lang.obj.merge({value:h.min,index:u},h.minOpen?r:i)),c.push(lively.lang.obj.merge({value:h.max,index:u},h.maxOpen?a:l))}var d="primary"===s?"blue":"grey",f="end"+s,p="primary"===s&&t.context.length?.2:1;(c=n.selectAll("text."+f).data(c,function(t,e){return e})).exit().remove(),c.enter().append("text").attr("class",f).style("font-family","Raleway").style("font-weight","300").style("font-size","32px").style("pointer-events","none").style("-webkit-user-select","none").merge(c).attr("x",function(t){return e(t.value)+t.offset}).attr("y",30).style("fill",d).style("opacity",p).text(function(t){return t.char})})},chartObject.drawRDefaultBinning=function(t){var e=t&&t.shiftProportion,n=t&&t.widthProportion;var r,a=this.data.values,i=this.dataMin,l=this.dataMax,s=this.dataBinQuantum,o=(r=this.data,Math.ceil(Math.log(r.length)/Math.log(2))+1),c=this.rPretty([i,l],o);if(void 0!==e){for(var u=c[1]-c[0],h=i+lively.lang.num.roundTo(u*e,s),d=(c[0],[]),f=h;f<l;)d.push(f),f=lively.lang.num.roundTo(f+u,s);d.push(f),c=d}if(void 0!==n){var p=c[1]-c[0],v=lively.lang.num.roundTo(p*n,s);for(d=[],f=c[0];f<l;)d.push(f),f=lively.lang.num.roundTo(f+v,s);d.push(f),c=d}function y(t){var e=0===t?function(t){return t>=c[0]&&t<=c[1]}:function(e){return e>c[t]&&e<=c[t+1]};return a.filter(e)}for(var x=[],g=0;g<c.length-1;g++)x.push({valueSet:y(g),left:c[g],right:c[g+1]});this.dropBallsIntoBins(x,t)},chartObject.drawSweepControl=function(t,e){this.histOrigin;var n=!1;function r(t){d3.select(t).style("fill-opacity",n?1:0)}this.histGroup.append("rect").attr("class","switch").attr("id","sweepSwitch").attr("x",t.x).attr("y",t.y).attr("width",12).attr("height",12).style("border-width",1).style("stroke","#444").style("fill","#444").style("cursor","pointer").each(function(){r(this)}).on("click",function(t){n=!n,r(this),e(n)}),this.histGroup.append("text").attr("class","switchLabel").attr("x",t.x+12+8).attr("y",t.y+6).attr("dy",this.textOffsets.middle).style("font-size","14px").style("pointer-events","none").style("-webkit-user-select","none").style("fill","#444").text("sweep bin offsets")},chartObject.drawValueList=function(t){var e=this,n=[];e.data.forEach(function(t){return n.push(t)});var r=n.length,a=t&&t.stage,i=this.plotOrigin,l=this.valueListHeight,s=i.x+this.valueListOrigin.x,o=i.y+this.valueListOrigin.y,c=this.valueListEntryHeight,u=c,h=this.valueListWidth,d=this.valueListFontSize,f=o,p=s+h,v=d3.scaleLinear().domain([0,r-1]).range([o,o+l]),y=this.colourScale,x=Math.floor(l/c),g=Math.max(.2,.8-(.8-.2)*r/x/4),m=this.chartGroup;m.selectAll(".focusGroup").remove(),m.selectAll(".listMousetrap").remove();var b=this.poolValueEntries;if(!b){b=[];var w=s-i.x-380,M=o-i.y+l/2+60,A=Math.sqrt(100*r),k=Math.PI;e.data.forEach(function(t,n){var r=Math.random(),a=1.1-r*r,l=2*k*Math.random(),o=k*(Math.random()-.5),c=w+a*A*Math.sin(l),u=M+a*A*Math.cos(l),f=s-i.x+h/2-c,p=v(n)-i.y+d/2-1-u;b.push({value:t,text:t.toFixed(e.dataDecimals),x:c,y:u,diffX:f,diffY:p,angle:o})}),this.poolValueEntries=b}var I=1e3,S=2e3,O=this.chartFixedCanvas.node().getContext("2d"),G=this.transformString,C=I+S;function z(t){e.clearFixedCanvas(),O.textAlign="start",b.forEach(function(e,n){var a=(t-n/r*S)/I;a<0?a=0:a>1&&(a=1);var l=i.x+e.x+a*e.diffX,s=i.y+e.y+a*e.diffY,o=e.angle*(1-a);O.fillStyle=y(e.value,a>0?1-a*(1-g):.7),O.save(),O.font=d+"px Arial",O.textAlign="center",O.translate(l,s),O.rotate(o),O.fillText(e.text,0,0),O.restore()})}function E(){var t=m.append("g").attr("class","focusGroup").attr("transform",G(p,f));m.append("rect").attr("class","listMousetrap").attr("x",s).attr("y",o-c/2).attr("width",h).attr("height",l+c).style("fill","none").style("pointer-events","all").style("cursor","crosshair").on("mousemove",function(){var t=d3.mouse(this.parentNode)[1]-o,n=Math.max(0,Math.min(r-10,Math.round(v.invert(t+o))-Math.floor(5))),a=Math.min(r-1,n+10-1),i=lively.lang.arr.range(n,a);e.highlightPathIndices&&e.highlightPathIndices(i),e.highlightValueIndices(i)}).on("mouseleave",function(){e.highlightPathIndices&&e.highlightPathIndices([]),e.highlightValueIndices([])}),e.highlightValueIndices=function(r,a){var i=[],s=[];if(r.length){var o=r[0],c=r[r.length-1];if(a){var p=n[r[0]],x=0;function g(t,n){var r=t.toFixed(e.dataDecimals);s.push({value:t,text:r,multiplier:1===n?null:" x "+n})}r.forEach(function(t){var e=n[t];e===p?x++:(g(p,x),x=1,p=e)}),g(p,x)}else s=r.map(function(t){return{value:n[t],text:n[t].toFixed(e.dataDecimals)}});var m=(s.length-1)*u,b=Math.max(0,Math.min(l-m,(v(o)+v(c))/2-f-m/2));i=[v(o)-f,v(c)-f]}var w=t.selectAll("text.focusItem").data(s);w.exit().remove(),w.enter().append("text").attr("class","focusItem").attr("x",4).attr("y",function(t,e){return b+u*e}).attr("dy",e.textOffsets.central).style("font-size",d+"px").style("-webkit-user-select","none").merge(w).attr("y",function(t,e){return b+u*e}).each(function(t){var n=d3.select(this);if(t.multiplier){n.text(""),n.attr("dy",e.textOffsets.central);var r=n.selectAll("tspan").data([t.text,t.multiplier]);r.exit().remove(),r.enter().append("tspan").style("font-size",function(t,e){return(0===e?d:d-1)+"px"}).style("fill",function(e,n){return 0===n?y(t.value,1):"grey"}).merge(r).text(String)}else n.selectAll("tspan").remove(),n.style("fill",function(t){return y(t.value,1)}).text(function(t){return t.text})});var M=t.selectAll("line.focusItem").data(i);M.exit().remove(),M.enter().append("line").attr("class","focusItem").attr("x1",-h).attr("x2",0).merge(M).attr("y1",function(t){return t}).attr("y2",function(t){return t}).style("stroke-width",1).style("stroke","black")}}void 0!==a?(z(a*C),1===a&&E()):this.startTimer({tick:function(t){z(t),t>I+S&&(e.stopTimer(!1),E())},forceToEnd:function(){z(C),E()}})},chartObject.dropBallsIntoBins=function(t,e){var n=this,r=!(!e||!e.instant),a=!(!e||!e.synchronised),i=!(!e||!e.showLines)||!r,l=!(e&&e.noScale);n.clearDemoBins=function(){n.chartGroup.selectAll("rect.demobin,line.binbreak,text.binbreak,text.democounter,circle.movingBall,g.annotation,rect.demobinMousetrap,text.dataunits").interrupt().remove()};var s=n.demoGroup,o=s.select("g.annotation");o.empty()&&(o=s.append("g").attr("class","annotation").attr("transform","translate(0,0)"));var c=n.dataGroup.selectAll("circle.settled,circle.dropped"),u=this.xScale,h=(this.plotOrigin,this.fallIntoBins),d=0+h,f=h-20,p=this.colourScale;function v(t){for(var e,n,r=t.length;0!==r;)n=Math.floor(Math.random()*r),e=t[r-=1],t[r]=t[n],t[n]=e}var y=[];t.forEach(function(e,n){y.push({value:e.left,index:n}),n===t.length-1&&y.push({value:e.right,index:n+1})});var x=s.selectAll("line.binbreak").data(y);x.exit().remove(),x.enter().append("line").attr("class","binbreak").attr("stroke-dasharray","2 6").attr("y1",0).attr("y2",d).style("stroke-width",1).style("stroke","grey").merge(x).attr("x1",function(t){return u(t.value)}).attr("x2",function(t){return u(t.value)}).style("opacity",i?1:0);var g=[],m=0;t.forEach(function(t,e){var r=t.valueSet,a=0;r.forEach(function(t){return a+=n.data.counts[String(t)]}),a>m&&(m=a);var i=c.filter(function(t){return r.indexOf(t.value)>=0});g.push({binNum:e,valueSet:r,balls:i,dropDelay:C,indices:[],totalCount:i.size(),left:t.left,right:t.right,colour:p((t.left+t.right)/2)})});var b=lively.lang.arr.range(0,g.length-1);function w(t){return 0===t?.01:f*t/m}v(b);var M=this.rPretty([0,m],5,!0),A=M[M.length-1],k=0,I=s.selectAll("rect.demobin").data(g,function(t){return t.binNum});I.exit().remove();var S=I.enter().append("rect").attr("class","demobin").style("cursor","crosshair").on("mouseover",function(t){n.highlightPathIndices&&n.highlightPathIndices(t.indices),n.highlightValueIndices&&n.highlightValueIndices(t.indices,!0)}).on("mouseleave",function(){n.highlightPathIndices&&n.highlightPathIndices([]),n.highlightValueIndices&&n.highlightValueIndices([])});if((I=I.merge(S)).attr("x",function(t){return u(t.left)}).attr("width",function(t){return u(t.right)-u(t.left)}).style("fill",function(t){return t.colour}).style("fill-opacity",1).style("stroke-width",.5).style("stroke","grey").style("stroke-opacity",1e-6),r)return c.call(T),void L();var O=s.selectAll("text.democounter").data(g,function(t){return t.binNum});O.exit().remove();var G=O.enter().append("text").attr("class","democounter").attr("y",d+8).attr("dy",this.textOffsets.hanging).style("fill","grey").style("font-size","11px").style("text-anchor","middle").style("pointer-events","none").style("-webkit-user-select","none");(O=O.merge(G)).attr("x",function(t){return u((t.left+t.right)/2)}),n.setTimerInfo({cleanup:function(){E=!0,n.dataGroup.selectAll("circle.movingBall").interrupt().remove(),s.selectAll("text.democounter").interrupt().remove()},forceToEnd:function(){c.call(T),L()}});var C=0,z=g.length,E=!1;function T(t){t.attr("class","dropped").style("fill","none").style("stroke-width",.5).style("stroke",function(t){return p(t.value,1)}).style("stroke-opacity",1)}function L(){I.each(function(t){var e=d3.select(this);E&&e.interrupt();var n=[];t.balls.each(function(t){return n.push(t.valueIndex)}),n.sort(d3.ascending),t.indices=n,e.attr("y",d-w(n.length)).attr("height",w(n.length)).style("fill","lightgray").style("fill-opacity",.5).style("stroke-opacity",1)}),N()}function D(t){if(l&&!(t<=k)){var e=d3.bisect(M,t),a=u(n.dataMax)+85,i=[{labelType:"title",x:a,anchor:"start",y:-w(Math.max(A,m))-15,text:"count"}],s=[{x:a,y:0,dx:-4,dy:0}];M.slice(0,e).forEach(function(t){i.push({labelType:"yAxis",x:a+4+3,y:-w(t),text:String(t)}),s.push({x:a,y:-w(t),dx:4,dy:0})}),n.drawBinAnnotations(o,{x:a,y:d},w(t),s,i,r),k=t}}function N(){D(Math.max(A,m)),r||s.selectAll("line.binbreak").transition().duration(1e3).style("opacity",1e-6)}b.forEach(function(t){var e=g[t],n=function(t){return d3.easePolyIn(t,2)};d3.transition().delay(a?0:C).on("start",function(){if(!E){var r=e.valueSet.slice();v(r),r.forEach(function(r,a){e.balls.filter(function(t){return t.value===r}).each(function(e,r){if(this.parentNode){var i=this.cloneNode();T(d3.select(this)),this.parentNode.appendChild(i);var l=d3.select(i),s=+l.attr("cy");l.datum(e).attr("class","movingBall").style("stroke","none").transition().delay(50*a+50*r).ease(n).duration(750).attr("cy",s+h-5).remove().on("end",function(e){return function(t,e){var n=g[t];n.indices.push(e);var r=I.nodes()[t],a=d3.select(r);a.attr("y",function(t){return d-w(t.indices.length)}).attr("height",function(t){return w(t.indices.length)});var i=O.nodes()[t],l=d3.select(i);l.style("opacity",1).text(String(n.indices.length));var s=n.indices.length;s>k&&D(s);s===n.totalCount&&(n.indices.sort(d3.ascending),a.transition().duration(1e3).style("fill","lightgray").style("fill-opacity",.5).style("stroke-opacity",1),l.transition().duration(1e3).style("opacity",1e-6).remove(),0==--z&&N())}(t,e.valueIndex)})}})})}}),C+=50*e.valueSet.length+200})},chartObject.duplicateBins=function(){var t=this.demoGroup.node(),e=this.duplicateObjects(t,"rect.demobin,line.binbreak,text.binbreak");return d3.select(e).style("opacity",1e-6),e},chartObject.duplicateObjects=function(t,e){var n=t.cloneNode();return t.parentNode.appendChild(n),d3.select(n).attr("class","groupclone"),d3.select(t).selectAll(e).each(function(t){var e=d3.select(this).attr("class"),r=this.cloneNode(!0);n.appendChild(r),d3.select(r).attr("class",e+"clone").style("pointer-events","none").datum(t)}),n},chartObject.estimateMaxBinDensity=function(){for(var t=this.data,e=0,n=t.length*this.dataRange/30,r=0;r<100;r+=10){var a=this.generateRanges(100/30,-r),i=this.binData(t,a),l=d3.max(i,function(t){return t.values.length})/n;l>e&&(e=l)}return e},chartObject.estimateMaxBinSize=function(t){for(var e=this.data,n=0,r=t||10,a=0;a<100;a+=10){var i=this.generateRanges(r,-a),l=this.binData(e,i),s=d3.max(l,function(t){return t.values.length});s>n&&(n=s)}return n},chartObject.flyBalls=function(t){var e=this,n=!(!t||!t.instant);this.clearDemoBalls=function(){this.dataGroup.selectAll("circle.settled,circle.dropped,line.numberline").interrupt().remove()},this.clearDemoBalls();var r=this.chartFixedCanvas.node().getContext("2d"),a=d3.max(lively.lang.obj.values(this.data.counts)),i=[];e.data.forEach(function(t){return i.push(t)});var l=i.length,s=2e3,o=1e3,c=4e3/Math.max(40,a),u=this.chartCanvas.node().getContext("2d"),h=this.xScale,d=this.plotOrigin,f=this.valueListHeight,p=this.valueListFontSize,v=d.x+this.valueListOrigin.x,y=d.y+this.valueListOrigin.y,x=this.fallAfterFlight,g=d.y-x,m=e.colourScale,b=d3.scaleLinear().domain([0,l-1]).range([y,y+f]),w=b(1)-b(0);r.lineWidth=.5;var M=0,A=[],k={};function I(t,e,n){if(e>t.y)return!1;t.x;var r=g-e,a=t.y-e,i=Math.acos(1-a/r);return v+n*Math.sin(i)<t.x}function S(t,e){var n=Math.PI;e.save(),e.beginPath(),e.translate(v,g),e.scale(v-Math.round(d.x+h(i[t])),g-b(t)),e.arc(0,0,1,-n/2,-n,!0),e.restore(),e.stroke()}e.data.valuesAndCountsDo(function(t,e){A.push(t);var n=m(t,1),r=1===e?n:m(t,.2),a=Math.round(d.x+h(t)),i=a-v,l=b(M);k[String(t)]={firstIndex:M,count:e,colour:n,pathColour:r,targetX:a,xDiff:i,firstOriginY:l},M+=e}),e.chartGroup.selectAll(".flightMousetrap").remove(),e.chartGroup.append("rect").attr("class","flightMousetrap").attr("x",d.x).attr("y",y).attr("width",v-d.x).attr("height",g-y).style("fill","none").style("pointer-events","all").style("cursor","crosshair").on("mousemove",function(){var t=d3.mouse(this.parentNode),n=lively.pt(t[0],t[1]);e.clearEphemeralCanvas(),u.lineWidth=1,u.strokeStyle="green";for(var r,a=!1,i=0;!a&&i<A.length;){I(n,(c=k[String(A[i])]).firstOriginY,c.xDiff)?i++:a=!0}var s=[];if(i>0){var o=i-1,c=k[String(A[o])];a=!1;for(var h=1;!a&&h<c.count;)I(n,c.firstOriginY+w*h,c.xDiff)?h++:a=!0;if(o!==A.length-1||a){var d=c.firstIndex+h-1;r=Math.max(0,Math.min(l-10,d-5));s=lively.lang.arr.range(r,r+10-1)}}e.highlightPathIndices(s),e.highlightValueIndices(s)}).on("mouseleave",function(){e.highlightPathIndices([]),e.highlightValueIndices([])}),e.highlightPathIndices=function(t){e.clearEphemeralCanvas(),u.lineWidth=1,u.strokeStyle="rgba(0, 0, 0, 0.5)",t.forEach(function(t){S(t,u)}),e.dataGroup.selectAll("circle.settled,circle.dropped").each(function(e){var n=t.indexOf(e.valueIndex)>=0,r=d3.select(this),a=r.attr("class");n&&r.raise(),r.style("stroke-opacity",n?0:1).style("fill",n?"black":"dropped"===a?"none":m(e.value))})};for(var O=[],G=[],C=Math.PI/2e3,z=0;z<1e3;z++)O.push(Math.sin(z*C)),G.push(Math.cos(z*C));var E=[];M=0;e.data.valuesAndCountsDo(function(t,e){var n=function(t){return s*t/l}(M),r=4e3-n,a=b(M),i=d.x+h(t);E.push({value:t,count:e,valueDelay:n,valueTFlight:r,allLanded:n+r+c*e+o,xTarget:i,xDiff:i-v,firstY:a,cumulativeIndex:M,lastSettled:-1}),M+=e});var T=[],L=this.dataMin-1,D=2,N=1.5,B=!1,V=1e5;function F(t){u.fillStyle="black";var a=2*Math.PI,i=[];E.forEach(function(l){if(u.fillStyle=m(l.value,1),t===V||t<l.allLanded){i.push(l);var s=t-l.valueDelay;if(s>0){var h=l.value,d=l.count,f=l.valueTFlight,y=l.xDiff,M=d<20,A=(l.cumulativeIndex,l.firstY),I=l.xTarget;L<h&&(!function(t){var a=r,i=k[String(t)],l=i.firstIndex,s=i.count;if(!n){var o=e.chartGroup.select("text.valueLabel");o.empty()&&(o=e.chartGroup.append("text").attr("class","valueLabel").attr("dy",e.textOffsets.central).style("font-size",p+"px").style("text-anchor","middle").attr("x",v+e.valueListWidth/2)),o.interrupt().datum(i).text(t.toFixed(e.dataDecimals)).style("fill",function(t){return t.colour}).style("opacity",1).attr("y",b(l+Math.floor((s-1)/2))).transition().delay(500).duration(1e3).style("opacity",1e-6).remove()}a.strokeStyle=m(t,1),a.lineWidth=.5;for(var c=0;c<s;c++)1===c&&(a.strokeStyle=m(t,.5)),S(l+c,a)}(h),L=h);var C=s/c|0;C>d-1&&(C=d-1);var z=(s-f)/c|0;z<0?z=0:z>d&&(z=d);var E=(s-f-o)/c|0;E<0?E=0:E>d&&(E=d);for(var T=s-c*z,B=z;B<=C;B++){var F=g-(A+w*B),H=T/f*1e3|0,R=v+y*O[H],P=g-F*G[H];u.beginPath(),M?u.arc(R,P,2,0,a):u.rect(R-2,P-2,4,4),u.fill(),T-=c}if(E===d)j(l,d-1);else{var W=s-f-c*E,Q=x/o,Y=Math.min(d-1,z);for(B=E;B<=Y;B++){if(W>0){var J=g+(Q*W+5e-4*W*W);J>=g+x-D*(1+2*N*B)?j(l,B):(u.beginPath(),u.arc(I,J,2,0,a),u.fill())}W-=c}}}}}),E=i,e.dataGroup.selectAll("circle.settled").data(T,function(t){return t.valueIndex}).enter().append("circle").attr("class","settled").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}).attr("r",D).style("fill",function(t){return m(t.value,1)}).style("pointer-events","none")}function j(t,n){if(B||(e.drawNumberLine(),B=!0),n>t.lastSettled){for(var r=t.xTarget,a=t.cumulativeIndex,i=++t.lastSettled;i<=n;i++)T.push({x:r-d.x,y:g+x-D*(1+2*N*i)-d.y,valueIndex:a+i,value:t.value});t.lastSettled=n}}n?F(V):this.startTimer({tick:function(t){e.clearEphemeralCanvas(),T.length===l?e.stopTimer(!1):F(t)},cleanup:function(){return e.clearEphemeralCanvas()},forceToEnd:function(){return F(V)}}),e.dataGroup.selectAll(".ballMousetrap").remove(),e.dataGroup.append("rect").attr("class","ballMousetrap").attr("x",-5).attr("y",5-x).attr("width",h(e.dataMax)-h(e.dataMin)+10).attr("height",x).style("fill","none").style("pointer-events","all").style("cursor","crosshair").on("mousemove",function(){var t=d3.mouse(this.parentNode)[0],n=h.invert(t),r=d3.scan(A,function(t,e){return Math.abs(t-n)-Math.abs(e-n)}),a=k[String(A[r])],i=lively.lang.arr.range(a.firstIndex,a.firstIndex+a.count-1);e.highlightPathIndices(i),e.highlightValueIndices(i,!0)}).on("mouseleave",function(){e.highlightPathIndices([]),e.highlightValueIndices([])})},chartObject.generateRanges=function(t,e){var n=this.dataMin,r=this.dataMax,a=r-n,i=a/1e3;function l(t,e){return Math.abs(t-e)<i?e:t}for(var s=[],o=t*a/100,c=e/100,u=0===c?n:l(n+(c-1)*o,n),h=!0;u<r;){var d=l(u+o,r);s.push({min:u,max:d,minOpen:!h,maxOpen:!1}),u=d,h=!1}return s},chartObject.hoverOver=function(t){var e=d3.select(t);if(0!==e.size()){var n=e.node().getBoundingClientRect(),r=this.chartSVG.node().getBoundingClientRect(),a=this.sizeRatio,i=(n.left-r.left)/a,l=(n.top-r.top)/a,s=n.width/a,o=n.height/a;this.chartSVG.select("rect.highlighter").remove(),this.chartSVG.append("rect").attr("class","highlighter").attr("x",i-4).attr("y",l-4).attr("width",s+8).attr("height",o+8).style("fill","none").style("pointer-events","none").style("stroke-width",2).style("stroke","red")}},chartObject.hoverOut=function(){this.chartSVG.select("rect.highlighter").remove()},chartObject.init=function(t){var e=this,n={};t.hasOwnProperty("noDensity")&&(n.noDensity=t.noDensity),this.initChartInElement(t.element,t.extent),this.initHistogramArea(),this.loadData(t.dataset,function(){return e.buildTable(t.definitions,n)})},chartObject.initBinBehaviour=function(){var t=this,e=t.binsAreDraggable;this.histGroup.selectAll("*").remove();var n=!1;this.histGroup.append("g").attr("class","binGroup").call(function(t){e&&d3.drag().on("start",b).on("drag",w).on("end",M)(t)}).on("mouseenter",function(){n=!0}).on("mousemove",function(){if(n=!0,!t.isDragging){var e=i(t.xScale.invert(d3.mouse(this)[0]));t.scheduleEvent("probe",0,function(){t.refreshTable({dataFocusIndex:e,binHighlight:e},0)})}}).on("mouseleave",function(){n=!1,t.isDragging||t.scheduleEvent("probe",200,function(){t.refreshTable({binHighlight:null},0)})});var r=null;function a(e,n){if(void 0===n&&(n=null),null!==e){var a=null===n?"primary":"context";!function(e,n){if(e===r)return;r&&m();if(null===e)return;r=e;var a,i,l="context"===n,s=l?y:v,o=d3.color(s.darker()),c=d3.select(e);c.style("fill",o.toString()).raise();var u=e.__data__;a=u.dataIndex,i=u.values.collection,t.dataGroup.selectAll("circle.ball").each(function(t){if(i.indexOf(t.value)>=0){var e=d3.select(this);e.raise().style("fill",s).style("stroke",s)}}),s=l?g:x,t.chartGroup.selectAll("text.dataTextCell").each(function(t){t.isContext===l&&t.dataIndex===a&&d3.select(this).interrupt().style("fill",s)});t.histGroup.selectAll("g.binDescriptor").remove();var h=t.histGroup.append("g").attr("class","binDescriptor").attr("transform","translate("+(Number(c.attr("x"))+Number(c.attr("width"))/2)+","+(Number(c.attr("y"))+Number(c.attr("height"))+6+6)+")"),d=[String(u.min),u.minOpen?"<":"≤","x",u.maxOpen?"<":"≤",String(u.max),"("+u.values.length+")"].join(" "),f=h.append("text").attr("x",0).attr("y",0).attr("dy",t.textOffsets.central).style("fill","blue").style("pointer-events","none").style("text-anchor","middle").style("font-size","12px").text(d),p=f.node().getComputedTextLength();h.append("rect").attr("width",p+12).attr("height",23).attr("x",-p/2-6).attr("y",-11).style("fill",t.chartSVG.style("background-color")).style("opacity",1);f.raise()}(l(a,function(t){return(null===n||n===t.scenario)&&t.dataIndex===e}),a)}else m()}function i(t,e){if(void 0===e&&(e=null),null===t)return null;var n=l(null===e?"primary":"context",function(n,r){return(null===e||e===n.scenario)&&n.min<t&&n.max>t});return n?n.__data__.dataIndex:null}function l(e,n){var r=null;return t.histGroup.selectAll("rect."+e).each(function(t,e){!r&&n(t,e)&&(r=this)}),r}t.highlightBinNumber=a;var s,o,c,u,h,d,f=this.contextBinFill,p=.15,v=d3.hcl(274,100,75),y=d3.hcl(73,100,75),x=v.darker(),g=y;function m(){t.histGroup.selectAll("g.binDescriptor").remove();var e={};t.histGroup.selectAll("rect.primary").each(function(n,r){n.dataIndex+t.stripeOffset&1&&n.values.collection.forEach(function(t){return e[String(t)]=!0})});var n=d3.transition().duration(250);t.dataGroup.selectAll("circle.ball").each(function(t){var r=d3.select(this);r.style("fill","black").style("stroke","black");var a=e[String(t.value)]?1:0;this.hasOwnProperty("oddEven")&&this.oddEven!==a&&(this.originalY||(this.originalY=+r.attr("cy")),r.attr("cy",this.originalY-4).transition(n).attr("cy",this.originalY)),this.oddEven=a});var a=t.histGroup.selectAll("rect.primary"),i=t.histGroup.selectAll("rect.context");if(i.empty())a.style("fill",t.restingBinFill);else{var l=d3.color(f);l.opacity=p,i.style("fill",l.toString()),a.style("fill","none")}null!==r&&t.chartGroup.selectAll("text.dataTextCell").style("fill","black"),r=null}function b(e){t.isDragging=!0,o=d3.min(t.chartGroup.selectAll("rect.primary").nodes(),function(t){return t.__data__.min});var n=t.chartGroup.selectAll("rect.primary").nodes()[0];c=n.__data__.max-n.__data__.min,t.dragPoint=s=t.xScale.invert(d3.mouse(this)[0]);var r=(t.dragPoint-o)/c;u=(.5-(r-Math.floor(r)))*c,h=Math.floor((s+u-o)/c)}function w(e,n){if(t.dragPoint=t.xScale.invert(d3.mouse(this)[0]),!(t.dragPoint<=t.dataMin-1.5*c||t.dragPoint>=t.dataMax+1.5*c)){var r=o+t.dragPoint-s,i=r-c*(1+Math.floor((r-t.dataMin)/c)),l=t.findClosestResult("lefts[0]",i,"offset");if(null!==l)h!==(h=Math.floor((t.dragPoint+u-(t.dataMin+l*c))/c))&&(t.stripeOffset=1-t.stripeOffset);t.refreshTable({dataFocusIndex:h,force:null!==l,binHighlight:null},0),a(h)}}function M(e){if(t.isDragging=!1,n){t.refreshTable({force:!0,binHighlight:null},0);var r=i(t.xScale.invert(d3.mouse(this)[0]));t.refreshTable({dataFocusIndex:r,binHighlight:r},0)}else t.refreshTable({force:!0,binHighlight:null},0)}t.resetBinHighlight=m,t.isDragging=!1,t.recordBinState=function(e){e=e||"primary",d=[],t.histGroup.selectAll("rect."+e).each(function(){var t=d3.select(this);"context"===e&&0==+t.style("stroke-opacity")||d.push({left:+t.attr("x"),width:+t.attr("width"),y:+t.attr("y"),height:+t.attr("height"),stroke:t.style("stroke")})}),d.sort(function(t,e){return t.left-e.left})},t.highlightBinDifferences=function(e,n){if(!d||0===d.length)return;e=e||"primary";d[0].y,d[0].height;var r=t.histGroup.append("g").attr("class","phosphor");r.lower();var a=!1;if(t.histGroup.selectAll("rect."+e).each(function(){var t=d3.select(this);if("context"!==e||0!=+t.style("stroke-opacity")){var n=+t.attr("x"),r=+t.attr("width"),i=+t.attr("y"),l=(t.attr("height"),n+r/2),s=d.find(function(t){return t.left<=l&&t.left+t.width>=l});s&&s.left===n&&s.width===r&&s.y===i||(a=!0)}}),a){r.selectAll("rect").data(d).enter().append("rect").attr("x",function(t){return t.left}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height}).style("fill","lightgrey").style("fill-opacity",.5).style("pointer-events","none").transition().delay(1e3).duration(1e3).ease(d3.easeLinear).style("fill-opacity",1e-6).remove()}d=null}},chartObject.initChartSubgroups=function(){this.stopTimer(),this.chartGroup.selectAll("*").remove(),this.dataLabelColour="chocolate";var t=this.commandListOrigin=lively.pt(45,10);this.buttonRowOrigin=lively.pt(290,this.visMaxExtent.y-70);var e=this.plotOrigin=lively.pt(185,this.visMaxExtent.y-210);this.numberLineWidth=550,this.fallAfterFlight=115,this.fallIntoBins=100;var n=this.valueListHeight=310;this.valueListOrigin=lively.pt(620,-n-60-this.fallAfterFlight),this.valueListWidth=40,this.valueListFontSize=12,this.valueListEntryHeight=15;var r=this.dataOrigin=lively.pt(270,110),a=this.histOrigin=lively.pt(270,265),i=this.tableOrigin=lively.pt(10,305);this.maxMainBinHeight=90;var l=d3.color("blue");l.opacity=.8,this.restingBinFill=l.toString(),this.contextBinFill=d3.color("darkgreen"),this.nakedHistOrigin=lively.pt(200,400);var s=this.transformString;this.commandGroup=this.chartGroup.append("g").attr("transform",s(t.x,t.y)),this.demoGroup=this.chartGroup.append("g").attr("transform",s(e.x,e.y)),this.histGroup=this.chartGroup.append("g").attr("transform",s(a.x,a.y)),this.dataGroup=this.chartGroup.append("g").attr("transform",s(e.x,e.y)),this.resetDataGroup=function(){this.dataGroup.attr("transform",s(e.x,e.y))},this.rangeGroup=this.chartGroup.append("g").attr("transform",s(r.x,r.y)),this.tableGroup=this.chartGroup.append("g").attr("transform",s(i.x,i.y)),this.clearFixedCanvas(),this.clearEphemeralCanvas()},chartObject.initChartSubstrates=function(t,e){var n=e.x,r=e.y,a=this.transformString=function(t,e){return"translate("+t+", "+e+")"};this.textOffsets={hanging:"0.75em",central:"0.4em",middle:"0.35em"},this.chartSVG=t.append("svg").attr("tabindex",-1).attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xlink","http://www.w3.org/1999/xlink").style("background-color","rgb(255,248,230)").attr("width",n).attr("height",e.y).attr("viewBox","0 0 "+e.x+" "+e.y),this.chartGroup=this.chartSVG.append("g").attr("transform",a(0,0)),this.chartFixedCanvas=t.append("canvas");this.chartFixedCanvas.node().getContext("2d");function i(t){t.node().getContext("2d").clearRect(0,0,n,r)}this.chartFixedCanvas.attr("class","fixed").attr("width",n).attr("height",r).style("position","absolute").style("left","0px").style("top","0px").style("pointer-events","none"),this.chartCanvas=t.append("canvas").attr("class","ephemeral").attr("width",n).attr("height",r).style("position","absolute").style("left","0px").style("top","0px").style("pointer-events","none"),this.clearEphemeralCanvas=function(){i(this.chartCanvas)},this.clearFixedCanvas=function(){i(this.chartFixedCanvas)},this.clearMousetraps=function(t){var e=this;t.forEach(function(t){return e.chartGroup.selectAll("."+t+"Mousetrap").remove()})},this.initChartSubgroups(),d3.selectAll("div.vistooltip").remove(),d3.select("body").append("div").attr("class","vistooltip").style("opacity",0)},chartObject.initHistogramArea=function(t){var e=this,n=!(!t||!t.instant);e.clearDataRanges=function(){e.rangeGroup.selectAll("text").remove()},e.clearDataBalls=function(){e.dataGroup.selectAll("circle.ball").remove()},e.clearDataRanges(),e.clearDataBalls(),this.stripeOffset=0;var r=this.transformString,a=this.colourScale,i=this.dataGroup,l=(i.node(),this.dataOrigin),s=i.attr("transform"),o=r(l.x,l.y);s===o&&(n=!0);var c=d3.easeQuadInOut,u=d3.interpolateTransformSvg(s,o),h=function(t){return u(c(t))},d=this.tableGroup;d.style("opacity",1e-6);var f=this.histGroup;f.style("opacity",1e-6),this.drawNumberLine(),this.drawBalls(this.data);var p=i.selectAll("circle.ball");p.style("opacity",1e-6);var v=i.selectAll("circle.settled,circle.dropped");v.style("fill",function(t){return a(t.value,1)});var y=1e3,x=1e3,g=y+x;function m(t){var e=Math.min(1,t/y);if(i.attr("transform",h(e)),t>y){var n=Math.min(1,(t-y)/x);d.style("opacity",n),p.style("opacity",n),f.style("opacity",n),v.style("opacity",1-n)}}n?m(g):this.startTimer({tick:function(t){m(t),t>=g&&e.stopTimer(!1)},forceToEnd:function(){return m(g)}}),this.initBinBehaviour()},chartObject.initNakedHistogram=function(t){var e=this,n=!(!t||!t.instant);e.rangeGroup.selectAll("text").remove(),e.dataGroup.selectAll("circle.ball,line.numberline").remove();var r=this.transformString,a=this.histGroup,i=(a.node(),this.nakedHistOrigin),l=a.attr("transform"),s=r(i.x,i.y),o=d3.easeQuadInOut,c=d3.interpolateTransformSvg(l,s),u=function(t){return c(o(t))};this.tableGroup.style("opacity",0);var h=750,d=h;function f(t){var e=Math.min(1,t/h);a.attr("transform",u(e))}n?f(d):this.startTimer({tick:function(t){f(t),t>=d&&e.stopTimer(!1)},forceToEnd:function(){return f(d)}}),this.primaryOpacity=.5,this.initBinBehaviour()},chartObject.initScrolliness=function(t){var e=this;var n=t.stepDefinitions;e.commandList=n.map(function(t){return{command:t.command,replayable:!!t.replayable}}),e.visMaxExtent=t.visExtent;var r=d3.select("#"+t.element),a=function(t,n,r){var a,i=t.map(function(t){return t.activate}),l=t.map(function(t){return t.update}),s=-1,o=0;var c=function(t,e,r){a=e,t.style("width",r.x+"px").style("height",r.y+"px"),a[n].call(a,t,r)};return c.activate=function(n,l){var c=l&&l.replay;if(n!==s||c){var u,h=s,d=h;(n<=s||-1===s)&&(a[r].call(a),d=function(e){for(var n=e;n>0&&!t[n].replayPoint;)n--;return n}(n)-1,s=null),(u=d===n?[n]:d3.range(d+1,n+1))[0];var f=u[u.length-1],p=s;u.forEach(function(t){var n=i[t];n&&(n(e,h,p,f,t),p=t)}),s=o=n}},c.update=function(t,n){var r=l[t];r&&r(e,n)},c.activeIndex=function(){return o},c.resetLastIndex=function(){s=-1},c}(n,"initChartSubstrates","initChartSubgroups");a(r,e,t.visExtent);var i=function(){var t,e,n,r,a,i,l=d3.select("body"),s=d3.dispatch("active","progress","size"),o=null,c=[],u=-1,h=d3.select("nav").node().getBoundingClientRect().height,d=h+50,f=200+h,p=10+h,v=10,y=null;function x(t,e){o=t,y=e,t.style("opacity",function(t,e){return 0===e?1:.1}),d3.select(window).on("scroll.scroller",E).on("resize.scroller",m);var n=d3.timer(function(){g(),n.stop()})}function g(){var u=d3.select("#scrolly").node().getBoundingClientRect().width;d3.select("#sections").style("padding-left","0px");var h=r.x/r.y,f=Math.max(n.x,h*n.y),p=u-a,x=h*(window.innerHeight-d),g=Math.max(f,Math.min(r.x,Math.min(p,x))),m=g/h,w=Math.max(a,Math.min(i,u-g));w|=0,d3.select("#sections").style("width",w-v+"px"),g|=0,m|=0,y.style("width",g+"px").style("height",m+"px");var M=Math.max(0,Math.floor((u-g-w)/2));d3.select("#sections").style("padding-left",M+"px"),y.style("padding-right",M+"px"),s.call("size",this,{x:g,y:m});var A=o.nodes()[o.size()-1];d3.select(A).style("padding-bottom","0px").style("margin-bottom","50px"),setTimeout(function(){var n;c=[],o.each(function(t,e){var r=this.getBoundingClientRect().top;0===e&&(n=r),c.push(r-n)});var r=l.node().getBoundingClientRect();t=r.top+window.pageYOffset,e=r.height-m,b()},250)}var m=lively.lang.fun.debounce(500,g);function b(){if(t){var n=window.pageYOffset-t,r=n<-p?"before":n>e-p?"after":"during",a="during"===r;y.style("position",a?"fixed":null).style("float",a?null:"right").style("top",a?p+"px":null).style("left",a?d3.select("#sections").node().getBoundingClientRect().right+v+1+"px":null).style("padding-top",a?null:"before"===r?"0px":e+"px");var i=Math.max(0,d3.bisect(c,n+f)-1);u!==i&&(s.call("active",this,i),u=i);var l=c[i],o=i<c.length-1?c[i+1]-l:1/0,h=n+f-l;h>0&&s.call("progress",this,u,h/o)}}var w,M,A,k,I,S,O,G,C,z,E=(w=b,M=100,z=lively.lang.fun.debounce(M,function(){O=S=!1}),function(){A=this,k=arguments;var t=function(){I=C=null,O&&w.apply(A,k),z()};return I||(C=Date.now(),I=setTimeout(t,M)),S?(O=!0,C&&Date.now()-C>M&&(clearTimeout(I),t())):G=w.apply(A,k),z(),S=!0,G});return x.container=function(t){return 0===arguments.length?l:(l=t,x)},x.on=function(t,e){s.on(t,e)},x.setVisExtents=function(t){return n=t.visMinExtent,r=t.visExtent,a=t.textMinWidth,i=t.textMaxWidth,x},x.resetLastIndex=function(){u=-1},x.sectionTop=function(t){return window.scrollY+o.nodes()[0].getBoundingClientRect().top+c[t]-p},x}().container(d3.select("#scrolly")).setVisExtents(t);e.maximumScrolledIndex=-1,e.activateStep=function(t){a.activate(t,{replay:!0}),e.drawCommandList(t)},e.jumpToStep=function(t){var n=a.activeIndex(),r=i.sectionTop(t);window.scrollTo(0,r),t===n&&(a.activate(t,{replay:!0}),e.drawCommandList(t))},e.replaySteps=function(){var t=a.activeIndex();a.activate(t,{replay:!0}),e.drawCommandList(t)},i.on("size",function(t){e.stopTimer(),e.resizeChartSubstrates(r,t),i.resetLastIndex(),a.resetLastIndex()}),i.on("active",function(t){d3.selectAll(".step").style("opacity",function(e,n){return n===t?1:.1}),e.lastScrolledIndex=t,t>e.maximumScrolledIndex&&(e.maximumScrolledIndex=t),a.activate(t),e.drawCommandList(t)}),i.on("progress",function(t,e){a.update(t,e)}),i(d3.selectAll(".step"),r),e.loadData(t.dataset)},chartObject.iterate=function(t,e){var n=this;t.forEach(function(t){e(t),n.scenarioRecords.push({value:t,bins:n.duplicateBins()})})},chartObject.loadData=function(t,e){var n,r=[],a=1,i="",l=8,s=50;this.datasetShortDescriptions={MPG:"fuel consumption (in mpg)<br/>for 32 car models",NBA:"age (in years)<br/>for 105 NBA athletes",Geyser:"272 records of delay (in seconds)<br/>between eruptions of Old Faithful",Diamonds:"price (in US$)<br/>for 1000 diamonds",Marathons:"finishing time (in hours)<br/>for 3000 NY marathon runners"};var o=this;function c(){o.dataName=t,o.dataUnits=i,o.dataMin=lively.lang.num.roundTo(d3.min(r),a),o.dataMax=lively.lang.num.roundTo(d3.max(r),a),o.dataRange=o.dataMax-o.dataMin,o.xScale=d3.scaleLinear().domain([o.dataMin,o.dataMax]).range([0,o.numberLineWidth]),o.dataQuantum=a,o.dataBinQuantum=n||a,o.dataDecimals=a>=1?0:a>=.1?1:2,o.dataBinDecimals=o.dataBinQuantum>=1?0:a>=.1?1:2,delete o.poolValueEntries,o.minBinsOverRange=l,o.maxBinsOverRange=s,o.scenarioRecords=[];var c=[],u={};r.forEach(function(t){var e=u[t];void 0===e&&(c.push(t),e=0),u[t]=++e});var h={values:c.sort(function(t,e){return t-e}),counts:u,length:r.length,filter:function(t){var e=this,n={};n.collection=null===t?this.values:this.values.filter(t);var r=0;return n.collection.forEach(function(t){return r+=e.counts[t]}),n.length=r,n.toString=function(){return"{"+this.length+"}"},n.forEach=function(t){var e=0;this.collection.forEach(function(n){for(var r=h.counts[n],a=0;a<r;a++)t(n,e+a);e+=r})},n},valuesAndCountsDo:function(t){var e=this;this.values.forEach(function(n){return t(n,e.counts[n])})}};h.allData=h.filter(null),h.forEach=function(t){this.allData.forEach(t)},o.data=h;var d=d3.scaleLinear().domain([o.dataMin,o.dataMax]),f=d3.interpolateHcl("#5086FE","#FD2EA7");o.colourScale=function(t,e){var n=d3.color(f(d(t)));return n.opacity=e,n.toString()},e&&e()}switch(t){case"marathons":return void d3.csv("data/sampled-marathon-times.csv",function(t){return Number(t.x)},function(t){r=t,a=.001,n=.02,l=15,s=150,i="hours",c()});case"diamonds":return void d3.csv("data/sampled-diamonds-price-small.csv",function(t){return Number(t.x)},function(t){r=t,a=1,n=5,l=15,s=45,i="US$",c()});case"nba":r=[28,30,26,30,28,31,30,27,29,24,27,29,24,30,28,32,25,29,34,23,32,28,28,23,32,27,34,26,30,30,23,31,28,27,25,32,29,34,28,23,26,30,32,27,27,25,24,27,25,27,31,30,25,26,33,24,26,31,24,27,28,22,30,31,23,25,31,33,28,37,28,24,34,24,28,33,23,26,28,26,25,25,26,25,27,35,31,25,30,24,23,23,27,27,25,24,24,23,23,26,24,23,32,24,27],a=1,n=.1,i="years";break;case"geyser":r=[216,108,200,137,272,173,282,216,117,261,110,235,252,105,282,130,105,288,96,255,108,105,207,184,272,216,118,245,231,266,258,268,202,242,230,121,112,290,110,287,261,113,274,105,272,199,230,126,278,120,288,283,110,290,104,293,223,100,274,259,134,270,105,288,109,264,250,282,124,282,242,118,270,240,119,304,121,274,233,216,248,260,246,158,244,296,237,271,130,240,132,260,112,289,110,258,280,225,112,294,149,262,126,270,243,112,282,107,291,221,284,138,294,265,102,278,139,276,109,265,157,244,255,118,276,226,115,270,136,279,112,250,168,260,110,263,113,296,122,224,254,134,272,289,260,119,278,121,306,108,302,240,144,276,214,240,270,245,108,238,132,249,120,230,210,275,142,300,116,277,115,125,275,200,250,260,270,145,240,250,113,275,255,226,122,266,245,110,265,131,288,110,288,246,238,254,210,262,135,280,126,261,248,112,276,107,262,231,116,270,143,282,112,230,205,254,144,288,120,249,112,256,105,269,240,247,245,256,235,273,245,145,251,133,267,113,111,257,237,140,249,141,296,174,275,230,125,262,128,261,132,267,214,270,249,229,235,267,120,257,286,272,111,255,119,135,285,247,129,265,109,268],a=1,i="seconds";break;default:case"mpg":r=[21,21.1,22.8,21.4,18.7,18.1,14.3,24.4,22.9,19.2,17.8,16.4,17.3,15.3,10.4,10.5,14.7,32.4,30.4,33.9,21.5,15.5,15.2,13.3,19.3,27.3,26,30.5,15.8,19.7,15,21.3],a=.1,i="mpg"}c()},chartObject.loadLibs=function(){Global.JSLoader.loadJs("https://d3js.org/d3.v4.js")},chartObject.pointerImageFlipped=function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACUAAAAnCAQAAAAiX0mDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAQ8SURBVEjHnZZNbFRVFMd/575XZqa2FiiUgtBKQIlSP7AVowZCCDEsTIiSsMAFyILEGBcsiLsaYSEuxOBHYpo0kLgjGo0fuKEaWaBBvkREIRT5DFJAaSmdaWfe/buYN6/ttFMq52Uy99537++dc+4591zj/4hhcUvx757EcASssR/cUXZSh0uw9wAKWYuv908I2edMIbg3mBFSF1xt8jckbZR5GqjCjZziJglyBKyPGrdbPfA0MprLtZocChxV9soMrQdgCkCm3FuT12oqz71sIQB/A9wqX3t3lMXmPSVbHg+dwmW5jo0IDiAcZynJBANm04bnBEugNR4+JJ1C8TOBDgEP0OGOBYfpZD5vWh4hl+VM2hckSVeF6GAW942jyAgzqqgLzqFn1CaT60HP6xvt1YMetakoe4V4lZlUE4yvSxN7w9N8ybuoU5L0qRDqliR9IrQpRr0u8zzGdNJjPW0EpNyvgV+mjEfO35EkXRNqjIrLdwu9H6MWefc7TUwjQ4gbDgkXo1r84+12gH0GC6kGoIG0FsTfHQAWx4Fw2vxPwLqgK7gSfM/KEi6MUXOgBVjBQyxJNniVLY5bTczgSQB+AfjTdmvlLLXagZl93+lFuvComF01vIS+kCT1KaeJZJuQnUNblJN0SVO9dZEmwFwcy4kDa0lNGLEnAc3fyU5SwFyWWfAIVcMoA/B3DXyAM8AmtsS9fg5Jlwlxw4nTD73J9Av0AXCZmwDcJJu8u6JH9VHS28I1izpLe2hMoY6laEfij7naLElq0TpJ0mJtSN79pp6k3SnEVzQzjTQuBIToMX8x8ddtBkf993Mr0aMlaR3mNblu306eCF8yUAwGF09Oylcl6WetogH/BrcYooBHrpThhWMHdaPCsj5qx4y1c9Gids6SY7CEAuGJ+KxgH1RA+TF5e5Rdsh/5liw58kSoaGARddBOvKdzkzIuYrMY1HZy5ErmlXzlKZDXW7lojQYmgXqbI+Y/5DxZBskXQcNaFRjihN920rYCNcVCQIoMANWkR4A62I79zJ4YFI0+SR0p6pjDItuPjqtb/0iSzuqaJKlbvUksdcjJnaKVJurJEJaXVSMkQz3NvIC2TpDMO4TcHyxnPg3UlBfVkl5V1NLIwvDGGklSl+r8w/7SKNDHQsERnmUBjdxPavx7gxGQZjpNVd0rJP2rZh/0WrRKfgSqxbu/aGUhs6krHiwjEaWaITyeAgXf0MseOrlgvMOi/Rs3sDo+VeE8/gy3GSBbCstKexxSwzy7g5BF7KKNpXyd1Lvis495TB/P3YwaCEiRYRbN1NLDdTwQ0Ex9rFZEnuNcYYAhCmM1Go0KSVNNihBRIAJCQkIchogYIhunyjjn5Mj6KjxDGHkcIiKKL2hBjCoG8lB5UFZCFRBB3Bbg4tJkgMcTFc+m8cTKesO3k+LVonxkgkuHVfiAKs6oGAD/AYvOeA4WBzKmAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE3LTAzLTMwVDAyOjQxOjQ1KzAyOjAwrFD4gwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNy0wMy0zMFQwMjo0MTo0NSswMjowMN0NQD8AAAAASUVORK5CYII="},chartObject.prepareScenarioZone=function(t){var e=this;this.chartGroup.append("rect").attr("class","scenariozone").attr("stroke-dasharray","6 8").attr("x",t.left).attr("y",t.top).attr("width",t.width).attr("height",t.height).style("stroke","green").style("fill-opacity",1e-6).on("mouseover",function(){return e.slowScenarioCycles=!0}).on("mouseout",function(){return e.slowScenarioCycles=!1}),this.slowScenarioCycles=!1},chartObject.resizeChartSubstrates=function(t,e){this.chartSVG.attr("width",e.x).attr("height",e.y);var n=e.x/this.visMaxExtent.x;this.sizeRatio=n;var r=Math.round(100*n),a=4/n,i=this.chartSVG.selectAll("text.scaleIndicator").data([r]);i.enter().append("text").attr("class","scaleIndicator").attr("x",this.visMaxExtent.x-a).attr("y",a).attr("dy",this.textOffsets.hanging).style("fill","#aaa").style("text-anchor","end").style("pointer-events","none").style("-webkit-user-select","none").merge(i).style("font-size",Math.floor(12/n)+"px").text(function(t){return"(vis scale: "+t+"%)"});var l=this.chartSVG.select("text.scaleIndicator").node().getBBox(),s=l.x,o=l.y+l.height,c=4/n,u=this.chartSVG.selectAll("line.indicatorFence").data([{x1:s-c,y1:0,x2:s-c,y2:o+c},{x1:s-c,y1:o+c,x2:this.visMaxExtent.x,y2:o+c}]);u.enter().append("line").attr("class","indicatorFence").style("stroke","#aaa").style("stroke-width",1).style("pointer-events","none").merge(u).attr("x1",function(t){return t.x1}).attr("y1",function(t){return t.y1}).attr("x2",function(t){return t.x2}).attr("y2",function(t){return t.y2});var h=this.chartCanvas.node(),d=h.getContext("2d");h.width=e.x,h.height=e.y,d.scale(1,1),d.scale(n,n),d=(h=this.chartFixedCanvas.node()).getContext("2d"),h.width=e.x,h.height=e.y,d.scale(1,1),d.scale(n,n)},chartObject.rPretty=function(t,e,n){(void 0===e||isNaN(parseInt(e)))&&(e=5),void 0===n&&(n=!1);var r=(e=parseInt(e))/3,a=Math.abs(t[0]-t[1]),i=a/e;Math.log(a)/Math.LN10<-2&&(i=.75*Math.max(Math.abs(a))/r);var l=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),s=0;l<1&&(s=Math.abs(Math.round(Math.log(l)/Math.LN10)));var o=l;2*l-i<1.5*(i-o)&&5*l-i<2.75*(i-(o=2*l))&&10*l-i<1.5*(i-(o=5*l))&&(o=10*l);var c=[];if(t[0]<=o)var u=0;else{u=Math.floor(t[0]/o)*o;u=parseFloat(u.toFixed(s))}for(;u<t[1];)c.push(u),u+=o,s>0&&(u=parseFloat(u.toFixed(s)));return c.push(u),n&&(c[0]<t[0]&&(c=c.slice(1)),c[c.length-1]>t[1]&&c.pop()),c},chartObject.spaceBifocally=function(t,e){var n=e.fishItemWidth,r=e.fishWidth,a=e.focusIndex,i=e.focusItemOffset,l=e.linearFocusOffset,s=t.selectAll(".fishItem").size()*n,o=s<=r,c=t.node();if(this.isDragging?c.hasOwnProperty("fishLock")||(c.fishLock=o):delete c.fishLock,!0===c.fishLock||!1!==c.fishLock&&o){var u=0;return void 0!==l&&(u=l),void t.selectAll(".fishItem").attr("transform",function(t){return"translate("+(t.indexInGroup*n+n/2+u)+",0)"}).style("opacity",1).each(function(t){var e=d3.select(this);e.select("text").style("opacity",void 0===a?1:Math.max(.15,1-.3*Math.abs(t.indexInGroup-a))).style("font-weight",t.indexInGroup===a?600:"normal").attr("letter-spacing","normal"),t.indexInGroup===a&&e.raise();var r=e.select("rect");t.mouseover&&r.on("mouseover",function(t){t.mouseover.call(this,t)}),t.mouseout&&r.on("mouseout",function(t){t.mouseout.call(this,t)}),r.attr("width",n).attr("x",-n/2).on("mousemove",null)})}var h=this.bifocalScale(r,s,3,n);h.focus(n*a,!1);u=0;void 0!==i&&(u=i-h(a*n)),t.selectAll(".fishItem").sort(function(t,e){return Math.abs(e.indexInGroup-a)-Math.abs(t.indexInGroup-a)}).attr("transform",function(t){return"translate("+(h(t.indexInGroup*n)+n/2+u)+",0)"}).style("opacity",1).each(function(t){var e=d3.select(this).select("rect"),r=t.indexInGroup*n,i=h(r),l=h(r+1)-i;0===l&&(l=i-h(r-1));var s=n*l;e.attr("x",-s/2).attr("width",s).on("mouseover",null).on("mouseout",function(t){t.mouseout.call(this,t)}).on("mousemove",function(t){var e=this.parentNode.parentNode,r=d3.mouse(e)[0]-n/2,a=h.findItem(r);d3.select(e).selectAll("rect").each(function(t){t.indexInGroup===a&&t.mouseover&&t.mouseover.call(this,t)})}),d3.select(this).select("text").style("opacity",function(t){return void 0===a?1:Math.max(.15,1-.3*Math.abs(t.indexInGroup-a))}).style("font-weight",function(t){return t.indexInGroup===a?600:"normal"}).attr("letter-spacing",1==l?"normal":"-"+(1-l)+"ex")})},chartObject.setTimerInfo=function(t){this.timerInfo&&this.stopTimer(),this.timerInfo=t},chartObject.startTimer=function(t){t.timer=d3.timer(t.tick),this.setTimerInfo(t)},chartObject.stopTimer=function(t){if(this.timerInfo){var e=this.timerInfo;e.timer&&e.timer.stop(),e.cleanup&&e.cleanup(),e.forceToEnd&&t&&e.forceToEnd(),delete this.timerInfo}},chartObject.svgSource=function(t){switch(t){case"mpg":return'\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 -5 100 125" enable-background="new 0 0 100 100" xml:space="preserve"><path d="M72,40c0,0-14-13-22-13H32C17,27,1,40,1,44v18.001l6.507,1.858C7.583,57.021,13.145,51.5,20,51.5  c6.903,0,12.5,5.597,12.5,12.5h35c0-6.903,5.597-12.5,12.5-12.5c6.855,0,12.416,5.521,12.493,12.359L99,62V51C99,47,89,42,72,40z   M37,40.931l-24.449-0.843C17.573,36.613,25.016,33,32,33h5V40.931z M43,41.138V33h7c2.853,0,9.49,4.249,15.064,8.899L43,41.138z"/><circle cx="20" cy="64" r="8.5"/><circle cx="80" cy="64" r="8.5"/></svg>';case"nba":return'\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 125" enable-background="new 0 0 100 100" xml:space="preserve"><path d="M83.259,21.384h13.824c1.014,0,1.835-0.821,1.835-1.834c0-1.014-0.821-1.834-1.835-1.834H83.259  c-1.013,0-1.833,0.82-1.833,1.834C81.426,20.562,82.246,21.384,83.259,21.384z"/><path d="M83.259,30.162h6.912c1.015,0,1.836-0.821,1.836-1.834c0-1.014-0.821-1.834-1.836-1.834h-6.912  c-1.013,0-1.833,0.82-1.833,1.834C81.426,29.341,82.246,30.162,83.259,30.162z"/><path d="M97.083,35.273H83.259c-1.013,0-1.833,0.822-1.833,1.833c0,1.014,0.82,1.834,1.833,1.834h13.824  c1.014,0,1.835-0.821,1.835-1.834C98.918,36.095,98.097,35.273,97.083,35.273z"/><path d="M16.741,17.716H2.917c-1.014,0-1.834,0.82-1.834,1.834c0,1.013,0.82,1.834,1.834,1.834h13.824  c1.013,0,1.833-0.821,1.833-1.834C18.574,18.536,17.754,17.716,16.741,17.716z"/><path d="M16.741,26.494H9.829c-1.014,0-1.836,0.82-1.836,1.834c0,1.013,0.822,1.834,1.836,1.834h6.912  c1.013,0,1.833-0.821,1.833-1.834C18.574,27.314,17.754,26.494,16.741,26.494z"/><path d="M16.741,35.273H2.917c-1.014,0-1.834,0.822-1.834,1.833c0,1.014,0.82,1.834,1.834,1.834h13.824  c1.013,0,1.833-0.821,1.833-1.834C18.574,36.095,17.754,35.273,16.741,35.273z"/><path d="M75.462,29.212C75.462,15.172,64.04,3.75,50,3.75c-14.04,0-25.461,11.422-25.461,25.462  c0,12.807,9.513,23.405,21.838,25.173c-0.512,0.683-0.82,1.512-0.82,2.413v10.97c-1.66,0.5-2.904,1.535-3.572,3.074  c-2.343,5.406,3.208,15.792,4.874,18.701l-1.477,6.267c-0.233,0.986,0.377,1.973,1.364,2.206c0.142,0.034,0.282,0.05,0.422,0.05  c0.831,0,1.585-0.569,1.784-1.413l1.644-6.98c0.11-0.464,0.034-0.953-0.21-1.364c-2.687-4.482-6.429-12.795-5.036-16.009  c0.052-0.12,0.122-0.242,0.206-0.362v0.511c0,1.013,0.822,1.835,1.834,1.835c1.014,0,1.835-0.822,1.835-1.835V56.798  c0-0.243,0.301-0.513,0.734-0.513c0.432,0,0.733,0.27,0.733,0.513v6.673v4.062v4.914c0,1.013,0.822,1.835,1.835,1.835  s1.833-0.822,1.833-1.835v-4.914v-4.062c0-0.243,0.302-0.515,0.735-0.515c0.43,0,0.732,0.271,0.732,0.515v1.855v4.163v1.856  c0,1.013,0.82,1.834,1.835,1.834c1.011,0,1.833-0.821,1.833-1.834v-1.856v-4.163c0-0.243,0.301-0.515,0.734-0.515  c0.432,0,0.733,0.271,0.733,0.515v2.814v3.007v0.198c0,1.013,0.82,1.834,1.834,1.834c1.013,0,1.834-0.821,1.834-1.834v-0.198v-3.007  c0-0.244,0.3-0.515,0.733-0.515c0.432,0,0.734,0.271,0.734,0.515v3.007c0,0.036,0,0.074,0.002,0.111l0.271,4.401  c0.004,0.062,0.012,0.124,0.021,0.186c0.009,0.055,0.855,5.476-2.508,10.988c-0.179,0.296-0.272,0.635-0.267,0.979l0.108,8.44  c0.013,1.006,0.831,1.811,1.834,1.811c0.008,0,0.017,0,0.023,0c1.012-0.013,1.823-0.844,1.81-1.857l-0.101-7.926  c3.522-6.122,2.861-12.032,2.735-12.926l-0.262-4.266v-2.949c0-2.306-1.976-4.182-4.402-4.182c-0.331,0-0.65,0.041-0.96,0.106  c-0.567-1.688-2.214-2.921-4.175-2.921c-0.476,0-0.925,0.09-1.354,0.223c-0.766-1.237-2.166-2.08-3.781-2.08  c-0.252,0-0.495,0.033-0.735,0.071v-2.561c0-0.896-0.304-1.722-0.81-2.402C65.911,52.659,75.462,42.043,75.462,29.212z M28.3,31.046  h10.332c-0.369,4.574-2.155,8.859-5.141,12.352C30.583,40.017,28.694,35.744,28.3,31.046z M33.443,15.079  c2.992,3.474,4.793,7.736,5.183,12.299H28.3C28.692,22.704,30.561,18.451,33.443,15.079z M71.7,27.378H61.374  c0.39-4.563,2.19-8.826,5.184-12.3C69.44,18.45,71.309,22.704,71.7,27.378z M57.707,27.378h-5.872V7.511  c4.589,0.385,8.778,2.188,12.12,4.982C60.285,16.666,58.11,21.839,57.707,27.378z M48.166,27.378h-5.873  c-0.404-5.538-2.578-10.712-6.249-14.885c3.342-2.795,7.532-4.597,12.121-4.982V27.378z M42.299,31.046h5.867v19.866  c-4.564-0.383-8.735-2.166-12.068-4.934C39.758,41.787,41.917,36.591,42.299,31.046z M51.835,31.046H57.7  c0.383,5.545,2.541,10.741,6.202,14.933c-3.334,2.768-7.504,4.55-12.067,4.933V31.046z M61.368,31.046H71.7  c-0.394,4.699-2.283,8.971-5.191,12.352C63.522,39.905,61.736,35.62,61.368,31.046z"/></svg>';case"marathons":return'\n<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" viewBox="-50 -50 647 902" version="1.1" x="0px" y="0px"><g transform="translate(647,-342) scale(-1,1)"><path style="" d="m 459.16425,341.81003 a 63.799577,63.799577 0 0 0 -63.757,63.7586 63.799577,63.799577 0 0 0 63.757,63.7586 63.799577,63.799577 0 0 0 63.76,-63.7586 63.799577,63.799577 0 0 0 -63.76,-63.7586 z m -50.908,134.0629 c -11.726,-1.2972 -23.472,3.8576 -30.547,13.8186 l -125.821,23.8789 c -8.811,1.6136 -16.108,7.8025 -19.272,16.2428 l -31.759,84.36566 c -5.026,13.2813 1.629,28.0644 14.91,33.0913 2.978,1.1792 6.049,1.5758 9.09,1.5758 10.366,0 20.033,-6.3043 23.88,-16.6065 l 26.91,-71.0316 71.396,-13.5761 -59.517,114.5482 c -2.794,5.4613 -3.825,11.322 -3.516,16.9696 l -48.123,52.2436 -72.365,-48.9706 c -14.087,-9.4954 -33.171,-5.8455 -42.667,8.2425 -9.495,14.0881 -5.845,33.293 8.242,42.7887 l 94.307,63.6375 c 5.213,3.5375 11.253,5.3336 17.212,5.3336 8.379,0 16.709,-3.4227 22.666,-9.9391 l 63.396,-68.8503 72.849,40.1217 -59.152,110.1847 c -8.007,14.9562 -2.473,33.6293 12.486,41.6975 4.655,2.4824 9.642,3.6361 14.545,3.6361 10.923,0 21.566,-5.8189 27.153,-16.1213 l 73.577,-136.9721 c 8.004,-14.8329 2.527,-33.4471 -12.243,-41.5772 l -56.972,-31.394 51.639,-99.2748 70.911,53.9405 c 4.592,3.5375 10.053,5.2119 15.515,5.2119 5.895,0 11.704,-2.0269 16.485,-6.0609 l 70.546,-59.516 c 10.799,-8.9371 12.154,-25.1426 3.031,-35.8793 -9.061,-10.7988 -25.14,-12.15336 -36.003,-3.0305 l -54.907,46.3037 -61.699,-46.91 1.212,-2.1815 c 8.441,-16.19806 2.016,-36.16646 -14.183,-44.60676 l -41.696,-21.8191 c -3.71,-1.9241 -7.608,-3.0827 -11.516,-3.5152 z" fill="#000000"/></g></svg>';case"diamonds":return'\n<svg xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 2 32 40" x="0px" y="0px"><title>diamonda</title><path fill="#000000" d="M9.992 10.523c0.084 0.188 0.271 0.302 0.465 0.302 0.069 0 0.139-0.015 0.207-0.045 0.257-0.113 0.372-0.415 0.259-0.672l-2.436-5.458c-0.115-0.256-0.416-0.371-0.672-0.256-0.258 0.115-0.373 0.415-0.258 0.672l2.435 5.457z"/><path fill="#000000" d="M6.056 12.385c0.15 0 0.298-0.066 0.399-0.191 0.176-0.22 0.139-0.539-0.080-0.715l-3.173-2.53c-0.219-0.176-0.539-0.14-0.715 0.080s-0.138 0.539 0.080 0.715l3.174 2.53c0.093 0.075 0.206 0.111 0.315 0.111z"/><path fill="#000000" d="M22.216 10.701c0.069 0.031 0.14 0.047 0.21 0.047 0.193 0 0.378-0.11 0.463-0.297l1.891-4.136c0.117-0.255 0.006-0.557-0.251-0.675-0.255-0.116-0.559-0.004-0.675 0.251l-1.891 4.136c-0.114 0.256-0.001 0.558 0.253 0.674z"/><path fill="#000000" d="M28.732 8.586l-2.557 2.957c-0.183 0.214-0.16 0.535 0.053 0.718 0.097 0.083 0.214 0.124 0.332 0.124 0.143 0 0.284-0.059 0.385-0.176l2.557-2.959c0.184-0.213 0.16-0.534-0.052-0.718s-0.533-0.161-0.718 0.053z"/><path fill="#000000" d="M16.367 10.116c0.006 0 0.013 0 0.017 0 0.274 0 0.5-0.217 0.509-0.491l0.118-3.504c0.010-0.281-0.21-0.516-0.491-0.525-0.276-0.004-0.515 0.209-0.527 0.491l-0.117 3.504c-0.009 0.282 0.211 0.516 0.49 0.525z"/><path fill="#000000" d="M27.191 17.789c-0.014-0.053-0.037-0.106-0.070-0.155-0.001-0.001-0.001-0.001-0.001-0.003l-3.052-4.378c-0.039-0.092-0.103-0.174-0.191-0.231-0.090-0.057-0.19-0.083-0.289-0.082-0.001 0-0.003 0-0.005 0h-14.555c-0.005 0-0.009 0.002-0.016 0.002-0.032 0.001-0.064 0.005-0.095 0.013-0.013 0.002-0.023 0.005-0.035 0.010-0.026 0.008-0.049 0.017-0.073 0.027-0.013 0.006-0.025 0.011-0.036 0.018-0.008 0.004-0.016 0.006-0.023 0.012-0.016 0.011-0.029 0.024-0.043 0.035-0.008 0.008-0.017 0.014-0.026 0.021-0.027 0.027-0.054 0.056-0.075 0.088v0l-2.982 4.474c-0.001 0.001-0.001 0.002-0.001 0.002-0.034 0.049-0.055 0.104-0.069 0.16-0.001 0.003-0.003 0.006-0.005 0.013-0.006 0.036-0.012 0.070-0.012 0.11 0 0.014 0.004 0.032 0.005 0.047 0 0.011 0.001 0.018 0.003 0.027 0.007 0.050 0.023 0.1 0.045 0.148 0.005 0.008 0.009 0.014 0.013 0.021 0.026 0.047 0.058 0.090 0.098 0.126 0.004 0.002 0.004 0.006 0.006 0.006l10.327 9.219c0.009 0.009 0.018 0.012 0.027 0.016 0.034 0.026 0.069 0.048 0.105 0.064 0.015 0.007 0.029 0.016 0.044 0.021 0.053 0.017 0.107 0.028 0.163 0.028 0.001 0 0.001 0 0.003 0 0.056 0 0.11-0.013 0.162-0.030 0.014-0.005 0.027-0.014 0.042-0.020 0.038-0.014 0.073-0.038 0.106-0.064 0.009-0.006 0.018-0.008 0.026-0.016l10.329-9.219c0.002-0.001 0.004-0.006 0.006-0.006 0.041-0.039 0.073-0.081 0.098-0.129 0.006-0.007 0.010-0.014 0.013-0.021 0.023-0.048 0.038-0.097 0.045-0.15 0.002-0.008 0.002-0.019 0.004-0.029 0.001-0.014 0.004-0.027 0.004-0.041 0-0.041-0.006-0.078-0.014-0.116-0.003-0.004-0.006-0.010-0.008-0.016zM16.368 25.955l-3.616-7.524h7.13l-3.514 7.524zM16.313 14.235l3.15 3.178h-6.3l3.151-3.178zM23.606 14.37l2.123 3.045h-4.108l1.985-3.045zM22.659 13.958l-2.059 3.158-3.13-3.158h5.189zM15.155 13.958l-3.13 3.158-2.059-3.158h5.189zM9.023 14.373l1.982 3.040h-4.008l2.026-3.040zM7.381 18.431h4.243l3.187 6.635-7.43-6.635zM17.884 25.112l3.121-6.681h4.364l-7.485 6.681z"/></svg>';case"geyser":return'\n<svg\n   xmlns:svg="http://www.w3.org/2000/svg"\n   xmlns="http://www.w3.org/2000/svg"\n   id="svg2"\n   xml:space="preserve"\n   style="enable-background:new 0 0 100 100;"\n   viewBox="0 0 100 125"\n   y="0px"\n   x="0px"\n   version="1.1"><defs\n     id="defs24" /><path\n     d="m 50.989762,26.749152 c 1.495836,0.111689 2.781856,-0.995628 2.893545,-2.491464 L 55.149118,7.3048794 C 55.260808,5.8090434 54.15349,4.5230232 52.657654,4.4113339 51.161818,4.2996447 49.875798,5.4069622 49.764109,6.9027983 L 48.498298,23.855607 c -0.11169,1.495836 0.995628,2.781856 2.491464,2.893545 z"\n     id="path6" /><path\n     d="m 63.651368,30.532827 c 0.3,0.1 0.7,0.2 1,0.2 1,0 2,-0.6 2.5,-1.7 3.1,-7.6 7.8,-12.5 13.9,-14.4 1.4,-0.4 2.2,-1.9 1.7,-3.3 -0.4,-1.4000003 -1.9,-2.2000003 -3.3,-1.7000003 -7.7,2.5000003 -13.5,8.3000003 -17.2,17.5000003 -0.6,1.3 0,2.9 1.4,3.4 z"\n     id="path8" /><path\n     d="m 90.2,47.2 c -5.9,-2.5 -14.9,-3 -24.8,8.8 -2,2.4 -3.7,5 -5.1,7.2 l -3,-15.7 c -0.3,-1.4 -1.7,-2.4 -3.1,-2.1 -1.4,0.3 -2.4,1.7 -2.1,3.1 l 4.3,22.7 c 0,0.5 0.1,1 0.3,1.4 l 0.1,0.6 -6.8,0 -6.8,0 0.1,-0.6 c 0.2,-0.4 0.3,-0.9 0.3,-1.4 l 4.3,-22.7 c 0.3,-1.4 -0.7,-2.8 -2.1,-3.1 -1.4,-0.3 -2.8,0.7 -3.1,2.1 l -3,15.7 C 38.3,60.9 36.6,58.4 34.6,56 24.8,44.2 15.7,44.7 9.8,47.2 c -1.4,0.6 -2,2.1 -1.4,3.5 0.6,1.4 2.1,2 3.5,1.4 13.4,-5.7 24,14.9 26.1,19.5 3.404884,8.298784 20.029396,10.199112 24,0 2.1,-4.5 12.7,-25.2 26.2,-19.5 1.4,0.6 2.9,-0.1 3.5,-1.4 0.5,-1.4 -0.1,-3 -1.5,-3.5 z"\n     id="path10" /><path\n     d="m 90.468389,27.811854 c -9.1,-1.2 -17.8,3.4 -25.7,13.4 -0.9,1.2 -0.7,2.8 0.4,3.7 0.5,0.4 1.1,0.6 1.6,0.6 0.8,0 1.6,-0.3 2.1,-1 6.7,-8.5 13.7,-12.4 20.9,-11.5 1.5,0.2 2.8,-0.8 3,-2.3 0.1,-1.4 -0.9,-2.8 -2.3,-2.9 z"\n     id="path12" /><path\n     d="m 22.9,19.8 c 6.1,2 10.8,6.8 13.9,14.4 0.4,1 1.4,1.7 2.5,1.7 0.3,0 0.7,-0.1 1,-0.2 1.4,-0.6 2,-2.1 1.5,-3.5 -3.8,-9.1 -9.5,-15 -17.2,-17.5 -1.4,-0.4 -2.9,0.3 -3.3,1.7 -0.5,1.5 0.2,3 1.6,3.4 z"\n     id="path14" /><path\n     d="m 28.6,43.6 c 0.5,0.7 1.3,1 2.1,1 0.6,0 1.2,-0.2 1.6,-0.6 1.2,-0.9 1.4,-2.6 0.4,-3.7 C 24.9,30.2 16.3,25.7 7.1,26.9 c -1.5,0.2 -2.5,1.5 -2.3,3 0.2,1.5 1.5,2.5 3,2.3 7.2,-1 14.2,2.9 20.8,11.4 z"\n     id="path16" /><path\n     d="m 48.006023,72.981759 c -8.772774,-2.699712 -18.117695,0.386131 -27.573701,8.929783 -1.087391,1.033236 -1.156824,2.644192 -0.222189,3.714919 0.42635,0.47773 0.98463,0.774922 1.477639,0.858246 0.788812,0.133318 1.62762,-0.02917 2.237282,-0.636057 8.022814,-7.264602 15.574855,-9.943535 22.524191,-7.856259 1.445696,0.447175 2.894164,-0.3222 3.341339,-1.767896 0.331908,-1.363758 -0.420806,-2.910827 -1.784561,-3.242736 z"\n     id="path12-9" /><path\n     d="M 83.226019,78.611756 C 76.88113,71.97908 67.217154,70.11963 54.796422,72.971899 c -1.453057,0.372321 -2.298755,1.7452 -2.004412,3.135653 0.139483,0.624936 0.482153,1.156516 0.87205,1.469535 0.623836,0.500827 1.435482,0.767717 2.263605,0.534878 10.545923,-2.433819 18.446025,-1.092771 23.497115,4.116499 1.044485,1.095011 2.684253,1.129062 3.779266,0.08457 0.954429,-1.029108 1.051079,-2.746857 0.02197,-3.701285 z"\n     id="path12-9-9" /></svg>';case"faithful-alternate":return'\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.0" x="0px" y="0px" viewBox="0 0 170 211.25" enable-background="new 0 0 170 169" xml:space="preserve"><g><g><g><defs><path id="c" d="M304,72.5c0,0.6,0.4,1,1,1s1-0.4,1-1v-19c0-0.6-0.4-1-1-1s-1,0.4-1,1V72.5z M309,76.7      c0,0.4,0.5,0.8,1.1,0.8c0.6,0,1.1-0.4,1.1-0.8V58.3c0-0.4-0.5-0.8-1.1-0.8c-0.6,0-1.1,0.4-1.1,0.8V76.7z M290.6,21.2      c1.3,0.3,2.5,0.8,3.7,1.4c0.7,0.4,1.1,1.3,0.7,2c-0.4,0.7-1.3,1.1-2,0.7c-2.5-1.2-5.3-1.8-8.1-1.8c-4.9,0-9.7,2-13.2,5.6      c-7.1,7.3-6.9,19.1,0.5,26.2c7.3,7.1,19.1,6.9,26.2-0.5c0.6-0.6,1.5-0.6,2.1,0c0.5,0.5,0.5,0.9,0.5,1.2c0,0.2,0,0.4,0,0.7      c0,0.5,0,1.3,0,2.4c0,2,0,4.8,0,8.3c0,6.3,0-16.1,0-5.8c0,9.3,0-0.8,0,8.8c0,2.1,0,4.1,0,5.8c0,1,0,1,0,1.6c0,0.5,0,0.5,0,0.6      c0,0.8-0.7,1.5-1.5,1.5s-1.5-0.7-1.5-1.5c0-0.1,0-0.1,0-0.6c0-0.6,0-0.6,0-1.6c0-1.7,0-3.6,0-5.8c0-9.6,0,0.4,0-8.8      c0-10.3,0,12.1,0,5.8c0-3.6-0.1-8.4-0.1-8.4s0.3-0.1-0.9,0.8c-8.2,5.6-19.5,4.8-27-2.3c-8.5-8.2-8.8-21.9-0.5-30.4      c4.1-4.2,9.6-6.5,15.3-6.6c0.7,0,1.3,0,2,0.1c5.2-5.1,12.2-8.1,19.7-8.1c7.7,0,14.8,3.1,19.9,8.3c1.3-0.2,2.6-0.3,3.8-0.3      c5.7,0,11.2,2.4,15.3,6.6c8.2,8.5,8,22.2-0.5,30.4c-7.7,7.4-19.5,8-27.7,1.8c-0.1-0.1-0.2-0.1-0.2-0.1s0,4.7,0,8.3      c0,6.3,0-8.1,0,2.2c0,9.3,0-8.8,0,0.8c0,2.1,0,4.1,0,5.8c0,1,0,1,0,1.6c0,0.5,0,0.5,0,0.6c0,0.8-0.7,1.5-1.5,1.5      s-1.5-0.7-1.5-1.5c0-0.1,0-0.1,0-0.6c0-0.6,0-0.6,0-1.6c0-1.7,0-3.6,0-5.8c0-9.6,0,8.4,0-0.8c0-10.3,0,4.1,0-2.2      c0-3.6,0-6.4,0-8.3c0-1,0-1.8,0-2.4c0-0.3,0-0.5,0-0.7c0-0.5,0-0.8,0.5-1.2c0.6-0.6,1.5-0.6,2.1,0c7.1,7.3,18.8,7.6,26.2,0.5      c7.3-7.1,7.6-18.8,0.5-26.2c-3.5-3.6-8.2-5.6-13.2-5.6c-0.5,0-1,0-1.5,0c1,1.4,2,2.8,2.8,4.4c0.4,0.7,0.1,1.6-0.7,2      c-0.7,0.4-1.6,0.1-2-0.7c-4.2-8.4-12.8-13.8-22.4-13.8C300.6,15.5,295,17.6,290.6,21.2z"/></defs><use xlink:href="#c" overflow="visible"/><clipPath><use xlink:href="#c" overflow="visible"/></clipPath></g></g><g><g><defs><path id="b" d="M317.7,98.7l1-1l0.7-0.7l-1.4-1.4l-0.7,0.7l-1,1l-0.7,0.7l1.4,1.4L317.7,98.7z M317.7,103.7l4-4l0.7-0.7      l-1.4-1.4l-0.7,0.7l-4,4l-0.7,0.7l1.4,1.4L317.7,103.7z M297.7,98.7l0.7-0.7l-1.4-1.4l-0.7,0.7l-5,5l0.7,2.1l0.7-0.7L297.7,98.7      z M264.2,122.2l21.5-21.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-21.5,21.5l-0.7,0.7l1.4,1.4L264.2,122.2z M268.2,123.2l18.5-18.5l0.7-0.7      l-1.4-1.4l-0.7,0.7l-18.5,18.5l-0.7,0.7l1.4,1.4L268.2,123.2z M353.2,123.2l3.5-3.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-3.5,3.5      l-0.7,0.7l1.4,1.4L353.2,123.2z M347.2,124.2l7.5-7.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-7.5,7.5l-0.7,0.7l1.4,1.4L347.2,124.2z       M341.2,125.2l10.5-10.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-10.5,10.5l-0.7,0.7l1.4,1.4L341.2,125.2z M335.2,126.2l14.5-14.5l0.7-0.7      l-1.4-1.4l-0.7,0.7l-14.5,14.5l-0.7,0.7l1.4,1.4L335.2,126.2z M330.2,126.2l16.5-16.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-16.5,16.5      l-0.7,0.7l1.4,1.4L330.2,126.2z M325.2,126.2l18.5-18.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-18.5,18.5l-0.7,0.7l1.4,1.4L325.2,126.2z       M320.2,126.2l21.5-21.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-21.5,21.5l-0.7,0.7l1.4,1.4L320.2,126.2z M315.2,126.2l23.5-23.5l0.7-0.7      l-1.4-1.4l-0.7,0.7l-23.5,23.5l-0.7,0.7l1.4,1.4L315.2,126.2z M310.2,126.2l26.5-26.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-26.5,26.5      l-0.7,0.7l1.4,1.4L310.2,126.2z M305.2,126.2l28.5-28.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-28.5,28.5l-0.7,0.7l1.4,1.4L305.2,126.2z       M300.2,126.2l22.5-22.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-22.5,22.5l-0.7,0.7l1.4,1.4L300.2,126.2z M295.2,126.2l16.5-16.5l0.7-0.7      l-1.4-1.4l-0.7,0.7l-16.5,16.5l-0.7,0.7l1.4,1.4L295.2,126.2z M310.7,105.7l-0.7-2.1l-0.7,0.7l-20.5,20.5l-0.7,0.7l1.4,1.4      l0.7-0.7L310.7,105.7z M309.7,101.7l0.7-0.7l-1-1.9l-1.1,1.2l-23.5,23.5l-0.7,0.7l1.4,1.4l0.7-0.7L309.7,101.7z M281.2,125.2      l27.5-27.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-27.5,27.5l-0.7,0.7l1.4,1.4L281.2,125.2z M277.2,124.2l21.5-21.5l0.7-0.7l-1.4-1.4      l-0.7,0.7l-21.5,21.5l-0.7,0.7l1.4,1.4L277.2,124.2z M290.7,105.7l0.7-0.7l-2.1-0.7l-18.5,18.5l-0.7,0.7l1.4,1.4l0.7-0.7      L290.7,105.7z M283.2,97.1c1.1,0,1.9,0.9,1.9,2v3c0,2.2,1.8,4,4,4v-1v-1h-0.1v1v1c2.2,0,4-1.8,4-4v-3c0-1.1,0.9-2,2-2v-1v-1h0v1      v1c1.1,0,2,0.9,2,2h1h1v-0.1h-1h-1c0,2.2,1.8,4,4,4h0.3c2.2,0,4-1.8,4-4v-0.1c0-1.1,0.9-2,2-2c1.1,0,2,0.9,2,2v7.1      c0,2.2,1.8,4,4,4v-1v-1H313v1v1c2.2,0,4-1.8,4-4v-7c0-1.1,0.9-2,2-2v-1v-1h-0.1v1v1c1.1,0,2,0.9,2,2l0,0.8c-0.2,2.6,1.3,4.9,4,4      l0,0c2.2,0,4-1.8,4-4V99c0-1.1,0.9-2,2-2l2,0l0-2l-2,0c-2.2,0-4,1.8-4,4v0.7c0,1.1-0.9,2-2,2h0c-1.1,0-2-0.9-2-2V99      c0-2.2-1.8-4-4-4v2h0.1v-2c-2.2,0-4,1.8-4,4v7c0,1.1-0.9,2-2,2v2h0.1v-2c-1.1,0-2-0.9-2-2v-7.1c0-2.2-1.8-4-4-4      c-2.2,0-4,1.8-4,4v0.1c0,1.1-0.9,2-2,2h-0.3c-1.1,0-2-0.9-2-2h-2V99h2c0-2.2-1.8-4-4-4v2h0v-2c-2.2,0-4,1.8-4,4v3      c0,1.1-0.9,2-2,2v2h0.1v-2c-1.1,0-2-0.9-2-2v-3c0-2.2-1.8-4-3.9-4V97.1z M294.3,84.5c0.6-0.9,1.7-0.8,6.6,0.7      c2.9,0.9,4.7,1.3,6.7,1.4c0.3,0,0.6,0,0.9,0c2.1-0.1,3.9-0.4,6.6-1.3c4.8-1.5,5.8-1.6,7-0.2l-0.1-0.1c2.4,3,5,6.1,7.8,9.2      c5.1,5.7,10.5,11.1,16,16.2c1.9,1.8,3.7,3.4,5.3,4.8c0.6,0.5,1.1,0.9,1.5,1.3c0.3,0.2,0.4,0.4,0.5,0.5c2.4,2.1,1.9,3.8-1.2,4.4      l-0.1,0c-0.1,0-0.3,0.1-0.6,0.2c-0.6,0.1-1.2,0.3-2,0.5c-2.2,0.5-4.9,1-7.9,1.4c-9,1.4-19.7,2.2-31.8,2.1      c-11.8-0.1-22.6-0.9-32.1-2.2c-3.4-0.5-6.5-1-9-1.5c-0.9-0.2-1.7-0.3-2.3-0.5c-0.4-0.1-0.6-0.1-0.8-0.2      c-3.2-0.6-3.6-2.2-1.2-4.4c0.1,0,0.2-0.2,0.5-0.4c0.4-0.4,0.9-0.8,1.4-1.2c1.5-1.3,3.1-2.9,4.9-4.6c5.1-4.9,10.2-10.1,15-15.5      C288.8,91.5,291.7,88,294.3,84.5L294.3,84.5z M291.9,82.7c-2.5,3.4-5.4,6.9-8.4,10.4c-4.7,5.4-9.7,10.5-14.8,15.3      c-1.8,1.7-3.4,3.2-4.9,4.5c-0.5,0.5-1,0.9-1.4,1.2c-0.2,0.2-0.4,0.3-0.5,0.4c-4.2,3.8-3,8.4,2.6,9.6c0.1,0,0.4,0.1,0.8,0.2      c0.7,0.2,1.5,0.3,2.4,0.5c2.6,0.5,5.7,1,9.2,1.5c9.6,1.3,20.5,2.2,32.5,2.2c12.3,0.1,23.1-0.8,32.3-2.1c3.1-0.5,5.8-1,8.1-1.5      c0.8-0.2,1.5-0.3,2.1-0.5c0.4-0.1,0.6-0.2,0.7-0.2l-0.1,0c5.5-1.2,6.7-5.9,2.5-9.7c-0.1-0.1-0.3-0.2-0.5-0.5      c-0.4-0.4-0.9-0.8-1.5-1.3c-1.6-1.4-3.3-3-5.2-4.7c-5.4-5-10.8-10.4-15.8-16c-2.7-3-5.3-6.1-7.6-9l-0.1-0.1c-1.3-1.5-3-2-5-1.9      c-1.3,0.1-1.7,0.2-5.1,1.3c-2.5,0.8-4,1.1-5.8,1.2c-0.2,0-0.5,0-0.7,0c-1.7-0.1-3.3-0.4-6-1.2c-3.6-1.1-4-1.2-5.2-1.3      C294.5,80.7,292.9,81.2,291.9,82.7L291.9,82.7z"/></defs><use xlink:href="#b" overflow="visible"/><clipPath><use xlink:href="#b" overflow="visible"/></clipPath></g></g></g><g><g><defs><path id="a" d="M137.7,148.7l3-3l0.7-0.7l-1.4-1.4l-0.7,0.7l-3,3l-0.7,0.7l1.4,1.4L137.7,148.7z M132.2,149.2l4.5-4.5     l0.7-0.7l-1.4-1.4l-0.7,0.7l-4.5,4.5l-0.7,0.7l1.4,1.4L132.2,149.2z M127.2,149.2l5.5-5.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-5.5,5.5     l-0.7,0.7l1.4,1.4L127.2,149.2z M121.2,150.2l7.5-7.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-7.5,7.5l-0.7,0.7l1.4,1.4L121.2,150.2z      M81.2,150.2l14.5-14.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-14.5,14.5l-0.7,0.7l1.4,1.4L81.2,150.2z M96.2,150.2l12.5-12.5l0.7-0.7     l-1.4-1.4l-0.7,0.7l-12.5,12.5l-0.7,0.7l1.4,1.4L96.2,150.2z M86.2,150.2l13.5-13.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-13.5,13.5     l-0.7,0.7l1.4,1.4L86.2,150.2z M76.2,150.2l12.5-12.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-12.5,12.5l-0.7,0.7l1.4,1.4L76.2,150.2z      M71.2,150.2l12.5-12.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-12.5,12.5l-0.7,0.7l1.4,1.4L71.2,150.2z M66.2,150.2l12.5-12.5l0.7-0.7     l-1.4-1.4l-0.7,0.7l-12.5,12.5l-0.7,0.7l1.4,1.4L66.2,150.2z M61.2,150.2l12.5-12.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-12.5,12.5     l-0.7,0.7l1.4,1.4L61.2,150.2z M57.2,149.2l12.5-12.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-12.5,12.5l-0.7,0.7l1.4,1.4L57.2,149.2z      M52.2,149.2l12.5-12.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-12.5,12.5l-0.7,0.7l1.4,1.4L52.2,149.2z M47.2,149.2l10.5-10.5l0.7-0.7     l-1.4-1.4l-0.7,0.7l-10.5,10.5l-0.7,0.7l1.4,1.4L47.2,149.2z M91.2,150.2l13.5-13.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-13.5,13.5     l-0.7,0.7l1.4,1.4L91.2,150.2z M105.2,151.2l11.5-11.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-11.5,11.5l-0.7,0.7l1.4,1.4L105.2,151.2z      M101.2,150.2l11.5-11.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-11.5,11.5l-0.7,0.7l1.4,1.4L101.2,150.2z M116.2,150.2l8.5-8.5l0.7-0.7     l-1.4-1.4l-0.7,0.7l-8.5,8.5l-0.7,0.7l1.4,1.4L116.2,150.2z M112.2,149.2l8.5-8.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-8.5,8.5l-0.7,0.7     l1.4,1.4L112.2,149.2z M43.2,148.2l8.5-8.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-8.5,8.5l-0.7,0.7l1.4,1.4L43.2,148.2z M38.2,148.2     l7.5-7.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-7.5,7.5l-0.7,0.7l1.4,1.4L38.2,148.2z M33.2,148.2l5.1-5.1l0.7-0.7l-1.4-1.4l-0.7,0.7     l-5.1,5.1l-0.7,0.7l1.4,1.4L33.2,148.2z M28.2,148.2l5.1-5.1l0.7-0.7l-1.4-1.4l-0.7,0.7l-5.1,5.1l-0.7,0.7l1.4,1.4L28.2,148.2z      M53.3,136.1c-0.9,0.2-1.9,0.4-2.8,0.6c-6.5,1.5-13.4,3.1-20.1,4.7c-2.4,0.6-4.5,1.1-6.5,1.6c-0.7,0.2-1.3,0.3-1.8,0.4     c-0.3,0.1-0.5,0.1-0.6,0.2c-3,0.7-4.4,1.4-4.3,3.1c0.1,1.7,1.7,2.1,4.7,2.4c0.1,0,0.2,0,0.5,0c0.4,0,0.8,0.1,1.3,0.1     c1.4,0.1,3.1,0.2,4.9,0.4c5.2,0.4,10.6,0.8,16.2,1.2c4.9,0.3,9.6,0.6,14.1,0.9c10,0.5,18.3,0.8,24.6,0.8c6.2,0,14.5-0.3,24.3-0.8     c4.4-0.2,9.1-0.5,13.9-0.9c5.5-0.4,10.9-0.8,16-1.2c1.8-0.1,3.4-0.3,4.8-0.4c0.5,0,0.9-0.1,1.3-0.1c0.4,0,0.4,0,0.5,0     c3.1-0.2,4.6-0.7,4.7-2.4c0.1-1.7-1.3-2.4-4.3-3.1c-0.1,0-0.3-0.1-0.7-0.2c-0.5-0.1-1.2-0.3-1.9-0.5c-2-0.5-4.3-1-6.8-1.6     c-7-1.7-14.2-3.4-21-4.9c-0.9-0.2-1.8-0.4-2.7-0.6c-5-1.1-9.6-2.2-13.7-3.1c-0.8-0.2-1.6,0-2.9,0.3c-0.3,0.1-2.6,0.8-3.4,1     c-2.8,0.8-5.5,1.3-8.7,1.3c-3.2,0-6-0.3-9.5-1.1c-0.1,0-3.3-0.8-4.1-0.9c-1.5-0.3-2.5-0.4-3.4-0.2     C62.2,134.1,57.9,135.1,53.3,136.1z M66.6,136.2c0.8-0.2-0.4-0.4,6.2,1.1c3.7,0.8,6.8,1.2,10.2,1.2c3.4-0.1,6.3-0.5,9.4-1.4     c0.8-0.2,3.1-1,3.4-1c0.8-0.2,1.3-0.3,1.4-0.3c4.1,0.9,8.6,1.9,13.6,3c0.9,0.2,1.8,0.4,2.7,0.6c6.8,1.6,13.9,3.2,20.9,4.9     c2.5,0.6,4.7,1.1,6.8,1.6c0.7,0.2,1.3,0.3,1.9,0.5c0.3,0.1,0.5,0.1,0.7,0.2c1,0.2,1.7,0.5,2.1,0.7c0.1,0.1,0.2,0.1,0.2,0.1     c-0.2-0.2-0.3-0.4-0.3-0.8c0-0.4,0.2-0.7,0.4-0.8c0,0-0.1,0-0.2,0.1c-0.4,0.1-1.2,0.3-2.2,0.3c-0.1,0-0.1,0-0.5,0     c-0.4,0-0.8,0.1-1.3,0.1c-1.4,0.1-3,0.2-4.8,0.4c-5.1,0.4-10.5,0.8-16,1.2c-4.8,0.3-9.4,0.6-13.9,0.8c-9.8,0.5-18,0.8-24.1,0.8     c-6.2,0-14.6-0.3-24.5-0.8c-4.5-0.2-9.2-0.5-14-0.8c-5.6-0.4-11-0.8-16.2-1.2c-1.8-0.1-3.4-0.3-4.9-0.4c-0.5,0-0.9-0.1-1.3-0.1     c-0.2,0-0.4,0-0.5,0c-1-0.1-1.7-0.2-2.2-0.3c-0.1,0-0.2-0.1-0.2-0.1c0.2,0.1,0.4,0.4,0.4,0.8c0,0.4-0.1,0.7-0.3,0.8     c0,0,0.1,0,0.2-0.1c0.4-0.2,1.1-0.4,2.1-0.7c0.1,0,0.3-0.1,0.6-0.2c0.5-0.1,1.1-0.3,1.8-0.4c1.9-0.5,4.1-1,6.5-1.6     c6.7-1.6,13.6-3.2,20.1-4.7c0.9-0.2,1.9-0.4,2.8-0.6C58.6,138,62.8,137.1,66.6,136.2z M79,56.5v49c0,0.6,0.4,1,1,1s1-0.4,1-1v-49     c0-0.6-0.4-1-1-1S79,55.9,79,56.5z M84,66.5v59c0,0.6,0.4,1,1,1s1-0.4,1-1v-59c0-0.6-0.4-1-1-1S84,65.9,84,66.5z M65.6,22.2     c1.3,0.3,2.5,0.8,3.7,1.4c0.7,0.4,1.1,1.3,0.7,2c-0.4,0.7-1.3,1.1-2,0.7c-2.5-1.2-5.3-1.8-8.1-1.8c-4.9,0-9.7,2-13.2,5.6     c-7.1,7.3-6.9,19.1,0.5,26.2c7.3,7.1,19.1,6.9,26.2-0.5c0.6-0.6,1.5-0.6,2.1,0c0.5,0.5,0.5,0.9,0.5,1.2c0,0.2,0,0.4,0,0.7     c0,0.5,0,1.3,0,2.4c0,2,0,4.8,0,8.3c0,6.3,0,14.9,0,25.2c0,9.3,0,19.2,0,28.8c0,2.1,0,4.1,0,5.8c0,1,0,1,0,1.6c0,0.5,0,0.5,0,0.6     c0,0.8-0.7,1.5-1.5,1.5c-0.8,0-1.5-0.7-1.5-1.5c0-0.1,0-0.1,0-0.6c0-0.6,0-0.6,0-1.6c0-1.7,0-3.6,0-5.8c0-9.6,0-19.6,0-28.8     c0-10.3,0-18.9,0-25.2c0-3.6-0.1-8.4-0.1-8.4s0.3-0.1-0.9,0.8c-8.2,5.6-19.5,4.8-27-2.3c-8.5-8.2-8.8-21.9-0.5-30.4     c4.1-4.2,9.6-6.5,15.3-6.6c0.7,0,1.3,0,2,0.1c5.2-5.1,12.2-8.1,19.7-8.1c7.7,0,14.8,3.1,19.9,8.3c1.3-0.2,2.6-0.3,3.8-0.3     c5.7,0,11.2,2.4,15.3,6.6c8.2,8.5,8,22.2-0.5,30.4c-7.7,7.4-19.5,8-27.7,1.8c-0.1-0.1-0.2-0.1-0.2-0.1s0,4.7,0,8.3     c0,6.3,0,14.9,0,25.2c0,9.3,0,19.2,0,28.8c0,2.1,0,4.1,0,5.8c0,1,0,1,0,1.6c0,0.5,0,0.5,0,0.6c0,0.8-0.7,1.5-1.5,1.5     c-0.8,0-1.5-0.7-1.5-1.5c0-0.1,0-0.1,0-0.6c0-0.6,0-0.6,0-1.6c0-1.7,0-3.6,0-5.8c0-9.6,0-19.6,0-28.8c0-10.3,0-18.9,0-25.2     c0-3.6,0-6.4,0-8.3c0-1,0-1.8,0-2.4c0-0.3,0-0.5,0-0.7c0-0.5,0-0.8,0.5-1.2c0.6-0.6,1.5-0.6,2.1,0c7.1,7.3,18.8,7.6,26.2,0.5     c7.3-7.1,7.6-18.8,0.5-26.2c-3.5-3.6-8.2-5.6-13.2-5.6c-0.5,0-1,0-1.5,0c1,1.4,2,2.8,2.8,4.4c0.4,0.7,0.1,1.6-0.7,2     c-0.7,0.4-1.6,0.1-2-0.7c-4.2-8.4-12.8-13.8-22.4-13.8C75.6,16.5,70,18.6,65.6,22.2z"/></defs><use xlink:href="#a" overflow="visible"/><clipPath><use xlink:href="#a" overflow="visible"/></clipPath></g></g></svg>'}},chartObject.switchDataset=function(t){this.datasetsAvailable=Math.max(this.datasetsAvailable,this.datasetsForSwitching.indexOf(t)+1),this.datasetsAvailable>1&&this.drawDataSelector({instant:!0}),this.privateSwitchDataset(t)},chartObject};
},{}]},{},["KWog"], null)
//# sourceMappingURL=chartObject.js.map