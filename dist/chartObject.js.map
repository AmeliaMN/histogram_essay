{"version":3,"sources":["chartObject.js"],"names":["window","createChartObject","chartObject","availableWidth","totalWidth","focalFactor","itemWidth","scale","d3","scaleIdentity","available","total","fw","d3_rebind_inner","target","source","method","value","apply","arguments","rescale","_","x","pivots","length","pi","xMin","yMin","y","xMax","d3_rebind","setup","f","focusInOutput","xRemainder","compressedScale","focusMin","focusMax","Math","min","max","push","findItem","focus","invert","floor","nice","ticks","tickFormat","i","n","data","ranges","bins","testValue","range","v","minOpen","maxOpen","ri","values","filter","buildTable","definitions","tableOptions","chart","dataMin","dataMax","dataRange","dataQuantum","clearTable","tableGroup","selectAll","remove","clearHistogram","histGroup","estimatedBinMax","countScaleMax","binMax","estimateMaxBinSize","binMaxDensity","estimateMaxBinDensity","varDefs","orderedVarNames","choiceGroups","chosen","forEach","def","name","extra","str","parseFloat","slice","choiceGroup","group","choices","default","resultCache","resultHash","varExpressions","context","map","vn","join","Object","keys","k","compute","eval","runComputation","measureExpression","groupName","choiceState","hash","contextVar","existing","hasOwnProperty","options","measure","precomputed","result","cacheable","lively","lang","obj","clone","noCache","findClosestResult","expr","fiddleVar","baseDef","main","extraResults","extras","extraExpr","extraDef","String","diff","minIndex","res","newDiff","abs","desiredValue","fixups","defer","sel","func","fun","curry","s","trans","transition","call","runDeferred","dur","t","duration","toggleContextSpec","varName","scheduleEvent","refreshTable","force","edges","boxSize","boxGap","xInset","yInset","rowHeight","fontHeight","spreadBackground","transformString","keyString","d","reason","showChange","textSeln","interrupt","style","ease","easeExpIn","fill","stringyValue","val","stringyValueParts","vp","isNaN","roundIfAny","rounding","undefined","Number","toFixed","eventQueue","eventTimeout","type","delay","clearTimeout","flushEventQueue","fn","setTimeout","runEvents","evt","objectsEqual","a","b","aKeys","bKeys","ai","lastRefresh","isDragging","useDensity","widthControl","width","forced","select","recordBinState","highlighting","focusVar","highlightIndex","focusIndex","focusOutwithContext","mainResult","mainBins","deriveBins","maxDataColumns","contextBins","ex","drawBins","highlight","extraAxisAnnotations","extraAxisValues","scaleToFitAxis","highlightBinDifferences","noVisibleTable","noRanges","rangeSets","primary","drawRanges","padIfNeeded","isArray","concat","arr","withN","primaryIndex","indexOf","dataRows","affectedByExtra","rowsAdded","rowInDisplay","varIndex","varDef","noDisplay","mainExpr","isInChoice","isChosen","isLastChoice","last","extrasHere","baseRow","styledExpr","styled","hasExtras","tokens","split","some","evn","extraData","isContextArray","rows","exit","attr","enter","append","rowItem","each","seln","on","rowSeln","isHighlightContext","rowVar","isContextDef","isActiveContextDef","rowCellGroups","category","xOffset","cells","rowSpec","text","cellGroup","groupObject","id","indexToHighlight","console","log","entryWidth","startOffset","extend","isFishy","fishWidth","fishItemWidth","e","indexInGroup","anchor","mouseover","cellItem","index","resetBinHighlight","mouseout","click","styledText","dataFocusIndex","offset","scaleLinear","domain","focusItemOffset","linearFocusOffset","cellSpec","dataIndex","isContext","binHighlight","weight","cellGroups","rcg","merge","groupSeln","cellClass","textOffsets","hanging","spaceBifocally","spans","colour","trapSeln","lineLocs","lines","maxRange","pictureCellGroups","rowCells","maxLen","unpacked","oneArray","vals","calloutVar","calloutIndex","extent","groupObj","calloutItem","isCallout","pcGroups","callouts","pictureCells","easeLinear","immediate","siblingItems","rectSeln","sizeFactor","topMargin","innerHeight","leftMargin","rightMargin","innerWidth","midX","baseCellX","sibling","transform","baseVal","matrix","mouse","xStep","round","xStart","numVerts","contextIndex","vertices","highlightBinNumber","newOptions","nonNulls","labels","yMid","isNumeric","mid","yForVal","yGap","adj","allStrings","uniq","sort","yFactor","si","stringyVals","JSON","stringify","collection","uniqueStrings","vert","animate","paths","line","p","dots","point","highlightVertex","find","primaryVertex","readouts","texts","hcl","darker","label","middle","circles","dotItem","node","elemClass","parentNode","raise","scenario","drawableBins","bin","lookup","vName","viaString","opacityHandler","xp","yp","triangleSetting","primaryOpacity","contextOpacity","noFader","drawFaderControl","pt","throttle","noDensity","drawDensityControl","widthValues","valueIndex","drawBinWidthControl","newValue","sweepControl","drawSweepControl","nBins","binWidth","sliceCounts","sliceWidth","sliceIndex","ceil","c","windowedCounts","nIterations","windowDiffs","finalBinStart","sliceCount","j","wCount","anchorPositions","scores","wDiff","sortedScores","sum","weightedSum","g","staggeredData","cutoffData","maxCount","valuesAndCountsDo","count","blobUnit","blobRadius","numBalls","stagger","clipLimit","cutoff","xScale","dataGroup","axisOrigin","axisHeight","tickDefs","labelDefs","instant","axisX","axisBase","labelType","baseline","highlightOnChange","empty","mainSpan","suffix","mainLeft","getBBox","dx","dy","refLines","primaryBins","rangeMax","scaleValues","rPretty","lastValue","maxBinHeight","maxMainBinHeight","heightScale","binGroup","showBins","binData","binClass","fillColour","classIndex","preWidth","rects","binItem","size","nodes","getAttribute","rectsE","binsAreDraggable","postWidth","num","roundTo","oddEven","allContext","binCollection","outlineContext","contextColour","contextBinFill","opacity","toString","restingBinFill","extraLabelSpacing","legendX","axisValues","dataUnits","baselineStart","baselineEnd","drawBinAnnotations","valueArray","initialIndex","handler","dragRegionOffset","stepSize","readoutColour","switchGroup","switchRect","switchReadout","switchW","central","minMaxIndicator","switchH","updateReadout","dragRect","startPt","startIndex","dragOffset","w","throttledMove","mouseup","event","preventDefault","mousemove","xDelta","newIndex","binBase","fallIntoBins","decimals","dataBinDecimals","demoGroup","throb","clearBreakValues","setTimerInfo","cleanup","current","thenDo","listOrigin","commandListOrigin","itemColour","commandsToDraw","commandList","maximumScrolledIndex","commandDefs","command","replayable","clickable","commandEntries","commandGroup","itemHeight","fontSize","boldWidth","nonBoldSpacing","centreX","buttonSize","symbol","symbolTriangle","buttonGap","jumpToStep","isCurrent","isFuture","handIndex","lastScrolledIndex","drawHandPointer","colourScale","bandLeft","plotOrigin","bandTop","fallAfterFlight","bandHeight","labelFontSize","fixedContext","chartFixedCanvas","getContext","drawNumber","step","maxStep","drawTime","drawForElapsedTime","elapsed","newStep","drawUpToStep","number","which","font","fillStyle","textAlign","fillText","drawLine","latestStep","perStep","startX","beginPath","rect","startTimer","tick","stopTimer","forceToEnd","labelFn","displayStep","cycleDirection","numScenarios","scenarioRecords","changeTime","pauseTime","shifting","autoStepping","abandoned","movingGroupSeln","controlStripWidth","controlStripHeight","controlStripOrigin","buttonRowOrigin","labelOrigin","dropDistance","controlGroup","stopTransition","desiredStep","transitionToScenario","stepAfterDelay","delayedStep","doStep","updateTitleText","basicFill","labelSpans","updateScenarioTexts","lower","nextGroupSeln","rectDefs","nextRects","binNum","height","indices","sampleRect","yBase","textDefs","nextTexts","sampleText","lineDefs","nextLines","sampleLine","preMoveRects","preMoveFirstRect","preMoveLastRect","preMoveFirstX","preMoveWidth","preMoveLastX","postMoveFirstX","postMoveWidth","postMoveLastX","cloneNode","datum","preY","preHeight","baseLine","checkForBinHighlight","duplicateObjects","widthExcess","binProbeX","indexRange","binHit","highlightPathIndices","highlightValueIndices","numberLineWidth","drawDataSelector","datasets","datasetsForSwitching","dataName","loadData","datasetsAvailable","chartGroup","buttonMidY","buttonHeight","dataLabelColour","labelX","firstButtonX","buttonWidth","readable","dn","datasetShortDescriptions","toLowerCase","readableName","descTexts","replace","switchDefs","switchEntries","hideTip","decorateSwitches","switchingAllowed","switchDataset","showTip","elem","box","getBoundingClientRect","tip","html","tipWidth","parseInt","padding","tipHeight","left","top","btoa","svgSource","privateSwitchDataset","replaySteps","drawDataUnits","valueListOrigin","unitLabelMiddle","unitLabels","histOrigin","showState","switchSize","initX","initY","baseLength","radius","offsetX","offsetY","faderGroup","drawKnob","xPercent","knobSeln","drag","dragstarted","dragged","dragended","indicatorSeln","start","end","PI","large","sin","cos","classed","yPercent","location","desiredTransform","imgGroup","pointerImageFlipped","allDone","oldTransform","attrTween","interpolateTransformSvg","drawNumberLine","rangeGroup","openMin","char","openMax","closedMin","closedMax","ends","endClass","drawRDefaultBinning","shiftProportion","widthProportion","dataValues","dataBinQuantum","breaks","breakPoint","firstShiftedBreak","newBreaks","baseWidth","adjustedWidth","filterValues","filterFn","valueSetDefs","bi","valueSet","right","dropBallsIntoBins","sweepActive","drawValueList","numEntries","stage","listHeight","valueListHeight","valueListX","valueListTop","listEntryHeight","valueListEntryHeight","focusEntryHeight","listWidth","valueListWidth","valueListFontSize","focusAreaTop","focusAreaLeft","listScale","itemsFittingList","baseOpacity","valueEntries","poolValueEntries","poolCentreX","poolCentreY","poolRadius","sqrt","distanceRand","random","fromCentre","offsetAngle","textAngle","diffX","diffY","dataDecimals","angle","moveTime","timeSpread","totalTime","flyAll","clearFixedCanvas","valueObj","flightStage","save","translate","rotate","restore","createListMousetrap","focusGroup","positionFromTop","firstInFocus","numToShow","lastInFocus","gatherRepeats","focusLineYs","items","valCount","addItem","multiplier","vi","numItems","focusListHeight","focusListTop","focusTexts","focusLines","synchronised","showLines","showScale","noScale","clearDemoBins","annotationGroup","balls","shuffle","array","currentIndex","temporaryValue","randomIndex","breakDefs","valueSetDef","delayBetweenBins","binDefs","maxBinCount","binCount","counts","binBalls","dropDelay","binDropDelay","totalCount","binIndices","countPlottedSoFar","binsE","showBallAsOutline","finishBins","counters","countersE","interrupted","binsToFill","ascending","addAxisAnnotations","numOfScaleValues","bisect","eezer","easePolyIn","appendChild","cloneSeln","yStart","addToBin","binIndex","finishDuration","binDef","binNode","binSeln","counterNode","counterSeln","duplicateBins","presentGroupNode","groupNodeClone","oldGroupNode","classes","newGroupNode","oldClass","newObj","guess","refDensity","off","generateRanges","optionalWidthPercent","widthPercent","flyBalls","clearDemoBalls","fixedCanvas","numValues","maxDelay","tFall","spreadDelay","chartCanvas","originX","fallHeight","flightTargetY","originYScale","originYIncrement","lineWidth","valIndex","uniqueValues","pathDefs","isPointInsidePath","pathStartY","pathXDiff","xDiff","pathYDiff","queryDiff","theta","acos","drawPath","arc","stroke","pathColour","targetX","firstOriginY","firstIndex","evtPoint","clearEphemeralCanvas","strokeStyle","numToHighlight","firstHighlightIndex","found","valueListIndex","pathDef","lastEnclosingIndex","pathWithinValue","midHighlight","indexList","hilited","ballClass","sines","cosines","piBy2000","plottableValues","valueDelay","delayScale","valueTFlight","firstY","allLanded","xTarget","cumulativeIndex","lastSettled","settledBalls","lastPathDrawn","staggerRatio","shownNumberLine","oneShot","twoPi","nextPlottable","valObj","sinceFirstTakeoff","useCircles","fallX","drawPaths","ctx","launched","firstStillFlying","firstStillFalling","sinceTakeoff","originY","yDiff","flightPoint","centreY","settleBalls","sinceFall","initialSpeed","lastFalling","fallPoint","fallY","baseIndex","evtX","probeValue","nearest","scan","binWidthPct","binOffsetPct","snapRange","snapTo","dataVal","binStart","binOffset","firstBin","binEnd","hoverOver","path","hoveredElem","elemRect","svgRect","chartSVG","ratio","sizeRatio","fullSizeLeft","fullSizeTop","fullSizeWidth","fullSizeHeight","outset","hoverOut","init","initChartInElement","element","initHistogramArea","dataset","initBinBehaviour","pointerOverBin","dragStarted","dragEnded","binNumber","findBinAround","highlightedBinNode","scenarioOrNull","applyBinHighlights","highlightColour","contextHighlightColour","primaryHighlightColour","color","__data__","dataItem","contextTextColour","primaryTextColour","descGroup","descFontSize","descText","textWidth","getComputedTextLength","findBin","dataTest","contextBaseColour","dragStartUnscaledX","dragStartMinBinX","draggableBinWidth","dragOffsetToCentre","dragBinIndex","recordedBinState","contextBaseOpacity","oddBinValues","stripeOffset","originalY","o","someBin","dragPoint","binMultiple","shiftedMinBinX","normalisedMinBinX","newOffset","deletePrevious","phosphorGroup","anyChanges","prevBin","initChartSubgroups","visMaxExtent","dataOrigin","tableOrigin","binFill","nakedHistOrigin","resetDataGroup","initChartSubstrates","divSeln","clearCanvas","canvSeln","clearRect","clearMousetraps","trapNames","clearDataRanges","clearDataBalls","desiredLoc","oldTrans","newTrans","easeQuadInOut","interpolator","easedTransform","drawBalls","newBalls","oldBalls","fadeTime","moveRatio","fadeRatio","initNakedHistogram","initScrolliness","scrollVis","stepDefs","stepDefinitions","visExtent","visSeln","stepController","initFnName","refreshFnName","activateFunctions","chartObj","activate","updateFunctions","update","lastIndex","activeIndex","ch","replay","originIndex","scrolledSections","restartIndex","replayPoint","first","prevRendered","progress","resetLastIndex","scroll","scroller","container","containerTop","containerMaxScroll","visMinExtent","textMinWidth","textMaxWidth","dispatch","sections","sectionPositions","navHeight","heightMargin","switchPos","stickPoint","textMargin","stepElems","visElem","throttledPosition","debouncedResize","timer","resize","stop","divWidth","visRatio","visMinWidth","textLimitedMaxWidth","heightLimitedMaxWidth","visWidth","visHeight","marginNeeded","lastSection","startPos","containerRect","pageYOffset","position","debounce","pos","newState","isDuring","sectionIndex","sectionTop","sectionLength","Infinity","belowSectionTop","wait","args","timeout","throttling","more","timeoutSet","whenDone","later","Date","now","action","callback","setVisExtents","scrollY","activateStep","drawCommandList","oldIndex","scrollTo","resizeChartSubstrates","iterate","rawData","binQuantum","quantum","units","minBins","maxBins","MPG","NBA","Geyser","Diamonds","Marathons","recordData","minBinsOverRange","maxBinsOverRange","subset","uv","subI","allData","valueScale","colourInterpolator","interpolateHcl","csv","row","loadLibs","Global","JSLoader","loadJs","prepareScenarioZone","rectObj","slowScenarioCycles","newExtent","ratioPercent","margin","scaleIndicator","bbox","bottom","pad","indicatorFence","x1","y1","x2","y2","canvas","internal_only","min_n","LN10","base","pow","base_toFixed","unit","pop","groupSelection","fieldWidth","fitsInField","groupElement","fishLock","xFish","bifocalScale","fishItem","fishCentre","xRatio","effectiveWidth","fishGroupElem","mouseInScaledRegion","siblingItem","timerInfo","spec"],"mappings":"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","file":"chartObject.js","sourceRoot":"../scripts","sourcesContent":["/*!\n\nchartObject.js for essay http://tinlizzie.org/histograms/ is released under the\n\nMIT License\n\nCopyright (c) 2016-2020 Aran Lunzer and Amelia McNamara\n\nPermission is hereby granted, free of charge, to any person obtaining a copy\nof this software and associated documentation files (the \"Software\"), to deal\nin the Software without restriction, including without limitation the rights\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the Software is\nfurnished to do so, subject to the following conditions:\n\nThe above copyright notice and this permission notice shall be included in all\ncopies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\nSOFTWARE.\n\n*/\n\nwindow.createChartObject = function createChartObject() {\nvar chartObject = {};\n\nchartObject.bifocalScale=function bifocalScale(availableWidth, totalWidth, focalFactor, itemWidth) {\n    // basic structure copied from https://bost.ocks.org/mike/fisheye/fisheye.js\n\n    // in a row of items, we want the centre of the first item and the centre of the last item not to move when focus is changed.  therefore these are treated as the anchors for the rescaling: we map a totalWidth less the width of one item to a field width less the same.  the client should request transforms ranging from 0 [centre of first] to (itemWidth * (numItems-1)) [centre of last]\n    var scale = d3.scaleIdentity(), available = availableWidth-itemWidth, total = totalWidth-itemWidth, fw = available/focalFactor;\n\n    // snarfed from d3 v3: https://github.com/d3/d3/blob/v3.5.17/src/core/rebind.js\n    // Copies a variable number of methods from source to target.\n    function d3_rebind(target, source) {\n      var i = 1, n = arguments.length, method;\n      while (++i < n) target[method = arguments[i]] = d3_rebind_inner(target, source, source[method]);\n      return target;\n    };\n\n    // Method is assumed to be a standard D3 getter-setter:\n    // If passed with no arguments, gets the value.\n    // If passed with arguments, sets the value and returns the target.\n    function d3_rebind_inner(target, source, method) {\n      return function() {\n        var value = method.apply(source, arguments);\n        return value === source ? target : value;\n      };\n    }\n\n    function rescale(_) {\n      var x = scale(_), pivots = rescale.pivots, maxIn = pivots[pivots.length-1].x;\n      if (x <= 0) return 0;\n      if (x >= total) return available;\n      var pi=1;\n      while (pi<pivots.length && pivots[pi].x < x) pi++;\n      var xMin = pivots[pi-1].x, yMin = pivots[pi-1].y, xMax = pivots[pi].x, yMax = pivots[pi].y;\n      return yMin + (yMax-yMin)*(x-xMin)/(xMax-xMin);\n    }\n\n    rescale.setup = function(f, focusInOutput) {\n        // focusInOutput = true means that the focus is specified in the compressed space that will be displayed, rather than the input range of totalWidth\n        rescale.pivots = [{ x: 0, y: 0 }];\n        if (total > available) {\n            // x represents input values, y the corresponding compressed output\n            var xRemainder = total-fw, // how much we need to fit in\n                yRemainder = available-fw,      // how much space we have\n                compressedScale = yRemainder/xRemainder;\n            if (focusInOutput) {\n                var focusMin = Math.min(available-fw, Math.max(0, f-fw/2)), focusMax = focusMin+fw;\n                if (focusMin > 0) rescale.pivots.push({ y: focusMin, x: focusMin/compressedScale });\n                if (focusMax < available) rescale.pivots.push({ y: focusMax, x: total-(available-focusMax)/compressedScale });\n            } else {\n                var focusMin = Math.min(total-fw, Math.max(0, f-fw/2)), focusMax = focusMin+fw;\n                if (focusMin > 0) rescale.pivots.push({ x: focusMin, y: focusMin*compressedScale });\n                if (focusMax < total) rescale.pivots.push({ x: focusMax, y: available-(total-focusMax)*compressedScale });\n            }\n        }\n        rescale.pivots.push({ x: total, y: available });\n//if (totalWidth>400 && !focusInOutput) console.log(f, focusMin, focusMax, rescale.pivots);\n    }\n\n    rescale.findItem = function(y) {\n        /* approximate method (twitchy because we estimate based on focussing at the arbitrary mouse point, whereas we then update the display by focussing at the middle of the nearest item).\n            i suspect there's no analytical way to do this properly.\n        */\n        rescale.focus(y, true);\n        var x = rescale.invert(y);\n\n//console.log(Math.round(y)+\"=>\"+Math.round(x)+\"=>\"+Math.round(rescale(x)));\n//console.log(Math.round(y)+\"=>\"+Math.round(x)+\"=>\"+(x/itemWidth).toFixed(1));\n        // x is a value in the scale's totalWidth space, which runs from half-way through the first item to half-way through the last.\n        return Math.floor(x/itemWidth+0.5);\n    }\n\n    rescale.invert = function(y) {\n        var pivots = rescale.pivots;\n        var x;\n        if (y <= 0) return 0;\n        if (y >= available) return total;\n        var pi=1;\n        while (pi<pivots.length && pivots[pi].y < y) pi++;\n        var xMin = pivots[pi-1].x, yMin = pivots[pi-1].y, xMax = pivots[pi].x, yMax = pivots[pi].y;\n        return xMin + (xMax-xMin)*(y-yMin)/(yMax-yMin);\n    }\n\n    rescale.focus = function(f, focusInOutput) {\n      rescale.setup(f, focusInOutput);\n      return rescale;\n    };\n\n    rescale.nice = scale.nice;\n    rescale.ticks = scale.ticks;\n    rescale.tickFormat = scale.tickFormat;\n\n    rescale.setup(0);\n\n    return d3_rebind(rescale, scale, \"domain\", \"range\");\n\n};\n\nchartObject.binData=function binData(data, ranges) {\n    // behind-the-scenes version, for use in estimating max bin count/density\n    var bins = [];\n    function testValue(range, v) {\n      return (range.minOpen ? v>range.min : v>=range.min) && (range.maxOpen ? v<range.max : v<= range.max);\n    }\n    for (var ri=0; ri<ranges.length; ri++) {\n    var range = ranges[ri]\n    bins.push({ min: range.min, max: range.max, values: data.filter(function(v) { return testValue(range, v) }) } );\n    }\n    return bins;\n};\n\nchartObject.buildTable=function buildTable(definitions, tableOptions) {\n//console.log(\"buildtable\", definitions)\n    var chart = this;\n    var data = this.data, dataMin = this.dataMin, dataMax = this.dataMax, dataRange = this.dataRange, dataQuantum = this.dataQuantum;\n\n    this.clearTable = function() { this.tableGroup.selectAll(\"*\").remove() }\n    // clear everything to do with the histogram - including all bins\n    this.clearHistogram = function() { this.histGroup.selectAll(\"*\").remove() }\n\n    this.clearTable();\n\n    delete chart.estimatedBinMax;   // if tableOptions.widthControl is true, this will be given a value each time the width setting changes\n    delete chart.countScaleMax;     // and this will be used to decide when the scale has changed\n    var binMax = this.estimateMaxBinSize(), binMaxDensity = this.estimateMaxBinDensity();\n    var varDefs = {}, orderedVarNames = [], choiceGroups = {}, chosen = {};\n    definitions.forEach(def=>{\n        var n=def.name;\n        orderedVarNames.push(n);\n        varDefs[n]=def;\n        // ugh.  javascript...\n        // if any context value has turned out as \"-0\", \"-0.0\" etc, remove the \"-\".\n        if (def.extra) def.extra.forEach((str,i)=>{ if (parseFloat(str)===0 && str[0]===\"-\") def.extra[i]=str.slice(1) });\n        if (def.choiceGroup) {\n            var group = choiceGroups[def.choiceGroup];\n            if (!group) group = choiceGroups[def.choiceGroup] = { choices: [] };\n            group.choices.push(n);\n            if (def.default) group.chosen = n;\n        }\n        });\n    var resultCache = {};\n    function resultHash(varExpressions, context) {\n        return orderedVarNames.map(function(vn) { return varExpressions[vn] }).join(\":\")+\":\"+(Object.keys(chosen).map(k=>chosen[k]).join(\":\")); //+\":\"+context;\n    }\n    var compute = eval(`(function(data, varExpressions, opts) {\n        // there are two ways to run this:\n        // 1. from scratch\n        // 2. with a pre-computed result set, supplied as opts.precomputed\n\n        var varNames = Object.keys(varExpressions);\n        // whenever a value is looked up, quantize to some reasonable number of places\n        var quantumLevel = 100000;\n        function quantize(v) {\n            if (typeof v !== \"number\") return v;\n            return Math.round(v*quantumLevel)/quantumLevel;\n        }\n        function RANGE(start, end, step) {\n            if (step===0 || Math.sign(step) !== Math.sign(end-start)) return [];\n            // the end value is meant to be non-inclusive.  don't let it get included just through JavaScript imprecision (e.g., 0.89999999 being accepted as less than 0.9).\n            var fuzzyEnd = end - step/1000; // close enough\n            var vals = [];\n            for (var v=start; v<fuzzyEnd; v+=step) vals.push(v);\n            return vals;\n        }\n        function COUNT(arr) { return arr.length }\n        function SUM(arr) { var s=0; arr.forEach(function(v) { return s+=v }); return s }\n        function FILTER_FN(arr, fn) { return arr.filter(fn) }\n        function G(nBins) { return chart.computeG(nBins) }\n        function RPrettyBreaks(dataMin, dataMax, n) { return chart.rPretty([dataMin, dataMax], n) }\n        function Sturges(data) { return Math.ceil(Math.log(data.length)/Math.log(2))+1 }\n        function ALL_BUT_FIRST(array) { return array.slice(1) }\n        function ALL_BUT_LAST(array) { return array.slice(0, -1) }\n        function PAIRS(array) { return lively.lang.arr.range(1,array.length-1).map(function(i) { return [quantize(array[i-1]), quantize(array[i])] }) }\n        function FILTER(data, lefts, rights, leftTests, rightTests, open) {\n            var leftFns = { \">\": function(left, v) { return v>left }, \"\": function(left, v) { return v>=left } };\n            var rightFns = { \"<\": function(right, v) { return v<right }, \"\": function(right, v) { return v<=right } };\n            return lefts.map(function(left, i) {\n                var right = rights[i];\n                var subset = FILTER_FN(data, function(v) { return leftFns[leftTests[i]](left, v) && rightFns[rightTests[i]](right, v) });\n                subset.stringyValueParts = open===\"L\" ? [ \"\", right ] : [ left, \"\" ];\n                return subset;\n                })\n        }\n        function iterations(vn) { var val=eval(vn); return lively.lang.arr.isArray(val) ? val.length : 0 }\n        var valStore = {};\n        function lookup(vn,index) {\n            var vals=valStore[vn];\n            var oneVal = lively.lang.arr.isArray(vals) ? vals[index] : vals; // assumes all array vars in a given expression have same number of elements\n            return quantize(oneVal);\n        }\n        var iterationsInForce = 0; // the size of the latest array result\n        function iterateIfNeeded(exprOrFn, reduce) {\n            var expr = typeof exprOrFn === \"function\" ? exprOrFn(chosen) : exprOrFn;\n            // if it's a template, parse it into tokens now\n            var replacementTokens = null;\n            if (expr.indexOf(\"{\")>=0) {\n                // odd-numbered tokens are variable refs\n                replacementTokens = (\" \"+expr).split(/[\\{\\}]/);\n            }\n            function contextualEval() {\n                return eval(replacementTokens ? replacementTokens.map(function(t,i) { t.length===0 ? \"\" : (i&1 ? eval(t) : t)}).join(\"\") : expr);\n            }\n            var varsInvolved = [];\n            var iterationsNeeded = 0;\n            if (!reduce) {\n                var tokens = expr.split(/\\\\W/); // all contiguous alphanumerics (needs extra slash because of being in a template)\n                if (tokens.indexOf(\"i\")>=0) iterationsNeeded = iterationsInForce;\n                else {\n                    varNames.forEach(function(vn) {\n                        if (tokens.indexOf(vn)>=0) {\n                            varsInvolved.push(vn);\n                            iterationsNeeded = Math.max(iterationsNeeded, iterations(vn));\n                        }\n                        });\n                if (iterationsNeeded) iterationsInForce = iterationsNeeded;\n                }\n            }\n            if (iterationsNeeded) {\n                varsInvolved.forEach(function(vn) { valStore[vn] = eval(vn) });\n                var result = [], iMax = iterationsNeeded-1;\n                for (var i=0; i<iterationsNeeded; i++) {\n                    varsInvolved.forEach(function(vn) {\n                      var val = lookup(vn, i);\n                      eval(vn+\"=val\");\n                      });\n                    result.push(contextualEval());\n                }\n                varsInvolved.forEach(function(vn) { eval(vn+\"=valStore.\"+vn) });\n                return result;\n            } else {\n                var val = contextualEval();\n                if (lively.lang.arr.isArray(val)) iterationsInForce = val.length;\n                return val;\n            }\n        }\n        ${ orderedVarNames.map(function(vn) { return \"var \"+vn+\";\"}).join(\" \") };\n        var pre, choiceSortedVars = [];\n        orderedVarNames.forEach(function(vn) {\n            if (choiceSortedVars.indexOf(vn)===-1) { // not added by a choice sibling\n                if (varDefs[vn].choiceGroup) {\n                    var group = choiceGroups[varDefs[vn].choiceGroup], choices = group.choices, chosen = group.chosen;\n                    choiceSortedVars.push(chosen);\n                    choices.forEach(function(cn) {\n                        if (cn!==chosen) {\n                            choiceSortedVars.push(cn);\n                            varExpressions[cn] = varDefs[cn].derivedMain;\n                        }\n                        });\n                } else choiceSortedVars.push(vn);\n            }\n            });\n        choiceSortedVars.forEach(function(vn) {\n            var val = opts.precomputed && (pre = opts.precomputed[vn]) !== undefined ? pre : iterateIfNeeded(varExpressions[vn], varDefs[vn].reduce);\n            eval(vn+\"=val\");\n            });\n        var result = { ${ orderedVarNames.map(function(vn) { return vn+\": \"+vn }).join(\", \") } };\n        if (opts.measure) result.measure = iterateIfNeeded(opts.measure, true);\n        return result;\n    })`);\n\n    function runComputation(data, varExpressions, measureExpression) {\n        Object.keys(choiceGroups).forEach(groupName=>{\n            var choiceState = choiceGroups[groupName];\n            chosen[groupName] = choiceState.chosen;\n            });\n        var hash = resultHash(varExpressions, contextVar);\n        var existing = resultCache[hash];\n        if (existing) {\n            if (!measureExpression || existing.hasOwnProperty(\"measure\"+measureExpression))\n                return existing;\n        }\n\n        var options = {};\n        if (measureExpression) options.measure = measureExpression;\n        if (existing) options.precomputed = existing;\n\n        var result = compute(data, varExpressions, options);\n        if (!existing) {\n            var cacheable = lively.lang.obj.clone(result);\n            if (measureExpression) {\n                cacheable[\"measure\"+measureExpression] = cacheable.measure;\n            }\n            orderedVarNames.forEach(vn=>{ if (varDefs[vn].noCache) delete cacheable[vn] });\n            resultCache[hash] = cacheable;\n        }\n        return result;\n    }\n    this.findClosestResult = function(expr, value, fiddleVar) {\n        var baseDef = {};\n        orderedVarNames.forEach(function(vn) { baseDef[vn] = varDefs[vn].main });\n        var extraResults = [], contextBins = [];\n        var extras = varDefs[fiddleVar].extra; // array of stringy expressions\n        extras.forEach(function(extraExpr) {\n            var extraDef = lively.lang.obj.clone(baseDef);\n            extraDef[fiddleVar] = String(extraExpr);\n            extraResults.push(runComputation(data, extraDef, expr));\n            });\n        var diff = 9999, minIndex;\n        extraResults.forEach((res, i)=>{\n            // in the event of a tie, we'll take the first\n            var newDiff = Math.abs(res.measure-value);\n            if (newDiff<diff) { diff=newDiff; minIndex=i }\n            });\n        var desiredValue = extras[minIndex];\n        if (varDefs[fiddleVar].main != desiredValue) {\n//console.log(\"change from \"+varDefs[fiddleVar].main+\" to \"+extras[minIndex]);\n            varDefs[fiddleVar].main = desiredValue;\n            //refreshTable({ force: true }, 0);  // now done by the client\n            return desiredValue;  // there was a change\n        }\n        return null; // no change\n    }\n\n    var fixups = [];\n    function defer(sel, func) {\n        fixups.push(lively.lang.fun.curry(function(s, trans) {\n            s\n                .transition(trans)\n                .call(func)\n            }, sel))\n    }\n    function runDeferred(dur) {\n        // does putting in a short delay help ensure that everything's ready to listen to the transition once it gets moving?\n        var t = d3.transition().duration(dur); //.delay(150);\n        fixups.forEach(function(f) { f(t) });\n        fixups = [];\n    };\n\n    var contextVar;\n    function toggleContextSpec(varName) {\n        if (contextVar===varName) contextVar = null;\n        else contextVar = varName;\n        scheduleEvent(\"\", 0, ()=>refreshTable({ force: true }, 500));  // force refresh\n    }\n\n    var edges = [ 10, 90, 450, 840 ], boxSize=10, boxGap=boxSize+8;\n    var xInset = 20, yInset = 20, rowHeight = 22, fontHeight = 13, spreadBackground=\"#eee\"; // d3.hsl(126,0.40,0.9);\n    var tableGroup = this.tableGroup;\n    var transformString = this.transformString;\n    function keyString(d) { return d.varName+d.reason }\n    function showChange(textSeln) {\n        textSeln\n            .interrupt()\n            .style(\"fill\", \"red\")\n            .transition()\n            .ease(d3.easeExpIn)\n            .duration(1000)\n            .style(\"fill\", d => d.fill || \"black\")\n    }\n\n    function stringyValue(val, varName) {\n        if (val===null) return \"\";\n\n        if (val.stringyValueParts) {\n            return val.stringyValueParts.map(vp=>stringyValue(vp, varName)).join(\"\");\n        }\n\n        var result = val;\n        if (!isNaN(val)) {\n            var roundIfAny = varDefs[varName].rounding;\n            if (roundIfAny!==undefined) result = Number(val).toFixed(roundIfAny);\n        }\n        return String(result)\n    }\n\n    /*\n    timing:\n        to reduce flickering as the user probes the interface, we allow interactions to set up delayed effects (e.g., removing a highlight) that can be cancelled if another event is triggered before the delay expires.  events are given a type: scheduling an event of type foo will cancel any previously queued foo event.  when the last specified delay expires (which could be immediately), the entire queue - which might contain non-foo events - will all be executed.\n\n        scheduleEvent(type, delay, f)\n        flushEventQueue(type)\n    */\n\n    var eventQueue = [];  // a list of { type, fn } objects\n    var eventTimeout;\n\n    function scheduleEvent(type, delay, f) {\n//console.log((Date.now())+\" sched: \"+type);\n        if (eventTimeout) { clearTimeout(eventTimeout); eventTimeout = null }\n        flushEventQueue(type);\n        eventQueue.push({type: type, fn: f});\n        if (delay) eventTimeout = setTimeout(runEvents, delay);\n        else runEvents();\n    }\n\n    function flushEventQueue(type) {\n        eventQueue = eventQueue.filter(evt=>evt.type!==type);\n    }\n\n    function runEvents() {\n//console.log((Date.now())+\" run \"+(eventQueue.length));\n        eventQueue.forEach(evt=>evt.fn());\n        eventQueue = [];\n    }\n\n    function objectsEqual(a, b) {\n        var aKeys = Object.keys(a), bKeys = Object.keys(b);\n        if (aKeys.length !== bKeys.length) return false;\n        for (var ai=0; ai<aKeys.length; ai++) {\n            var k = aKeys[ai];\n            if (!b.hasOwnProperty(k)) return false;\n            if (b[k] !== a[k]) return false;\n        }\n        return true;\n    }\n\n    // states that we want to support include:\n    //   a. no context, no focus\n    //   b. context, no focus\n    //   c. context, focus from within the context (i.e., highlight one scenario)\n    //   d. context, focus from another variable's context (change all scenarios; no highlight)\n    //   e. focus, no context\n    //\n    // override is controlled by mouseover (and mouseout) on context values.\n    // context state is set by switches.  note that a change in context state won't ever happen in the presence of an override.\n    var lastRefresh = {};\n    function refreshTable(options, duration) {   // options is an object { force, focusVar, focusIndex, dataFocusIndex }\n        options.isDragging = chart.isDragging;\n        options.useDensity = chart.useDensity;\n        // when we have a binwidth-control widget,\n        if (tableOptions.widthControl) {\n            if (!chart.estimatedBinMax) {\n                chart.estimatedBinMax = chart.estimateMaxBinSize(varDefs.width.main/chart.dataRange*100);\n            }\n            binMax = options.estimatedBinMax = chart.estimatedBinMax;\n        }\n        var forced = options.force; delete options.force;\n        if (!forced && objectsEqual(options, lastRefresh)) return;\n        lastRefresh = options;\n//console.log(\"refresh:\", lastRefresh);\n\n        if (contextVar) {\n            chart.histGroup.select(\"g.fader\").style(\"opacity\", 1);\n        } else {\n            chart.histGroup.select(\"g.fader\").style(\"opacity\", 0);\n\n            chart.recordBinState(\"primary\"); // for later highlight\n        }\n\n        function deriveBins(result, scenario) {\n            var drawableBins = [];\n\n            var bins = result.bins;\n\n            bins.forEach(function(bin, i) {\n                function lookup(vName, viaString) {\n                    var val = result[vName];\n                    if (lively.lang.obj.isArray(val)) val = val[i];\n                    return viaString ? Number(stringyValue(val, vName)) : val;\n                }\n                // NB: if leftTests and rightTests don't exist, they'll both be false.  it's up to the calling code to set noRanges in such a case.\n                drawableBins.push({min: lookup(\"lefts\", true), minOpen: lookup(\"leftTests\")==\">\", max: lookup(\"rights\", true), maxOpen: lookup(\"rightTests\")==\"<\", values: bin, scenario: scenario, dataIndex: i });\n                });\n            return drawableBins;\n        }\n\n        var baseDef = {};\n        var highlighting = !!options.focusVar && options.focusVar===contextVar, highlightIndex = highlighting ? options.focusIndex : null;\n        var focusOutwithContext = !!options.focusVar && !highlighting;\n        orderedVarNames.forEach(function(vn) { baseDef[vn] = focusOutwithContext && options.focusVar===vn ? varDefs[vn].extra[options.focusIndex] : varDefs[vn].main });\n        var mainResult = runComputation(data, baseDef), mainBins = deriveBins(mainResult);\n        var maxDataColumns = mainBins.length;\n        var extraResults = [], contextBins = [];\n        if (contextVar) {\n            var extras = varDefs[contextVar].extra; // array of stringy expressions\n            extras.forEach(function(extraExpr) {\n                var extraDef = lively.lang.obj.clone(baseDef);\n                extraDef[contextVar] = String(extraExpr);\n                extraResults.push(runComputation(data, extraDef));\n                });\n            extraResults.forEach(function(ex, i) {\n                var bins = deriveBins(ex, i);\n                contextBins.push(bins);\n                maxDataColumns = Math.max(maxDataColumns, bins.length);\n            });\n        }\n\n        chart.drawBins(mainBins, contextBins, {\n             useDensity: options.useDensity,\n             binMax: options.useDensity ? binMaxDensity : binMax,\n             highlight: highlightIndex,\n             extraAxisAnnotations: !!tableOptions.extraAxisValues,\n             scaleToFitAxis: !!tableOptions.widthControl\n             });\n\n        if (!contextVar) chart.highlightBinDifferences(\"primary\", !options.isDragging); // true to delete previous (@@ currently ignored by hBD)\n\n        if (!tableOptions.noVisibleTable) {\n            if (!tableOptions.noRanges) {\n                var rangeSets = { primary: mainBins, context: [] };\n                if (highlighting) rangeSets.context = contextBins[highlightIndex];\n                chart.drawRanges(rangeSets);\n            }\n\n            function padIfNeeded(data) {\n                if (lively.lang.obj.isArray(data) && data.length < maxDataColumns) {\n                    return data.concat(lively.lang.arr.withN(maxDataColumns-data.length, null))\n                }\n                return data;\n            }\n            var primaryIndex = contextVar ? varDefs[contextVar].extra.indexOf(varDefs[contextVar].main) : null; // slightly hacky assumption\n\n            var dataRows = [];\n            var affectedByExtra = [];\n            var rowsAdded = 0;\n            dataRows.push({ varName: \"dummy\", reason: \"rule\", rowInDisplay: rowsAdded });\n            orderedVarNames.forEach(function(vn, varIndex) {\n                var varDef = varDefs[vn];\n                if (!varDef.noDisplay) {\n                    var mainExpr = varDef.main;\n                    if (typeof mainExpr===\"function\") mainExpr = mainExpr(chosen);\n                    var isInChoice = !!varDef.choiceGroup, isChosen = isInChoice && choiceGroups[varDef.choiceGroup].chosen===vn, isLastChoice = isInChoice && lively.lang.arr.last(choiceGroups[varDef.choiceGroup].choices)===vn;\n\n                    // new apr 2017 (expt24): include any extraDefs in the var's main row\n                    var extrasHere = varDef.extra; // may be undefined\n                    if (extrasHere && !(isInChoice && !isChosen)) {\n                        dataRows.push({ varName: vn, baseRow: varIndex, rowInDisplay: rowsAdded++, reason: \"main\", hasExtras: true, expr: extrasHere, data: padIfNeeded(mainResult[vn]) });\n                        if (vn===contextVar) affectedByExtra.push(vn);\n                    } else {\n                        dataRows.push({ varName: vn, baseRow: varIndex, rowInDisplay: rowsAdded++, reason: \"main\", expr: isInChoice && !isChosen ? \"-\" : mainExpr, styledExpr: varDef.styled, data: padIfNeeded(mainResult[vn]) });\n                    }\n\n                    // and then any row needed for an extension coming from another var\n                    if (contextVar && (contextVar!==vn)) {\n                        /* each item in a context array is the value for a named variable in the context-defining execution.  the items may be arrays, and may have different sizes.  for example, for the variable \"left\" the context array could be:\n                                [\n                                array of 10 values,\n                                array of 11 values,\n                                array of 12 values,\n                                ...\n                                array of 18 values\n                                ]\n                        */\n                        var tokens = mainExpr.split(/\\W/);\n                        if (affectedByExtra.some(evn => tokens.indexOf(evn)>=0)) {\n                            affectedByExtra.push(vn);\n\n                            var extraData = extraResults.map(res=>res[vn]);\n                            extraData.isContextArray = true;\n\n                            dataRows.push({ varName: vn, baseRow: varIndex, rowInDisplay: rowsAdded, reason: \"extraShadow\", expr: \"\", data: [] });\n                            dataRows.push({ varName: vn, baseRow: varIndex, rowInDisplay: rowsAdded, reason: contextVar+\"extra\", expr: \"\", data: [], context: extraData });\n                            rowsAdded++;\n                        }\n                    }\n\n                    if (!(isInChoice && !isLastChoice)) dataRows.push({ varName: vn, reason: \"rule\", rowInDisplay: rowsAdded });\n                }\n                });\n    //console.log(dataRows);\n            var rows = tableGroup.selectAll(\".row\").data(dataRows, keyString);\n\n            rows.exit()\n                .attr(\"class\", \"defunctRow\")\n                .call(defer, function(s) {\n                    s\n                        .style(\"opacity\", 1e-6)\n                        .remove();\n                    });\n\n            // each rowItem has { varName, baseRow, rowIndisplay, reason, expr, data, context }\n            rows.enter().append(\"g\")\n                .attr(\"class\", \"row\")\n                .attr(\"transform\", rowItem => transformString(xInset, yInset+rowHeight*rowItem.rowInDisplay+1) )\n                .style(\"opacity\", rowItem => rowItem.reason===\"main\" ? 1 : 0)\n                .each(function(rowItem) {\n                    var seln = d3.select(this);\n                    if (rowItem.reason===\"rule\") {\n                        seln.append(\"line\")\n                        .attr(\"class\", \"rowSeparator\")\n                        .attr(\"x1\", 0)\n                        .attr(\"y1\", -1)\n                        .attr(\"x2\", lively.lang.arr.last(edges))\n                        .attr(\"y2\", -1)\n                        .style(\"stroke\", \"grey\")\n                        .style(\"stroke-width\", 0.75)\n                        .style(\"opacity\", 1)\n                        .style(\"pointer-events\", \"none\");\n                    } else {\n                        seln.append(\"rect\")\n                            .attr(\"class\", \"rowBackground\")\n                            .attr(\"x\", 0)\n                            .attr(\"y\", 0)\n                            .attr(\"width\", lively.lang.arr.last(edges))\n                            .attr(\"height\", rowHeight-2)\n                            .style(\"opacity\", 1);\n\n                        if (rowItem.hasExtras) {\n                            seln.append(\"rect\")\n                                .attr(\"class\", \"extraToggle\")\n                                .attr(\"id\", rowItem.varName+\"-extraToggle\")\n                                .attr(\"x\", edges[1])\n                                .attr(\"y\", (rowHeight-boxSize)/2-2)\n                                .attr(\"width\", boxSize)\n                                .attr(\"height\", boxSize)\n                                .style(\"fill\", \"green\")\n                                .style(\"fill-opacity\", 0.3)\n                                .style(\"stroke\", \"green\")\n                                .style(\"stroke-opacity\", 0.7)\n                                .style(\"stroke-width\", 2)\n                                .style(\"cursor\", \"pointer\")\n                                .on(\"click\", ()=>toggleContextSpec(rowItem.varName))\n                        }\n\n                        if (rowItem.reason===\"main\" && varDefs[rowItem.varName].choiceGroup) {\n                            seln.append(\"circle\")\n                                .attr(\"class\", \"choiceToggle\")\n                                .attr(\"cx\", edges[0]+boxSize/2)\n                                .attr(\"cy\", rowHeight/2-2)\n                                .attr(\"r\", boxSize/2)\n                                .style(\"fill\", \"green\")\n                                .style(\"fill-opacity\", 0.3)\n                                .style(\"stroke\", \"green\")\n                                .style(\"stroke-opacity\", 0.7)\n                                .style(\"stroke-width\", 2)\n                                .on(\"click\", ()=>{\n                                    choiceGroups[varDefs[rowItem.varName].choiceGroup].chosen=rowItem.varName;\n                                    contextVar = null;\n                                    refreshTable({ force: true }, 250);\n                                    });\n                        }\n                    }\n                    });\n\n            tableGroup.selectAll(\".row\").each(function(rowItem) {\n                var rowSeln = d3.select(this); // the g element for the row\n                var isHighlightContext = highlighting && rowItem.reason===contextVar+\"extra\";\n                var rowVar = rowItem.varName;\n                var isContextDef = !!rowItem.hasExtras, isActiveContextDef = isContextDef && rowVar===contextVar;\n\n                // set up the row background\n                rowSeln.select(\"rect.rowBackground\").style(\"fill\", (rowItem.reason===\"extraShadow\" || isActiveContextDef) ? spreadBackground : (rowItem.reason===\"main\" ? \"white\" : \"none\"));\n\n                defer(rowSeln, function(s) {\n                    s\n                        .attr(\"transform\", transformString(xInset, yInset+rowHeight*rowItem.rowInDisplay))\n                        .style(\"opacity\", 1)\n                    });\n\n                if (rowItem.reason===\"rule\") return;\n\n                var isInChoice = !!varDefs[rowVar].choiceGroup, isChosen = isInChoice && choiceGroups[varDefs[rowVar].choiceGroup].chosen===rowVar;\n\n                // set appearance of the \"extra values\" toggle, if there is one\n                rowSeln.select(\"rect.extraToggle\").style(\"fill-opacity\", isActiveContextDef ? 1 : 0);\n\n                // and the choices switch, if any\n                if (isInChoice) rowSeln.select(\"circle.choiceToggle\").style(\"fill-opacity\", isChosen ? 1 : 0);\n\n                // the data item associated with each cellItem within a row has { rowSpec, x, width, text, anchor } and optionally { indexInGroup, dataIndex, mouseover, mouseout, click }.  and maybe some other gunk.\n                var rowCellGroups = [];\n\n                // label column\n                if (rowItem.reason===\"main\") rowCellGroups.push({ category: \"label\", xOffset: edges[0], cells: [{ rowSpec: rowItem, text: rowVar, x: isInChoice ? boxGap : 0 }] });\n\n                // expression columns\n                if (rowItem.expr !== \"\") {\n                    var cellGroup = [], groupObject = { category: \"expr\", cells: cellGroup, xOffset: edges[1] };\n                    if (rowItem.reason===\"extraShadow\") cellGroup.push({rowSpec: rowItem, text: rowItem.expr, x: 32, fill: \"green\"}); // jan 2017: text is empty\n                    else if (!lively.lang.obj.isArray(rowItem.expr)) {\n                        groupObject.id = rowItem.varName+\"-expression\";\n                        cellGroup.push({rowSpec: rowItem, text: rowItem.expr, x: 0, styledText: rowItem.styledExpr});\n                    } else {\n                        if (rowItem.hasExtras) {\n                            groupObject.id = rowItem.varName+\"-extraGroup\";\n\n                            if (options.focusVar===rowVar) groupObject.focusIndex = groupObject.indexToHighlight = options.focusIndex;\n                            else {\n                                var varDef = varDefs[rowVar];\n                                groupObject.focusIndex = varDef.extra.indexOf(varDef.main);\n    if (groupObject.focusIndex==-1) console.log(\"can't find focus value in def:\",varDef);\n                            }\n                        }\n                        var entryWidth = 32, startOffset = rowItem.hasExtras ? boxGap : 0;\n                        lively.lang.obj.extend(groupObject, {\n                            isFishy: true,  // use distortion if needed\n                            fishWidth: edges[2]-edges[1]-startOffset-32,\n                            fishItemWidth: entryWidth\n                            });\n                        groupObject.xOffset += startOffset;\n                        rowItem.expr.forEach(function(e, i) {\n                            cellGroup.push({rowSpec: rowItem, indexInGroup: i, width: entryWidth, text: stringyValue(e, rowVar), x: i*entryWidth, anchor: \"middle\",\n                                // add handlers for probing alternative values from the \"extra\" list\n                                mouseover: function(cellItem) {\n                                    var vn = cellItem.rowSpec.varName, index = cellItem.indexInGroup;\n                                    scheduleEvent(\"probe\", 0, ()=>{\n                                        refreshTable({ focusVar: vn, focusIndex: index }, 250);\n                                        chart.resetBinHighlight()\n                                        });\n                                },\n                                mouseout: function(cellItem) {\n                                    scheduleEvent(\"probe\", 200, ()=>{\n                                        refreshTable({}, 250);\n                                        chart.resetBinHighlight()\n                                        });\n                                },\n                                click: function(cellItem) {\n                                    var vn = cellItem.rowSpec.varName, index = cellItem.indexInGroup;\n                                    varDefs[vn].main = varDefs[vn].extra[index];\n                                    scheduleEvent(\"probe\", 0, ()=>{\n                                        refreshTable({ focusVar: vn, focusIndex: index, force: true }, 250); // force refresh\n                                        chart.resetBinHighlight()\n                                        });\n                                }\n                                });\n                            });\n                    }\n                    if (cellGroup.length) rowCellGroups.push(groupObject);\n                }\n\n                // data columns\n                var entryWidth = 44;\n                if (lively.lang.obj.isArray(rowItem.data)) {\n                    var cellGroup = [], groupObject = {\n                        category: \"data\",\n                        cells: cellGroup,\n                        xOffset: edges[2],\n                        isFishy: true,\n                        fishWidth: edges[3]-edges[2]-xInset,\n                        fishItemWidth: entryWidth,\n                        focusIndex: (options.dataFocusIndex) || 0,\n                        };\n                    if (options.isDragging && rowItem.data.length) {\n                        var n = rowItem.data.length;\n                        if (mainResult.offset != 0) n--; // we have an extra item, so n is one less\n                        var scale = d3.scaleLinear().domain([0, (n+1)*entryWidth]).range([entryWidth, groupObject.fishWidth-entryWidth]);\n                        groupObject.focusItemOffset = scale((groupObject.focusIndex+mainResult.offset)*entryWidth);\n                        groupObject.linearFocusOffset = (mainResult.offset+1)*entryWidth;\n                    }\n                    rowItem.data.forEach(function(e, i) {\n                        var text = lively.lang.obj.isArray(e)\n                            ? \"{\"+(e.length)+\"}\"\n                            : stringyValue(e, rowVar);\n                        var cellSpec = {\n                            rowSpec: rowItem,\n                            text: text,\n                            x: i*entryWidth,\n                            width: entryWidth,\n                            anchor: \"middle\",\n                            dataIndex: i,\n                            indexInGroup: i,\n                            isContext: isHighlightContext\n                            };\n                        if (!isHighlightContext) {\n                            // for texty values, add mouseover behaviour (which will result in addition of an overlaid rect to do the detection)\n                            cellSpec.mouseover = function(cellItem) {\n                                scheduleEvent(\"probe\", 0, ()=>{\n                                    refreshTable({ dataFocusIndex: cellItem.dataIndex, binHighlight: cellItem.dataIndex }, 0);\n                                    });\n                                };\n                            cellSpec.mouseout = function(cellItem) {\n                                scheduleEvent(\"probe\", 200, ()=>{\n                                    refreshTable({ binHighlight: null }, 0);\n                                    });\n                                };\n                        }\n                        cellGroup.push(cellSpec);\n                        });\n                    if (cellGroup.length) rowCellGroups.push(groupObject);\n                } else {\n                    var startOffset = entryWidth/2;\n                    var val = stringyValue(rowItem.data, rowVar);\n                    rowCellGroups.push({ category: \"data\", xOffset: edges[2]+startOffset, cells: [{ rowSpec: rowItem, text: val, anchor: \"middle\", weight: \"bold\", x: 0, isContext: isHighlightContext }] });\n                }\n\n                var cellGroups = rowSeln.selectAll(\".cellGroup\").data(rowCellGroups, rcg=>rcg.category);\n                cellGroups.exit().remove(); // if we ever count on this (rather than just destroying the entire row), it might need a bit of finesse\n                cellGroups.enter().append(\"g\")\n                    .attr(\"class\", \"cellGroup\")\n                  .merge(cellGroups)\n                    .attr(\"transform\", groupObject => transformString(groupObject.xOffset,0))\n                    .each(function(groupObject) {\n                        var groupSeln = d3.select(this);\n                        var cellClass = groupObject.isFishy ? \"fishItem\" : \"cellItem\";\n                        if (groupObject.id) groupSeln.attr(\"id\", groupObject.id);\n\n                        var cells = groupSeln.selectAll(\".\"+cellClass).data(groupObject.cells, cellItem=>cellItem.indexInGroup);\n\n                        cells.exit()\n                            .attr(\"class\", \"defunctCell\")\n                            .interrupt()\n                            .each(function(cellItem) {\n                                var seln = d3.select(this);\n                                seln.select(\"text\").attr(\"class\",\"defunctText\")\n                                if (options.isDragging || cellItem.isContext) seln.remove(); // must be instant\n                                else defer(seln, function(s) {\n                                    s\n                                        .style(\"opacity\", 1e-6)\n                                        .remove();\n                                    });\n                                });\n\n                        cells.enter().append(\"g\")\n                            .attr(\"class\", cellClass)\n                            .each(function(cellItem) {\n                                var seln = d3.select(this);\n                                if (cellItem.mouseover) {\n                                    seln.append(\"rect\")\n                                        .attr(\"class\", groupObject.category+\"MouseTrap\")\n                                        .attr(\"y\", 1)\n                                        .attr(\"height\", isContextDef ? rowHeight-4 : rowHeight)\n                                        .style(\"fill-opacity\", groupObject.isFishy ? 1 : 0)\n                                        .style(\"stroke\", \"green\") // should never be seen\n                                        .style(\"stroke-width\", 1)\n                                        .style(\"stroke-opacity\", 0)\n                                        .style(\"cursor\", cellItem.click ? \"pointer\" : \"crosshair\")\n                                        .on(\"mouseover\", cellItem=>cellItem.mouseover(cellItem))\n                                        .on(\"mouseout\", cellItem=>cellItem.mouseout(cellItem))\n                                        .on(\"click\", cellItem=>{ if (cellItem.click) cellItem.click(cellItem); })\n                                }\n                                seln.append(\"text\")\n                                    .attr(\"class\", groupObject.category+\"TextCell\")\n                                    .attr(\"dy\", chart.textOffsets.hanging)\n                                    //.style(\"dominant-baseline\", \"hanging\")\n                                    .style(\"fill\", cellItem=>cellItem.fill || \"black\")\n                                    .style(\"font-size\", (isHighlightContext ? fontHeight-4 : fontHeight)+\"px\")\n                                    .style(\"font-weight\", cellItem=>cellItem.weight || \"normal\")\n                                    .style(\"text-anchor\", cellItem.anchor || \"start\")\n                                    .style(\"opacity\", groupObject.isFishy ? 0.2 : 1)\n                                    .style(\"pointer-events\", \"none\")\n                                    .style(\"-webkit-user-select\",\"none\");\n                                });\n\n                        if (groupObject.isFishy) chart.spaceBifocally(groupSeln, groupObject);\n\n                        d3.select(this).selectAll(\".\"+cellClass)\n                            .each(function(cellItem) { // @@ probably some efficiency improvements to be made here\n                                var seln = d3.select(this);\n                                if (!groupObject.isFishy) seln.attr(\"transform\", transformString(cellItem.x, 0));\n\n                                var textSeln = seln.select(\"text\");\n                                textSeln.attr(\"y\", isHighlightContext ? 0 : 4); // now redundant?\n\n                                if (cellItem.styledText) {\n                                    textSeln.attr(\"dy\", chart.textOffsets.hanging)\n                                    var spans = textSeln.selectAll(\"tspan\").data(cellItem.styledText);\n                                    spans.exit().remove();  // shouldn't happen\n                                    spans.enter().append(\"tspan\")\n                                        //.style(\"dominant-baseline\", \"hanging\")\n                                      .merge(spans)\n                                        .style(\"font-style\", d=>d.style)\n                                        .style(\"fill\", d=>d.colour || \"black\")\n                                        .text(d=>d.text);\n                                } else {\n                                    var oldText = textSeln.text();\n                                    if (oldText !== cellItem.text) textSeln.call(showChange);\n\n                                    textSeln.text(cellItem.text);\n                                }\n\n                                if (groupObject.isFishy) {\n                                    var trapSeln = seln.select(\"rect\");\n                                    trapSeln\n                                        .style(\"fill\", isActiveContextDef ? spreadBackground : \"white\");\n\n                                    // highlight (if groupObject wants it) by showing a border\n                                    if (groupObject.indexToHighlight === cellItem.indexInGroup) {\n                                        trapSeln\n                                            .style(\"stroke\", isActiveContextDef ? \"black\" : \"blue\")\n                                            .style(\"stroke-opacity\", 1);\n                                    } else trapSeln.style(\"stroke-opacity\", 0);\n\n                                    //var adjustedWidth = trapSeln.attr(\"width\");\n                                    var lineLocs = cellItem.text===\"\" ? [true] : [];\n                                    var lines = seln.selectAll(\"line\").data(lineLocs);\n                                    lines.exit().remove();\n                                    lines.enter().append(\"line\")\n                                        .attr(\"y1\", rowHeight/2)\n                                        .attr(\"y2\", rowHeight/2)\n                                        .style(\"stroke\", \"grey\")\n                                        .style(\"stroke-width\", 1)\n                                      .merge(lines)\n                                        .attr(\"x1\", -2)\n                                        .attr(\"x2\", 2)\n                                }\n                                });\n                        });\n\n                // @@ maybe want to merge this group into the general handling above\n                var maxRange = 0, probeFill = \"#d8d8d8\";\n                var pictureCellGroups = [];\n                if (rowItem.context) {\n                    var rowCells = [];\n                    // a context array is arranged by scenario, and if the values are arrays then these arrays might have different lengths.  we unpack them into an array by indices - each array having one value per scenario, with a null if the scenario doesn't have an entry at that index.\n                    var maxLen = d3.max(rowItem.context, val=>lively.lang.obj.isArray(val) ? val.length : 1), unpacked = [];\n                    for (var ai=0; ai<maxLen; ai++) {\n                        var oneArray = unpacked[ai] = [];\n                        rowItem.context.forEach(val=>{\n                            var v;\n                            if (lively.lang.obj.isArray(val)) {\n                                v = val.length > ai ? val[ai] : null\n                            } else {\n                                v = ai===0 ? val : null;\n                            }\n                            oneArray.push(v);\n                            });\n                    }\n                    var entryWidth = 44;\n                    unpacked.forEach(function(vals, i) {\n                        rowCells.push({\n                            rowSpec: rowItem,\n                            dataIndex: i,\n                            indexInGroup: i,\n                            x: i*entryWidth,\n                            width: entryWidth,\n                            values: vals,\n                            mouseover: function(cellItem) {\n    //console.log(\"over mousetrap \"+cellItem.dataIndex)\n                                scheduleEvent(\"probe\", 0, ()=>{\n                                    refreshTable({ dataFocusIndex: cellItem.dataIndex, calloutVar: cellItem.rowSpec.varName, calloutIndex: cellItem.dataIndex, binHighlight: cellItem.dataIndex }, 0);\n                                    //chart.highlightBinNumber(cellItem.dataIndex)\n                                    });\n                                },\n                            mouseout: function(cellItem) {\n    //console.log(\"out of \"+cellItem.dataIndex)\n                                scheduleEvent(\"probe\", 200, ()=>{\n                                    refreshTable({ binHighlight: null }, 0);\n                                    //chart.resetBinHighlight();\n                                    });\n                                }\n                            });\n                        if (vals.length && vals.some(v=>typeof v === \"number\")) {\n                            var ex = d3.extent(vals), range = ex[1]-ex[0];\n                            if (range>maxRange) maxRange=range;\n                        }\n                        });\n                    var groupObj = {\n                        cells: rowCells,\n                        xOffset: edges[2],\n                        isFishy: true,\n                        fishWidth: edges[3]-edges[2]-xInset,\n                        fishItemWidth: entryWidth,\n                        focusIndex: (options.dataFocusIndex) || 0,\n                        };\n\n                    if (rowItem.varName===options.calloutVar) {\n                        var calloutIndex = options.calloutIndex;\n                        groupObj.calloutItem = {\n                            isCallout: true,\n                            rowSpec: rowItem,\n                            dataIndex: calloutIndex,\n                            // x: calloutIndex*entryWidth,  never used\n                            width: entryWidth*2.5,\n                            values: unpacked[calloutIndex]\n                        };\n                    }\n\n                    pictureCellGroups.push(groupObj);\n                }\n                var pcGroups = rowSeln.selectAll(\".pictureCellGroup\").data(pictureCellGroups);\n                pcGroups.exit().remove();\n                pcGroups.enter().append(\"g\")\n                    .attr(\"class\", \"pictureCellGroup\")\n                  .merge(pcGroups)\n                    .attr(\"transform\", (groupObject) => transformString(groupObject.xOffset,0))\n                    .each(function(groupObject) {\n                        var groupSeln = d3.select(this);\n                        var cellClass = \"fishItem\";\n\n                        var callouts = [];\n                        if (groupObject.calloutItem) callouts.push(groupObject.calloutItem);\n\n                        var pictureCells = groupSeln.selectAll(\".\"+cellClass+\",.callout\").data(groupObject.cells.concat(callouts), cellItem=>cellItem.isCallout ? \"callout\" : cellItem.indexInGroup);\n\n                        // now that fishiness is the norm, disappearing cells shouldn't clutter up the fish zone by taking time to fade out\n                        pictureCells.exit().remove();  // just go\n\n                        pictureCells.enter().append(\"g\")\n                            .attr(\"class\", cellItem=>cellItem.isCallout ? \"callout\" : cellClass)\n                            .style(\"opacity\", cellItem=>cellItem.isCallout ? 1 : 0) // will be brought up by spaceBifocally\n                            .append(\"rect\")\n                                .attr(\"class\", \"pictureMouseTrap\")\n                                .attr(\"x\", cellItem=>-cellItem.width/2)\n                                .attr(\"y\", 0)\n                                .attr(\"width\", (cellItem) => cellItem.width)\n                                .attr(\"height\", cellItem=>cellItem.isCallout ? rowHeight*3 : rowHeight)\n                                .style(\"stroke\", \"none\")\n                                .style(\"fill\", cellItem=>cellItem.isCallout ? probeFill : \"none\")\n                                .style(\"cursor\", \"crosshair\") //cellItem=>cellItem.isCallout ? \"ew-resize\": \"crosshair\")\n                                .style(\"pointer-events\", \"all\");\n\n                        chart.spaceBifocally(groupSeln, groupObject);\n\n                        // the spaceBifocally call will have set all fishItems' widths instantly; the positions of their enclosing g elements might be changing in a timed transition\n                        var trans = d3.transition().duration(300).ease(d3.easeLinear);\n                        var immediate = d3.transition().duration(0);\n                        groupSeln.selectAll(\".\"+cellClass+\",.callout\")\n                            .each(function(cellItem, i, siblingItems) {\n                                var isCallout = cellItem.isCallout;\n                                var seln = d3.select(this), rectSeln = seln.select(\"rect\");\n                                rectSeln.style(\"fill\", cellItem.rowSpec.varName===options.calloutVar && cellItem.dataIndex===options.calloutIndex ? probeFill : \"none\");\n                                var sizeFactor = isCallout ? 2 : 1;\n                                var width = rectSeln.attr(\"width\"),\n                                    height = rectSeln.attr(\"height\"),\n                                    topMargin = isCallout ? 14 : 3,\n                                    bottomMargin = isCallout ? 10 : 3,\n                                    innerHeight = height-topMargin-bottomMargin,\n                                    leftMargin = isCallout ? 24 : 5,\n                                    rightMargin = isCallout ? 16 : 5,\n                                    innerWidth = Math.max(1, width-leftMargin-rightMargin),\n                                    midX = (leftMargin-rightMargin)/2;\n\n                                // a callout \"cell\" takes care of its own positioning, and has special mousemove behaviour\n                                if (isCallout) {\n                                    var baseCellX = 0;\n                                    d3.selectAll(siblingItems).each(function(sibling) {\n                                        if (sibling.dataIndex===cellItem.dataIndex && d3.select(this).attr(\"class\")===\"fishItem\") {\n                                            // extracting (in this case) the x translation from the transform http://stackoverflow.com/questions/38224875/replacing-d3-transform-in-d3-v4\n                                            baseCellX = this.transform.baseVal[0].matrix.e; }\n                                        });\n                                    seln\n                                        .attr(\"transform\", transformString(baseCellX, rowHeight-1));\n                                    rectSeln\n                                        .on(\"mouseout\", function(cellItem) {\n    //console.log(\"out of callout\");\n                                            scheduleEvent(\"probe\", 200, ()=>{\n                                                refreshTable({}, 0);\n                                                chart.resetBinHighlight();\n                                                })\n                                            })\n                                        .on(\"mousemove\", function(cellItem) {\n                                            if (!contextVar) return; // e.g., when context has been cancelled, and row is fading away\n                                            var x = d3.mouse(this)[0];\n                                            scheduleEvent(\"probe\", 0, function() {\n                                                var index = xStep === 0 ? 0 : Math.round((x-xStart)/xStep);\n                                                index = Math.max(0, Math.min(index, numVerts-1));\n                                                var contextIndex = vertices[index].contextIndex;\n                                                //chart.resetBinHighlight();\n                                                refreshTable({ focusVar: contextVar, focusIndex: contextIndex, dataFocusIndex: cellItem.dataIndex, calloutVar: cellItem.rowSpec.varName, calloutIndex: cellItem.dataIndex, binHighlight: null }, 0);\n                                                chart.highlightBinNumber(cellItem.dataIndex, contextIndex);\n                                                });\n                                            })\n                                        .on(\"click\", function(cellItem) {\n                                            if (options.focusIndex) {\n                                                var vn = contextVar, index = options.focusIndex;\n                                                varDefs[vn].main = varDefs[vn].extra[index];\n                                                var newOptions = lively.lang.obj.clone(options);\n                                                newOptions.force = true;\n                                                scheduleEvent(\"probe\", 0, ()=>{\n                                                    refreshTable(newOptions, 250);\n                                                    });\n                                            }\n                                            })\n                                }\n\n                                var vals = cellItem.values;\n                                if (vals.length===0) {\n                                    seln.selectAll(\"*\").remove();\n                                } else {\n                                    var nonNulls = vals.filter(v=>v!==null);\n                                    var vertices = [], labels = [];\n                                    var yMid=topMargin+innerHeight*0.5;\n                                    var isNumeric = nonNulls.some(v=>typeof v === \"number\");\n                                    if (isNumeric) {\n                                        var ex = d3.extent(nonNulls), mid=(ex[0]+ex[1])/2;\n                                        function yForVal(val) { return yMid-innerHeight*(maxRange==0 ? 0 : (val-mid)/maxRange) }\n                                        vals.forEach(function(v, i) {\n                                            if (v!==null) vertices.push({ y: yForVal(v), contextIndex: i });\n                                            });\n                                        if (isCallout) {\n                                            var nums = ex[0]==ex[1] ? [ex[0]] : ex;\n                                            labels = nums.map(n=>({ text: stringyValue(n, cellItem.rowSpec.varName), y: yForVal(n) }));\n                                            if (labels.length===2) {\n                                                var yGap = labels[0].y - labels[1].y;\n                                                if (yGap<10) {\n                                                    var adj = (10-yGap)/2;\n                                                    labels[0].y += adj;\n                                                    labels[1].y -= adj;\n                                                }\n                                            }\n                                        }\n                                    } else if (nonNulls.some(v=>typeof v === \"boolean\")) {\n                                        var yOffset=2;\n                                        vals.forEach(function(v, i) {\n                                            if (v!==null) vertices.push({ y: yMid+(v ? -yOffset : yOffset), contextIndex: i });\n                                            });\n                                    } else if (nonNulls.some(v=>typeof v === \"string\")) {\n                                        var allStrings = lively.lang.arr.uniq(nonNulls);\n                                        allStrings.sort();\n                                        var ex = allStrings.length-1, yFactor=ex===0 ? 0 : Math.min(4, innerHeight/ex);\n                                        vals.forEach(function(v, i) {\n                                            if (v!==null) {\n                                                var si = allStrings.indexOf(v); // we assume tiny collections\n                                                vertices.push({ y: yMid+yFactor*(si-ex/2), contextIndex: i });\n                                            }\n                                            });\n                                    } else if (nonNulls.some(v=>v.hasOwnProperty(\"collection\") || lively.lang.obj.isArray(v))) {\n                                        var stringyVals = vals.map(arr=>arr===null ? null : JSON.stringify(arr.collection ? arr.collection : arr));\n                                        var uniqueStrings = lively.lang.arr.uniq(stringyVals);\n                                        var ex = uniqueStrings.length-1, yFactor=ex===0 ? 0 : Math.min(4, innerHeight/ex);\n                                        stringyVals.forEach(function(v, i) {\n                                            if (v!==null) {\n                                                var si = uniqueStrings.indexOf(v); // we assume tiny collections\n                                                vertices.push({ y: yMid-yFactor*(si-ex/2), contextIndex: i });\n                                            }\n                                            });\n                                    }\n                                    var numVerts = vertices.length, xStep = numVerts <= 1 ? 0 : Math.min(innerWidth/(numVerts-1), 6*sizeFactor);\n                                    var xStart = midX - (numVerts-1)*0.5*xStep;\n                                    vertices.forEach(function(vert, i) {\n                                        vert.x = xStart + i*xStep;\n                                        });\n                                    var animate = !(isCallout || options.hasOwnProperty(\"focusIndex\"));\n                                    if (isNumeric) {\n                                        var paths = seln.selectAll(\"path\").data([vertices]);\n                                        paths.enter().append(\"path\")\n                                            .attr(\"class\", \"spark\")\n                                            .attr(\"d\", d3.line().x(p=>p.x).y(p=>p.y))\n                                            .style(\"stroke\", \"green\") // was highlighting ? \"black\" : \"green\"\n                                            .style(\"stroke-width\", sizeFactor)\n                                            .style(\"fill\", \"none\")\n                                            .style(\"pointer-events\", \"none\")\n                                          .merge(paths)\n                                            .interrupt()\n                                            .transition(animate ? trans : immediate)\n                                            .attr(\"d\", d3.line().x(p=>p.x).y(p=>p.y));\n                                    } else seln.selectAll(\"path\").remove();\n\n                                    var dots = isNumeric ? [] : vertices.map(vert=>({ point: vert, reason: \"base\" }));\n                                    var highlightVertex = highlighting && vertices.find(vert=>vert.contextIndex===highlightIndex);;\n                                    if (highlightVertex) dots.push({point: highlightVertex, reason: \"highlight\"});\n                                    var primaryVertex = vertices.find(vert=>vert.contextIndex===primaryIndex);\n                                    if (primaryVertex) dots.push({point: primaryVertex, reason: \"primary\"});\n\n                                    var readouts = (isCallout && options.hasOwnProperty(\"focusIndex\")) ? [stringyValue(vals[options.focusIndex], rowVar)] : [];\n                                    var texts = seln.selectAll(\"text.readout\").data(readouts);\n                                    texts.exit().remove();\n                                    texts.enter().append(\"text\")\n                                      .merge(texts)\n                                        .attr(\"class\", \"readout\")\n                                        .attr(\"x\", 0)\n                                        .attr(\"y\", 2)\n                                        .attr(\"dy\", chart.textOffsets.hanging)\n                                        .style(\"fill\", d3.hcl(73,100,75).darker(0.5))\n                                        .style(\"font-size\", (fontHeight)+\"px\")\n                                        .style(\"font-weight\", \"bold\")\n                                        //.style(\"dominant-baseline\", \"hanging\")\n                                        .style(\"text-anchor\", \"middle\")\n                                        .style(\"pointer-events\", \"none\")\n                                        .style('-webkit-user-select','none')\n                                        .text(String);\n\n                                    var texts = seln.selectAll(\"text.sparkLabel\").data(labels);\n                                    texts.exit().remove();\n                                    texts.enter().append(\"text\")\n                                      .merge(texts)\n                                        .attr(\"class\", \"sparkLabel\")\n                                        .attr(\"x\", 4-width/2)\n                                        .attr(\"y\", label=>label.y)\n                                        .attr(\"dy\", chart.textOffsets.middle)\n                                        .style(\"font-size\", (fontHeight-4)+\"px\")\n                                        //.style(\"dominant-baseline\", \"middle\")\n                                        .style(\"pointer-events\", \"none\")\n                                        .style('-webkit-user-select','none')\n                                        .text(label=>label.text);\n\n                                    var circles = seln.selectAll(\"circle\").data(dots);\n                                    circles.exit().remove();\n                                    circles.enter().append(\"circle\")\n                                        .attr(\"cx\", dotItem=>dotItem.point.x)\n                                        .attr(\"cy\", dotItem=>dotItem.point.y)\n                                      .merge(circles)\n                                        .attr(\"r\", dotItem=>dotItem.reason===\"base\" ? sizeFactor : 1.5*sizeFactor)\n                                        .style(\"fill\", dotItem=>dotItem.reason===\"highlight\" ? \"black\" : (dotItem.reason===\"primary\" ? \"blue\" : \"green\"))\n                                        .style(\"stroke-width\", 0)\n                                        .style(\"pointer-events\", \"none\")\n                                        .interrupt()\n                                        .transition(animate ? trans : immediate)\n                                        .attr(\"cx\", dotItem=>dotItem.point.x)\n                                        .attr(\"cy\", dotItem=>dotItem.point.y);\n\n                                }\n                                });\n                    });\n\n                });\n\n            // somewhat-hack: if there's a cell callout, bring its parent row to the top of all row groups\n            tableGroup.select(\".callout\").each(function(cellItem) {\n                var node = this, seln, elemClass;\n                while (node=node.parentNode,\n                        (elemClass=(seln=d3.select(node)).attr(\"class\")) !==\"row\"\n                            && elemClass !== \"defunctRow\"\n                        ) {}\n                if (elemClass!==\"defunctRow\") seln.raise();\n                });\n        }\n        tableGroup.raise();\n\n        if (options.hasOwnProperty(\"binHighlight\")) {\n            if (options.binHighlight===null) chart.resetBinHighlight();\n            else chart.highlightBinNumber(options.binHighlight);\n        }\n\n        runDeferred(duration || 0);\n    }\n    this.refreshTable = refreshTable;\n    this.scheduleEvent = scheduleEvent;\n\n    var group = this.histGroup;\n    var opacityHandler = (xp,yp)=>{\n        chart.triangleSetting = { x: xp, y: yp };\n        var x = xp*0.01, y = yp*0.01;\n        chart.primaryOpacity = y;\n        chart.contextOpacity = x*0.8; // fudge\n//console.log(xp, yp, chart.primaryOpacity, chart.contextOpacity)\n    \tgroup.selectAll(\"rect.primary\").style(\"opacity\", chart.primaryOpacity);\n    \tgroup.selectAll(\"rect.context\").style(\"opacity\", chart.contextOpacity);\n    }\n\n    if (tableOptions.noFader!==true) {\n        this.drawFaderControl(lively.pt(260, tableOptions.noVisibleTable ? 70 : 45), lively.lang.fun.throttle(opacityHandler, 100));\n        group.select(\"g.fader\").style(\"opacity\", 0);\n    }\n    if (tableOptions.noDensity!==true) this.drawDensityControl(lively.pt(480, tableOptions.noVisibleTable ? 55 : 30), ()=>refreshTable({}, 250));\n    if (tableOptions.widthControl) {\n        var widthValues = varDefs.width.extra; // array of stringy expressions\n        var valueIndex = widthValues.indexOf(varDefs.width.main);\n        this.drawBinWidthControl(lively.pt(420, 51), widthValues, valueIndex, newValue=>{\n            varDefs.width.main = newValue;\n            delete chart.estimatedBinMax;\n            refreshTable({ force: true }, 0);\n            });\n    }\n    if (tableOptions.sweepControl) {\n        this.drawSweepControl(lively.pt(0, 55), ()=>toggleContextSpec(\"offset\"));\n    }\n\n\n    refreshTable({ force: true, binHighlight: null }, 0);  // force refresh\n};\n\nchartObject.computeG=function computeG(nBins) {\n  // using the algorithm in the appendix of https://scholar.google.com/citations?view_op=view_citation&hl=en&user=7KgmBisAAAAJ&citation_for_view=7KgmBisAAAAJ:d1gkVwhDpl0C\n  //  K is nBins\n  //  T is anchorPositions - currently set to 100\n  //  h is dataRange/nBins\n  //  x1 is dataMin\n  //  bins m0...m((K+1)/T) are in sliceCounts\n  //  bins M0...M(KT) are in windowedCounts\n  //  scores S0...ST are in scores\n  // their algorithm creates the \"mj\" bin counts using open left, closed right ranges.  thus all x1 values would land in bin T-1 - i.e., (d0 + (T-1)h/t, d0 + h],  or  (x1 - h/T, x1]\n  // in the interests of consistency we re-create this outcome, by finding the difference between x and x1, dividing by the (mini-) bin width, taking the ceiling, and adding T-1.\n  var data = this.data, dataMin = this.dataMin, dataMax = this.dataMax, dataRange = dataMax-dataMin, binWidth = dataRange/nBins;\n  var anchorPositions = 100; // (offset 0 to 0.99 - calc'd as -1 to -0.01)\n  var sliceCounts = [], sliceWidth = binWidth/anchorPositions, firstEdge = dataMin - binWidth;\n  data.forEach(function(v) {\n    var sliceIndex = Math.ceil((v - dataMin)/sliceWidth) + anchorPositions - 1;\n    var c = sliceCounts[sliceIndex];\n    if (c === undefined) c = 1; else c++;\n    sliceCounts[sliceIndex] = c;\n    });\n  var windowedCounts = [], nIterations = nBins*anchorPositions, windowDiffs = [], finalBinStart = (nBins-1)*anchorPositions;\n  function sliceCount(j) { return sliceCounts[j] || 0 };\n  var wCount = sliceCount(anchorPositions-1); // M0\n  windowedCounts.push(wCount);\n  var scores = lively.lang.arr.withN(anchorPositions, 0);\n  scores[0] += wCount*wCount; // first element of S0\n  var t=1;\n  for (var j=1; j<nIterations; j++) {\n    wCount = wCount - sliceCount(j-1) + sliceCount(j+anchorPositions-1);\n    windowedCounts.push(wCount);\n    if (j>=anchorPositions) {\n      var wDiff = wCount-windowedCounts[j-anchorPositions];\n      windowDiffs.push(wDiff);\n      scores[t] += wDiff*wDiff;\n      if (j>=finalBinStart) {\n        scores[t] += wCount*wCount;\n      }\n    }\n    if (++t === anchorPositions) t=0;\n  }\n  var sortedScores = scores.slice();\n  sortedScores.sort(function(a,b) { return b-a }); // inverse order\n  var sum = 0, weightedSum = 0;\n  for (var i=1; i<=anchorPositions; i++) {\n    weightedSum += i * sortedScores[i-1];\n    sum += scores[i-1];\n  }\n  var g = (2*weightedSum/sum - 1)/anchorPositions;\n  return g;\n};\n\nchartObject.drawBalls=function drawBalls(data) {\n    // these go into dataGroup\n    var chart=this;\n\n    // draw balls based on our bag-like collection\n    var staggeredData = [], staggerRatio = 1.5, cutoffData = [], prev = null;\n    var maxCount = 0;\n    data.valuesAndCountsDo((val,count)=>maxCount = Math.max(maxCount, count));\n    var blobUnit = maxCount<=10 ? 1 : Math.floor(maxCount/10);\n    // make blobs at least a bit bigger if each represents multiple data points\n    var blobRadius = 2+Math.floor(Math.log(blobUnit)/Math.log(10));\n    data.valuesAndCountsDo((val,count)=>{\n        var numBalls = count/blobUnit; // (logBase**blobUnit);\n        for (var i=0;i<Math.ceil(numBalls);i++) staggeredData.push({ value: val, stagger: i*staggerRatio, clipLimit: i+1>numBalls ? numBalls-i : undefined });\n        cutoffData.push({ value: val, cutoff: numBalls});\n        });\n\tvar xScale = this.xScale;\n\tvar group = this.dataGroup;\n\n\tvar balls = group.selectAll(\"circle.ball\").data(staggeredData);\n\tballs.enter()\n\t    .each(function(d,i) {\n\t        // clipPath stuff following example in http://www.d3noob.org/2015/07/clipped-paths-in-d3js-aka-clippath.html\n\t        if (d.clipLimit) {\n\t            group.append(\"clipPath\")\n\t                .attr(\"id\", \"ballClipper\"+i)\n\t                .append(\"rect\")\n            \t\t.attr(\"x\", xScale(d.value)-blobRadius)\n            \t\t.attr(\"y\", -blobRadius*(d.clipLimit+2*d.stagger))\n            \t\t.attr(\"width\", 2*blobRadius)\n            \t\t.attr(\"height\", d.clipLimit*2*blobRadius)\n\t        }})\n\t\t.append(\"circle\")\n\t\t.attr(\"class\", \"ball\")\n\t\t.attr(\"cx\", d=>xScale(d.value))\n\t\t.attr(\"cy\", d=>-blobRadius*(1+2*d.stagger))\n\t\t.attr(\"r\", blobRadius)\n\t\t.style(\"fill\", \"black\")\n\t\t.style(\"stroke-width\", 0.5)\n\t\t.style(\"stroke\", \"black\")\n\t\t.attr(\"clip-path\", (d, i)=>d.clipLimit ? \"url(#ballClipper\"+i+\")\" : \"none\")\n\n\t\t.on(\"mouseover\", function(d) {\n\t\t    })\n\n\t\t.on(\"mouseout\", function(d) {\n            //group.selectAll(\"path.testing\").remove()\n\t\t    });\n\n/* if we go back to using datasets that need a blob to represent more than one data item\n\n\t// no good reason to use a data join for these.  but hey.\n\tvar legendBalls = group.selectAll(\"circle.legend\").data([0]);\n\tlegendBalls.enter()\n\t\t.append(\"circle\")\n\t\t.attr(\"class\", \"legend\")\n\t\t.attr(\"cx\", xScale.range()[1]+20)\n\t\t.attr(\"cy\", -10*blobRadius)\n\t\t.attr(\"r\", blobRadius)\n\t\t.style(\"fill\", \"black\");\n\tvar legendLabels = group.selectAll(\"text.legend\").data([0]);\n\tlegendLabels.enter()\n\t\t.append(\"text\")\n\t\t.attr(\"class\", \"legend\")\n\t\t.attr(\"x\", xScale.range()[1]+23+blobRadius)\n\t\t.attr(\"y\", -10*blobRadius+1)\n\t\t.style(\"font-size\", \"11px\")\n\t\t.style(\"dominant-baseline\", \"middle\")\n        .style('-webkit-user-select','none')\n        .text(\"= \"+blobUnit)\n*/\n};\n\nchartObject.drawBinAnnotations=function drawBinAnnotations(group, axisOrigin, axisHeight, tickDefs, labelDefs, instant) {\n    var chart=this;\n    var axisX = axisOrigin.x, axisBase = axisOrigin.y;\n\n    var labels = group.selectAll(\"text.histLabel\").data(labelDefs, def=>def.labelType+def.text);\n\tlabels.exit().remove();\n\tlabels.enter().append(\"text\")\n\t    .attr(\"class\", \"histLabel\")\n\t    .style(\"font-size\", \"10px\")\n\t    .style(\"fill\", \"grey\")\n\t\t.style(\"pointer-events\", \"none\")\n        .style(\"-webkit-user-select\",\"none\")\n        .each(function(def) {\n            var seln = d3.select(this);\n            if (!instant) {\n                seln\n                    .style(\"opacity\", 1e-6)\n                    .transition()\n                    .duration(500)\n                    .style(\"opacity\", 1)\n            }\n            })\n      .merge(labels)\n\t    .attr(\"x\", d=>d.x)\n\t    .attr(\"y\", d=>axisBase+d.y)\n        .attr(\"dy\", d=>chart.textOffsets[d.baseline || \"central\"])\n        .each(function(def) {\n            var seln = d3.select(this);\n            var spans = seln.selectAll(\"tspan\");\n            var highlight = def.highlightOnChange && (spans.empty() || d3.select(spans.node()).text()!==def.text);\n            spans.remove();\n            var mainSpan = seln.append(\"tspan\")\n                .text(def.text)\n        \t    .style(\"text-anchor\", d=>d.anchor || \"start\");\n            if (def.suffix) {\n                // mildly hacky.  we want to add a suffix (typically a units string) but have the first tspan be anchored as if it were on its own.  so we figure out where the anchoring tspan has been put, then fix it to a \"start\" anchor and explicit offset before appending a further tspan for the suffix.\n\n            \t// var mainLeft = mainSpan.node().getBBox().x; doesn't work on IE\n            \tvar mainLeft = this.getBBox().x;\n            \tmainSpan\n            \t    .style(\"text-anchor\", \"start\")\n            \t    .attr(\"dx\", mainLeft-def.x);\n            \tseln.append(\"tspan\").text(def.suffix);\n            }\n\n            if (highlight) {\n                seln\n                    .style(\"fill\", \"red\")\n                    .transition()\n                    .duration(1000)\n                    .style(\"fill\", \"grey\")\n            }\n            });\n\n\tvar ticks = group.selectAll(\"line.tick\").data(tickDefs);\n\tticks.exit().remove();\n\tticks.enter().append(\"line\")\n\t    .attr(\"class\", \"tick\")\n\t    .style(\"stroke\", \"grey\")\n\t    .style(\"stroke-width\", 1)\n      .merge(ticks)\n\t    .attr(\"x1\", d=>d.x)\n\t    .attr(\"x2\", d=>d.x+d.dx)\n\t    .attr(\"y1\", d=>axisBase+d.y)\n\t    .attr(\"y2\", d=>axisBase+d.y+d.dy);\n\n\tvar refLines = group.selectAll(\"line.yscale\").data([axisHeight]);\n\trefLines.enter().append(\"line\")\n\t    .attr(\"class\", \"yscale\")\n\t    .attr(\"x1\", axisX)\n\t    .attr(\"x2\", axisX)\n\t    .attr(\"y1\", axisBase)\n\t    .style(\"stroke-width\", \"1px\")\n\t    .style(\"stroke\", \"grey\")\n      .merge(refLines)\n\t    .attr(\"y2\", d=>axisBase-d);\n\n};\n\nchartObject.drawBins=function drawBins(primaryBins, contextBins, options) {\n    // options: useDensity, binMax, scaleToFitAxis, highlight, extraAxisAnnotations\n\n    // bins go into g.binGroup, a child of histGroup; scale goes directly into histGroup\n\n    // primaryBins is a collection of objects { min, max, values }\n    // contextBins is a collection of bin collections, where each bin also has a \"scenario\" property (numbered from 0)\n    // highlight is an optional scenario index used to put the highlight onto a context scenario, rather than on the primary\n\n    var chart = this;\n\n    var xScale = this.xScale;\n\tvar rangeMax = options.binMax, useDensity = options.useDensity, highlight = options.highlight, extraAxisAnnotations = options.extraAxisAnnotations;\n\t// if scaleToFitAxis is true, the height scale will be based on the generated \"pretty\" count scale\n    // draw a zero count as a vanishingly short bin (i.e., a line)\n\tvar scaleValues = this.rPretty([0, rangeMax], 5), lastValue = scaleValues[scaleValues.length-1];\n\tif (options.scaleToFitAxis) {\n\t    if (this.countScaleMax !== lastValue) chart.histGroup.selectAll(\"text.histLabel\").filter(def=>def.highlightOnChange).interrupt().remove();\n\t    rangeMax = this.countScaleMax = lastValue;\n\t}\n\tvar maxBinHeight = this.maxMainBinHeight;\n\t// if we're drawing a full axis, no need to fill in zero-height bins with a line\n    var heightScale = extraAxisAnnotations ? function(val) { return val/rangeMax*maxBinHeight } : function(val) { return val===0 ? 0.01 : val/rangeMax*maxBinHeight };\n\tvar histGroup = this.histGroup, binGroup = histGroup.select(\".binGroup\");\n    var transformString = this.transformString;\n\n\tfunction showBins(binData, binClass, fillColour) {\n\t    // binClass is \"primary\", \"context\", or \"contextOutline\"\n\t    // binData can be empty!\n\t    var classIndex = [\"primary\", \"context\", \"contextOutline\"].indexOf(binClass);\n\t    //var isPrimary = binClass===\"primary\", isContext = binClass===\"context\";\n    \tvar rects = binGroup.selectAll(\"rect.\"+binClass).data(binData, binItem=>binItem.dataIndex);\n    \trects.exit().remove();\n    \tvar preWidth;\n    \tif (binClass===\"primary\" && rects.size()) preWidth = +(rects.nodes()[0].getAttribute(\"width\"));\n    \tvar rectsE = rects.enter().append(\"rect\")\n    \t    .attr(\"class\", binClass+\" bin\");\n       \trects = rects.merge(rectsE);\n    \trects\n\t\t    .attr(\"x\", binItem=>xScale(binItem.min))\n\t\t\t.attr(\"y\", binItem=>-heightScale(useDensity ? binItem.values.length/(chart.data.length*(binItem.max-binItem.min)) : binItem.values.length))\n            .attr(\"width\", binItem=>xScale(binItem.max)-xScale(binItem.min))\n\t\t\t.attr(\"height\", binItem=>heightScale(useDensity ? binItem.values.length/(chart.data.length*(binItem.max-binItem.min)) : binItem.values.length))\n\t\t\t.style(\"fill\", fillColour)\n    \t    .style(\"stroke\", [\"blue\", \"none\", \"black\"][classIndex])\n    \t    //.style(\"fill-opacity\", isContext ? 0.15 : 1)\n    \t    .style(\"stroke-width\", [ contextBins.length ? 1 : 0.5, 0, 1 ][classIndex])\n    \t    .style(\"stroke-opacity\", [ 1, 0, 1 ][classIndex])\n            .style(\"opacity\", [ contextBins.length ? chart.primaryOpacity : 0.5, chart.contextOpacity, chart.primaryOpacity ][classIndex])\n            .attr(\"pointer-events\", [ \"all\", \"none\", \"none\" ][classIndex])\n\t\t\t.style(\"cursor\", chart.binsAreDraggable ? \"ew-resize\" : \"crosshair\")\n\t\t\t.each(function() {\n\t\t\t    if (binClass===\"primary\" || binClass===\"contextOutline\") d3.select(this).raise();\n    \t\t\t});\n        if (preWidth) {\n            // if widths of the primary bins have changed, reset any balls' odd/even annotation (so they can't be used this time around)\n            var postWidth = +(rects.nodes()[0].getAttribute(\"width\"));\n            if (lively.lang.num.roundTo(postWidth, 0.1)!==lively.lang.num.roundTo(preWidth, 0.1)) {\n//console.log(\"resetting odd/evens\", preWidth, postWidth);\n                chart.dataGroup.selectAll(\"circle.ball\")\n                    .each(function() { delete this.oddEven });\n            }\n        }\n\t}\n\n    // @@ experimental\n/*\n\tfunction showPoles(binData) {\n\t    var offsets = [];\n\t    binData.forEach((binItem, i)=>{\n\t        if (i===0) offsets.push(binItem.min);\n\t        offsets.push(binItem.max)\n\t        });\n\t    var lines = histGroup.selectAll(\"line.binPole\").data(offsets);\n    \tlines.enter().append(\"line\")\n    \t    .attr(\"class\", \"binPole\")\n    \t   .merge(lines)\n\t\t    .attr(\"x1\", off=>xScale(off))\n\t\t\t.attr(\"y1\", -250)\n\t\t    .attr(\"x2\", off=>xScale(off))\n\t\t\t.attr(\"y2\", -130)\n    \t    .style(\"stroke\", \"grey\")\n    \t    .style(\"stroke-width\", 0.5)\n            .attr(\"pointer-events\", \"none\")\n\n    \tlines.exit().remove();\n\t}\n*/\n\n//showPoles(primaryBins);   @@ probably want to use these when the bins are moved\n\tvar allContext = [];\n\tcontextBins.forEach(function(binCollection) {\n\t    allContext = allContext.concat(binCollection);\n    \t});\n    var outlineContext = allContext.filter(binItem=>binItem.scenario===highlight);\n    var contextColour = this.contextBinFill;\n    contextColour.opacity = 0.15;\n\tshowBins(allContext, \"context\", contextColour.toString());\n    showBins(primaryBins, \"primary\", allContext.length ? \"none\" : this.restingBinFill);\n    showBins(outlineContext, \"contextOutline\", \"none\");\n\n\tvar extraLabelSpacing = 9;\n\tvar legendX = xScale(this.dataMax)+40, lineLegendY = 12;\n\tvar labelDefs = [\n        { labelType: \"title\", x: legendX, anchor: \"start\", y: -heightScale(lastValue)-15, text: useDensity ? \"density\" : \"count\" }\n        ];\n    var tickLength = 4;\n    var tickDefs = [\n        { x: legendX, y: 0, dx: -tickLength, dy: 0 }    // a foot for the scale\n        ];\n\tscaleValues.forEach(v=>{\n\t    labelDefs.push({ labelType: \"yAxis\", x: legendX+tickLength+3, y: -heightScale(v), text: String(v), highlightOnChange: true });\n\t    tickDefs.push({ x: legendX, y: -heightScale(v), dx: tickLength, dy: 0 });\n\t    });\n\tif (extraAxisAnnotations) {\n\t    // not just min and max\n    \tvar axisValues = this.rPretty([this.dataMin, this.dataMax], 10);\n    \taxisValues.forEach(v=>{\n    \t    labelDefs.push({ labelType: \"xAxis\", x: xScale(v), anchor: \"middle\", y: lineLegendY, text: String(v) });\n    \t    tickDefs.push({ x: xScale(v), y: 0, dx: 0, dy: tickLength });\n    \t    });\n    \tlabelDefs[labelDefs.length-1].suffix = \" \"+this.dataUnits;\n    \t// add a very long \"tick\" to act as a baseline for the axis\n    \tvar baselineStart = xScale(axisValues[0]), baselineEnd = xScale(axisValues[axisValues.length-1]);\n    \ttickDefs.push({ x: baselineStart, y: 0, dx: baselineEnd-baselineStart, dy: 0 });\n\t} else {\n\t    [ { val: this.dataMin }, { val: this.dataMax, suffix: \" \"+this.dataUnits } ].forEach(def=>{\n\t        labelDefs.push({ labelType: \"xAxis\", x: xScale(def.val), anchor: \"middle\", y: lineLegendY, text: String(def.val), suffix: def.suffix });\n\t        tickDefs.push({ x: xScale(def.val), y: 0, dx: 0, dy: tickLength });\n    \t    });\n\t}\n    this.drawBinAnnotations(histGroup, { x: legendX, y: 0 }, heightScale(lastValue), tickDefs, labelDefs, true);  // instant\n};\n\nchartObject.drawBinWidthControl=function drawBinWidthControl(offset, valueArray, initialIndex, handler) {\n    // goes into histGroup\n    var chart=this;\n\n    var switchW = 50, switchH = 32, rectOffset = 75, dragRegionOffset = { x: offset.x+rectOffset, y: offset.y }, stepSize = 8, switchColour = \"#444\", readoutColour = \"black\";\n    var switchGroup = this.histGroup.append(\"g\").attr(\"class\", \"switchGroup\");\n\n    var valueIndex = initialIndex;\n\n    var switchRect = switchGroup\n        .append(\"rect\")\n        .attr(\"id\", \"widthControl\")\n        .attr(\"x\", dragRegionOffset.x)\n        .attr(\"y\", dragRegionOffset.y)\n        .attr(\"width\", switchW)\n        .attr(\"height\", switchH)\n        .style(\"border-width\", 1)\n        .style(\"stroke\", switchColour)\n        .style(\"fill\", \"none\")\n        .style(\"pointer-events\", \"none\")\n        .attr(\"stroke-dasharray\", \"2 4\");\n\n    var switchReadout = switchGroup\n\t    .append(\"text\")\n\t\t.attr(\"class\", \"readout\")\n\t\t.attr(\"x\", dragRegionOffset.x+switchW/2)\n\t\t.attr(\"y\", dragRegionOffset.y+switchH/3)\n\t\t.attr(\"dy\", this.textOffsets.central)\n\t\t.style(\"font-size\", \"14px\")\n\t\t.style(\"text-anchor\", \"middle\")\n\t\t//.style(\"dominant-baseline\", \"central\")\n\t\t.style(\"pointer-events\", \"none\")\n        .style(\"-webkit-user-select\",\"none\")\n        .style(\"fill\", readoutColour);\n\n    var minMaxIndicator = switchGroup\n\t    .append(\"text\")\n\t\t.attr(\"class\", \"minmax\")\n\t\t.attr(\"x\", dragRegionOffset.x+switchW/2)\n\t\t.attr(\"y\", dragRegionOffset.y+switchH*0.75)\n\t\t.attr(\"dy\", this.textOffsets.central)\n\t\t.style(\"font-size\", \"9px\")\n\t\t.style(\"text-anchor\", \"middle\")\n\t\t//.style(\"dominant-baseline\", \"central\")\n\t\t.style(\"pointer-events\", \"none\")\n        .style(\"-webkit-user-select\",\"none\")\n        .style(\"fill\", readoutColour);\n\n    function updateReadout() {\n        switchReadout\n            .interrupt()\n            .text(valueArray[valueIndex])\n            .style(\"fill\", \"red\")\n            .transition()\n            .duration(1000)\n            .style(\"fill\", readoutColour);\n        minMaxIndicator\n            .text(valueIndex===0 ? \"(MIN)\" : (valueIndex===valueArray.length-1 ? \"(MAX)\" : \"\"))\n    }\n    updateReadout();\n\n    var dragRect = switchGroup\n        .append(\"rect\")\n        .attr(\"class\", \"draggable\")\n        .attr(\"x\", dragRegionOffset.x)\n        .attr(\"y\", dragRegionOffset.y)\n        .attr(\"width\", switchW)\n        .attr(\"height\", switchH)\n        .style(\"fill\", \"none\")\n        .style(\"pointer-events\", \"all\")\n        .style(\"cursor\", \"ew-resize\") // \"col-resize\"\n//.style(\"stroke\", \"green\")\n        .on(\"mousedown\", function() {\n            // low-rent drag capability, as shown in https://bl.ocks.org/mbostock/4198499\n            var startPt = d3.mouse(this), startIndex = valueIndex, dragOffset = { x: startPt[0]-dragRegionOffset.x, y: startPt[1]-dragRegionOffset.y };\n              //.classed(\"active\", true);\n\n            var w = d3.select(window)\n                .on(\"mousemove\", ()=>{\n                    var pt = d3.mouse(switchRect.node());\n                    dragRect.attr(\"x\", pt[0]-dragOffset.x).attr(\"y\", pt[1]-dragOffset.y); // every time\n                    throttledMove(pt);  // in a controlled manner\n                    })\n                .on(\"mouseup\", mouseup);\n\n            d3.event.preventDefault(); // maybe not needed.  whatevs.\n\n            function mousemove(pt) {\n                var xDelta = pt[0]-startPt[0];\n                var newIndex = Math.max(0, Math.min(valueArray.length-1, startIndex + Math.floor(xDelta/stepSize)));\n                if (newIndex !== valueIndex) {\n                    valueIndex = newIndex;\n                    updateReadout();\n                    handler(valueArray[valueIndex])\n                }\n            }\n            var throttledMove = lively.lang.fun.throttle(mousemove, 100);\n\n            function mouseup() {\n                w.on(\"mousemove\", null).on(\"mouseup\", null);\n                dragRect.attr(\"x\", dragRegionOffset.x).attr(\"y\", dragRegionOffset.y);\n            }\n            });\n\n\tswitchGroup\n\t    .append(\"text\")\n\t\t.attr(\"class\", \"switchLabel\")\n\t\t.attr(\"x\", offset.x)\n\t\t.attr(\"y\", offset.y+switchH/3)\n\t\t.attr(\"dy\", this.textOffsets.central)\n\t\t.style(\"font-size\", \"14px\")\n\t\t//.style(\"dominant-baseline\", \"central\")\n\t\t.style(\"pointer-events\", \"none\")\n        .style(\"-webkit-user-select\",\"none\")\n        .style(\"fill\", switchColour)\n        .text(\"bin width\")\n\n\tswitchGroup\n\t    .append(\"text\")\n\t\t.attr(\"class\", \"switchLabel\")\n\t\t.attr(\"x\", offset.x)\n\t\t.attr(\"y\", offset.y+switchH*0.75)\n\t\t.attr(\"dy\", this.textOffsets.central)\n\t\t.style(\"font-size\", \"9px\")\n\t\t//.style(\"dominant-baseline\", \"central\")\n\t\t.style(\"pointer-events\", \"none\")\n        .style(\"-webkit-user-select\",\"none\")\n        .style(\"fill\", switchColour)\n        .text(\"(drag to change)\")\n\n};\n\nchartObject.drawBreakValues=function drawBreakValues(options) {\n    var chart=this;\n\n    var instant = !!(options && options.instant);\n\n    var stackBase = 0, dropDistance = this.fallIntoBins, binBase = stackBase+dropDistance;\n    var xScale = this.xScale;\n\n    var decimals = this.dataBinDecimals;\n    var labelDefs = [];\n\n    // the data element for a text.binbreak includes text, value, index\n    chart.demoGroup.selectAll(\"line.binbreak\").each(function(def, i) {\n        var seln=d3.select(this);\n        labelDefs.push({text: def.value.toFixed(decimals), value: def.value, index: i });\n        });\n    var labels = chart.demoGroup.selectAll(\"text.binbreak\").data(labelDefs, def=>def.index);\n    labels.exit().remove();\n    labels.enter().append(\"text\")\n        .attr(\"class\", \"binbreak\")\n        .attr(\"y\", binBase+10)\n        .attr(\"dy\", this.textOffsets.hanging)\n        .style(\"font-size\", \"12px\")\n        .style(\"text-anchor\", \"middle\")\n        //.style(\"dominant-baseline\", \"hanging\")\n        .style(\"pointer-events\", \"none\")\n        .style(\"-webkit-user-select\",\"none\")\n      .merge(labels)\n        .attr(\"x\", def=>xScale(def.value))\n        .text(def=>def.text)\n        .each(function() {\n            var seln = d3.select(this);\n            if (instant) seln.style(\"fill\", \"grey\");\n            else {\n                seln.style(\"fill\", \"red\");\n                function throb() {\n                    seln\n                        .transition()\n                        .duration(500)\n                        .style(\"fill\", \"gray\")\n                        .transition()\n                        .duration(500)\n                        .style(\"fill\", \"red\")\n                        .on(\"end\", throb);\n                }\n\n                throb();\n            }\n            });\n\n    function clearBreakValues() {\n        chart.demoGroup.selectAll(\"text.binbreak\").remove();\n    }\n    chart.clearBreakValues = clearBreakValues;\n\n    chart.setTimerInfo({\n        cleanup: ()=> {\n            chart.demoGroup.selectAll(\"text.binbreak\")\n                .interrupt()\n                .style(\"fill\", \"gray\")\n            }\n        });\n\n};\n\nchartObject.drawCommandList=function drawCommandList(current, thenDo) {\n    var chart=this;\n\n    var listOrigin = this.commandListOrigin, fontSize = 13, itemHeight = 20, buttonSize = 16, itemColour = \"rgb(0, 100, 0)\", buttonGap = 6;\n    var transformString = this.transformString;\n\n    var commandsToDraw = chart.commandList.slice(0, Math.max(current, chart.maximumScrolledIndex)+1);\n    var commandDefs = commandsToDraw.map((def, i)=>({ command: def.command, replayable: def.replayable, index: i }));\n    if (commandsToDraw.length < chart.commandList.length) {\n        commandDefs.push({ command: \"...(keep scrolling)\", replayable: false, clickable: false, index: commandsToDraw.length })\n    }\n\n    var commandEntries = chart.commandGroup.selectAll(\"g.command\").data(commandDefs, def=>def.index+def.command); // need to ensure the \"...\" line gets shifted\n    commandEntries.exit().remove();\n    commandEntries.enter().append(\"g\")\n        .attr(\"class\", \"command\")\n        .attr(\"transform\", (def, i)=>transformString(0, itemHeight*i))\n        .each(function(def,i) {\n            var seln = d3.select(this);\n            var text = seln\n                .append(\"text\")\n                .attr(\"x\", 0)\n                .attr(\"y\", itemHeight/2)\n        \t\t.attr(\"dy\", chart.textOffsets.middle)\n                .style(\"font-size\", fontSize+\"px\")\n                .style(\"font-weight\", 600)\n                .style(\"fill\", itemColour)\n                .style(\"fill-opacity\", 0.4)\n                .style(\"text-anchor\", \"start\")\n                .style(\"pointer-events\", \"none\")\n                .style('-webkit-user-select','none')\n                .text(def.command);\n\n            // space out the \"normal\"-weight text to match the length it'll have when bold\n            var boldWidth = text.node().getBBox().width;\n            text.style(\"font-weight\", \"normal\");\n            text.node().nonBoldSpacing = (boldWidth - text.node().getBBox().width)/def.command.length;\n\n            if (def.replayable) {\n                var centreX = boldWidth + buttonGap + buttonSize/2;\n\n                seln\n                    .append(\"circle\")\n                    .attr(\"class\", \"replay\")\n                    .attr(\"cx\", centreX)\n                    .attr(\"cy\", itemHeight/2)\n                    .attr(\"r\", buttonSize/2)\n                    .style(\"fill\", \"green\")\n                    .style(\"stroke\", \"green\")\n                    .style(\"stroke-width\", 1)\n                    .style(\"pointer-events\", \"none\");\n\n                seln\n                    .append(\"path\")\n                    .attr(\"d\", d3.symbol().type(d3.symbolTriangle).size(36))\n                    .attr(\"transform\", \"translate(\"+centreX+\" 10) rotate(90 0 0)\")\n                    .style(\"fill\", \"white\")\n                    .style(\"stroke\", \"green\")\n                    .style(\"stroke-width\", 1)\n                    .style(\"pointer-events\", \"none\");\n                }\n\n            if (!(def.clickable===false)) {\n                seln\n                    .append(\"rect\")\n                    .attr(\"x\", 0)\n                    .attr(\"y\", 0)\n                    .attr(\"width\", boldWidth + (def.replayable ? buttonGap+buttonSize : 0))\n                    .attr(\"height\", itemHeight)\n                    .style(\"fill\", \"none\")\n                    .style(\"pointer-events\", \"all\")\n                    .style(\"cursor\", \"pointer\")\n                    .on(\"click\", function(def) { chart.jumpToStep(def.index) });\n            }\n        });\n\n    function decorateList() {\n        chart.commandGroup.selectAll(\"g.command\")\n            .each(function(def,i) {\n                var isCurrent = i===current, isFuture = i > current;\n\n                var buttonSeln = d3.select(this).select(\".replay\");\n                //buttonSeln.style(\"fill\", isCurrent ? \"black\" : (isFuture ? \"green\" : \"white\"));\n                buttonSeln.style(\"fill\", isCurrent ? \"green\" : \"white\"); // simpler policy\n\n                var textSeln = d3.select(this).select(\"text\");\n                textSeln\n                    .text(def=>def.command)\n                    .interrupt()\n                    .style(\"fill\", isCurrent ? \"red\" : itemColour)\n                    .style(\"fill-opacity\", isFuture ? 0.5 : 1)\n                    .style(\"font-weight\", isCurrent ? 600 : \"normal\")\n                    .attr(\"letter-spacing\", isCurrent ? \"normal\" : textSeln.node().nonBoldSpacing+\"px\");\n                if (isCurrent) {\n                    textSeln.transition()\n                        .duration(2000)\n                        .style(\"fill\", itemColour);\n                }\n                });\n    }\n\n    decorateList();\n    chart.commandGroup.raise();\n\n    if (thenDo) thenDo();\n\n    var handIndex = this.lastScrolledIndex || 0;\n    this.drawHandPointer({ x: listOrigin.x - 4, y: listOrigin.y + (handIndex+0.5)*itemHeight+2 }\n    //,decorateList\n        );\n\n\n\n};\n\nchartObject.drawColouredNumberLine=function drawColouredNumberLine(options) {\n    var chart=this;\n\n    var instant = !!(options && options.instant);\n\n    var dataMin = this.dataMin, dataMax = this.dataMax, dataRange = dataMax-dataMin;\n    var xScale = this.xScale, colourScale = this.colourScale;\n    var bandLeft = this.plotOrigin.x, bandTop = this.plotOrigin.y -this.fallAfterFlight + 5, bandHeight = 10;\n    var labelFontSize = 14;\n    var fixedCanvas = this.chartFixedCanvas.node(), fixedContext = fixedCanvas.getContext(\"2d\");\n\n    drawNumber(dataMin, \"min\");\n\n    var step = 0, maxStep = 40, drawTime = 1000;\n    if (instant) {\n        drawUpToStep(maxStep);\n        drawNumber(dataMax, \"max\");\n    } else {\n        this.startTimer({\n            tick: elapsed=>{\n                drawForElapsedTime(elapsed);\n                if (step===maxStep) {\n                    chart.stopTimer(false);\n//console.log(\"finished\");\n                }\n                },\n            forceToEnd: ()=>drawForElapsedTime(drawTime)\n            })\n    }\n\n    function drawForElapsedTime(elapsed) {\n    //console.log(\"cnl\");\n        var newStep = Math.min(maxStep, Math.round(elapsed/drawTime*maxStep));\n        if (newStep!==step) {\n            drawUpToStep(newStep);\n            if (step===maxStep) drawNumber(dataMax, \"max\");\n        }\n    }\n\n    function drawNumber(number, which) {\n        fixedContext.font = labelFontSize+\"px Arial\";\n        fixedContext.fillStyle = colourScale(number);\n        fixedContext.textAlign = which===\"min\" ? \"end\" : \"start\";\n        var x = bandLeft + xScale(number) + (which===\"min\" ? -5 : 5);\n        fixedContext.fillText(String(number), x, bandTop+bandHeight);\n    }\n\n    function drawUpToStep(newStep) {\n        for (var s=step+1; s<=newStep; s++) drawLine(s);\n        step = newStep;\n    }\n\n    function drawLine(latestStep) {\n        var perStep = dataRange/maxStep;\n        var midValue = dataMin+(latestStep-0.5)*perStep, colour = colourScale(midValue, 1);\n        var startX = Math.floor(xScale(dataMin+(latestStep-1)*perStep));\n        if (latestStep===1) startX--;\n        var width = Math.floor(xScale(dataMin+latestStep*perStep))-startX;\n        // since we're using opaque colours, it's ok to overlap by a pixel (and avoids most of the glitchiness that otherwise appears when the canvas has been scaled down)\n        //if (latestStep===maxStep) width++;\n        width++;  // every time\n\n        fixedContext.fillStyle = colour;\n        fixedContext.beginPath();\n        fixedContext.rect(bandLeft+startX, bandTop, width, bandHeight);\n        fixedContext.fill();\n    }\n\n};\n\nchartObject.drawCyclingScenarios=function drawCyclingScenarios(labelFn) {\n    // not a pretty piece of code.\n\n    // cycling won't be launched unless the user pauses scrolling at this step.\n    // if user doesn't interact with the control strip, the animation will step automatically at a rate defined by pauseTime and changeTime.\n    // if user mouses over the strip, the selected scenario will be drawn instantly.  once the mouse leaves the strip, automatic stepping will resume from the selected scenario (and in the direction of the last automatic step).\n\n    var chart=this;\n\n    var scenarioClasses = \"rect.demobin,line.binbreak,text.binbreak\";\n    var numScenarios = this.scenarioRecords.length, changeTime = 400, pauseTime = 750, shifting = false;\n\n    var switchSize = 16, autoStepping = true, abandoned = false, displayStep, cycleDirection;\n    var movingGroupSeln = null;\n\n    // NB: going into demoGroup, so coords are relative to plotOrigin\n    var controlStripWidth = 150, controlStripHeight = 20, controlStripOrigin = { x: this.commandListOrigin.x-this.plotOrigin.x, y: this.buttonRowOrigin.y-this.plotOrigin.y }, labelOrigin = { x: controlStripOrigin.x, y: controlStripOrigin.y+controlStripHeight+10 };\n\n    var stackBase = 0, dropDistance = this.fallIntoBins, binBase = stackBase+dropDistance;\n\n    var controlGroup = this.demoGroup.append(\"g\").attr(\"class\", \"scenariocontrol\");\n    controlGroup.append(\"rect\")\n        .attr(\"id\", \"scenarioSwitcher\")\n        .attr(\"x\", controlStripOrigin.x)\n        .attr(\"y\", controlStripOrigin.y)\n        .attr(\"width\", controlStripWidth)\n        .attr(\"height\", controlStripHeight)\n        .style(\"stroke\", \"green\")\n        .style(\"fill-opacity\", 1e-6)\n        .style(\"cursor\", \"crosshair\")\n        .on(\"mouseover\", ()=>{\n            if (abandoned) return;\n\n            autoStepping = false;\n            stopTransition();\n            })\n        .on(\"mousemove\", function() {\n            if (abandoned) return;\n\n            var x = d3.mouse(this.parentNode)[0]-controlStripOrigin.x;\n            var desiredStep = Math.max(0, Math.min(Math.floor(numScenarios*x/controlStripWidth), numScenarios-1));\n//console.log(desiredStep);\n            if (desiredStep!==displayStep) transitionToScenario(desiredStep, true);\n            })\n        .on(\"mouseout\", ()=>{\n            if (abandoned) return;\n\n            autoStepping = true;\n            stepAfterDelay(0);\n            });\n\n    var delayedStep = null;\n    function stepAfterDelay(delay) {\n        if (delayedStep) clearTimeout(delayedStep);\n        delayedStep = null;\n\n        if (delay) {\n            delayedStep = setTimeout(doStep, delay);\n        } else {\n            doStep();\n        }\n\n        function doStep() {\n            if (abandoned || !autoStepping) return;  // either user has taken control by mousing over control strip, or we've left this stage of the essay\n\n            // bounce off the ends\n            if (displayStep===0) cycleDirection = 1;\n            else if (displayStep===numScenarios-1) cycleDirection = -1;\n\n            transitionToScenario(displayStep+cycleDirection, false); // not instant\n        }\n    }\n\n    function updateTitleText(val) {\n        var labelText = controlGroup.selectAll(\"text.scenarioTitle\").data([0]);\n        labelText.enter().append(\"text\")\n            .attr(\"class\", \"scenarioTitle\")\n            .attr(\"x\", labelOrigin.x)\n            .attr(\"y\", labelOrigin.y)\n    \t\t.attr(\"dy\", chart.textOffsets.hanging)\n            .style(\"font-size\", \"14px\");\n        // for now, we expect labelFn to return an array of objects with props { text, highlightOnChange }\n        var basicFill = \"grey\";\n        var labelSpans = controlGroup.select(\"text.scenarioTitle\").selectAll(\"tspan\").data(labelFn(val));\n        labelSpans.enter().append(\"tspan\")\n            .style(\"fill\", basicFill)\n            .style(\"-webkit-user-select\",\"none\")\n            .style(\"pointer-events\", \"none\")\n          .merge(labelSpans)\n            .each(function(def) {\n                var seln = d3.select(this);\n                seln.interrupt();\n                if (def.highlightOnChange && seln.text()!==def.text) {\n                    seln\n                        .style(\"fill\", \"red\")\n                        .transition()\n                        .duration(1000)\n                        .style(\"fill\", basicFill)\n                }\n                })\n            .text(def=>def.text);\n    }\n\n    function updateScenarioTexts(current) {\n        // current is zero-offset\n        var labels = controlGroup.selectAll(\"text.scenarioNumber\").data(lively.lang.arr.range(1, numScenarios));\n        labels.enter().append(\"text\")\n            .attr(\"class\", \"scenarioNumber\")\n            .attr(\"x\", n=>controlStripOrigin.x+(n-0.5)*controlStripWidth/numScenarios)\n            .attr(\"y\", controlStripOrigin.y+controlStripHeight/2)\n    \t\t.attr(\"dy\", chart.textOffsets.middle)\n    \t\t.style(\"text-anchor\", \"middle\")\n            .style(\"font-size\", \"16px\")\n            .style(\"-webkit-user-select\",\"none\")\n            .style(\"pointer-events\", \"none\")\n            //.text(String)\n          .merge(labels)\n            //.style(\"font-weight\", n=>n===current+1 ? \"bold\" : \"normal\")\n            //.style(\"opacity\", n=>n===current+1 ? 1 : 0.7)\n            .text(n=>n===current+1 ? \"\" : \"\")\n\n        var highlight = controlGroup.selectAll(\"rect.scenarioHighlight\").data([current]);\n        highlight.enter().append(\"rect\")\n            .attr(\"class\", \"scenarioHighlight\")\n            .attr(\"fill\", \"lightgray\")\n            .attr(\"width\", controlStripWidth/numScenarios-2)\n            .attr(\"height\", controlStripHeight-2)\n            .attr(\"y\", controlStripOrigin.y+1)\n          .merge(highlight)\n            .attr(\"x\", c=>controlStripOrigin.x+c*controlStripWidth/numScenarios+1)\n            .lower();\n    }\n\n    function transitionToScenario(scenario, instant) {\n        var nextGroupSeln = d3.select(chart.scenarioRecords[scenario].bins);\n\n        // we want to move the elements in movingGroup to the positions of the corresponding elements in nextGroup.  we do this by setting up data objects that hold the relevant attributes of the latter.\n        var rectDefs = [];\n        var nextRects = nextGroupSeln.selectAll(\"rect\");\n        nextRects.each(function(def) {\n            var seln = d3.select(this);\n            rectDefs.push({ binNum: def.binNum, x: +seln.attr(\"x\"), y: +seln.attr(\"y\"), width: +seln.attr(\"width\"), height: +seln.attr(\"height\"), indices: def.indices })\n            });\n        var sampleRect = nextRects.nodes()[0]; // suitable for cloning\n        var yBase = rectDefs[0].y+rectDefs[0].height; // as good as any\n\n        var textDefs = [];\n        var nextTexts = nextGroupSeln.selectAll(\"text\");\n        nextTexts.each(function(def, i) {\n            var seln = d3.select(this);\n            textDefs.push({ text: seln.text(), x: +seln.attr(\"x\"), index: i })\n            });\n        var sampleText = nextTexts.nodes()[0]; // for cloning\n\n        var lineDefs = [];\n        var nextLines = nextGroupSeln.selectAll(\"line\");\n        nextLines.each(function(def, i) {\n            var seln = d3.select(this);\n            lineDefs.push({ x: +seln.attr(\"x1\"), index: i })\n            });\n        var sampleLine = nextLines.nodes()[0]; // for cloning\n\n        shifting = true; // suppress bin hit-testing until the shift finishes\n        var trans = d3.transition().duration(instant ? 0 : changeTime);\n\n        var preMoveRects = movingGroupSeln.selectAll(\"rect.movingclone\"), preMoveFirstRect = d3.select(preMoveRects.nodes()[0]), preMoveLastRect = d3.select(preMoveRects.nodes()[preMoveRects.size()-1]), preMoveFirstX = +preMoveFirstRect.attr(\"x\"), preMoveWidth = +preMoveFirstRect.attr(\"width\"), preMoveLastX = +preMoveLastRect.attr(\"x\")+Number(preMoveLastRect.attr(\"width\"));\n        var postMoveFirstX = +rectDefs[0].x, postMoveWidth = +rectDefs[0].width, postMoveLastX = postMoveFirstX + postMoveWidth*rectDefs.length;\n\n        // @@ the following is utterly ridonculous\n        var rects = movingGroupSeln.selectAll(\"rect.movingclone\").data(rectDefs, def=>def.binNum);\n\n        rects.exit()\n            .attr(\"class\", \"defunctclone\")\n            .transition(trans)\n            .on(\"start.defunctrect\", function() {\n                d3.select(this)\n                    .style(\"stroke-opacity\", 1e-6)\n                    .style(\"fill-opacity\", 0.15)\n                    })\n            .attr(\"x\", def=>postMoveFirstX + def.binNum*postMoveWidth)\n            .attr(\"y\", yBase)\n            .attr(\"height\", 0)\n            .style(\"opacity\", 1e-6)\n            .style(\"stroke-opacity\", 1e-6)\n            .remove();\n\n        rects.enter().append(def=>{\n                var node = sampleRect.cloneNode();\n                d3.select(node).datum(def)\n                return node\n                })\n            .attr(\"class\", \"movingclone\")\n            .style(\"opacity\", 1e-6)\n            .style(\"stroke-opacity\", 1e-6)\n            .attr(\"x\", def=>preMoveFirstX + def.binNum*preMoveWidth)\n            .attr(\"y\", def=>def.y+def.height)\n            .attr(\"width\", def=>def.width)\n            .attr(\"height\", 0);\n\n        movingGroupSeln.selectAll(\"rect.movingclone\")\n            .each(function(def) {\n                var seln = d3.select(this);\n                def.preY = +seln.attr(\"y\");\n                def.preHeight = +seln.attr(\"height\");\n                });\n\n        movingGroupSeln.selectAll(\"rect.movingclone\")\n            .transition(trans)\n\n            .on(\"start.rect\", function(def) {\n                d3.select(this)\n                    .style(\"stroke-opacity\", 1e-6)\n                    .attr(\"y\", def=>def.preY-1)\n                    .attr(\"height\", def=>def.preHeight+1)\n                    })\n\n            .attr(\"x\", def=>def.x)\n            .attr(\"width\", def=>def.width)\n            .attr(\"height\", def=>def.height+2) // fudge for appearances' sake\n            .attr(\"y\", def=>def.y-2)\n            .style(\"opacity\", 1)\n            .transition()\n            .duration(instant ? 0 : 200)\n            .attr(\"y\", def=>def.y)\n            .attr(\"height\", def=>def.height)\n            .style(\"stroke-opacity\", 1);\n\n        var texts = movingGroupSeln.selectAll(\"text.movingclone\").data(textDefs, def=>def.index);\n\n        texts.exit()\n            .attr(\"class\", \"defunctclone\")\n            .transition(trans)\n            .attr(\"x\", def=>postMoveFirstX + def.index*postMoveWidth)\n            .style(\"opacity\", 1e-6)\n            .remove();\n\n        texts.enter().append(def=>{\n                var node = sampleText.cloneNode(true);  // need true for text\n                d3.select(node).datum(def)\n                return node\n                })\n            .attr(\"class\", \"movingclone\")\n            .style(\"opacity\", 1e-6)\n            .attr(\"x\", def=>preMoveFirstX + def.index*preMoveWidth)\n            .text(\"-\");\n\n        movingGroupSeln.selectAll(\"text.movingclone\")\n            .transition(trans)\n            .attr(\"x\", def=>def.x)\n            .style(\"opacity\", 1)\n            .on(\"end.text\", function(def) {\n                d3.select(this).text(def.text);\n                });\n\n        var lines = movingGroupSeln.selectAll(\"line.movingclone\").data(lineDefs, def=>def.index);\n\n        lines.exit()\n            .attr(\"class\", \"defunctclone\")\n            .transition(trans)\n            .attr(\"x1\", def=>postMoveFirstX + def.index*postMoveWidth)\n            .attr(\"x2\", def=>postMoveFirstX + def.index*postMoveWidth)\n            .style(\"opacity\", 1e-6)\n            .remove();\n\n        lines.enter().append(def=>{\n                var node = sampleLine.cloneNode();\n                d3.select(node).datum(def);\n                return node\n                })\n            .attr(\"class\", \"movingclone\")\n            .style(\"opacity\", 1e-6)\n            .attr(\"x1\", def=>preMoveFirstX + def.index*preMoveWidth)\n            .attr(\"x2\", def=>preMoveFirstX + def.index*preMoveWidth);\n\n        movingGroupSeln.selectAll(\"line.movingclone\")\n            .transition(trans)\n            .attr(\"x1\", def=>def.x)\n            .attr(\"x2\", def=>def.x)\n            .style(\"opacity\", 1);\n\n        var baseLine = movingGroupSeln.selectAll(\"line.base\").data([0]);\n        baseLine.enter().append(\"line\")\n            .attr(\"class\", \"base\")\n            .attr(\"y1\", yBase)\n            .attr(\"y2\", yBase)\n            .style(\"stroke-width\", 0.5)  // style copied from dropBallsIntoBins\n            .style(\"stroke\", \"grey\")\n          .merge(baseLine)\n            .attr(\"x1\", preMoveFirstX)\n            .attr(\"x2\", preMoveLastX)\n            .transition(trans)\n            .attr(\"x1\", postMoveFirstX)\n            .attr(\"x2\", postMoveLastX);\n\n        trans\n            .on(\"end\", function() {\n//console.log(\"end\");\n                if (abandoned) return;\n\n                shifting = false;\n                displayStep = scenario;\n                updateTitleText(chart.scenarioRecords[scenario].value);\n                updateScenarioTexts(scenario);\n                checkForBinHighlight();\n                if (autoStepping) stepAfterDelay(pauseTime);\n                });\n\n    }\n\n    function stopTransition() {\n        if (delayedStep) clearTimeout(delayedStep);\n        delayedStep = null;\n\n        if (movingGroupSeln) {\n            movingGroupSeln.selectAll(\"*\").interrupt();\n            movingGroupSeln.selectAll(\".defunctclone\").remove();\n        }\n    }\n\n    movingGroupSeln = d3.select(chart.duplicateObjects(chart.scenarioRecords[0].bins, \"rect,text,line\")); // NB: not the scenarioClasses, but these with \"clone\" added\n\n    movingGroupSeln.selectAll(\"*\")\n        .attr(\"class\", \"movingclone\");\n\n    // prepare the moving group's elements.  by default (see dropBallsIntoBins) the bins' fill is lightgray at 0.25 opacity.\n    movingGroupSeln.style(\"opacity\", 1);\n    movingGroupSeln.selectAll(\"text,line\")\n        .style(\"opacity\", 1);\n    movingGroupSeln.selectAll(\"rect\")\n        .style(\"fill\", \"lightgray\")\n        .style(\"fill-opacity\", 0.5)\n        .style(\"stroke-opacity\", 1);\n\n    // hide and de-sensitise the main-scenario elements\n    this.demoGroup.selectAll(scenarioClasses)\n        .style(\"opacity\", 0)\n        .style(\"cursor\", \"default\")\n        .on(\"mouseover\", null)\n        .on(\"mouseout\", null);\n\n    // add a mousetrap for highlighting the (changing) bin membership\n    var widthExcess = 100;\n    var binProbeX = null;\n    this.demoGroup.append(\"rect\")\n        .attr(\"class\", \"demobinMousetrap\")\n        .attr(\"x\", -widthExcess)\n        .attr(\"y\", stackBase)\n        .attr(\"width\", this.numberLineWidth+2*widthExcess)\n        .attr(\"height\", dropDistance)\n        .style(\"fill\", \"none\")\n        .style(\"pointer-events\", \"all\")\n        .style(\"cursor\", \"crosshair\")\n        .on(\"mousemove\", function() {\n            binProbeX = d3.mouse(this.parentNode)[0];\n            // highlighting waits until bins have settled\n            if (!shifting) checkForBinHighlight();\n            })\n        .on(\"mouseleave\", function() {\n            binProbeX = null;\n            // clearing is immediate (even while bins are shifting)\n            chart.highlightPathIndices([]);\n            chart.highlightValueIndices([]);\n            });\n\n    function checkForBinHighlight() {\n        if (binProbeX!==null) {\n            var indexRange = [];\n            var binHit = movingGroupSeln.selectAll(\"rect\").select(function() {\n                var x = Number(this.getAttribute(\"x\")), w = Number(this.getAttribute(\"width\"));\n                return binProbeX>=x && binProbeX<=x+w ? this : null;\n                });\n            if (binHit.size()) indexRange = binHit.datum().indices;\n\n            chart.highlightPathIndices(indexRange);\n            chart.highlightValueIndices(indexRange, true); // gather repeats\n        }\n    }\n\n    displayStep = 0;\n    cycleDirection = 1;\n\n    updateTitleText(chart.scenarioRecords[displayStep].value);\n    updateScenarioTexts(displayStep);\n\n    chart.setTimerInfo({\n        cleanup: ()=> {\n            abandoned = true;\n            stopTransition();\n            chart.demoGroup.selectAll(\"tspan\").interrupt();\n            chart.demoGroup.selectAll(\"g.scenariocontrol,rect.demoBinMousetrap,g.groupclone\").remove();\n            chart.scenarioRecords = [];\n            movingGroupSeln.remove();\n\n            // unhide main elements (but no need to restore event handlers)\n            chart.demoGroup.selectAll(scenarioClasses).style(\"opacity\", 1);\n            }\n        });\n\n    stepAfterDelay(pauseTime);\n\n// }\n\n};\n\nchartObject.drawDataSelector=function drawDataSelector(options) {\n    var instant = !!(options && options.instant);\n\n    var datasets = this.datasetsForSwitching;\n    if (datasets.indexOf(this.dataName)===-1) {\n        this.loadData(datasets[0]); // ...which needs to be synchronous (as it is, for \"mpg\")\n    }\n\n    this.datasetsAvailable = Math.min(this.datasetsAvailable, datasets.length);\n\n    var chart=this, chartGroup = this.chartGroup, transformString = this.transformString;\n\n    var buttonWidth = 50, buttonSep = 30, buttonHeight = 35, imageWidth = 35, imageHeight = 35, buttonMidY = this.buttonRowOrigin.y + buttonHeight/2;\n    var fontSize = 16, dataLabelColour = this.dataLabelColour;\n\n    var labelX = this.buttonRowOrigin.x;\n    var firstButtonX = labelX + buttonWidth/2; // centre of button\n\n    // short descriptions are stored under mixed-case keys, to be used as their human-readable names\n    function readable(dn) { return Object.keys(chart.datasetShortDescriptions).find(k=>k.toLowerCase()===dn) };\n\n    var dataName = this.dataName, readableName = readable(dataName);\n    var descTexts = chartGroup.selectAll(\"text.datadesc\").data([\n        { x: labelX-5, anchor: \"end\", colour: \"black\", text: \"dataset:\" },\n        { x: labelX, anchor: \"start\", colour: this.dataLabelColour, text: readableName+\"\"+(this.datasetShortDescriptions[readableName].replace(/\\<br\\/\\>/m,\" \")) }\n        ]);\n    descTexts.enter().append(\"text\")\n        .attr(\"class\", \"datadesc\")\n        .attr(\"y\", buttonMidY+buttonHeight/2+10)\n\t\t.attr(\"dy\", chart.textOffsets.hanging)\n        .style(\"font-size\", fontSize+\"px\")\n        .style(\"pointer-events\", \"none\")\n        .style('-webkit-user-select','none')\n      .merge(descTexts)\n        .attr(\"x\", def=>def.x)\n\t\t.style(\"text-anchor\", def=>def.anchor)\n\t\t.style(\"fill\", def=>def.colour)\n        .text(def=>def.text);\n\n    var switchDefs = datasets.slice(0, this.datasetsAvailable).map(dn=>({ dataName: dn, readableName: readable(dn) }));\n\n    var switchEntries = chartGroup.selectAll(\"g.dataswitch\").data(switchDefs, def=>def.dataName);\n    switchEntries.exit().remove();\n    switchEntries.enter().append(\"g\")\n        .attr(\"class\", \"dataswitch\")\n        .attr(\"transform\", (def, i)=>transformString(firstButtonX+i*(buttonWidth+buttonSep), buttonMidY))\n        .style(\"opacity\", 1e-6)\n        .each(function(def, i) {\n            var seln = d3.select(this);\n            seln\n                .append(\"rect\")\n                .attr(\"x\", -buttonWidth/2)\n                .attr(\"y\", -buttonHeight/2)\n                .attr(\"width\", buttonWidth)\n                .attr(\"height\", buttonHeight)\n                .style(\"fill\", \"#e6830f\")\n                .style(\"fill-opacity\", 0.2)\n                .style(\"stroke\", dataLabelColour)\n                .style(\"stroke-width\", 2)\n                .style(\"stroke-opacity\", 0)\n                .on(\"click\", def=>{\n                    if (chart.datasetsAvailable > 1) {\n                        hideTip();\n                        chart.switchDataset(def.dataName);\n                    }\n                    })\n                .on(\"mouseover\", function(def) {\n                    showTip(this, '<b>'+def.readableName + '</b><br/>' + chart.datasetShortDescriptions[def.readableName])\n                    })\n                .on(\"mouseout\", hideTip);\n\n            seln\n                .append(\"image\")\n                .attr(\"width\", imageWidth)\n                .attr(\"height\", imageHeight)\n                .attr(\"xlink:href\", def=>\"data:image/svg+xml;base64,\"+window.btoa(chart.svgSource(def.dataName)))\n                .attr(\"x\", -imageWidth/2)\n                .attr(\"y\", -imageHeight/2 + 5)  // fudge\n                .style(\"pointer-events\", \"none\");\n\n            });\n\n    // tooltip code adapted from  http://bl.ocks.org/d3noob/a22c42db65eb00d4e369\n    function showTip(elem, text) {\n        var box = elem.getBoundingClientRect();\n        var tip = d3.select(\"div.vistooltip\"), padding = 8; // NB: tied to scrolly.css\n        tip.html(text);\n        var tipWidth = Number.parseInt(tip.style(\"width\"))+padding*2, tipHeight = Number.parseInt(tip.style(\"height\"))+padding*2;\n        // NB: tooltip position style is \"fixed\", in case user scrolls\n        tip\n            .style(\"left\", box.left + box.width/2 - tipWidth/2 + \"px\")\n            .style(\"top\", box.top - tipHeight - 1 + \"px\");\n        tip.transition()\n            .duration(200)\n            .style(\"opacity\", 1);\n    }\n    function hideTip() {\n        d3.select(\"div.vistooltip\")\n            .transition()\n            .duration(500)\n            .style(\"opacity\", 0);\n    };\n\n    function decorateSwitches() {\n        var switchingAllowed = chart.datasetsAvailable > 1;\n        chartGroup.selectAll(\"g.dataswitch rect\")\n            .style(\"cursor\", switchingAllowed ? \"pointer\" : \"default\")\n            .style(\"stroke-opacity\", def=>switchingAllowed && def.dataName===chart.dataName ? 1 : 0);\n    }\n    decorateSwitches();\n\n    // now that the switches are decorated, apply the opacity - maybe as a transition\n    chartGroup.selectAll(\"g.dataswitch\")\n        .transition()\n        .duration(instant ? 0 : 1000)\n        .style(\"opacity\", 1);\n\n    // NB: method switchDataset, which is triggered from some links in the text, accesses privateSwitchDataset - first calling drawDataSelector to initialise the switches if necessary\n    chart.privateSwitchDataset = function(dataName) {\n        this.loadData(dataName, ()=>{\n            decorateSwitches();\n            this.replaySteps();\n            });\n    }\n\n};\n\nchartObject.drawDataUnits=function drawDataUnits() {\n\n    var chart=this, chartGroup = this.chartGroup;\n\n    var fontSize = 14;\n    var plotOrigin = this.plotOrigin;\n    var labelX = plotOrigin.x+this.valueListOrigin.x+10; // same as numbers in value list\n    var unitLabelMiddle = plotOrigin.y - this.fallAfterFlight + 9;  // same as middle of coloured number line\n\n    var unitLabels = chartGroup.selectAll(\"text.dataunits\").data([\n        { x: labelX-5, anchor: \"end\", colour: \"black\", text: \"unit:\" },\n        { x: labelX, anchor: \"start\", colour: this.dataLabelColour, text: this.dataUnits }\n        ]);\n    unitLabels.enter().append(\"text\")\n        .attr(\"class\", \"dataunits\")\n        .attr(\"y\", unitLabelMiddle)\n\t\t.attr(\"dy\", chart.textOffsets.middle)\n        .style(\"font-size\", fontSize+\"px\")\n        .style(\"pointer-events\", \"none\")\n        .style('-webkit-user-select','none')\n      .merge(unitLabels)\n        .attr(\"x\", def=>def.x)\n\t\t.style(\"text-anchor\", def=>def.anchor)\n\t\t.style(\"fill\", def=>def.colour)\n        .text(def=>def.text);\n};\n\nchartObject.drawDensityControl=function drawDensityControl(offset, handler) {\n    // goes into histGroup\n    var chart=this;\n\n    var histGroupOrigin = this.histOrigin;\n\n    var switchSize = 12, switchColour = \"#444\";  // dark grey\n\n    this.histGroup\n        .append(\"rect\")\n        .attr(\"class\", \"switch\")\n        .attr(\"id\", \"densitySwitch\")\n        .attr(\"x\", offset.x)\n        .attr(\"y\", offset.y)\n        .attr(\"width\", switchSize)\n        .attr(\"height\", switchSize)\n        .style(\"border-width\", 1)\n        .style(\"stroke\", switchColour)\n        .style(\"fill\", switchColour)\n        .style(\"cursor\", \"pointer\")\n        .each(function() { showState(this) })\n        .on(\"click\", function(d) {\n            chart.useDensity = !chart.useDensity;\n            showState(this);\n            handler();\n        });\n\n    function showState(node) {\n        d3.select(node).style(\"fill-opacity\", chart.useDensity ? 1 : 0)\n    }\n\n\tthis.histGroup\n\t    .append(\"text\")\n\t\t.attr(\"class\", \"switchLabel\")\n\t\t.attr(\"x\", offset.x+switchSize+8)\n\t\t.attr(\"y\", offset.y+switchSize/2)\n\t\t.attr(\"dy\", this.textOffsets.middle)\n\t\t.style(\"font-size\", \"14px\")\n\t\t//.style(\"dominant-baseline\", \"middle\")\n        .style(\"-webkit-user-select\",\"none\")\n        .style(\"fill\", switchColour)\n        .text(\"plot as densities\")\n};\n\nchartObject.drawFaderControl=function drawFaderControl(offset, handler) {\n    // goes into histGroup\n    // this replaces the triangle control, which allowed apportioning of percentages for the primary and context scenarios up to a combined total of 100.  removing the second degree of freedom, we now enforce 100 as the total.\n    var chart = this;\n    var initX = this.triangleSetting.x, initY = this.triangleSetting.y;\n    var baseLength = 40;\n    var radius = 10;\n    var offsetX = offset.x, offsetY = offset.y-radius; // of bottom-left corner rel to bottom-left of histogram area\n\n    var faderGroup = this.histGroup.append(\"g\").attr(\"class\", \"fader\");\n\n    faderGroup\n        .append('path')\n        .attr('d', \"M0 \"+(radius)+\" A\"+radius+\" \"+radius+\" 0, 0, 1, 0 \"+(-radius)+\" L\"+baseLength+\" \"+(-radius)+\" A\"+radius+\" \"+radius+\" 0, 0, 1, \"+baseLength+\" \"+radius+\" Z\")\n\t\t.attr('stroke','gray')\n\t\t.attr('stroke-width',1)\n\t\t.attr('fill', 'none')\n\t\t.attr('transform', \"translate(\"+offsetX+\",\"+offsetY+\")\");\n\n    function drawKnob(xPercent) {\n        var centreX = offsetX+(baseLength*xPercent/100);\n        var knobSeln = faderGroup.selectAll(\"circle.faderKnob\").data([0]);\n        knobSeln.enter().append(\"circle\")\n            .attr(\"class\", \"faderKnob\")\n            .attr(\"cy\", offsetY)\n            .attr('r', radius)\n    \t\t.style('opacity', 0)\n    \t\t.style(\"pointer-events\", \"all\")\n    \t\t.style(\"cursor\", \"ew-resize\")\n            .call(d3.drag()\n                .on(\"start\", dragstarted)\n                .on(\"drag\", dragged)\n                .on(\"end\", dragended))\n          .merge(knobSeln)\n            .attr(\"cx\", centreX);\n\n        // NB: an svg arc can't have coincident start and end points (because there would be an infinite number of full circles matching the parameters).  so here we always keep the end angles a tiny fraction below 2pi.  see https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths\n        var indicatorSeln = faderGroup.selectAll(\"path.fadeIndicator\").data([\n            { colour: \"green\", start: 0, end: xPercent*Math.PI*1.999/100, large: xPercent<50 ? 0 : 1 },\n            { colour: \"blue\", start: xPercent*Math.PI*2/100, end: Math.PI*1.999, large: xPercent<50 ? 1 : 0 }\n            ]);\n        indicatorSeln.enter().append(\"path\")\n            .attr(\"class\", \"fadeIndicator\")\n          .merge(indicatorSeln)\n            .attr('transform', \"translate(\"+centreX+\",\"+offsetY+\")\")\n            .attr(\"d\", def=>\"M0 0 L\"+(radius*Math.sin(def.start))+\" \"+(-radius*(Math.cos(def.start)))+\" A\"+radius+\" \"+radius+\" 0, \"+def.large+\", 1, \"+(radius*Math.sin(def.end))+\" \"+(-radius*(Math.cos(def.end)))+\" Z\")\n    \t\t.style('stroke-width',0)\n    \t\t.style('fill', def=>def.colour)\n    \t\t.style('opacity', 0.6)\n    \t\t.style(\"pointer-events\", \"none\")\n    }\n\n    drawKnob(initX);\n\n    function dragstarted(d) {\n        d3.select(this).raise().classed(\"active\", true);  // won't do nuthin', though\n    }\n\n    function dragged(d) {\n        var x = d3.event.x-offsetX; // requested; may be outside the control\n        if (x < 0) x = 0;\n        else if (x > baseLength) x = baseLength;\n\n        var xPercent = Math.round(x/baseLength*100), yPercent = 100-xPercent;\n        drawKnob(xPercent);\n        handler(xPercent, yPercent);\n    }\n\n    function dragended(d) {\n        d3.select(this).classed(\"active\", false);\n    }\n\n    handler(initX, initY);\n};\n\nchartObject.drawHandPointer=function drawHandPointer(location, thenDo) {\n    // NB: on any replay (in particular, when jumping back in the command sequence), the hand will be erased as part of the reset.  this is why the hand will make a smooth transition into its new position when moving down the essay, but not back up.\n    function transformString(x, y, angle) { return \"translate(\"+x+\", \"+y+\") rotate(\"+angle+\")\" }\n    var desiredTransform = transformString(location.x, location.y, 45);\n\n    var imgGroup = this.chartGroup.select(\"g.handpointer\");\n    if (imgGroup.empty()) {\n        imgGroup = this.chartGroup.append(\"g\").attr(\"class\", \"handpointer\");\n        imgGroup.append(\"image\")\n            .attr(\"xlink:href\", this.pointerImageFlipped)\n            .attr(\"x\", -26)\n            .attr(\"y\", -2)\n            .attr(\"width\", 37)\n            .attr(\"height\", 39)\n            .style(\"pointer-events\", \"none\");\n        imgGroup.attr(\"transform\", desiredTransform);\n        allDone();\n    } else {\n        var oldTransform = imgGroup.attr(\"transform\");\n        if (oldTransform===desiredTransform) allDone();\n        else {\n            imgGroup\n                .transition()\n                .duration(400)\n                .attrTween(\"transform\", ()=>d3.interpolateTransformSvg(oldTransform, desiredTransform))\n                .on(\"end\", allDone);\n        }\n    }\n\n    function allDone() { if (thenDo) thenDo() }\n};\n\nchartObject.drawNumberLine=function drawNumberLine() {\n    // the non-coloured one\n    var excess = 50;\n    this.dataGroup.selectAll(\".numberline\").remove();\n    this.dataGroup.append(\"line\")\n        .attr(\"class\", \"numberline\")\n        .attr(\"x1\", -excess)\n        .attr(\"x2\", this.numberLineWidth+excess)\n        .attr(\"y1\", 0)\n        .attr(\"y2\", 0)\n        .style(\"stroke\", \"grey\")\n        .style(\"stroke-width\", 0.5);\n};\n\nchartObject.drawRanges=function drawRanges(rangeSets) {\n    // rangeSets is an object with elements { primary, context } - each being a (possibly empty) bin set.\n    // the range markers are text items that go into rangeGroup\n    var chart=this;\n\n    // bins should be objects { min, max, minOpen, maxOpen }\n    var xScale = this.xScale, group = this.rangeGroup;\n\n    var openMin = { char: \"(\", offset: -2 }, openMax = { char: \")\", offset: -6.5 }, closedMin = { char: \"[\", offset: -3.5 }, closedMax = { char: \"]\", offset: -4.5 };\n\n    [\"primary\", \"context\"].forEach(category=>{\n        var ranges = rangeSets[category], ends = [];\n        for (var ri=0; ri<ranges.length; ri++) {\n            var range = ranges[ri];\n            ends.push(lively.lang.obj.merge({ value: range.min, index: ri }, range.minOpen ? openMin : closedMin) );\n            ends.push(lively.lang.obj.merge({ value: range.max, index: ri }, range.maxOpen ? openMax : closedMax) );\n        }\n\n        var colour = category===\"primary\" ? \"blue\" : \"grey\", endClass = \"end\"+category, opacity = category===\"primary\" && rangeSets.context.length ? 0.2 : 1;\n\n    \tvar ends = group.selectAll(\"text.\"+endClass).data(ends, (d,i)=>i);\n    \tends.exit().remove();\n    \tends.enter().append(\"text\")\n    \t    .attr(\"class\", endClass)\n      \t\t.style(\"font-family\", \"Raleway\") //\"sans-serif\")\n      \t\t.style(\"font-weight\", \"300\")\n       \t\t.style(\"font-size\", \"32px\")\n      \t\t.style(\"pointer-events\", \"none\")\n            .style(\"-webkit-user-select\",\"none\")\n        .merge(ends)\n      \t\t.attr(\"x\", d=>xScale(d.value)+d.offset)\n      \t\t.attr(\"y\", 30)\n       \t\t.style(\"fill\", colour)\n       \t\t.style(\"opacity\", opacity)\n       \t\t.text(d=>d.char);\n\n\t// for calibrating character offsets\nif (false) {\n\tvar calib = group.selectAll(\"line\")\n\t\t\t.data(ends);\n\tcalib.enter().append(\"line\")\n  \t\t.style(\"stroke-width\", 0.5)\n  \t\t.style(\"stroke\", \"black\")\n  \t.merge(calib)\n\t\t\t.attr(\"x1\", function(d) { return xScale(d.value) })\n\t\t\t.attr(\"x2\", function(d) { return xScale(d.value) })\n\t\t\t.attr(\"y1\", -50)\n\t\t\t.attr(\"y2\", 150);\n\tcalib.exit().remove();\n}\n\n    })\n};\n\nchartObject.drawRDefaultBinning=function drawRDefaultBinning(options) {\n    // options (if there) are { instant, synchronised, shiftProportion, widthProportion, showLines }\n    var chart = this;\n\n    var shiftProportion = options && options.shiftProportion, widthProportion = options && options.widthProportion;\n\n    function Sturges(data) { return Math.ceil(Math.log(data.length)/Math.log(2))+1 }\n\n    var dataValues = this.data.values, dataMin = this.dataMin, dataMax = this.dataMax, dataBinQuantum = this.dataBinQuantum;\n    var nBins = Sturges(this.data), breaks = this.rPretty([dataMin, dataMax], nBins);\n\n    if (shiftProportion!==undefined) {\n        // when shift is specified, it's used to set the bins' positions relative to dataMin\n        var width = breaks[1]-breaks[0], firstShiftedBreak = dataMin + lively.lang.num.roundTo(width*shiftProportion, dataBinQuantum), shift = firstShiftedBreak-breaks[0];\n        var newBreaks = [], breakPoint = firstShiftedBreak;\n        while (breakPoint < dataMax) {\n            newBreaks.push(breakPoint);\n            breakPoint = lively.lang.num.roundTo(breakPoint + width, dataBinQuantum);\n        }\n        newBreaks.push(breakPoint);  // right-hand end of last bin\n        breaks = newBreaks;\n    }\n\n    if (widthProportion!==undefined) {\n        // when width is specified, it's used to reduce the bins' widths (without changing the first break position)\n        var baseWidth = breaks[1]-breaks[0], adjustedWidth = lively.lang.num.roundTo(baseWidth*widthProportion, dataBinQuantum);\n        var newBreaks = [], breakPoint = breaks[0];\n        while (breakPoint < dataMax) {\n            newBreaks.push(breakPoint);\n            breakPoint = lively.lang.num.roundTo(breakPoint + adjustedWidth, dataBinQuantum);\n        }\n        newBreaks.push(breakPoint);  // right-hand end of last bin\n        breaks = newBreaks;\n    }\n\n//console.log(dataMin, dataMax, breaks);\n    function filterValues(binNum) {\n        var filterFn = binNum === 0\n            ? (v=>v>=breaks[0] && v<=breaks[1])\n            : (v=>v>breaks[binNum] && v<=breaks[binNum+1]);\n        return dataValues.filter(filterFn);\n    }\n\n    var valueSetDefs = [];\n    for (var bi=0; bi<breaks.length-1; bi++) {\n        valueSetDefs.push({ valueSet: filterValues(bi), left: breaks[bi], right: breaks[bi+1] });\n    }\n\n    this.dropBallsIntoBins(valueSetDefs, options);\n};\n\nchartObject.drawSweepControl=function drawSweepControl(offset, handler) {\n    // goes into histGroup\n    var chart=this;\n\n    var histGroupOrigin = this.histOrigin;\n\n    var switchSize = 12, switchColour = \"#444\";  // dark grey\n\n    var sweepActive = false;\n\n    this.histGroup\n        .append(\"rect\")\n        .attr(\"class\", \"switch\")\n        .attr(\"id\", \"sweepSwitch\")\n        .attr(\"x\", offset.x)\n        .attr(\"y\", offset.y)\n        .attr(\"width\", switchSize)\n        .attr(\"height\", switchSize)\n        .style(\"border-width\", 1)\n        .style(\"stroke\", switchColour)\n        .style(\"fill\", switchColour)\n        .style(\"cursor\", \"pointer\")\n        .each(function() { showState(this) })\n        .on(\"click\", function(d) {\n            sweepActive = !sweepActive;\n            showState(this);\n            handler(sweepActive);\n        });\n\n    function showState(node) {\n        d3.select(node).style(\"fill-opacity\", sweepActive ? 1 : 0)\n    }\n\n\tthis.histGroup\n\t    .append(\"text\")\n\t\t.attr(\"class\", \"switchLabel\")\n\t\t.attr(\"x\", offset.x+switchSize+8)\n\t\t.attr(\"y\", offset.y+switchSize/2)\n\t\t.attr(\"dy\", this.textOffsets.middle)\n\t\t.style(\"font-size\", \"14px\")\n\t\t//.style(\"dominant-baseline\", \"middle\")\n\t\t.style(\"pointer-events\", \"none\")\n        .style(\"-webkit-user-select\",\"none\")\n        .style(\"fill\", switchColour)\n        .text(\"sweep bin offsets\")\n};\n\nchartObject.drawValueList=function drawValueList(options) {\n    // this.drawValueList({ stage: 0 });\n    // draw list onto the fixed canvas, with a mousetrap that creates a callout of separated items.\n    // valueListHeight is the distance between the mid-levels of the first and last items.\n\n    var chart=this, values = [];\n    chart.data.forEach(v=>values.push(v));\n    var numEntries = values.length;\n\n    var stage = options && options.stage; // iff undefined, start timed flight\n\n    // list and pool locations are (now) relative to plotOrigin, not canvas absolute\n    var plotOrigin = this.plotOrigin;\n    var listHeight = this.valueListHeight, valueListX = plotOrigin.x+this.valueListOrigin.x, valueListTop = plotOrigin.y+this.valueListOrigin.y, listEntryHeight = this.valueListEntryHeight, focusEntryHeight = listEntryHeight;\n    var listWidth = this.valueListWidth, fontSize=this.valueListFontSize;\n    var focusAreaTop = valueListTop, focusAreaLeft = valueListX+listWidth;\n    var listScale = d3.scaleLinear().domain([0, numEntries-1]).range([valueListTop, valueListTop+listHeight]);\n    var colourScale = this.colourScale;\n    var maxOpacity = 0.8, minOpacity = 0.2, itemsFittingList = Math.floor(listHeight/listEntryHeight), baseOpacity = Math.max(minOpacity, maxOpacity - (maxOpacity-minOpacity)*numEntries/itemsFittingList/4);\n\n    var chartGroup = this.chartGroup;\n    chartGroup.selectAll(\".focusGroup\").remove();\n    chartGroup.selectAll(\".listMousetrap\").remove();\n\n    var valueEntries = this.poolValueEntries;\n\n    if (!valueEntries) {\n        valueEntries = [];\n        var poolCentreX = valueListX-plotOrigin.x-380,\n            poolCentreY = valueListTop-plotOrigin.y+listHeight/2+60, // minor fudge\n            poolRadius = Math.sqrt(numEntries*100);\n\n        var pi = Math.PI;\n        chart.data.forEach((v, i)=>{\n            // to avoid clumping at the centre, use squared random distance and an offset\n            var distanceRand = Math.random(),\n                fromCentre = (1.1-distanceRand*distanceRand),\n                offsetAngle = 2*pi*Math.random(),\n                textAngle = pi*(Math.random()-0.5),\n                x = poolCentreX+fromCentre*poolRadius*Math.sin(offsetAngle),\n                y = poolCentreY+fromCentre*poolRadius*Math.cos(offsetAngle),\n                diffX = valueListX-plotOrigin.x+listWidth/2-x,\n                diffY = listScale(i)-plotOrigin.y+fontSize/2-1-y;\n            valueEntries.push({\n                value: v,\n                text: v.toFixed(chart.dataDecimals),\n                x: x, y: y,\n                diffX: diffX, diffY: diffY,\n                angle: textAngle\n                });\n            });\n        this.poolValueEntries = valueEntries;\n    }\n\n    var moveTime = 1000, timeSpread = 2000;\n\n    var fixedCanvas = this.chartFixedCanvas.node(), fixedContext = fixedCanvas.getContext(\"2d\");\n\n    var transformString = this.transformString;\n\n    var totalTime = moveTime+timeSpread;\n    if (stage !== undefined) {\n        flyAll(stage*totalTime);\n        if (stage===1) createListMousetrap();\n    } else {\n        this.startTimer({\n            tick: elapsed=>{\n                flyAll(elapsed);\n                if (elapsed > moveTime+timeSpread) {\n                    chart.stopTimer(false);\n                    createListMousetrap();\n//console.log(\"finished\");\n                }\n                },\n            forceToEnd: ()=>{\n                flyAll(totalTime);\n                createListMousetrap();\n                }\n            });\n    }\n\n    function flyAll(elapsed) {\n        chart.clearFixedCanvas();\n        fixedContext.textAlign = \"start\";\n        valueEntries.forEach((valueObj, i)=>{\n            var delay = i/numEntries * timeSpread, flightStage = (elapsed - delay)/moveTime;\n            if (flightStage < 0) flightStage = 0;\n            else if (flightStage > 1) flightStage = 1;\n\n            var x = plotOrigin.x+valueObj.x+flightStage*valueObj.diffX, y = plotOrigin.y+valueObj.y+flightStage*valueObj.diffY, angle = valueObj.angle*(1-flightStage);\n            fixedContext.fillStyle = colourScale(valueObj.value, flightStage > 0 ? 1-flightStage*(1-baseOpacity) : 0.7);\n\n            fixedContext.save();\n            fixedContext.font = fontSize+\"px Arial\";  // seems to be necessary\n            fixedContext.textAlign = \"center\";\n            fixedContext.translate(x, y);\n            fixedContext.rotate(angle);\n            fixedContext.fillText(valueObj.text, 0, 0);\n            fixedContext.restore();\n            });\n    }\n\n    function createListMousetrap() {\n        var focusGroup = chartGroup.append(\"g\")\n            .attr(\"class\", \"focusGroup\")\n            .attr(\"transform\", transformString(focusAreaLeft, focusAreaTop));\n\n        chartGroup.append(\"rect\")\n            .attr(\"class\", \"listMousetrap\")\n            .attr(\"x\", valueListX)\n            .attr(\"y\", valueListTop-listEntryHeight/2) // detector covers all of top and bottom values\n            .attr(\"width\", listWidth)\n            .attr(\"height\", listHeight+listEntryHeight)\n    //.style(\"stroke-width\", 1)\n    //.style(\"stroke\", \"black\")\n            .style(\"fill\", \"none\")\n            .style(\"pointer-events\", \"all\")\n            .style(\"cursor\", \"crosshair\")\n\n            .on(\"mousemove\", function() {\n                // focus list is also measured from middle of first item to middle of last\n                var positionFromTop = d3.mouse(this.parentNode)[1]-valueListTop;\n                var numToShow = 10;\n                var firstInFocus = Math.max(0, Math.min(numEntries-numToShow, Math.round(listScale.invert(positionFromTop+valueListTop))-Math.floor(numToShow/2))), lastInFocus = Math.min(numEntries-1, firstInFocus+numToShow-1);\n                var indexRange = lively.lang.arr.range(firstInFocus, lastInFocus);\n\n                if (chart.highlightPathIndices) chart.highlightPathIndices(indexRange);\n                chart.highlightValueIndices(indexRange);\n                })\n            .on(\"mouseleave\", function() {\n                if (chart.highlightPathIndices) chart.highlightPathIndices([]);\n                chart.highlightValueIndices([]);\n                });\n\n        function highlightValueIndices(indexRange, gatherRepeats) {\n            var focusLineYs = [], items = [];\n            if (indexRange.length) {\n                var firstInFocus = indexRange[0], lastInFocus = indexRange[indexRange.length-1];\n                if (gatherRepeats) {\n                    var lastValue = values[indexRange[0]], valCount = 0;\n                    function addItem(value, count) {\n                        var str = value.toFixed(chart.dataDecimals);\n                        items.push({ value: value, text: str, multiplier: count===1 ? null : \" x \"+count })\n                        }\n                    indexRange.forEach(vi=>{\n                        var val = values[vi];\n                        if (val===lastValue) valCount++;\n                        else {\n                            addItem(lastValue, valCount);\n                            valCount = 1;\n                            lastValue = val;\n                        }\n                        });\n                    addItem(lastValue, valCount);\n                } else {\n                    items = indexRange.map(vi=>({ value: values[vi], text: values[vi].toFixed(chart.dataDecimals) }));\n                }\n                var numItems = items.length;\n                var focusListHeight = (numItems-1)*focusEntryHeight,\n                    focusListTop = Math.max(0, Math.min(listHeight-focusListHeight, (listScale(firstInFocus)+listScale(lastInFocus))/2-focusAreaTop-focusListHeight/2));\n                focusLineYs = [listScale(firstInFocus)-focusAreaTop, listScale(lastInFocus)-focusAreaTop];\n            }\n            var focusTexts = focusGroup.selectAll(\"text.focusItem\").data(items);\n            focusTexts.exit().remove();\n            focusTexts.enter().append(\"text\")\n                .attr(\"class\", \"focusItem\")\n                .attr(\"x\", 4)\n                .attr(\"y\", (d, i)=>focusListTop+focusEntryHeight*i)\n        \t\t.attr(\"dy\", chart.textOffsets.central)\n                //.style(\"dominant-baseline\", \"central\") // numbers are tall, so not \"middle\"\n                .style(\"font-size\", fontSize+\"px\")\n                .style(\"-webkit-user-select\",\"none\")\n              .merge(focusTexts)\n                .attr(\"y\", (d, i)=>focusListTop+focusEntryHeight*i)\n                .each(function(d) {\n                    var seln = d3.select(this);\n                    if (d.multiplier) {\n                        seln.text(\"\"); // use only tspans\n                        seln.attr(\"dy\", chart.textOffsets.central)\n                        var spans = seln.selectAll(\"tspan\").data([d.text, d.multiplier]);\n                        spans.exit().remove();  // shouldn't happen\n                        spans.enter().append(\"tspan\")\n                            //.style(\"dominant-baseline\", \"central\")\n                            .style(\"font-size\", (str, i)=>(i===0 ? fontSize : fontSize-1)+\"px\")\n                            .style(\"fill\", (str, i)=>i===0 ? colourScale(d.value, 1) : \"grey\")\n                          .merge(spans)\n                            .text(String)\n                    } else {\n                        seln.selectAll(\"tspan\").remove();\n                        seln\n                            .style(\"fill\", d=>colourScale(d.value, 1))\n                            .text(d=>d.text);\n                    }\n                });\n\n            var focusLines = focusGroup.selectAll(\"line.focusItem\").data(focusLineYs);\n            focusLines.exit().remove();\n            focusLines.enter().append(\"line\")\n                .attr(\"class\", \"focusItem\")\n                .attr(\"x1\", -listWidth).attr(\"x2\", 0)\n              .merge(focusLines)\n                .attr(\"y1\", d=>d).attr(\"y2\", d=>d)\n                .style(\"stroke-width\", 1)\n                .style(\"stroke\", \"black\");\n        }\n        chart.highlightValueIndices = highlightValueIndices;\n    }\n};\n\nchartObject.dropBallsIntoBins=function dropBallsIntoBins(valueSetDefs, options) {\n    var chart = this;\n    var instant = !!(options && options.instant),\n        synchronised = !!(options && options.synchronised),\n        showLines = !!(options && options.showLines) || !instant,\n        showScale = !(options && options.noScale);\n\n    function clearDemoBins() {\n        chart.chartGroup.selectAll(\"rect.demobin,line.binbreak,text.binbreak,text.democounter,circle.movingBall,g.annotation,rect.demobinMousetrap,text.dataunits\").interrupt().remove();\n    }\n    chart.clearDemoBins = clearDemoBins;\n\n    var demoGroup = chart.demoGroup;\n    var annotationGroup = demoGroup.select(\"g.annotation\");\n    if (annotationGroup.empty()) annotationGroup = demoGroup.append(\"g\").attr(\"class\", \"annotation\").attr(\"transform\", \"translate(0,0)\");\n\n    // the first time this is called (for a given dataset), all the balls are \"settled\".  but when we run through an iteration of bin offsets or widths for the \"fiddle\" stages, we need to reuse the balls that are now \"dropped\".\n    var balls = chart.dataGroup.selectAll(\"circle.settled,circle.dropped\");\n\n    var xScale = this.xScale, plotOrigin = this.plotOrigin, stackBase = 0, dropDistance = this.fallIntoBins, binBase = stackBase+dropDistance, maxBinHeight = dropDistance-20;\n    var colourScale = this.colourScale;\n\n    // shuffle from stackoverflow (!): http://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array\n    function shuffle(array) {\n      var currentIndex = array.length, temporaryValue, randomIndex;\n\n      // While there remain elements to shuffle...\n      while (0 !== currentIndex) {\n\n        // Pick a remaining element...\n        randomIndex = Math.floor(Math.random() * currentIndex);\n        currentIndex -= 1;\n\n        // And swap it with the current element.\n        temporaryValue = array[currentIndex];\n        array[currentIndex] = array[randomIndex];\n        array[randomIndex] = temporaryValue;\n      }\n      // return array;  ael - no need\n    }\n\n    var breakDefs = [];\n    valueSetDefs.forEach((valueSetDef, i)=>{\n        breakDefs.push({ value: valueSetDef.left, index: i });\n        if (i===valueSetDefs.length-1) breakDefs.push({ value: valueSetDef.right, index: i+1 });\n        });\n\n    // the data element for a break includes value, index\n    var lines = demoGroup.selectAll(\"line.binbreak\").data(breakDefs);\n    lines.exit().remove();\n    lines.enter().append(\"line\")\n        .attr(\"class\", \"binbreak\")\n        .attr(\"stroke-dasharray\", \"2 6\")\n        .attr(\"y1\", stackBase)\n        .attr(\"y2\", binBase)\n        .style(\"stroke-width\", 1)\n        .style(\"stroke\", \"grey\")\n      .merge(lines)\n        .attr(\"x1\", def=>xScale(def.value))\n        .attr(\"x2\", def=>xScale(def.value))\n        .style(\"opacity\", showLines ? 1 : 0);\n\n    var delayBetweenBins = 200, delayBetweenPiles = 50, delayBetweenDots = 50, dropTime = 750;\n\n    // the data element for a bin includes binNum, left, right, valueSet etc\n    var binDefs = [], maxBinCount = 0;\n    valueSetDefs.forEach((valueSetDef, i)=>{\n        var valueSet = valueSetDef.valueSet;\n        var binCount=0;\n        valueSet.forEach(value=>binCount+=chart.data.counts[String(value)]);\n        if (binCount > maxBinCount) maxBinCount = binCount;\n\n        var binBalls = balls.filter(d=>valueSet.indexOf(d.value)>=0);\n        binDefs.push({ binNum: i, valueSet: valueSet, balls: binBalls, dropDelay: binDropDelay, indices: [], totalCount: binBalls.size(), left: valueSetDef.left, right: valueSetDef.right, colour: colourScale((valueSetDef.left+valueSetDef.right)/2) });\n        });\n\n    // we use a shuffled set of bin indices to decide the order of bin filling\n    var binIndices = lively.lang.arr.range(0, binDefs.length-1);\n    shuffle(binIndices);\n\n    // draw a zero count as a vanishingly tall bin (i.e., a line)\n    function heightScale(count) { return count===0 ? 0.01 : maxBinHeight*count/maxBinCount }\n\n    // settings for the count scale, which we build incrementally as needed\n\tvar scaleValues = this.rPretty([0, maxBinCount], 5, true), lastValue = scaleValues[scaleValues.length-1];\n    var countPlottedSoFar = 0;\n\n    var bins = demoGroup.selectAll(\"rect.demobin\").data(binDefs, def=>def.binNum);\n    bins.exit().remove();\n    var binsE = bins.enter().append(\"rect\")\n        .attr(\"class\", \"demobin\")\n        .style(\"cursor\", \"crosshair\")\n        .on(\"mouseover\", function(def) {\n            if (chart.highlightPathIndices) chart.highlightPathIndices(def.indices);\n            if (chart.highlightValueIndices) chart.highlightValueIndices(def.indices, true);\n            })\n        .on(\"mouseleave\", function() {\n            if (chart.highlightPathIndices) chart.highlightPathIndices([]);\n            if (chart.highlightValueIndices) chart.highlightValueIndices([]);\n            });\n    bins = bins.merge(binsE);\n    bins\n        .attr(\"x\", def=>xScale(def.left))\n        .attr(\"width\", def=>xScale(def.right) - xScale(def.left))\n        .style(\"fill\", def=>def.colour)\n        .style(\"fill-opacity\", 1)\n        .style(\"stroke-width\", 0.5)\n        .style(\"stroke\", \"grey\")\n        .style(\"stroke-opacity\", 1e-6);\n\n    if (instant) {\n        balls.call(showBallAsOutline);\n        finishBins();\n        return;\n    }\n\n    var counters = demoGroup.selectAll(\"text.democounter\").data(binDefs, def=>def.binNum);\n    counters.exit().remove();\n    var countersE = counters.enter().append(\"text\")\n        .attr(\"class\", \"democounter\")\n        .attr(\"y\", binBase+8)\n\t\t.attr(\"dy\", this.textOffsets.hanging)\n        .style(\"fill\", \"grey\")\n        .style(\"font-size\", \"11px\")\n        //.style(\"dominant-baseline\", \"hanging\")\n        .style(\"text-anchor\", \"middle\")\n        .style(\"pointer-events\", \"none\")\n        .style(\"-webkit-user-select\",\"none\");\n\n    counters = counters.merge(countersE);\n    counters\n        .attr(\"x\", def=>xScale((def.left+def.right)/2));\n\n    chart.setTimerInfo({\n        cleanup: ()=>{\n            interrupted=true;\n            chart.dataGroup.selectAll(\"circle.movingBall\").interrupt().remove();\n            demoGroup.selectAll(\"text.democounter\").interrupt().remove();\n            },\n        forceToEnd: ()=>{\n            balls.call(showBallAsOutline);\n            finishBins();\n            }\n        });\n\n    var binDropDelay = 0, binsToFill = binDefs.length;\n    var interrupted = false;\n    binIndices.forEach(function(bi) {\n        var def = binDefs[bi];\n        var eezer = t=>d3.easePolyIn(t,2);\n        d3.transition().delay(synchronised ? 0 : binDropDelay).on(\"start\", ()=>{\n\n            if (interrupted) return;  // while we were waiting to start, events overtook us\n\n            var values = def.valueSet.slice();\n            shuffle(values);\n            values.forEach(function(value, vi) {\n                def.balls.filter(d=>d.value===value).each(function(d, i) {\n                    if (!this.parentNode) return;  // somewhat-hack in case ball has been removed\n\n                    var clone = this.cloneNode();\n                    var seln = d3.select(this);\n                    showBallAsOutline(seln);\n\n                    this.parentNode.appendChild(clone);\n                    var cloneSeln = d3.select(clone), yStart = +cloneSeln.attr(\"cy\");\n                    cloneSeln.datum(d)\n                        .attr(\"class\", \"movingBall\")\n                        //.style(\"fill\", newBinColour)\n                        .style(\"stroke\", \"none\")\n                        .transition()\n                        .delay(vi*delayBetweenPiles+i*delayBetweenDots)\n                        .ease(eezer).duration(dropTime)\n                        .attr(\"cy\", yStart+dropDistance-5)\n                        .remove()\n                        //.on(\"interrupt\", function() { d3.select(this).remove() })\n                        .on(\"end\", d=>addToBin(bi, d.valueIndex));\n                    });\n                });\n            });\n            binDropDelay += def.valueSet.length*delayBetweenPiles + delayBetweenBins;\n        });\n\n    function showBallAsOutline(seln) {\n        // use fill of \"none\", rather than fillOpacity, so we can always highlight by setting fill colour\n        seln\n            .attr(\"class\", \"dropped\")\n            .style(\"fill\", \"none\")\n            .style(\"stroke-width\", 0.5)\n            .style(\"stroke\", d=>colourScale(d.value, 1))\n            .style(\"stroke-opacity\", 1);\n    }\n\n    function finishBins() {\n        bins.each(function(def) {\n            var seln = d3.select(this);\n            if (interrupted) seln.interrupt();\n\n            var indices = [];\n            def.balls.each(d=>indices.push(d.valueIndex));\n            indices.sort(d3.ascending);\n            def.indices = indices;\n\n            seln\n                .attr(\"y\", binBase-heightScale(indices.length))\n                .attr(\"height\", heightScale(indices.length))\n                .style(\"fill\", \"lightgray\")\n                .style(\"fill-opacity\", 0.5)\n                .style(\"stroke-opacity\", 1);\n            });\n        allDone();\n    }\n\n    function addToBin(binIndex, valueIndex) {\n        var finishDuration = 1000;\n        var binDef = binDefs[binIndex];\n        binDef.indices.push(valueIndex);\n        var binNode = bins.nodes()[binIndex], binSeln = d3.select(binNode);\n        binSeln\n            .attr(\"y\", def=>binBase-heightScale(def.indices.length))\n            .attr(\"height\", def=>heightScale(def.indices.length));\n\n        var counterNode = counters.nodes()[binIndex], counterSeln = d3.select(counterNode);\n        counterSeln\n            .style(\"opacity\", 1)\n            .text(String(binDef.indices.length));\n\n        var binCount = binDef.indices.length;\n        if (binCount > countPlottedSoFar) addAxisAnnotations(binCount);\n\n        if (binCount===binDef.totalCount) {\n            binDef.indices.sort(d3.ascending);\n            binSeln\n                .transition()\n                .duration(finishDuration)\n                .style(\"fill\", \"lightgray\")\n                .style(\"fill-opacity\", 0.5)\n                .style(\"stroke-opacity\", 1);\n\n            counterSeln\n                .transition()\n                .duration(finishDuration)\n                .style(\"opacity\", 1e-6)\n                .remove();\n\n            if (--binsToFill===0) allDone();\n        }\n    }\n\n    function addAxisAnnotations(count) {\n        if (!showScale) return;\n        if (count <= countPlottedSoFar) return;\n\n        var numOfScaleValues = d3.bisect(scaleValues, count);\n\n    \tvar legendX = xScale(chart.dataMax)+85;  // try to steer clear of moving bins\n    \tvar labelDefs = [\n            { labelType: \"title\", x: legendX, anchor: \"start\", y: -heightScale(Math.max(lastValue, maxBinCount))-15, text: \"count\" },\n    \t    ];\n        var tickLength = 4;\n        var tickDefs = [\n            { x: legendX, y: 0, dx: -tickLength, dy: 0 }\n            ];\n    \tscaleValues.slice(0, numOfScaleValues).forEach(v=>{\n        \t    labelDefs.push({ labelType: \"yAxis\", x: legendX+tickLength+3, y: -heightScale(v), text: String(v) });\n        \t    tickDefs.push({ x: legendX, y: -heightScale(v), dx: tickLength, dy: 0 });\n    \t    });\n        chart.drawBinAnnotations(annotationGroup, { x: legendX, y: binBase }, heightScale(count), tickDefs, labelDefs, instant);\n        countPlottedSoFar = count;\n    }\n\n    function allDone() {\n        addAxisAnnotations(Math.max(lastValue, maxBinCount));\n\n        if (!instant) {\n            demoGroup.selectAll(\"line.binbreak\")\n                .transition()\n                .duration(1000)\n                .style(\"opacity\", 1e-6)\n                //.remove();        don't remove; we can use them to draw the values\n        }\n    }\n\n};\n\nchartObject.duplicateBins=function duplicateBins() {\n    // take a copy of the bins, and put it in the scenario records\n\n    var chart=this;\n\n    var scenarioClasses = \"rect.demobin,line.binbreak,text.binbreak\";\n\n    var presentGroupNode = this.demoGroup.node();\n    var groupNodeClone = this.duplicateObjects(presentGroupNode, scenarioClasses);\n    d3.select(groupNodeClone).style(\"opacity\", 1e-6)\n    return groupNodeClone;\n};\n\nchartObject.duplicateObjects=function duplicateObjects(oldGroupNode, classes) {\n    var newGroupNode = oldGroupNode.cloneNode(); // shallow.  we decide what goes in.\n    oldGroupNode.parentNode.appendChild(newGroupNode);\n    d3.select(newGroupNode).attr(\"class\", \"groupclone\");\n    d3.select(oldGroupNode).selectAll(classes).each(function(d) {\n        var oldClass = d3.select(this).attr(\"class\");\n        var newObj = this.cloneNode(true);\n        newGroupNode.appendChild(newObj);\n        d3.select(newObj)\n            .attr(\"class\", oldClass+\"clone\")\n            .style(\"pointer-events\", \"none\")\n            .datum(d);\n        });\n\n    return newGroupNode;\n\n/* TEST\n\n    function transformString(x, y) { return \"translate(\"+x+\", \"+y+\")\" }\n\n    // extracting (in this case) the x and y translations from the transform http://stackoverflow.com/questions/38224875/replacing-d3-transform-in-d3-v4\n    var matrix = oldGroupNode.transform.baseVal[0].matrix, oldGroupX = matrix.e, oldGroupY = matrix.f;\n    var oldTrans = transformString(oldGroupX, oldGroupY), newTrans = transformString(oldGroupX+100, oldGroupY-200);\n    d3.select(newGroupNode)\n        .transition()\n        .duration(5000)\n        .attrTween(\"transform\", ()=>d3.interpolateTransformSvg(oldTrans, newTrans));\n*/\n};\n\nchartObject.estimateMaxBinDensity=function estimateMaxBinDensity() {\n    var data = this.data, guess = 0;\n    // rather arbitrarily, we assume that 30 bins over the range is fine enough, and we slide the binning through ten positions.\n    var numBins = 30;\n    var refDensity = data.length * this.dataRange / numBins;\n    for (var off=0; off<100; off+=10) {\n        var ranges = this.generateRanges(100/numBins, -off);\n        var bins = this.binData(data, ranges);\n        var max = d3.max(bins, b=>b.values.length)/refDensity;\n        if (max>guess) guess=max;\n    }\n    return guess;\n};\n\nchartObject.estimateMaxBinSize=function estimateMaxBinSize(optionalWidthPercent) {\n    // if optionalWidthPercent is specified, it is a percentage of the data range\n    var data = this.data, guess = 0;\n    // if width is not specified, we assume that binning in tenths of the range is coarse enough.\n    // we slide the binning through ten positions, and return the maximum of all.\n    var widthPercent = optionalWidthPercent || 10;\n    for (var off=0; off<100; off+=10) {\n        var ranges = this.generateRanges(widthPercent, -off);\n        var bins = this.binData(data, ranges);\n        var max = d3.max(bins, b=>b.values.length);\n        if (max>guess) guess=max;\n    }\n    return guess;\n};\n\nchartObject.flyBalls=function flyBalls(options) {\n//console.log(\"fly\")\n\n    var chart = this;\n    var instant = !!(options && options.instant);\n\n    this.clearDemoBalls = function() {\n        this.dataGroup.selectAll(\"circle.settled,circle.dropped,line.numberline\").interrupt().remove();\n    }\n    this.clearDemoBalls();\n\n    var fixedCanvas = this.chartFixedCanvas.node(), fixedContext = fixedCanvas.getContext(\"2d\");\n\n    //fixedContext.clearRect(0, 0, fixedCanvas.width, fixedCanvas.height);\n    // this.drawValueList(); @@ DEBUG\n\n    var maxCount = d3.max(lively.lang.obj.values(this.data.counts));\n    var values = [];\n    chart.data.forEach(v=>values.push(v)); // all values, including repeats\n    var numValues = values.length;\n\n    // tFlight is the time of flight of the first instance of the first value.  other values are offset, so their first dots land together\n    var maxDelay = 2000, tFlight = 4000, tFall = 1000, spreadDelay = tFlight/Math.max(40, maxCount), maxSpread = maxCount*spreadDelay;\n    var canvas = this.chartCanvas.node(), context = canvas.getContext(\"2d\");\n    var xScale = this.xScale, plotOrigin = this.plotOrigin;\n\n    var valueListHeight = this.valueListHeight;\n    var fontSize=this.valueListFontSize;\n    var originX = plotOrigin.x+this.valueListOrigin.x, valueListTop = plotOrigin.y+this.valueListOrigin.y;\n    var fallHeight = this.fallAfterFlight, flightTargetY = plotOrigin.y-fallHeight;\n\n    var colourScale = chart.colourScale;\n\n    var originYScale = d3.scaleLinear()\n        .domain([0, numValues-1])\n        .range([valueListTop, valueListTop+valueListHeight]);\n    var originYIncrement = originYScale(1)-originYScale(0);\n\n    function delayScale(valIndex) { return maxDelay*valIndex/numValues }\n\n    var fillLineWidth = 0.5;\n    fixedContext.lineWidth = fillLineWidth;\n\n    // for each value, set up a definition of how to draw its path(s) from number list to number line\n    var valIndex = 0, uniqueValues = [], pathDefs = {};\n    chart.data.valuesAndCountsDo((val, count)=>{\n        uniqueValues.push(val);\n        var colour = colourScale(val, 1);\n        var pathColour = count===1 ? colour : colourScale(val, 0.2);\n        var targetX = Math.round(plotOrigin.x+xScale(val)), xDiff = targetX-originX;\n        var firstOriginY = originYScale(valIndex);\n        pathDefs[String(val)] = { firstIndex: valIndex, count: count, colour: colour, pathColour: pathColour, targetX: targetX, xDiff: xDiff, firstOriginY: firstOriginY };\n        valIndex += count;\n        });\n\n    chart.chartGroup.selectAll(\".flightMousetrap\").remove();\n    chart.chartGroup.append(\"rect\")\n        .attr(\"class\", \"flightMousetrap\")\n        .attr(\"x\", plotOrigin.x)\n        .attr(\"y\", valueListTop)\n        .attr(\"width\", originX-plotOrigin.x)\n        .attr(\"height\", flightTargetY - valueListTop)\n        .style(\"fill\", \"none\")\n        .style(\"pointer-events\", \"all\")\n        .style(\"cursor\", \"crosshair\")\n        .on(\"mousemove\", function() {\n            var evtPoint = d3.mouse(this.parentNode);\n            var point = lively.pt(evtPoint[0], evtPoint[1]);\n            chart.clearEphemeralCanvas();\n            context.lineWidth = 1;\n            context.strokeStyle = \"green\";\n            var numToHighlight = 10;\n            var firstHighlightIndex;\n            var found = false, valueListIndex = 0;\n            // find the first value (if any) whose first path doesn't enclose the probe point.\n            while (!found && valueListIndex<uniqueValues.length) {\n                var pathDef = pathDefs[String(uniqueValues[valueListIndex])];\n                if (!isPointInsidePath(point, pathDef.firstOriginY, pathDef.xDiff)) found = true;\n                else valueListIndex++;\n            }\n            var indexRange = [];\n            // if not even the first value encloses the probe point, there's nothing to highlight;\n            if (valueListIndex > 0) {\n                // narrow down onto the individual paths for the last value that *does* enclose the probe.\n                var lastEnclosingIndex = valueListIndex-1, pathDef = pathDefs[String(uniqueValues[lastEnclosingIndex])];\n                found = false;\n                var pathWithinValue = 1;\n                while (!found && pathWithinValue<pathDef.count) {\n                    if (!isPointInsidePath(point, pathDef.firstOriginY+originYIncrement*pathWithinValue, pathDef.xDiff)) found = true;\n                    else pathWithinValue++;\n                }\n                // if the probe point is enclosed by even the last path, again don't highlight anything\n                if (!(lastEnclosingIndex===uniqueValues.length-1 && !found)) {\n                    var midHighlight = pathDef.firstIndex+pathWithinValue-1;\n                    firstHighlightIndex = Math.max(0, Math.min(numValues-numToHighlight, midHighlight-numToHighlight/2));\n                    var indexRange = lively.lang.arr.range(firstHighlightIndex, firstHighlightIndex   +numToHighlight-1);\n                }\n            }\n            chart.highlightPathIndices(indexRange);\n            chart.highlightValueIndices(indexRange);\n            })\n        .on(\"mouseleave\", function() {\n            chart.highlightPathIndices([]);\n            chart.highlightValueIndices([]);\n            });\n\n    function isPointInsidePath(point, pathStartY, pathXDiff) {\n        if (pathStartY > point.y) return false;\n\n        var xDiff = originX-point.x;\n        var pathYDiff = flightTargetY - pathStartY;\n        var queryDiff = point.y - pathStartY; // = wholeDiff * (1-cos(theta))\n        var theta = Math.acos(1 - queryDiff/pathYDiff);\n        return originX + pathXDiff * Math.sin(theta) < point.x;\n    }\n\n    function highlightPathIndices(indexList) {\n        chart.clearEphemeralCanvas();\n        context.lineWidth = 1;\n        var pathHighlightColour = \"rgba(0, 0, 0, 0.5)\", ballHighlightColour = \"black\";\n        context.strokeStyle = pathHighlightColour;\n        indexList.forEach(index=>{\n            //context.strokeStyle = colourScale(values[index], 1);\n            drawPath(index, context)\n            });\n        chart.dataGroup.selectAll(\"circle.settled,circle.dropped\").each(function(d) {\n            var hilited = indexList.indexOf(d.valueIndex)>=0;\n            var seln = d3.select(this), ballClass = seln.attr(\"class\");\n            if (hilited) seln.raise();\n            seln\n                .style(\"stroke-opacity\", hilited ? 0 : 1)\n                .style(\"fill\", hilited ? ballHighlightColour : (ballClass===\"dropped\" ? \"none\" : colourScale(d.value))) });\n    }\n    chart.highlightPathIndices = highlightPathIndices;\n\n    function drawPaths(val) {\n        var ctx = fixedContext;\n\n        var def = pathDefs[String(val)];\n        var firstIndex = def.firstIndex, count = def.count;\n\n        if (!instant) {\n            var textSeln = chart.chartGroup.select(\"text.valueLabel\");\n            if (textSeln.empty()) {\n                textSeln = chart.chartGroup.append(\"text\")\n                    .attr(\"class\", \"valueLabel\")\n            \t\t.attr(\"dy\", chart.textOffsets.central)\n                    .style(\"font-size\", fontSize+\"px\")\n                    .style(\"text-anchor\", \"middle\")\n                    .attr(\"x\", originX+chart.valueListWidth/2)\n            }\n\n            textSeln\n                .interrupt()\n                .datum(def)\n                .text(val.toFixed(chart.dataDecimals))\n                .style(\"fill\", def=>def.colour)\n                .style(\"opacity\", 1)\n                .attr(\"y\", originYScale(firstIndex+Math.floor((count-1)/2)))\n                .transition()\n                .delay(500)\n                .duration(1000)\n                .style(\"opacity\", 1e-6)\n                .remove();\n        }\n\n        ctx.strokeStyle = colourScale(val, 1);\n        ctx.lineWidth = 0.5;\n        for (var i=0; i<count; i++) {\n            if (i===1) ctx.strokeStyle = colourScale(val, 0.5);\n            drawPath(firstIndex+i, ctx);\n        }\n    }\n\n    // while we're waiting for canvas ellipse() to be supported more widely, here's a circle-scaling approach from http://stackoverflow.com/questions/2172798/how-to-draw-an-oval-in-html5-canvas\n    function drawPath(valueIndex, context) {\n        // caller has to set the lineWidth and strokeStyle\n        var pi = Math.PI;\n        context.save(); // save state\n        context.beginPath();\n\n        context.translate(originX, flightTargetY);\n        context.scale(originX-Math.round(plotOrigin.x+xScale(values[valueIndex])), flightTargetY-originYScale(valueIndex));\n        context.arc(0, 0, 1, -pi/2, -pi, true);\n\n        context.restore(); // restore to original state before stroking (to avoid scaling the stroke)\n        context.stroke();\n    }\n\n    // simpler call, but not yet widely supported\n    function drawPathWithEllipse(valueIndex, context) {\n        // caller has to set the lineWidth and strokeStyle\n        var pi = Math.PI;\n        context.beginPath();\n        context.ellipse(originX, flightTargetY, originX-Math.round(plotOrigin.x+xScale(values[valueIndex])), flightTargetY-originYScale(valueIndex), 0, pi, pi*1.5, false);\n        context.stroke();\n    }\n\n    // precompute tables of sines and cosines\n    var sines = [], cosines = [], piBy2000 = Math.PI/2000;\n    for (var i=0; i<1000; i++) { sines.push(Math.sin(i*piBy2000)); cosines.push(Math.cos(i*piBy2000)) }\n\n    var plottableValues = [];\n    var valIndex = 0;\n    chart.data.valuesAndCountsDo((val, count)=>{\n        var valueDelay = delayScale(valIndex), valueTFlight = tFlight-valueDelay;\n        var firstY = originYScale(valIndex);\n        var targetX = plotOrigin.x+xScale(val);\n\n        plottableValues.push({ value: val, count: count, valueDelay: valueDelay, valueTFlight: valueTFlight, allLanded: valueDelay+valueTFlight+spreadDelay*count+tFall, xTarget: targetX, xDiff: targetX-originX, firstY: firstY, cumulativeIndex: valIndex, lastSettled: -1 })\n        valIndex += count;\n        });\n\n    var settledBalls = [], lastPathDrawn = this.dataMin-1; // something less than the min\n    var radius = 2, staggerRatio = 1.5;\n    var shownNumberLine = false;\n\n    var oneShot = 100000;\n    if (instant) {\n        flyAll(oneShot);\n    } else {\n        this.startTimer({\n            tick: elapsed=>{\n                chart.clearEphemeralCanvas();\n                if (settledBalls.length === numValues) {\n                    chart.stopTimer(false);\n//console.log(\"finished\");\n                } else flyAll(elapsed);\n                },\n            cleanup: ()=>chart.clearEphemeralCanvas(),\n            forceToEnd: ()=>flyAll(oneShot)\n            });\n    }\n\n    function flyAll(elapsed) {\n        context.fillStyle = \"black\";\n        var twoPi = Math.PI*2; // performance.\n        var nextPlottable = [];\n        plottableValues.forEach(valObj=>{\n            context.fillStyle = colourScale(valObj.value, 1);\n            if (elapsed === oneShot || elapsed < valObj.allLanded) {\n                nextPlottable.push(valObj);\n                var sinceFirstTakeoff = elapsed-valObj.valueDelay; // launch of first for this value\n                if (sinceFirstTakeoff > 0) {\n                    var val = valObj.value, count = valObj.count, valueTFlight = valObj.valueTFlight, xDiff = valObj.xDiff, useCircles = count < 20, valIndex = valObj.cumulativeIndex, firstY = valObj.firstY, fallX = valObj.xTarget;\n\n                    if (lastPathDrawn < val) {\n                        drawPaths(val);\n                        lastPathDrawn = val;\n                    }\n\n                    // launched is the index of the last instance to have taken off.  it maxes out at count-1\n                    var launched = (sinceFirstTakeoff/spreadDelay) | 0;\n                    if (launched > count-1) launched = count-1;\n                    // firstStillFlying is the index of the first instance still on the flight path.  it maxes out at count.\n                    var firstStillFlying = ((sinceFirstTakeoff - valueTFlight) / spreadDelay) | 0;\n                    if (firstStillFlying < 0) firstStillFlying = 0;\n                    else if (firstStillFlying > count) firstStillFlying = count;\n                    // firstStillFalling is the index of the first instance still tumbling to the number line.  when all have landed, it maxes out at count.\n                    var firstStillFalling = ((sinceFirstTakeoff - valueTFlight - tFall) / spreadDelay) | 0;\n                    if (firstStillFalling < 0) firstStillFalling = 0;\n                    else if (firstStillFalling > count) firstStillFalling = count;\n\n                    var sinceTakeoff = sinceFirstTakeoff - spreadDelay*firstStillFlying;\n                    for (var i=firstStillFlying; i<=launched; i++) {\n                        var originY = firstY+originYIncrement*i, yDiff = flightTargetY-originY;\n\n                        var flightPoint = (1000*/*eezer*/(sinceTakeoff / valueTFlight)) | 0;\n                        var centreX = originX+xDiff*sines[flightPoint], centreY = flightTargetY-yDiff*cosines[flightPoint];\n\n                        context.beginPath();\n                        if (useCircles) context.arc(centreX, centreY, 2, 0, twoPi);\n                        else context.rect(centreX-2, centreY-2, 4, 4);\n                        context.fill();\n\n                        sinceTakeoff -= spreadDelay;\n                    }\n\n                    if (firstStillFalling===count) { // maxed out\n                        settleBalls(valObj, count-1); // make sure everything has settled\n                    } else {\n                        var sinceFall = sinceFirstTakeoff - valueTFlight - spreadDelay*firstStillFalling;\n                        var initialSpeed = fallHeight/tFall, lastFalling=Math.min(count-1, firstStillFlying);\n                        for (var i=firstStillFalling; i<=lastFalling; i++) {\n                            if (sinceFall > 0) {\n                                var fallPoint = initialSpeed*sinceFall + 0.0005*sinceFall*sinceFall;\n                                var finalY = flightTargetY+fallHeight-radius*(1+2*staggerRatio*i);\n                                var fallY = flightTargetY+fallPoint;\n                                if (fallY >= finalY) settleBalls(valObj, i);\n                                else {\n                                    context.beginPath();\n                                    context.arc(fallX, fallY, 2, 0, twoPi);\n                                    context.fill();\n                                }\n                            }\n                            sinceFall -= spreadDelay;\n                        }\n                    }\n                }\n            }\n            });\n        plottableValues = nextPlottable;\n        var balls = chart.dataGroup.selectAll(\"circle.settled\").data(settledBalls, d=>d.valueIndex);\n        balls.enter().append(\"circle\")\n            .attr(\"class\", \"settled\")\n            .attr(\"cx\", d=>d.x)\n            .attr(\"cy\", d=>d.y)\n            .attr(\"r\", radius)\n            .style(\"fill\", d=>colourScale(d.value,1))\n            .style(\"pointer-events\", \"none\");\n    }\n\n    function settleBalls(valObj, last) {\n        if (!shownNumberLine) {\n            chart.drawNumberLine();\n            shownNumberLine = true;\n        }\n        if (last > valObj.lastSettled) {\n            var fallX = valObj.xTarget, baseIndex = valObj.cumulativeIndex;\n            for (var i=++valObj.lastSettled; i<=last; i++) {\n                settledBalls.push({ x: fallX-plotOrigin.x, y: flightTargetY+fallHeight-radius*(1+2*staggerRatio*i)-plotOrigin.y, valueIndex: baseIndex+i, value: valObj.value });\n            }\n            valObj.lastSettled = last;\n        }\n    }\n\n    chart.dataGroup.selectAll(\".ballMousetrap\").remove();\n    chart.dataGroup.append(\"rect\")\n        .attr(\"class\", \"ballMousetrap\")\n        .attr(\"x\", -5)\n        .attr(\"y\", 5-fallHeight)\n        .attr(\"width\", xScale(chart.dataMax)-xScale(chart.dataMin)+10)\n        .attr(\"height\", fallHeight)\n        .style(\"fill\", \"none\")\n        .style(\"pointer-events\", \"all\")\n        .style(\"cursor\", \"crosshair\")\n        .on(\"mousemove\", function() {\n            var evtX = d3.mouse(this.parentNode)[0];\n            var probeValue = xScale.invert(evtX);\n            var nearest = d3.scan(uniqueValues, (a, b)=>(Math.abs(a-probeValue)-Math.abs(b-probeValue)));\n            var def = pathDefs[String(uniqueValues[nearest])];\n            var indexRange = lively.lang.arr.range(def.firstIndex, def.firstIndex+def.count-1);\n            chart.highlightPathIndices(indexRange);\n            chart.highlightValueIndices(indexRange, true);\n            })\n        .on(\"mouseleave\", function() {\n            chart.highlightPathIndices([]);\n            chart.highlightValueIndices([]);\n            });\n\n\n};\n\nchartObject.generateRanges=function generateRanges(binWidthPct, binOffsetPct) {\n  // binWidth and binOffset are expressed as percentages\n  var dataMin = this.dataMin, dataMax = this.dataMax, dataRange = dataMax-dataMin, snapRange = dataRange/1000;\n\n  // if a range end is within one thousandth of the range of data min or max, snap to that value\n  function snapTo(v, dataVal) { return Math.abs(v-dataVal) < snapRange ? dataVal : v }\n  var ranges = [];\n  var binWidth = binWidthPct * dataRange / 100, binOffset = binOffsetPct / 100;\n  var binStart = binOffset === 0 ? dataMin : snapTo(dataMin + (binOffset-1) * binWidth, dataMin);\n  var firstBin = true;\n  while (binStart < dataMax) {\n    var binEnd = snapTo(binStart + binWidth, dataMax);\n    ranges.push({ min: binStart, max: binEnd, minOpen: !firstBin, maxOpen: false});\n    binStart = binEnd;\n    firstBin = false;\n  }\n\n  return ranges;\n};\n\nchartObject.hoverOver=function hoverOver(path) {\n    var hoveredElem = d3.select(path);\n    if (hoveredElem.size()===0) return; // if replay has been done independently of scroll, the visualisation might not have that element right now\n\n    var elemRect = hoveredElem.node().getBoundingClientRect(), outset = 4;\n    var svgRect = this.chartSVG.node().getBoundingClientRect();\n    var ratio = this.sizeRatio;\n    var fullSizeLeft = (elemRect.left-svgRect.left)/ratio, fullSizeTop = (elemRect.top-svgRect.top)/ratio, fullSizeWidth = elemRect.width/ratio, fullSizeHeight = elemRect.height/ratio;\n    this.chartSVG.select(\"rect.highlighter\").remove();\n    this.chartSVG.append(\"rect\")\n        .attr(\"class\", \"highlighter\")\n        .attr(\"x\", fullSizeLeft-outset)\n        .attr(\"y\", fullSizeTop-outset)\n        .attr(\"width\", fullSizeWidth+2*outset)\n        .attr(\"height\", fullSizeHeight+2*outset)\n        .style(\"fill\", \"none\")\n        .style(\"pointer-events\", \"none\")\n        .style(\"stroke-width\", outset-2)\n        .style(\"stroke\", \"red\");\n};\n\nchartObject.hoverOut=function hoverOut() {\n    this.chartSVG.select(\"rect.highlighter\").remove();\n};\n\nchartObject.init=function init(options) {\n    var tableOptions = {};\n    if (options.hasOwnProperty(\"noDensity\")) tableOptions.noDensity = options.noDensity;\n    this.initChartInElement(options.element, options.extent);\n    if (true || options.showHist) this.initHistogramArea(); // @@ until we get organised\n    this.loadData(options.dataset, ()=>this.buildTable(options.definitions, tableOptions));\n};\n\nchartObject.initBinBehaviour=function initBinBehaviour() {\n    var chart = this;\n    var binsAreDraggable = chart.binsAreDraggable;\n\n    this.histGroup.selectAll(\"*\").remove();\n\n    // set up a nested group just for bins\n    var pointerOverBin = false;\n\tthis.histGroup\n\t\t.append(\"g\")\n        .attr(\"class\", \"binGroup\")\n        .call(seln=>{\n            if (binsAreDraggable) {\n                (d3.drag()\n                    .on(\"start\", dragStarted)\n                    .on(\"drag\", dragged)\n                    .on(\"end\", dragEnded))(seln)\n            }\n            })\n        // note: if pointer leaves and then re-enters the bins during a drag, we get a mouseleave but not a mousemove\n        .on('mouseenter', function() { pointerOverBin = true })\n        .on('mousemove', function() {  // not arrow, because we need \"this\"\n            pointerOverBin = true;\n            if (!chart.isDragging) {\n                var binNumber = findBinAround(chart.xScale.invert(d3.mouse(this)[0]));\n                chart.scheduleEvent(\"probe\", 0, ()=>{\n                    chart.refreshTable({ dataFocusIndex: binNumber, binHighlight: binNumber }, 0);\n                    //highlightBinNumber(binNumber);\n                    });\n            };\n            })\n        // mouseout would be sent for each sub-object; mouseleave is only sent when mouse leaves the entire group\n        .on('mouseleave', function() {\n            pointerOverBin = false;\n            if (!chart.isDragging) {\n                chart.scheduleEvent(\"probe\", 200, ()=>{\n                    chart.refreshTable({ binHighlight: null }, 0)\n                    });\n            };\n            });\n\n    var highlightedBinNode = null;\n    chart.highlightBinNumber = highlightBinNumber;\n    function highlightBinNumber(binNum, scenarioOrNull) {\n        if (scenarioOrNull===undefined) scenarioOrNull = null;\n        if (binNum === null) { resetBinHighlight(); return };\n\n        var binClass = scenarioOrNull === null ? \"primary\" : \"context\";\n        var binNode = findBin(binClass, function(binItem) {\n            // make sure we hit at most one bin.  doesn't matter that mousing on the boundary won't hit any.\n//console.log(d.min, d.max, value)\n            return (scenarioOrNull===null || scenarioOrNull===binItem.scenario) && binItem.dataIndex===binNum;\n            });\n\n        applyBinHighlights(binNode, binClass);\n    }\n\n    function findBinAround(value, scenarioOrNull) {\n        if (scenarioOrNull===undefined) scenarioOrNull = null;\n        if (value === null) return null;\n\n        var binClass = scenarioOrNull === null ? \"primary\" : \"context\";\n        var binNode = findBin(binClass, function(binItem, i) {\n            // make sure we hit at most one bin.  doesn't matter that mousing on the boundary won't hit any.\n            return (scenarioOrNull===null || scenarioOrNull===binItem.scenario) && binItem.min<value && binItem.max>value\n            });\n        return binNode ? binNode.__data__.dataIndex : null;\n    }\n\n    // return the first bin node object for which the bound data object satisfies the supplied dataTest\n    function findBin(binClass, dataTest) {\n        var found = null;\n        chart.histGroup.selectAll(\"rect.\"+binClass).each(function(d, i) {\n            if (!found && dataTest(d, i)) found=this;\n            });\n        return found;\n    }\n\n    var contextBaseColour = this.contextBinFill, contextBaseOpacity = 0.15;\n    var primaryHighlightColour = d3.hcl(274,100,75), contextHighlightColour = d3.hcl(73,100,75), primaryTextColour = primaryHighlightColour.darker(), contextTextColour = contextHighlightColour; /*.darker(0.25);*/\n\n    function applyBinHighlights(binNode, binClass) {\n        if (binNode === highlightedBinNode) return;\n\n        if (highlightedBinNode) resetBinHighlight(); // cancel previous\n        if (binNode === null) return; // nothing more to do\n        highlightedBinNode = binNode;\n\n        var isContext = binClass === \"context\";\n        var highlightColour = isContext ? contextHighlightColour : primaryHighlightColour;\n        var binHighlight = d3.color(highlightColour.darker());\n        //binHighlight.opacity = 0.5;\n        var binSeln = d3.select(binNode);\n        var highlightIndex, valueSet;\n        binSeln\n            .style(\"fill\", binHighlight.toString())\n            .raise();\n        var binItem = binNode.__data__;\n        highlightIndex = binItem.dataIndex;\n        valueSet = binItem.values.collection;\n        chart.dataGroup.selectAll(\"circle.ball\").each(function(dataItem) {\n            if (valueSet.indexOf(dataItem.value)>=0) {\n                var seln = d3.select(this);\n                seln\n                    .raise()\n                    .style(\"fill\", highlightColour)\n                    .style(\"stroke\", highlightColour); // @@ now that we're not using striping\n\n            }\n            });\n        highlightColour = isContext ? contextTextColour : primaryTextColour;\n        chart.chartGroup.selectAll(\"text.dataTextCell\").each(function(cellItem) {\n            //d3.select(this).style(\"fill\", (cellItem.isContext===isContext && cellItem.dataIndex === highlightIndex) ? highlightColour : \"black\");\n            if (cellItem.isContext===isContext && cellItem.dataIndex === highlightIndex) d3.select(this).interrupt().style(\"fill\", highlightColour);\n            });\n\n        var descFontSize = 12;\n        chart.histGroup.selectAll(\"g.binDescriptor\").remove();\n        var descGroup = chart.histGroup.append(\"g\")\n            .attr(\"class\", \"binDescriptor\")\n            .attr(\"transform\", \"translate(\"+(Number(binSeln.attr(\"x\"))+Number(binSeln.attr(\"width\"))/2)+\",\"+(Number(binSeln.attr(\"y\"))+Number(binSeln.attr(\"height\"))+6+descFontSize/2)+\")\");\n        var text = [\n            String(binItem.min),\n            binItem.minOpen ? \"<\" : \"\",\n            \"x\",\n            binItem.maxOpen ? \"<\" : \"\",\n            String(binItem.max),\n            \"(\"+binItem.values.length+\")\"\n            ].join(\" \");\n        var descText = descGroup.append(\"text\")\n            .attr(\"x\", 0)\n            .attr(\"y\", 0)\n    \t\t.attr(\"dy\", chart.textOffsets.central)\n            .style(\"fill\", \"blue\")\n            .style(\"pointer-events\", \"none\")\n            .style(\"text-anchor\", \"middle\")\n            //.style(\"dominant-baseline\", \"central\")\n            .style(\"font-size\", descFontSize+\"px\")\n            .text(text);\n        var textWidth = descText.node().getComputedTextLength();\n        var descRect = descGroup.append(\"rect\")\n            .attr(\"width\", textWidth+12)\n            .attr(\"height\", descFontSize+11)\n            .attr(\"x\", -textWidth/2-6)\n            .attr(\"y\", -descFontSize/2-5)\n            .style(\"fill\", chart.chartSVG.style(\"background-color\"))\n            .style(\"opacity\", 1);\n        descText.raise();\n    }\n\n    chart.resetBinHighlight = resetBinHighlight;\n    function resetBinHighlight() {\n        //if (highlightedBinNode === null) return;  nope - always do this (cost be damned)\n//console.log(\"reset\");\n        chart.histGroup.selectAll(\"g.binDescriptor\").remove();\n\n        var oddBinValues = {};\n        chart.histGroup.selectAll(\"rect.primary\").each(function(binItem, i) {\n            if ((binItem.dataIndex + chart.stripeOffset) & 1) {\n                binItem.values.collection.forEach(v=>oddBinValues[String(v)]=true);\n            }\n            });\n\n        // a ball that was previously marked as being in an odd or even bin, and now finds itself in one of the opposite persuasion, will jump a few pixels in the air.  this marking gets reset if the bin widths are changed.\n        var trans = d3.transition().duration(250), filling = \"black\";\n        chart.dataGroup.selectAll(\"circle.ball\").each(function(dataItem) {\n            var seln = d3.select(this);\n            seln.style(\"fill\", filling).style(\"stroke\", filling);\n            var oddEven = oddBinValues[String(dataItem.value)] ? 1 : 0;\n            if (this.hasOwnProperty(\"oddEven\") && this.oddEven!==oddEven) {\n                if (!this.originalY) this.originalY = +seln.attr(\"cy\");\n                seln\n                    .attr(\"cy\", this.originalY-4)\n                    .transition(trans)\n                    .attr(\"cy\", this.originalY)\n            }\n            this.oddEven = oddEven;\n            });\n\n        var primaryBins = chart.histGroup.selectAll(\"rect.primary\");\n        var contextBins = chart.histGroup.selectAll(\"rect.context\");\n        if (!contextBins.empty()) {\n            var contextColour = d3.color(contextBaseColour);\n            contextColour.opacity = contextBaseOpacity;\n            contextBins.style(\"fill\", contextColour.toString());\n            primaryBins.style(\"fill\", \"none\");\n        } else primaryBins.style(\"fill\", chart.restingBinFill);\n\n        if (highlightedBinNode !== null) chart.chartGroup.selectAll(\"text.dataTextCell\").style(\"fill\", \"black\");  // only do this bit if there was a highlight\n\n        highlightedBinNode = null;\n    }\n\n    var dragStartUnscaledX, dragStartMinBinX, draggableBinWidth, dragOffsetToCentre, dragBinIndex;\n    chart.isDragging = false;\n    function dragStarted(d) {\n        // during dragging, we're going to specify what value we desire for the left edge of the leftmost bin.\n        chart.isDragging = true;\n        dragStartMinBinX = d3.min(chart.chartGroup.selectAll(\"rect.primary\").nodes(), o=>o.__data__.min);\n        var someBin = chart.chartGroup.selectAll(\"rect.primary\").nodes()[0];\n        draggableBinWidth = someBin.__data__.max - someBin.__data__.min;\n        chart.dragPoint = dragStartUnscaledX = chart.xScale.invert(d3.mouse(this)[0]);\n        // if user starts dragging in the middle of a bin, there's no problem figuring out which bin to highlight, even when the bins jump.  in case the user happens to start dragging near a bin boundary, we therefore figure out an offset to apply when hit-testing so that the test value is always near the middle.\n        var binMultiple = (chart.dragPoint - dragStartMinBinX) / draggableBinWidth;\n        dragOffsetToCentre = (0.5 - (binMultiple - Math.floor(binMultiple)))*draggableBinWidth;\n        dragBinIndex = Math.floor((dragStartUnscaledX+dragOffsetToCentre-dragStartMinBinX)/draggableBinWidth);\n    }\n    function dragged(d, i) {\n        chart.dragPoint = chart.xScale.invert(d3.mouse(this)[0]);\n        if (chart.dragPoint <= chart.dataMin - draggableBinWidth*1.5 || chart.dragPoint >= chart.dataMax+draggableBinWidth*1.5) return;\n\n        // first, figure out where the original left edge would have been dragged to\n        var shiftedMinBinX = dragStartMinBinX + chart.dragPoint - dragStartUnscaledX;\n        // then normalise to the region a single bin-width to the left of the data minimum\n        var normalisedMinBinX = shiftedMinBinX - (draggableBinWidth*(1+Math.floor((shiftedMinBinX-chart.dataMin)/draggableBinWidth)));\n\n        var newOffset = chart.findClosestResult(\"lefts[0]\", normalisedMinBinX, \"offset\");\n\n        if (newOffset!==null) {\n            var oldBinIndex = dragBinIndex;\n            dragBinIndex = Math.floor((chart.dragPoint+dragOffsetToCentre-(chart.dataMin+newOffset*draggableBinWidth))/draggableBinWidth);\n            // if the index being dragged has changed, the stripes need to be re-aligned\n            if (oldBinIndex!==dragBinIndex) chart.stripeOffset = 1-chart.stripeOffset;\n        }\n\n        chart.refreshTable({ dataFocusIndex: dragBinIndex, force: newOffset!==null, binHighlight: null }, 0);  // null highlight to force re-highlighting, maybe after a shift\n        //resetBinHighlight();\n        highlightBinNumber(dragBinIndex);\n    }\n    function dragEnded(d) {\n        chart.isDragging = false;\n        if (pointerOverBin) {\n            //resetBinHighlight();\n            chart.refreshTable({ force: true, binHighlight: null }, 0);\n            var binNumber = findBinAround(chart.xScale.invert(d3.mouse(this)[0]));\n            chart.refreshTable({ dataFocusIndex: binNumber, binHighlight: binNumber }, 0);\n            //highlightBinNumber(binNumber);\n        } else {\n            chart.refreshTable({ force: true, binHighlight: null }, 0);\n            //resetBinHighlight();\n        }\n    }\n\n    var recordedBinState;\n    chart.recordBinState = recordBinState;\n    function recordBinState(binClass) {\n        binClass = binClass || \"primary\";\n        recordedBinState = [];\n        chart.histGroup.selectAll(\"rect.\"+binClass).each(function() {\n            var seln = d3.select(this);\n            if (binClass===\"context\" && +seln.style(\"stroke-opacity\")===0) return;\n\n            recordedBinState.push({ left: +seln.attr(\"x\"), width: +seln.attr(\"width\"), y: +seln.attr(\"y\"), height: +seln.attr(\"height\"), stroke: seln.style(\"stroke\") });\n            });\n        recordedBinState.sort((a, b)=>a.left-b.left);\n    }\n\n    chart.highlightBinDifferences = highlightBinDifferences;\n    function highlightBinDifferences(binClass, deletePrevious) {\n        // @@ we currently ignore deletePrevious.  let stuff fade away.\n        //if (deletePrevious) chart.histGroup.selectAll(\"g.phosphor\").interrupt().remove();\n        if (!recordedBinState || recordedBinState.length===0) return;\n\n        binClass = binClass || \"primary\";\n        var yBase = recordedBinState[0].y+recordedBinState[0].height; // as good as any\n        var phosphorGroup = chart.histGroup.append(\"g\").attr(\"class\", \"phosphor\");\n        phosphorGroup.lower();\n\n        // check (in a somewhat inefficient way) if anything has changed visually\n        var anyChanges = false;\n        chart.histGroup.selectAll(\"rect.\"+binClass).each(function() {\n            var seln = d3.select(this);\n            if (binClass===\"context\" && +seln.style(\"stroke-opacity\")===0) return;\n\n            var left = +seln.attr(\"x\"), width = +seln.attr(\"width\"), y = +seln.attr(\"y\"), height = +seln.attr(\"height\");\n            var centreX = left+width/2;\n            var prevBin = recordedBinState.find(def=>def.left<=centreX && def.left+def.width>=centreX);\n            if (!prevBin || prevBin.left!==left || prevBin.width!==width || prevBin.y!==y) anyChanges = true;\n            });\n\n        if (anyChanges) {\n            var firstDur = 200, delay = 1000, secondDur = 1000;\n            phosphorGroup.selectAll(\"rect\").data(recordedBinState).enter().append(\"rect\")\n                .attr(\"x\", def=>def.left)\n                .attr(\"y\", def=>def.y)\n                .attr(\"width\", def=>def.width)\n                .attr(\"height\", def=>def.height)\n                .style(\"fill\", \"lightgrey\")\n                .style(\"fill-opacity\", 0.5)\n                //.style(\"stroke\", \"lightgrey\")\n                //.style(\"stroke-opacity\", 0.5)\n                .style(\"pointer-events\", \"none\")\n/*\n                .transition()\n                .duration(firstDur)\n                .ease(d3.easeLinear)\n                .style(\"stroke-opacity\", 1e-6)\n                .style(\"fill-opacity\", 0.25)\n                .on(\"end\", ()=>phosphorGroup.lower())\n*/\n                .transition()\n                .delay(delay)\n                .duration(secondDur)\n                .ease(d3.easeLinear)  // easeQuadOut another possibility\n                .style(\"fill-opacity\", 1e-6) // attempting to reduce flicker, as per bost.ocks.org/mike/transition/\n                .remove();\n        }\n\n        recordedBinState=null;\n\n    }\n\n};\n\nchartObject.initChartSubgroups=function initChartSubgroups() {\n\n    this.stopTimer();\n    this.chartGroup.selectAll(\"*\").remove();\n\n    this.dataLabelColour = \"chocolate\";\n\n    var commandListOrigin = this.commandListOrigin = lively.pt(45, 10);\n    this.buttonRowOrigin = lively.pt(290, this.visMaxExtent.y - 70);\n\n    var plotOrigin = this.plotOrigin = lively.pt(185, this.visMaxExtent.y - 210);\n\n    // during \"demo\" phase\n    this.numberLineWidth = 550;  // between dataMin and dataMax\n    this.fallAfterFlight = 115;  // bottom of flight arcs to number line\n    this.fallIntoBins = 100;     // number line to histogram base line\n\n    // definition of valueListOrigin is relative to plotOrigin\n    var valueListHeight = this.valueListHeight = 310, valueListBottomGap = 60;\n    this.valueListOrigin = lively.pt(620, -valueListHeight-valueListBottomGap-this.fallAfterFlight);\n    this.valueListWidth = 40;\n    this.valueListFontSize = 12;\n    this.valueListEntryHeight = 15;\n\n    // once we've presented the code table\n    var dataOrigin = this.dataOrigin = lively.pt(270, 110);\n    var histOrigin = this.histOrigin = lively.pt(270, 265);\n    var tableOrigin = this.tableOrigin = lively.pt(10, 305);\n    this.maxMainBinHeight = 90;\n\n    var binFill = d3.color(\"blue\");\n    binFill.opacity = 0.8;\n    this.restingBinFill = binFill.toString();\n    this.contextBinFill = d3.color(\"darkgreen\");\n\n    // final stages - no table\n    this.nakedHistOrigin = lively.pt(200, 400);\n\n    var transformString = this.transformString;\n\n    // the order of these will become significant if their glyphs start to overlap\n    this.commandGroup = this.chartGroup.append('g')\n\t\t.attr(\"transform\", transformString(commandListOrigin.x, commandListOrigin.y));\n\n\tthis.demoGroup = this.chartGroup.append('g')\n\t\t.attr(\"transform\", transformString(plotOrigin.x, plotOrigin.y));\n\n\tthis.histGroup = this.chartGroup.append('g')\n\t\t.attr(\"transform\", transformString(histOrigin.x, histOrigin.y));\n\n\t// data balls along number line.  starts at plotOrigin; later gets shifted to dataOrigin\n\tthis.dataGroup = this.chartGroup.append('g')\n\t\t.attr(\"transform\", transformString(plotOrigin.x, plotOrigin.y));\n    this.resetDataGroup = function() { this.dataGroup.attr(\"transform\",  transformString(plotOrigin.x, plotOrigin.y)) }\n\n    this.rangeGroup = this.chartGroup.append('g')\n\t\t.attr(\"transform\", transformString(dataOrigin.x, dataOrigin.y));\n\n    this.tableGroup = this.chartGroup.append('g')\n\t\t.attr(\"transform\", transformString(tableOrigin.x, tableOrigin.y));\n\n\tthis.clearFixedCanvas();\n\tthis.clearEphemeralCanvas();\n\n};\n\nchartObject.initChartSubstrates=function initChartSubstrates(divSeln, extent) {\n\n    var width = extent.x, height = extent.y;\n\n    var transformString = this.transformString = function(x, y) { return \"translate(\"+x+\", \"+y+\")\" }\n    this.textOffsets = {\n        hanging: \"0.75em\",\n        central: \"0.4em\",\n        middle: \"0.35em\"\n    }\n//console.log(this.textOffsets);\n\n    this.chartSVG = divSeln.append(\"svg\")\n        .attr(\"tabindex\", -1)\n        .attr(\"xmlns\", \"http://www.w3.org/2000/svg\")\n        .attr(\"xmlns:xlink\", \"http://www.w3.org/1999/xlink\")\n        .style(\"background-color\", \"rgb(255,248,230)\")\n        .attr(\"width\", width)\n        .attr(\"height\", extent.y)\n        .attr(\"viewBox\", \"0 0 \"+extent.x+\" \"+extent.y);\n\n    this.chartGroup = this.chartSVG.append('g')\n        .attr(\"transform\", transformString(0,0));\n\n    this.chartFixedCanvas = divSeln.append(\"canvas\");\n    var context = this.chartFixedCanvas.node().getContext(\"2d\");\n\n    this.chartFixedCanvas\n        .attr(\"class\", \"fixed\")\n        .attr(\"width\", width)\n        .attr(\"height\", height)\n        .style(\"position\", \"absolute\")\n        .style(\"left\", \"0px\")\n        .style(\"top\", \"0px\")\n        //.style(\"width\", width+\"px\")\n        //.style(\"height\", height+\"px\")\n        .style(\"pointer-events\", \"none\");\n\n    this.chartCanvas = divSeln.append(\"canvas\")\n        .attr(\"class\", \"ephemeral\")\n        .attr(\"width\", width)\n        .attr(\"height\", height)\n        .style(\"position\", \"absolute\")\n        .style(\"left\", \"0px\")\n        .style(\"top\", \"0px\")\n        //.style(\"width\", width+\"px\")\n        //.style(\"height\", height+\"px\")\n        .style(\"pointer-events\", \"none\");\n\n    function clearCanvas(canvSeln) {\n        var canvas = canvSeln.node(), context = canvas.getContext(\"2d\");\n        context.clearRect(0, 0, width, height);\n    }\n    this.clearEphemeralCanvas = function() { clearCanvas(this.chartCanvas) }\n    this.clearFixedCanvas = function() { clearCanvas(this.chartFixedCanvas) }\n\n    this.clearMousetraps = function(trapNames) {\n        trapNames.forEach(name=>this.chartGroup.selectAll(\".\"+name+\"Mousetrap\").remove())\n        }\n\n    this.initChartSubgroups();\n\n    // Define a div to act as a tooltip within the visualisation\n    d3.selectAll(\"div.vistooltip\").remove();\n    d3.select(\"body\").append(\"div\")\n        .attr(\"class\", \"vistooltip\")\n        .style(\"opacity\", 0);\n\n};\n\nchartObject.initHistogramArea=function initHistogramArea(options) {\n    // (plus lots of other highlighting experiments in unusedBinDiffHighlightFns)\n    var chart=this;\n    var instant = !!(options && options.instant);\n\n    chart.clearDataRanges = function() { chart.rangeGroup.selectAll(\"text\").remove() }\n    chart.clearDataBalls = function() { chart.dataGroup.selectAll(\"circle.ball\").remove() }\n\n    chart.clearDataRanges();\n    chart.clearDataBalls();\n\n    this.stripeOffset = 0;\n\n    var transformString = this.transformString;\n    var colourScale = this.colourScale;\n\n    // see if the dataGroup needs to be shifted\n    var dataGroup = this.dataGroup, dataGroupNode = dataGroup.node(), dataOrigin = this.dataOrigin, desiredLoc = dataOrigin;\n    // NB: this code assumes we're using the same transformString format everywhere\n    var oldTrans = dataGroup.attr(\"transform\"), newTrans = transformString(desiredLoc.x, desiredLoc.y);\n    if (oldTrans===newTrans) instant = true; // @@ even if caller didn't think so\n    var eezer = d3.easeQuadInOut, interpolator = d3.interpolateTransformSvg(oldTrans, newTrans), easedTransform = t=>interpolator(eezer(t));\n\n    var tableGroup = this.tableGroup;\n    tableGroup.style(\"opacity\", 1e-6);\n\n    var histGroup = this.histGroup;\n    histGroup.style(\"opacity\", 1e-6);\n\n    this.drawNumberLine();  // make sure it's there\n    this.drawBalls(this.data);\n    var newBalls = dataGroup.selectAll(\"circle.ball\");\n    newBalls.style(\"opacity\", 1e-6);\n\n    var oldBalls = dataGroup.selectAll(\"circle.settled,circle.dropped\");\n    oldBalls.style(\"fill\", def=>colourScale(def.value, 1));\n\n    var moveTime = 1000, fadeTime = 1000, totalTime = moveTime+fadeTime;\n    if (instant) {\n        drawForElapsedTime(totalTime);\n    } else {\n        this.startTimer({\n            tick: elapsed=>{\n                drawForElapsedTime(elapsed);\n                if (elapsed >= totalTime) {\n                    chart.stopTimer(false);\n//console.log(\"finished\");\n                }\n                },\n            forceToEnd: ()=>drawForElapsedTime(totalTime)\n            })\n    }\n\n    function drawForElapsedTime(elapsed) {\n        // update transform even after moveTime, because we might only be called once\n        var moveRatio = Math.min(1, elapsed/moveTime);\n        dataGroup.attr(\"transform\", easedTransform(moveRatio));\n\n        if (elapsed > moveTime) {\n            var fadeRatio = Math.min(1, (elapsed-moveTime)/fadeTime);\n            tableGroup.style(\"opacity\", fadeRatio);\n            newBalls.style(\"opacity\", fadeRatio);\n            histGroup.style(\"opacity\", fadeRatio);\n            oldBalls.style(\"opacity\", 1-fadeRatio);\n        }\n    }\n\n    this.initBinBehaviour();\n};\n\nchartObject.initNakedHistogram=function initNakedHistogram(options) {\n    var chart=this;\n    var instant = !!(options && options.instant);\n\n    chart.rangeGroup.selectAll(\"text\").remove();\n    chart.dataGroup.selectAll(\"circle.ball,line.numberline\").remove()\n\n    var transformString = this.transformString;\n\n    // see if the histGroup needs to be shifted\n    var histGroup = this.histGroup, histGroupNode = histGroup.node(), desiredLoc = this.nakedHistOrigin;\n    // NB: this code assumes we're using the same transformString format everywhere\n    var oldTrans = histGroup.attr(\"transform\"), newTrans = transformString(desiredLoc.x, desiredLoc.y);\n    //if (oldTrans===newTrans) instant = true; // @@ even if caller didn't think so\n    var eezer = d3.easeQuadInOut, interpolator = d3.interpolateTransformSvg(oldTrans, newTrans), easedTransform = t=>interpolator(eezer(t));\n\n    var tableGroup = this.tableGroup;\n    tableGroup.style(\"opacity\", 0);\n\n    var moveTime = 750, totalTime = moveTime;\n    if (instant) {\n        drawForElapsedTime(totalTime);\n    } else {\n        this.startTimer({\n            tick: elapsed=>{\n                drawForElapsedTime(elapsed);\n                if (elapsed >= totalTime) {\n                    chart.stopTimer(false);\n//console.log(\"finished\");\n                }\n                },\n            forceToEnd: ()=>drawForElapsedTime(totalTime)\n            })\n    }\n\n    function drawForElapsedTime(elapsed) {\n        // update transform even after moveTime, because we might only be called once\n        var moveRatio = Math.min(1, elapsed/moveTime);\n        histGroup.attr(\"transform\", easedTransform(moveRatio));\n    }\n\n    this.primaryOpacity = 0.5;\n    this.initBinBehaviour();\n};\n\nchartObject.initScrolliness=function initScrolliness(options) {\n    // adapted from https://github.com/vlandham/scroll_demo/blob/gh-pages/js/sections.js\n\n    // the job of this code is to install a scrollable content zone and a static but resizable visualisation zone that gets kicked whenever the content scrolls to a new section.\n\n    var chart=this; // the whole object - with code for the scroller and the visualisation\n\n    function scroller() {\n        // this code adapted from scroller() function by Jim Vallandingham:\n        // https://github.com/vlandham/scroll_demo/blob/gh-pages/js/scroller.js\n        // (as found in http://vallandingham.me/scroll_demo/ on 19 March 2017)\n\n        /**\n        * scroller - handles the details\n        * of figuring out which section\n        * the user is currently scrolled\n        * to.\n        *\n        */\n\n        var container = d3.select('body'); // until told otherwise\n        // event dispatcher\n        var dispatch = d3.dispatch('active', 'progress', 'size'); // ael added size\n\n        // d3 selection of all the\n        // text sections that will\n        // be scrolled through\n        var sections = null;\n\n        // array that will hold the\n        // y coordinate of each section\n        // that is scrolled through\n        var sectionPositions = [];\n        var currentIndex = -1;  // somewhat redundantly tracked both here and by the stepController\n        // the following are used to switch on and off the inline scrolling of the viz.\n        var containerTop, containerMaxScroll, visScrollState = null;\n\n        var navHeight = d3.select(\"nav\").node().getBoundingClientRect().height;\n        var heightMargin = navHeight+50;\n        var switchPos = 200+navHeight;  // how far from the top we switch in a new section\n        var stickPoint = 10+navHeight\n        var textMargin = 10;  // NB: tied to scrolly.css\n\n        var visSeln = null;\n        // ael - permissible vis and text extents\n        var visMinExtent, visMaxExtent, textMinWidth, textMaxWidth;\n\n        /**\n        * scroll - constructor function.\n        * Sets up scroller to monitor\n        * scrolling of stepElems selection.\n        *\n        * @param stepElems - d3 selection of\n        *  elements that will be scrolled\n        *  through by user.\n        */\n        function scroll(stepElems, visElem) {\n            sections = stepElems;\n            visSeln = visElem;\n\n            stepElems.style('opacity', (d,i)=>i===0? 1 : 0.1);  // first section shown fully, rest faded out\n\n            // when window is scrolled call\n            // position. When it is resized\n            // call resize.\n            d3.select(window)\n              .on('scroll.scroller', throttledPosition)\n              .on('resize.scroller', debouncedResize);\n\n            // hack to get resize (and hence position)\n            // to be called once for\n            // the scroll position on\n            // load.\n            var timer = d3.timer(function () {\n                resize();\n                timer.stop();\n                });\n        }\n\n        /**\n        * resize - called on load, and\n        * also when page is resized.\n        * Resizes the vis and the text as needed,\n        * then recalculates sectionPositions and\n        * calls position() to figure out where\n        * the window now is.\n        *\n        */\n        function resize() {\n            // ael: first figure out what size we're going to give the text and vis.\n\n            // we rely on the page's base css to define the width of #scrolly.\n            // vis gets height of window, up to its visMaxExtent.y, unless the proportionally scaled width would leave less than textMinWidth for the text column.\n            // i.e., subject to the min vis extent, we want the vis to be the smaller of:\n            //    leaving width of at least textMinWidth (which includes a narrow gutter, specified as #sections.margin-right)\n            //    fitting into the window height.\n\n            var divWidth = d3.select(\"#scrolly\").node().getBoundingClientRect().width;\n            d3.select(\"#sections\").style(\"padding-left\", \"0px\");\n            var visRatio = visMaxExtent.x / visMaxExtent.y;\n            var visMinWidth = Math.max(visMinExtent.x, visRatio*visMinExtent.y);\n\n            var textLimitedMaxWidth = divWidth - textMinWidth;\n            var heightLimitedMaxWidth = visRatio * (window.innerHeight - heightMargin);\n            var visWidth = Math.max(visMinWidth, Math.min(visMaxExtent.x, Math.min(textLimitedMaxWidth, heightLimitedMaxWidth)));\n            var visHeight = visWidth / visRatio;\n            var textWidth = Math.max(textMinWidth, Math.min(textMaxWidth, divWidth - visWidth));\n\n            textWidth = textWidth | 0;\n            d3.select(\"#sections\").style(\"width\", textWidth-textMargin+\"px\"); // margin is supplementary to width value\n            visWidth = visWidth | 0;\n            visHeight = visHeight | 0;\n            visSeln.style(\"width\", visWidth+\"px\").style(\"height\", visHeight+\"px\");\n\n            var marginNeeded = Math.max(0, Math.floor((divWidth - visWidth - textWidth)/2));\n            d3.select(\"#sections\").style(\"padding-left\", marginNeeded+\"px\");\n            visSeln.style(\"padding-right\", marginNeeded+\"px\");\n\n            dispatch.call('size', this, { x: visWidth, y: visHeight });\n\n            var lastSection = sections.nodes()[sections.size()-1];\n            d3.select(lastSection).style(\"padding-bottom\", \"0px\").style(\"margin-bottom\", \"50px\");\n\n            // give the page some time to reflow before we measure section positions\n            setTimeout(function() {\n                // sectionPositions will be each section's\n                // starting position relative to the top\n                // of the first section.\n                sectionPositions = [];\n                var startPos;\n                sections.each(function (d, i) {\n                  var top = this.getBoundingClientRect().top;\n                  if (i === 0) startPos = top;\n                  sectionPositions.push(top - startPos);\n                });\n\n                // for the scrolly container, record its top (in page coords) and the max scroll distance during the interactive phase\n                var containerRect = container.node().getBoundingClientRect();\n                containerTop = containerRect.top + window.pageYOffset; // px from top of page\n                containerMaxScroll = containerRect.height - visHeight;\n\n                visScrollState = null;  // force re-layout\n\n                position();\n                }, 250);\n        }\n        var debouncedResize = lively.lang.fun.debounce(500, resize);\n\n        /**\n        * position - get user's current position.\n        * if user has scrolled to new section,\n        * dispatch active event with new section\n        * index.\n        *\n        * ael: original logic wasn't coping with sections of\n        * different lengths.  we now switch to a section when\n        * its start comes within a specified distance (switchPos)\n        * of the viewport top.\n        *\n        */\n        function position() {\n            // reject any position() prior to a resize(), which takes crucial measurements.\n            if (!containerTop) return;\n\n            var pos = window.pageYOffset - containerTop; // pos of top of visible region relative to start of scrolly\n\n            var unstickPoint = containerMaxScroll-stickPoint;\n            var newState = pos < -stickPoint ? \"before\" : (pos > unstickPoint ? \"after\" : \"during\");\n            var isDuring = newState===\"during\";\n            visSeln\n                .style(\"position\", isDuring ? \"fixed\" : null)\n                .style(\"float\", isDuring ? null : \"right\")\n                .style(\"top\", isDuring ? stickPoint+\"px\" : null)\n                .style(\"left\", isDuring ? (d3.select(\"#sections\").node().getBoundingClientRect().right+textMargin+1+\"px\") : null)\n                .style(\"padding-top\", isDuring ? null : (newState===\"before\" ? \"0px\" : (containerMaxScroll+\"px\")) );\n            visScrollState = newState;\n\n            var sectionIndex = Math.max(0, d3.bisect(sectionPositions, pos+switchPos)-1);\n\n            if (currentIndex !== sectionIndex) {\n              dispatch.call('active', this, sectionIndex);\n              currentIndex = sectionIndex;\n            }\n\n            // NB: no \"progress\" calls will be made for the very last section\n            var sectionTop = sectionPositions[sectionIndex], sectionLength = (sectionIndex<sectionPositions.length-1) ? sectionPositions[sectionIndex+1]-sectionTop : Infinity;\n            var belowSectionTop = pos + switchPos - sectionTop;\n            if (belowSectionTop > 0) dispatch.call('progress', this, currentIndex, belowSectionTop/sectionLength);\n        }\n\n        // augmented version of lively.lang.fun.throttle, for coping if the browser is too busy to service its setTimeout queue.  the events from a scroll gesture on a MacBook trackpad seem to induce such issues, at least in Chrome.\n        // the standard throttle uses debounce to clear the throttling flag when the incoming events idle - at which point we're presumably safe in assuming that the setTimeout will be scheduled as it should.\n        function highRateThrottle (func, wait) {\n            var context, args, timeout, throttling, more, result, timeoutSet, whenDone = lively.lang.fun.debounce(wait, function () {\n                    more = throttling = false;\n                });\n            return function () {\n                context = this;\n                args = arguments;\n                var later = function () {\n                    timeout = timeoutSet = null;\n                    if (more)\n                        func.apply(context, args);\n                    whenDone();\n                };\n                if (!timeout) {\n                    timeoutSet = Date.now(); // added\n                    timeout = setTimeout(later, wait);\n                }\n                if (throttling) {\n                    more = true;\n                    // added code.  if the timeout should have triggered by now, do it manually.\n                    if (timeoutSet && (Date.now()-timeoutSet > wait)) {\n                      clearTimeout(timeout);\n                      later();\n                    }\n\n                } else {\n                    result = func.apply(context, args);\n                }\n                whenDone();\n                throttling = true;\n                return result;\n            };\n        }\n        var throttledPosition = highRateThrottle(position, 100);\n\n        /**\n        * container - get/set the parent element\n        * of the sections. Useful for if the\n        * scrolling doesn't start at the very top\n        * of the page.\n        *\n        * @param value - the new container value\n        */\n        scroll.container = function (value) {\n            if (arguments.length === 0) {\n              return container;\n            }\n            container = value;\n            return scroll;\n        };\n\n        // @v4 There is now no d3.rebind, so this implements\n        // a .on method to pass in a callback to the dispatcher.\n        scroll.on = function (action, callback) {\n            dispatch.on(action, callback);\n        };\n\n        // ael added\n        scroll.setVisExtents = function(options) {\n            visMinExtent = options.visMinExtent;\n            visMaxExtent = options.visExtent;\n            textMinWidth = options.textMinWidth;\n            textMaxWidth = options.textMaxWidth;\n\n            return scroll;\n        }\n\n        scroll.resetLastIndex = function() { currentIndex = -1 }\n\n        scroll.sectionTop = function(sectionIndex) {\n            return window.scrollY + sections.nodes()[0].getBoundingClientRect().top + sectionPositions[sectionIndex] - stickPoint;\n        }\n\n        return scroll;\n    }\n\n\n    // scrollVis sets up the visualisation control structure, using a scroller created with the function above\n    /**\n     * scrollVis - encapsulates\n     * all the code for the visualization\n     * using reusable charts pattern:\n     * http://bost.ocks.org/mike/chart/\n     *\n     * ael: augmented...\n     */\n    var scrollVis = function (stepDefs, initFnName, refreshFnName) {\n        // When scrolling to a new section\n        // the activationFunction for that\n        // section is called.\n\n        // If a section has an updateFunction\n        // then it is called while scrolling\n        // through the section with the current\n        // progress through the section.\n\n        // When the section to be activated is earlier than the current section,\n        // the refreshFunction is invoked, then activation proceeds forwards from\n        // the most recent step with the tag replayPoint.\n\n        // ael; margin disabled, for now\n        //var margin = { top: 0, left: 20, bottom: 40, right: 10 };\n\n        var activateFunctions = stepDefs.map(def=>def.activate);\n        var updateFunctions = stepDefs.map(def=>def.update);\n\n        // Keep track of which visualization\n        // we are on and which was the last\n        // index activated. When user scrolls\n        // quickly, we want to call all the\n        // activate functions that the scroll passes.\n        var lastIndex = -1;\n        var activeIndex = 0;\n\n        var chartObj;\n        function refreshChart() { chartObj[refreshFnName].call(chartObj) }\n\n        /**\n        * stepController (was chart in original code) - constructor function\n        *\n        * @param divSeln - the d3 selection\n        *  to draw the visualization in.\n        */\n        var stepController = function (divSeln, ch, extent) {\n            chartObj = ch;\n            // for now, no margin taken into account.\n            // the div will be resized, if necessary, by the scroller object.\n            //var extent = { x: width + margin.left + margin.right, y: height + margin.top + margin.bottom };\n            divSeln.style(\"width\", extent.x+\"px\").style(\"height\", extent.y+\"px\");\n            chartObj[initFnName].call(chartObj, divSeln, extent);\n        };\n\n        // find the most recent index - at or before \"start\" - that has the replayPoint tag\n        function restartIndex(start) {\n            var index = start;\n            while (index>0 && !(stepDefs[index].replayPoint)) index--;\n            return index;\n        }\n\n        /**\n        * activate - [reworked by ael]\n        *\n        * @param index - index of the activated section\n        * @param options - (ael added)\n        *                   replay: force replay (even if index is same as before), from\n        *                       most recent replayPoint\n        */\n        stepController.activate = function (index, options) {\n            var replay = options && options.replay;\n            if (index===lastIndex && !replay) return;  // nothing to do\n\n            var originIndex = lastIndex;\n            var startIndex = originIndex; // unless there's a restart point along the way\n            if (index <= lastIndex || lastIndex===-1) {  // jump backwards, replay, or page load\n                refreshChart();\n                startIndex = restartIndex(index)-1;\n                lastIndex = null;   // for steps that care which step was last rendered\n            }\n\n            /*\n            activate each relevant section in turn.\n            the activation function might need to distinguish among all the following conditions:\n                1. orderly transition from previous state to here\n                2a/b. fast visit on the way to somewhere ahead, either starting (a) here or (b) earlier\n                3. forwards jump ending here\n                4a/b. replay (or jump backwards) ending here, starting (a) here or (b) earlier\n\n            if we provide just arguments previousRenderedIndex, targetIndex (and thisIndex), the conditions are:\n                1 = n-1, n\n                2a = null, n+m\n                2b = n-1, n+m\n                3 = n-1, n\n                4a = null, n\n                4b = n-1, n\n\n            1, 3 and 4b are indistinguishable, so all treated as smooth transitions from previous step.  not ideal.\n            so add one more argument: originIndex (the last fully displayed index, or -1 if this is a page reload).\n            */\n\n            var scrolledSections;\n            if (startIndex===index) scrolledSections = [index];\n            else scrolledSections = d3.range(startIndex + 1, index + 1); // non-inclusive end\n            var first = scrolledSections[0], last = scrolledSections[scrolledSections.length-1];\n//console.log(\"from \"+first+\" to \"+last);\n            var prevRendered = lastIndex;\n            scrolledSections.forEach(function (i) {\n//console.log(\"step:\", prevRendered, last, i);\n                var f = activateFunctions[i];\n                if (f) {\n                    f(chart, originIndex, prevRendered, last, i);\n                    prevRendered = i;\n                }\n                });\n\n            lastIndex = activeIndex = index;\n        };\n\n        /**\n        * update\n        *\n        * @param index\n        * @param progress\n        */\n        stepController.update = function (index, progress) {\n            var f = updateFunctions[index];\n            if (f) f(chart, progress);\n        };\n\n        stepController.activeIndex = function() { return activeIndex }\n\n        stepController.resetLastIndex = function() { lastIndex = -1 }\n\n        // return stepController function\n        return stepController;\n    };\n\n    // set up scroll functionality on the #scrolly div - which contains a #sections div for the scrollable text sections, and (typically) a #vis div for the arbitrarily updatable plot\n\n    var stepDefs = options.stepDefinitions;\n    chart.commandList = stepDefs.map(function(def) { return { command: def.command, replayable: !!def.replayable } });\n\n    chart.visMaxExtent = options.visExtent;\n\n    var visSeln = d3.select(\"#\"+options.element);\n\n    // first create a new stepController and its plot, initially displayed at full extent\n    var stepController = scrollVis(stepDefs, \"initChartSubstrates\", \"initChartSubgroups\");\n    stepController(visSeln, chart, options.visExtent);\n\n    // now set up the scroll functionality on the outer div\n    var scroll = scroller()\n        .container(d3.select('#scrolly'))\n        .setVisExtents(options);\n\n    chart.maximumScrolledIndex = -1; // ael - HACK\n\n    // jumping to an index (not through scrolling)\n    chart.activateStep = function(index) {\n        // 2nd activate() arg forces replay if index hasn't changed\n        stepController.activate(index, { replay: true });\n        chart.drawCommandList(index);\n        }\n\n    chart.jumpToStep = function(index) {\n        var oldIndex = stepController.activeIndex();\n        var sectionTop = scroll.sectionTop(index);\n        window.scrollTo(0, sectionTop);\n        // force replay iff index hasn't changed\n        if (index===oldIndex) {\n            stepController.activate(index, { replay: true });\n            chart.drawCommandList(index);\n        }\n    }\n\n    // replaying to current position from nearest step tagged \"replayPoint\" (or 0 if none)\n    chart.replaySteps = function() {\n        var index = stepController.activeIndex();\n        stepController.activate(index, { replay: true });\n        chart.drawCommandList(index)\n        }\n\n    // ael added\n    scroll.on('size', function(extent) {\n        chart.stopTimer();  // abandon anything that was running\n        chart.resizeChartSubstrates(visSeln, extent);\n        scroll.resetLastIndex();\n        stepController.resetLastIndex();\n        });\n\n    // set up event handling for scrolling.  this is called through a throttled handler.\n    scroll.on('active', function (index) {\n        // highlight current step text\n        d3.selectAll('.step')\n          .style('opacity', function (d, i) { return i === index ? 1 : 0.1; });\n\n        chart.lastScrolledIndex = index; // ael - for the moving hand\n        if (index > chart.maximumScrolledIndex) chart.maximumScrolledIndex = index;\n\n        // activate current section (and intermediates along the way)\n        stepController.activate(index);\n        chart.drawCommandList(index);\n        });\n\n    scroll.on('progress', function (index, progress) {\n        stepController.update(index, progress);\n        });\n\n    // pass in .step selection as the steps.  triggers the first position and resize calls, based on loaded page state.\n    scroll(d3.selectAll('.step'), visSeln);\n\n    chart.loadData(options.dataset);\n};\n\nchartObject.iterate=function iterate(values, fn) {\n    // we used to have a delay argument, for iterating at a specified rate.  now just store the results for some other function to display.\n    var chart=this;\n\n    values.forEach(v=>{\n        fn(v);\n        chart.scenarioRecords.push({ value: v, bins: chart.duplicateBins() });\n        });\n};\n\nchartObject.loadData=function loadData(dataset, thenDo) {\n    var rawData = [], quantum = 1, binQuantum, units = \"\", minBins = 8, maxBins = 50;\n    this.datasetShortDescriptions = {\n        MPG: \"fuel consumption (in mpg)<br/>for 32 car models\",\n        NBA: \"age (in years)<br/>for 105 NBA athletes\",\n        Geyser: \"272 records of delay (in seconds)<br/>between eruptions of Old Faithful\",\n        Diamonds: \"price (in US$)<br/>for 1000 diamonds\",\n        Marathons: \"finishing time (in hours)<br/>for 3000 NY marathon runners\"\n    }\n    var chart=this;\n    function recordData() {\n        chart.dataName = dataset;\n        chart.dataUnits = units;\n        chart.dataMin = lively.lang.num.roundTo(d3.min(rawData), quantum);\n        chart.dataMax = lively.lang.num.roundTo(d3.max(rawData), quantum);\n        chart.dataRange = chart.dataMax - chart.dataMin;\n        chart.xScale = d3.scaleLinear()\n        \t\t\t\t\t.domain([chart.dataMin, chart.dataMax])\n        \t\t\t\t\t.range([0, chart.numberLineWidth]);\n        // dataQuantum is the precision with which the values have been measured\n        chart.dataQuantum = quantum;\n        // dataBinQuantum is the precision permissible in setting bin widths (typically same as dataQuantum, but can be overridden in the data setup)\n        chart.dataBinQuantum = binQuantum || quantum;\n        // dataDecimals, derived from the quantum, is the precision to be used in displaying values.\n        chart.dataDecimals = quantum >= 1 ? 0 : (quantum >= 0.1 ? 1 : 2);\n        chart.dataBinDecimals = chart.dataBinQuantum >= 1 ? 0 : (quantum >= 0.1 ? 1 : 2);\n        delete chart.poolValueEntries;\n        // may 2017: for now, these are only used in the last stage of the essay\n        chart.minBinsOverRange = minBins;\n        chart.maxBinsOverRange = maxBins;\n        chart.scenarioRecords = [];\n\n        // quick hack to support an efficient bag-like collection for the data\n        var values = [], counts = {};\n        rawData.forEach(v => {\n            var count = counts[v];\n            if (count===undefined) { values.push(v); count = 0 };\n            counts[v] = ++count;\n            });\n        var data = { values: values.sort((a,b)=>a-b), counts: counts, length: rawData.length };\n        data.filter = (function(f) {\n            var subset = {};\n            subset.collection = f===null ? this.values : this.values.filter(f);\n            var total = 0;\n            subset.collection.forEach(uv=>total+=this.counts[uv]);\n            subset.length = total;\n            subset.toString = function() { return \"{\"+this.length+\"}\"};\n            subset.forEach = function(f) {\n                var i=0;\n                this.collection.forEach(uv=>{\n                    var count = data.counts[uv];\n                    for (var subI=0; subI<count; subI++) f(uv, i+subI);\n                    i+=count;\n                    })\n                };\n            return subset;\n            });\n        data.valuesAndCountsDo = function(f) {\n            this.values.forEach(uv=>f(uv, this.counts[uv]));\n            };\n        data.allData = data.filter(null);\n        data.forEach = function(f) { this.allData.forEach(f) };\n\n        chart.data = data;\n\n        var valueScale = d3.scaleLinear().domain([chart.dataMin, chart.dataMax]);\n        var colourInterpolator = d3.interpolateHcl(\"#5086FE\", \"#FD2EA7\");\n        chart.colourScale = function(val, opacity) { var c = d3.color(colourInterpolator(valueScale(val))); c.opacity = opacity; return c.toString() };\n\n        if (thenDo) thenDo();\n    }\n\n    switch(dataset) {\n        case \"marathons\":\n            // a subset of nyc marathon finishing times\n            d3.csv(\"data/sampled-marathon-times.csv\", row=>Number(row.x), function(d) {\n                rawData=d;\n                quantum=0.001;\n                binQuantum = 0.02;\n                minBins = 15;\n                maxBins = 150;\n                units = \"hours\";\n                recordData();\n                });\n            return;\n        case \"diamonds\":\n            // a subset of prices from the ggplot2 diamonds dataset\n            d3.csv(\"data/sampled-diamonds-price-small.csv\", row=>Number(row.x), function(d) {\n                rawData=d;\n                quantum=1;\n                binQuantum = 5;\n                minBins = 15;\n                maxBins = 45;\n                units = \"US$\";\n                recordData();\n                });\n            return;\n\n        case \"nba\":\n            // from chatterjee et al 1992-3 nba player ages http://people.stern.nyu.edu/jsimonof/Casebook/Data/ASCII/nba.dat\n            rawData = [28, 30, 26, 30, 28, 31, 30, 27, 29, 24, 27, 29, 24, 30, 28, 32, 25, 29, 34, 23, 32, 28, 28, 23, 32, 27, 34, 26, 30, 30, 23, 31, 28, 27, 25, 32, 29, 34, 28, 23, 26, 30, 32, 27, 27, 25, 24, 27, 25, 27, 31, 30, 25, 26, 33, 24, 26, 31, 24, 27, 28, 22, 30, 31, 23, 25, 31, 33, 28, 37, 28, 24, 34, 24, 28, 33, 23, 26, 28, 26, 25, 25, 26, 25, 27, 35, 31, 25, 30, 24, 23, 23, 27, 27, 25, 24, 24, 23, 23, 26, 24, 23, 32, 24, 27];\n            quantum = 1;\n            binQuantum = 0.1;\n            units = \"years\";\n            break;\n\n        case \"geyser\":\n            // eruption times from R sample dataset https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/faithful.html (ne60, adjusted and rounded as described on that page)\n            rawData = [216, 108, 200, 137, 272, 173, 282, 216, 117, 261, 110, 235, 252, 105, 282, 130, 105, 288, 96, 255, 108, 105, 207, 184, 272, 216, 118, 245, 231, 266, 258, 268, 202, 242, 230, 121, 112, 290, 110, 287, 261, 113, 274, 105, 272, 199, 230, 126, 278, 120, 288, 283, 110, 290, 104, 293, 223, 100, 274, 259, 134, 270, 105, 288, 109, 264, 250, 282, 124, 282, 242, 118, 270, 240, 119, 304, 121, 274, 233, 216, 248, 260, 246, 158, 244, 296, 237, 271, 130, 240, 132, 260, 112, 289, 110, 258, 280, 225, 112, 294, 149, 262, 126, 270, 243, 112, 282, 107, 291, 221, 284, 138, 294, 265, 102, 278, 139, 276, 109, 265, 157, 244, 255, 118, 276, 226, 115, 270, 136, 279, 112, 250, 168, 260, 110, 263, 113, 296, 122, 224, 254, 134, 272, 289, 260, 119, 278, 121, 306, 108, 302, 240, 144, 276, 214, 240, 270, 245, 108, 238, 132, 249, 120, 230, 210, 275, 142, 300, 116, 277, 115, 125, 275, 200, 250, 260, 270, 145, 240, 250, 113, 275, 255, 226, 122, 266, 245, 110, 265, 131, 288, 110, 288, 246, 238, 254, 210, 262, 135, 280, 126, 261, 248, 112, 276, 107, 262, 231, 116, 270, 143, 282, 112, 230, 205, 254, 144, 288, 120, 249, 112, 256, 105, 269, 240, 247, 245, 256, 235, 273, 245, 145, 251, 133, 267, 113, 111, 257, 237, 140, 249, 141, 296, 174, 275, 230, 125, 262, 128, 261, 132, 267, 214, 270, 249, 229, 235, 267, 120, 257, 286, 272, 111, 255, 119, 135, 285, 247, 129, 265, 109, 268];\n            quantum = 1;\n            units = \"seconds\";\n            break;\n\n        default:\n        case \"mpg\":\n            // mpg entries from the R mtcars dataset https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/mtcars.html\n            // FUDGED to remove the identical values (see raw-mpg below for original set)\n            rawData = [21.0, 21.1, 22.8, 21.4, 18.7, 18.1, 14.3, 24.4, 22.9, 19.2, 17.8, 16.4, 17.3, 15.3, 10.4, 10.5, 14.7, 32.4, 30.4, 33.9, 21.5, 15.5, 15.2, 13.3, 19.3, 27.3, 26.0, 30.5, 15.8, 19.7, 15.0, 21.3];\n            quantum = 0.1;\n            units = \"mpg\";\n\n    }\n\n    recordData();\n};\n\nchartObject.loadLibs=function loadLibs() {\n    //Global.JSLoader.loadJs('core/lib/d3/d3.v4.js');\n    //Global.JSLoader.loadJs('https://d3js.org/d3.v4.min.js');\n    Global.JSLoader.loadJs('https://d3js.org/d3.v4.js');\n};\n\nchartObject.pointerImageFlipped=function pointerImageFlipped() {\n    // base64 for a PNG with a friendly left-hand pointer\n    return \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACUAAAAnCAQAAAAiX0mDAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAAmJLR0QAAKqNIzIAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAQ8SURBVEjHnZZNbFRVFMd/575XZqa2FiiUgtBKQIlSP7AVowZCCDEsTIiSsMAFyILEGBcsiLsaYSEuxOBHYpo0kLgjGo0fuKEaWaBBvkREIRT5DFJAaSmdaWfe/buYN6/ttFMq52Uy99537++dc+4591zj/4hhcUvx757EcASssR/cUXZSh0uw9wAKWYuv908I2edMIbg3mBFSF1xt8jckbZR5GqjCjZziJglyBKyPGrdbPfA0MprLtZocChxV9soMrQdgCkCm3FuT12oqz71sIQB/A9wqX3t3lMXmPSVbHg+dwmW5jo0IDiAcZynJBANm04bnBEugNR4+JJ1C8TOBDgEP0OGOBYfpZD5vWh4hl+VM2hckSVeF6GAW942jyAgzqqgLzqFn1CaT60HP6xvt1YMetakoe4V4lZlUE4yvSxN7w9N8ybuoU5L0qRDqliR9IrQpRr0u8zzGdNJjPW0EpNyvgV+mjEfO35EkXRNqjIrLdwu9H6MWefc7TUwjQ4gbDgkXo1r84+12gH0GC6kGoIG0FsTfHQAWx4Fw2vxPwLqgK7gSfM/KEi6MUXOgBVjBQyxJNniVLY5bTczgSQB+AfjTdmvlLLXagZl93+lFuvComF01vIS+kCT1KaeJZJuQnUNblJN0SVO9dZEmwFwcy4kDa0lNGLEnAc3fyU5SwFyWWfAIVcMoA/B3DXyAM8AmtsS9fg5Jlwlxw4nTD73J9Av0AXCZmwDcJJu8u6JH9VHS28I1izpLe2hMoY6laEfij7naLElq0TpJ0mJtSN79pp6k3SnEVzQzjTQuBIToMX8x8ddtBkf993Mr0aMlaR3mNblu306eCF8yUAwGF09Oylcl6WetogH/BrcYooBHrpThhWMHdaPCsj5qx4y1c9Gids6SY7CEAuGJ+KxgH1RA+TF5e5Rdsh/5liw58kSoaGARddBOvKdzkzIuYrMY1HZy5ErmlXzlKZDXW7lojQYmgXqbI+Y/5DxZBskXQcNaFRjihN920rYCNcVCQIoMANWkR4A62I79zJ4YFI0+SR0p6pjDItuPjqtb/0iSzuqaJKlbvUksdcjJnaKVJurJEJaXVSMkQz3NvIC2TpDMO4TcHyxnPg3UlBfVkl5V1NLIwvDGGklSl+r8w/7SKNDHQsERnmUBjdxPavx7gxGQZjpNVd0rJP2rZh/0WrRKfgSqxbu/aGUhs6krHiwjEaWaITyeAgXf0MseOrlgvMOi/Rs3sDo+VeE8/gy3GSBbCstKexxSwzy7g5BF7KKNpXyd1Lvis495TB/P3YwaCEiRYRbN1NLDdTwQ0Ex9rFZEnuNcYYAhCmM1Go0KSVNNihBRIAJCQkIchogYIhunyjjn5Mj6KjxDGHkcIiKKL2hBjCoG8lB5UFZCFRBB3Bbg4tJkgMcTFc+m8cTKesO3k+LVonxkgkuHVfiAKs6oGAD/AYvOeA4WBzKmAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE3LTAzLTMwVDAyOjQxOjQ1KzAyOjAwrFD4gwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNy0wMy0zMFQwMjo0MTo0NSswMjowMN0NQD8AAAAASUVORK5CYII=\"\n};\n\nchartObject.prepareScenarioZone=function prepareScenarioZone(rectObj) {\n    var chart=this;\n\n    this.chartGroup.append(\"rect\")\n        .attr(\"class\", \"scenariozone\")\n        .attr(\"stroke-dasharray\", \"6 8\")\n        .attr(\"x\", rectObj.left)\n        .attr(\"y\", rectObj.top)\n        .attr(\"width\", rectObj.width)\n        .attr(\"height\", rectObj.height)\n        .style(\"stroke\", \"green\")\n        .style(\"fill-opacity\", 1e-6)\n        .on(\"mouseover\", ()=>chart.slowScenarioCycles=true)\n        .on(\"mouseout\", ()=>chart.slowScenarioCycles=false);\n\n    this.slowScenarioCycles = false;\n};\n\nchartObject.resizeChartSubstrates=function resizeChartSubstrates(divSeln, newExtent) {\n\n    this.chartSVG.attr(\"width\", newExtent.x).attr(\"height\", newExtent.y);\n\n    var ratio = newExtent.x/this.visMaxExtent.x;\n    this.sizeRatio = ratio;\n\n    var ratioPercent = Math.round(ratio*100), baseFontSize = 12, margin = 4/ratio;\n    var scaleIndicator = this.chartSVG.selectAll(\"text.scaleIndicator\").data([ratioPercent]);\n    scaleIndicator.enter().append(\"text\")\n        .attr(\"class\", \"scaleIndicator\")\n        .attr(\"x\", this.visMaxExtent.x-margin)\n        .attr(\"y\", margin)\n\t\t.attr(\"dy\", this.textOffsets.hanging)\n        .style(\"fill\", \"#aaa\")\n        //.style(\"dominant-baseline\", \"hanging\")\n        .style(\"text-anchor\", \"end\")\n        .style(\"pointer-events\", \"none\")\n        .style('-webkit-user-select','none')\n      .merge(scaleIndicator)\n        .style(\"font-size\", Math.floor(baseFontSize/ratio)+\"px\")\n        .text(d=>\"(vis scale: \"+d+\"%)\");\n\n    var bbox = this.chartSVG.select(\"text.scaleIndicator\").node().getBBox(), left = bbox.x, bottom = bbox.y+bbox.height, pad = 4/ratio;\n    var indicatorFence = this.chartSVG.selectAll(\"line.indicatorFence\").data([\n        { x1: left-pad, y1: 0, x2: left-pad, y2: bottom+pad },\n        { x1: left-pad, y1: bottom+pad, x2: this.visMaxExtent.x, y2: bottom+pad }\n        ]);\n    indicatorFence.enter().append(\"line\")\n        .attr(\"class\", \"indicatorFence\")\n        .style(\"stroke\", \"#aaa\")\n        .style(\"stroke-width\", 1)\n        .style(\"pointer-events\", \"none\")\n      .merge(indicatorFence)\n        .attr(\"x1\", d=>d.x1)\n        .attr(\"y1\", d=>d.y1)\n        .attr(\"x2\", d=>d.x2)\n        .attr(\"y2\", d=>d.y2);\n\n    var canvas = this.chartCanvas.node(), context = canvas.getContext(\"2d\");\n    canvas.width = newExtent.x;\n    canvas.height = newExtent.y;\n    context.scale(1,1);\n    context.scale(ratio, ratio);\n\n    canvas = this.chartFixedCanvas.node(), context = canvas.getContext(\"2d\");\n    canvas.width = newExtent.x;\n    canvas.height = newExtent.y;\n    context.scale(1,1);\n    context.scale(ratio, ratio);\n};\n\nchartObject.rPretty=function rPretty(range, n, internal_only) {\n    // this.rPretty([0,56],5,true)\n    // from https://gist.github.com/Frencil/aab561687cdd2b0de04a\n/**\n * Generate a \"pretty\" set of ticks (multiples of 1, 2, or 5 on the same order of magnitude for the range)\n * Based on R's \"pretty\" function:\n * https://github.com/wch/r-source/blob/b156e3a711967f58131e23c1b1dc1ea90e2f0c43/src/appl/pretty.c\n * Arguments:\n *  range (required) :: Two-element array representing the range for the ticks to cover\n *  n     (optional) :: A \"target\" number of ticks; will not necessarily be the number of ticks you get (default: 5)\n *  internal_only (optional) :: Boolean for whether to only return ticks inside the provided range (default: false)\n */\n\n  if (typeof n == \"undefined\" || isNaN(parseInt(n))){\n    n = 5;\n  }\n  n = parseInt(n);\n  if (typeof internal_only == \"undefined\"){\n    internal_only = false;\n  }\n\n  var min_n = n / 3;\n  var shrink_sml = 0.75;\n  var high_u_bias = 1.5;\n  var u5_bias = 0.5 + 1.5 * high_u_bias;\n  var d = Math.abs(range[0] - range[1]);\n  var c = d / n;\n  if ((Math.log(d) / Math.LN10) < -2){\n    c = (Math.max(Math.abs(d)) * shrink_sml) / min_n;\n  }\n\n  var base = Math.pow(10, Math.floor(Math.log(c)/Math.LN10));\n  var base_toFixed = 0;\n  if (base < 1){\n    base_toFixed = Math.abs(Math.round(Math.log(base)/Math.LN10));\n  }\n\n  var unit = base;\n  if ( ((2 * base) - c) < (high_u_bias * (c - unit)) ){\n    unit = 2 * base;\n    if ( ((5 * base) - c) < (u5_bias * (c - unit)) ){\n      unit = 5 * base;\n      if ( ((10 * base) - c) < (high_u_bias * (c - unit)) ){\n        unit = 10 * base;\n      }\n    }\n  }\n\n  var ticks = [];\n  if (range[0] <= unit){\n    var i = 0;\n  } else {\n    var i = Math.floor(range[0]/unit)*unit;\n    i = parseFloat(i.toFixed(base_toFixed));\n  }\n  while (i < range[1]){\n    ticks.push(i);\n    i += unit;\n    if (base_toFixed > 0){\n      i = parseFloat(i.toFixed(base_toFixed));\n    }\n  }\n  ticks.push(i);\n\n  if (internal_only){\n    if (ticks[0] < range[0]){ ticks = ticks.slice(1); }\n    if (ticks[ticks.length-1] > range[1]){ ticks.pop(); }\n  }\n\n  return ticks;\n};\n\nchartObject.spaceBifocally=function spaceBifocally(groupSelection, groupObject) {\n    // groupObject includes parameters fishItemWidth, fishWidth, focusIndex, and optionally focusItemOffset and linearFocusOffset;\n    var chart=this;\n    var itemWidth = groupObject.fishItemWidth, fieldWidth = groupObject.fishWidth, focusIndex = groupObject.focusIndex, focusItemOffset = groupObject.focusItemOffset, linearFocusOffset = groupObject.linearFocusOffset;\n    var numItems = groupSelection.selectAll(\".fishItem\").size(), totalWidth = numItems*itemWidth;\n//console.log(\"width = \"+fieldWidth+\", totalW = \"+totalWidth+\", num = \"+numItems);\n\n    // during dragging, first time through set a preference for fishy or not, then stick to that preference.  preference gets removed as soon as a refresh outwith chart dragging happens.\n    var fitsInField = totalWidth <= fieldWidth;\n    var groupElement = groupSelection.node();\n    if (!chart.isDragging) delete groupElement.fishLock;\n    else if (!groupElement.hasOwnProperty(\"fishLock\")) groupElement.fishLock=fitsInField;\n\n    if (groupElement.fishLock===true || (groupElement.fishLock!==false && fitsInField)) {\n        var offset = 0;\n        if (linearFocusOffset !== undefined) offset = linearFocusOffset;\n\n        groupSelection.selectAll(\".fishItem\")\n            .attr(\"transform\", d=>\"translate(\"+(d.indexInGroup*itemWidth+itemWidth/2+offset)+\",0)\")\n            .style(\"opacity\", 1)\n            .each(function(cellItem) {\n                var seln = d3.select(this);\n                seln.select(\"text\")\n                    //.style(\"opacity\", 1)\n                    .style(\"opacity\", focusIndex===undefined ? 1 : Math.max(0.15, 1-(0.3*Math.abs(cellItem.indexInGroup-focusIndex))))\n                    .style(\"font-weight\", cellItem.indexInGroup===focusIndex ? 600 : \"normal\")\n                    .attr(\"letter-spacing\", \"normal\");\n\n                if (cellItem.indexInGroup===focusIndex) seln.raise();\n\n                var rectSeln = seln.select(\"rect\");\n                if (cellItem.mouseover) rectSeln.on(\"mouseover\", function(cellItem) { cellItem.mouseover.call(this, cellItem) });\n                if (cellItem.mouseout) rectSeln.on(\"mouseout\", function(cellItem) { cellItem.mouseout.call(this, cellItem) });\n                rectSeln\n                    .attr(\"width\", itemWidth)\n                    .attr(\"x\", -itemWidth/2)\n                    .on(\"mousemove\", null);\n            })\n\n        return;\n    }\n\n    var xFish = this.bifocalScale(fieldWidth, totalWidth, 3, itemWidth);\n    xFish.focus(itemWidth*focusIndex, false);\n\n    var offset = 0;\n    if (focusItemOffset !== undefined) {\n        // set the offset such that the focus item ends up at that offset relative to the internal field (from middle of first item to middle of last)\n        offset = focusItemOffset-xFish(focusIndex*itemWidth);\n    }\n//console.log(\"focus index: \"+focusIndex+ \", item width: \"+itemWidth+\", totalWidth: \"+totalWidth);\n\n    groupSelection.selectAll(\".fishItem\")\n        .sort(function(a, b) { return Math.abs(b.indexInGroup-focusIndex) - Math.abs(a.indexInGroup-focusIndex) })\n        .attr(\"transform\", d=>\"translate(\"+(xFish(d.indexInGroup*itemWidth)+itemWidth/2+offset)+\",0)\" )\n        .style(\"opacity\", 1)\n        .each(function(fishItem) {\n            var rectSeln = d3.select(this).select(\"rect\");\n            var centreX = fishItem.indexInGroup*itemWidth, fishCentre = xFish(centreX);\n            var xRatio = xFish(centreX+1)-fishCentre;\n            if (xRatio === 0) xRatio = fishCentre-xFish(centreX-1);\n            var effectiveWidth = itemWidth*xRatio;\n            rectSeln\n                .attr(\"x\", -effectiveWidth/2)\n                .attr(\"width\", effectiveWidth)\n//.style(\"fill\", d.indexInGroup===focusIndex ? \"#ddd\" : \"#eee\")\n                // each mousable rectangle in the fishy zone reports mousemove to the zone as a whole, which calculates which rectangle (perhaps the same one) would have received the event in a non-compressed rendering.\n                // each item responds to mouseout as it would without the fishiness.\n                .on(\"mouseover\", null)\n                .on(\"mouseout\", function(fishItem) { fishItem.mouseout.call(this, fishItem) })\n                .on(\"mousemove\", function(fishItem) {\n                    var fishGroupElem = this.parentNode.parentNode;\n                    var mouseX = d3.mouse(fishGroupElem)[0], mouseInScaledRegion = mouseX - itemWidth/2;\n                    var index = xFish.findItem(mouseInScaledRegion);\n                    d3.select(fishGroupElem).selectAll(\"rect\").each(function(siblingItem) {\n                        if (siblingItem.indexInGroup===index && siblingItem.mouseover) siblingItem.mouseover.call(this, siblingItem);\n                        });\n                    });\n\n            var textSeln = d3.select(this).select(\"text\");\n            textSeln\n                .style(\"opacity\", cellItem=>focusIndex===undefined ? 1 : Math.max(0.15, 1-(0.3*Math.abs(cellItem.indexInGroup-focusIndex))))\n                .style(\"font-weight\", cellItem=>cellItem.indexInGroup===focusIndex ? 600 : \"normal\")\n                .attr(\"letter-spacing\", xRatio==1 ? \"normal\" : \"-\"+(1-xRatio)+\"ex\");\n            });\n};\n\nchartObject.setTimerInfo=function setTimerInfo(timerInfo) {\n    if (this.timerInfo) this.stopTimer();\n\n    this.timerInfo = timerInfo;\n};\n\nchartObject.startTimer=function startTimer(timerInfo) {\n    timerInfo.timer = d3.timer(timerInfo.tick);\n    this.setTimerInfo(timerInfo);\n};\n\nchartObject.stopTimer=function stopTimer(forceToEnd) {\n    if (!this.timerInfo) return;\n\n    var spec = this.timerInfo;\n    if (spec.timer) spec.timer.stop();\n    if (spec.cleanup) spec.cleanup();\n    if (spec.forceToEnd && forceToEnd) spec.forceToEnd();\n\n    delete this.timerInfo;\n};\n\nchartObject.svgSource=function svgSource(name) {\n    // svg sources (with captions removed) from the Noun Project\n    switch (name) {\n        case \"mpg\":\n            // Car by Jens Trning\n            // viewBox was 0 0 100 125\n            return `\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" x=\"0px\" y=\"0px\" viewBox=\"0 -5 100 125\" enable-background=\"new 0 0 100 100\" xml:space=\"preserve\"><path d=\"M72,40c0,0-14-13-22-13H32C17,27,1,40,1,44v18.001l6.507,1.858C7.583,57.021,13.145,51.5,20,51.5  c6.903,0,12.5,5.597,12.5,12.5h35c0-6.903,5.597-12.5,12.5-12.5c6.855,0,12.416,5.521,12.493,12.359L99,62V51C99,47,89,42,72,40z   M37,40.931l-24.449-0.843C17.573,36.613,25.016,33,32,33h5V40.931z M43,41.138V33h7c2.853,0,9.49,4.249,15.064,8.899L43,41.138z\"/><circle cx=\"20\" cy=\"64\" r=\"8.5\"/><circle cx=\"80\" cy=\"64\" r=\"8.5\"/></svg>`\n\n        case \"nba\":\n            // Basketball by Andrey Vasiliev\n            return `\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" x=\"0px\" y=\"0px\" viewBox=\"0 0 100 125\" enable-background=\"new 0 0 100 100\" xml:space=\"preserve\"><path d=\"M83.259,21.384h13.824c1.014,0,1.835-0.821,1.835-1.834c0-1.014-0.821-1.834-1.835-1.834H83.259  c-1.013,0-1.833,0.82-1.833,1.834C81.426,20.562,82.246,21.384,83.259,21.384z\"/><path d=\"M83.259,30.162h6.912c1.015,0,1.836-0.821,1.836-1.834c0-1.014-0.821-1.834-1.836-1.834h-6.912  c-1.013,0-1.833,0.82-1.833,1.834C81.426,29.341,82.246,30.162,83.259,30.162z\"/><path d=\"M97.083,35.273H83.259c-1.013,0-1.833,0.822-1.833,1.833c0,1.014,0.82,1.834,1.833,1.834h13.824  c1.014,0,1.835-0.821,1.835-1.834C98.918,36.095,98.097,35.273,97.083,35.273z\"/><path d=\"M16.741,17.716H2.917c-1.014,0-1.834,0.82-1.834,1.834c0,1.013,0.82,1.834,1.834,1.834h13.824  c1.013,0,1.833-0.821,1.833-1.834C18.574,18.536,17.754,17.716,16.741,17.716z\"/><path d=\"M16.741,26.494H9.829c-1.014,0-1.836,0.82-1.836,1.834c0,1.013,0.822,1.834,1.836,1.834h6.912  c1.013,0,1.833-0.821,1.833-1.834C18.574,27.314,17.754,26.494,16.741,26.494z\"/><path d=\"M16.741,35.273H2.917c-1.014,0-1.834,0.822-1.834,1.833c0,1.014,0.82,1.834,1.834,1.834h13.824  c1.013,0,1.833-0.821,1.833-1.834C18.574,36.095,17.754,35.273,16.741,35.273z\"/><path d=\"M75.462,29.212C75.462,15.172,64.04,3.75,50,3.75c-14.04,0-25.461,11.422-25.461,25.462  c0,12.807,9.513,23.405,21.838,25.173c-0.512,0.683-0.82,1.512-0.82,2.413v10.97c-1.66,0.5-2.904,1.535-3.572,3.074  c-2.343,5.406,3.208,15.792,4.874,18.701l-1.477,6.267c-0.233,0.986,0.377,1.973,1.364,2.206c0.142,0.034,0.282,0.05,0.422,0.05  c0.831,0,1.585-0.569,1.784-1.413l1.644-6.98c0.11-0.464,0.034-0.953-0.21-1.364c-2.687-4.482-6.429-12.795-5.036-16.009  c0.052-0.12,0.122-0.242,0.206-0.362v0.511c0,1.013,0.822,1.835,1.834,1.835c1.014,0,1.835-0.822,1.835-1.835V56.798  c0-0.243,0.301-0.513,0.734-0.513c0.432,0,0.733,0.27,0.733,0.513v6.673v4.062v4.914c0,1.013,0.822,1.835,1.835,1.835  s1.833-0.822,1.833-1.835v-4.914v-4.062c0-0.243,0.302-0.515,0.735-0.515c0.43,0,0.732,0.271,0.732,0.515v1.855v4.163v1.856  c0,1.013,0.82,1.834,1.835,1.834c1.011,0,1.833-0.821,1.833-1.834v-1.856v-4.163c0-0.243,0.301-0.515,0.734-0.515  c0.432,0,0.733,0.271,0.733,0.515v2.814v3.007v0.198c0,1.013,0.82,1.834,1.834,1.834c1.013,0,1.834-0.821,1.834-1.834v-0.198v-3.007  c0-0.244,0.3-0.515,0.733-0.515c0.432,0,0.734,0.271,0.734,0.515v3.007c0,0.036,0,0.074,0.002,0.111l0.271,4.401  c0.004,0.062,0.012,0.124,0.021,0.186c0.009,0.055,0.855,5.476-2.508,10.988c-0.179,0.296-0.272,0.635-0.267,0.979l0.108,8.44  c0.013,1.006,0.831,1.811,1.834,1.811c0.008,0,0.017,0,0.023,0c1.012-0.013,1.823-0.844,1.81-1.857l-0.101-7.926  c3.522-6.122,2.861-12.032,2.735-12.926l-0.262-4.266v-2.949c0-2.306-1.976-4.182-4.402-4.182c-0.331,0-0.65,0.041-0.96,0.106  c-0.567-1.688-2.214-2.921-4.175-2.921c-0.476,0-0.925,0.09-1.354,0.223c-0.766-1.237-2.166-2.08-3.781-2.08  c-0.252,0-0.495,0.033-0.735,0.071v-2.561c0-0.896-0.304-1.722-0.81-2.402C65.911,52.659,75.462,42.043,75.462,29.212z M28.3,31.046  h10.332c-0.369,4.574-2.155,8.859-5.141,12.352C30.583,40.017,28.694,35.744,28.3,31.046z M33.443,15.079  c2.992,3.474,4.793,7.736,5.183,12.299H28.3C28.692,22.704,30.561,18.451,33.443,15.079z M71.7,27.378H61.374  c0.39-4.563,2.19-8.826,5.184-12.3C69.44,18.45,71.309,22.704,71.7,27.378z M57.707,27.378h-5.872V7.511  c4.589,0.385,8.778,2.188,12.12,4.982C60.285,16.666,58.11,21.839,57.707,27.378z M48.166,27.378h-5.873  c-0.404-5.538-2.578-10.712-6.249-14.885c3.342-2.795,7.532-4.597,12.121-4.982V27.378z M42.299,31.046h5.867v19.866  c-4.564-0.383-8.735-2.166-12.068-4.934C39.758,41.787,41.917,36.591,42.299,31.046z M51.835,31.046H57.7  c0.383,5.545,2.541,10.741,6.202,14.933c-3.334,2.768-7.504,4.55-12.067,4.933V31.046z M61.368,31.046H71.7  c-0.394,4.699-2.283,8.971-5.191,12.352C63.522,39.905,61.736,35.62,61.368,31.046z\"/></svg>`\n\n        case \"marathons\":\n            // derived from run by Hopkins\n            // viewBox was 0 0 517.5 721.8\n            // 517.5*1.25 646.875\n            // 721.8*1.25 902.25\n            // and then flip x and shift (transform was \"translate(-116,-342)\")\n            return `\n<svg xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns:cc=\"http://creativecommons.org/ns#\" xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\" xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\" viewBox=\"-50 -50 647 902\" version=\"1.1\" x=\"0px\" y=\"0px\"><g transform=\"translate(647,-342) scale(-1,1)\"><path style=\"\" d=\"m 459.16425,341.81003 a 63.799577,63.799577 0 0 0 -63.757,63.7586 63.799577,63.799577 0 0 0 63.757,63.7586 63.799577,63.799577 0 0 0 63.76,-63.7586 63.799577,63.799577 0 0 0 -63.76,-63.7586 z m -50.908,134.0629 c -11.726,-1.2972 -23.472,3.8576 -30.547,13.8186 l -125.821,23.8789 c -8.811,1.6136 -16.108,7.8025 -19.272,16.2428 l -31.759,84.36566 c -5.026,13.2813 1.629,28.0644 14.91,33.0913 2.978,1.1792 6.049,1.5758 9.09,1.5758 10.366,0 20.033,-6.3043 23.88,-16.6065 l 26.91,-71.0316 71.396,-13.5761 -59.517,114.5482 c -2.794,5.4613 -3.825,11.322 -3.516,16.9696 l -48.123,52.2436 -72.365,-48.9706 c -14.087,-9.4954 -33.171,-5.8455 -42.667,8.2425 -9.495,14.0881 -5.845,33.293 8.242,42.7887 l 94.307,63.6375 c 5.213,3.5375 11.253,5.3336 17.212,5.3336 8.379,0 16.709,-3.4227 22.666,-9.9391 l 63.396,-68.8503 72.849,40.1217 -59.152,110.1847 c -8.007,14.9562 -2.473,33.6293 12.486,41.6975 4.655,2.4824 9.642,3.6361 14.545,3.6361 10.923,0 21.566,-5.8189 27.153,-16.1213 l 73.577,-136.9721 c 8.004,-14.8329 2.527,-33.4471 -12.243,-41.5772 l -56.972,-31.394 51.639,-99.2748 70.911,53.9405 c 4.592,3.5375 10.053,5.2119 15.515,5.2119 5.895,0 11.704,-2.0269 16.485,-6.0609 l 70.546,-59.516 c 10.799,-8.9371 12.154,-25.1426 3.031,-35.8793 -9.061,-10.7988 -25.14,-12.15336 -36.003,-3.0305 l -54.907,46.3037 -61.699,-46.91 1.212,-2.1815 c 8.441,-16.19806 2.016,-36.16646 -14.183,-44.60676 l -41.696,-21.8191 c -3.71,-1.9241 -7.608,-3.0827 -11.516,-3.5152 z\" fill=\"#000000\"/></g></svg>`\n\n        case \"diamonds\":\n            // Diamond by O s t r e a\n            // viewBox was 0 0 32 40\n            return `\n<svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" viewBox=\"0 2 32 40\" x=\"0px\" y=\"0px\"><title>diamonda</title><path fill=\"#000000\" d=\"M9.992 10.523c0.084 0.188 0.271 0.302 0.465 0.302 0.069 0 0.139-0.015 0.207-0.045 0.257-0.113 0.372-0.415 0.259-0.672l-2.436-5.458c-0.115-0.256-0.416-0.371-0.672-0.256-0.258 0.115-0.373 0.415-0.258 0.672l2.435 5.457z\"/><path fill=\"#000000\" d=\"M6.056 12.385c0.15 0 0.298-0.066 0.399-0.191 0.176-0.22 0.139-0.539-0.080-0.715l-3.173-2.53c-0.219-0.176-0.539-0.14-0.715 0.080s-0.138 0.539 0.080 0.715l3.174 2.53c0.093 0.075 0.206 0.111 0.315 0.111z\"/><path fill=\"#000000\" d=\"M22.216 10.701c0.069 0.031 0.14 0.047 0.21 0.047 0.193 0 0.378-0.11 0.463-0.297l1.891-4.136c0.117-0.255 0.006-0.557-0.251-0.675-0.255-0.116-0.559-0.004-0.675 0.251l-1.891 4.136c-0.114 0.256-0.001 0.558 0.253 0.674z\"/><path fill=\"#000000\" d=\"M28.732 8.586l-2.557 2.957c-0.183 0.214-0.16 0.535 0.053 0.718 0.097 0.083 0.214 0.124 0.332 0.124 0.143 0 0.284-0.059 0.385-0.176l2.557-2.959c0.184-0.213 0.16-0.534-0.052-0.718s-0.533-0.161-0.718 0.053z\"/><path fill=\"#000000\" d=\"M16.367 10.116c0.006 0 0.013 0 0.017 0 0.274 0 0.5-0.217 0.509-0.491l0.118-3.504c0.010-0.281-0.21-0.516-0.491-0.525-0.276-0.004-0.515 0.209-0.527 0.491l-0.117 3.504c-0.009 0.282 0.211 0.516 0.49 0.525z\"/><path fill=\"#000000\" d=\"M27.191 17.789c-0.014-0.053-0.037-0.106-0.070-0.155-0.001-0.001-0.001-0.001-0.001-0.003l-3.052-4.378c-0.039-0.092-0.103-0.174-0.191-0.231-0.090-0.057-0.19-0.083-0.289-0.082-0.001 0-0.003 0-0.005 0h-14.555c-0.005 0-0.009 0.002-0.016 0.002-0.032 0.001-0.064 0.005-0.095 0.013-0.013 0.002-0.023 0.005-0.035 0.010-0.026 0.008-0.049 0.017-0.073 0.027-0.013 0.006-0.025 0.011-0.036 0.018-0.008 0.004-0.016 0.006-0.023 0.012-0.016 0.011-0.029 0.024-0.043 0.035-0.008 0.008-0.017 0.014-0.026 0.021-0.027 0.027-0.054 0.056-0.075 0.088v0l-2.982 4.474c-0.001 0.001-0.001 0.002-0.001 0.002-0.034 0.049-0.055 0.104-0.069 0.16-0.001 0.003-0.003 0.006-0.005 0.013-0.006 0.036-0.012 0.070-0.012 0.11 0 0.014 0.004 0.032 0.005 0.047 0 0.011 0.001 0.018 0.003 0.027 0.007 0.050 0.023 0.1 0.045 0.148 0.005 0.008 0.009 0.014 0.013 0.021 0.026 0.047 0.058 0.090 0.098 0.126 0.004 0.002 0.004 0.006 0.006 0.006l10.327 9.219c0.009 0.009 0.018 0.012 0.027 0.016 0.034 0.026 0.069 0.048 0.105 0.064 0.015 0.007 0.029 0.016 0.044 0.021 0.053 0.017 0.107 0.028 0.163 0.028 0.001 0 0.001 0 0.003 0 0.056 0 0.11-0.013 0.162-0.030 0.014-0.005 0.027-0.014 0.042-0.020 0.038-0.014 0.073-0.038 0.106-0.064 0.009-0.006 0.018-0.008 0.026-0.016l10.329-9.219c0.002-0.001 0.004-0.006 0.006-0.006 0.041-0.039 0.073-0.081 0.098-0.129 0.006-0.007 0.010-0.014 0.013-0.021 0.023-0.048 0.038-0.097 0.045-0.15 0.002-0.008 0.002-0.019 0.004-0.029 0.001-0.014 0.004-0.027 0.004-0.041 0-0.041-0.006-0.078-0.014-0.116-0.003-0.004-0.006-0.010-0.008-0.016zM16.368 25.955l-3.616-7.524h7.13l-3.514 7.524zM16.313 14.235l3.15 3.178h-6.3l3.151-3.178zM23.606 14.37l2.123 3.045h-4.108l1.985-3.045zM22.659 13.958l-2.059 3.158-3.13-3.158h5.189zM15.155 13.958l-3.13 3.158-2.059-3.158h5.189zM9.023 14.373l1.982 3.040h-4.008l2.026-3.040zM7.381 18.431h4.243l3.187 6.635-7.43-6.635zM17.884 25.112l3.121-6.681h4.364l-7.485 6.681z\"/></svg>`\n\n        case \"geyser\":\n            // derived from Fountain by Anton Gajdosik\n            return `\n<svg\n   xmlns:svg=\"http://www.w3.org/2000/svg\"\n   xmlns=\"http://www.w3.org/2000/svg\"\n   id=\"svg2\"\n   xml:space=\"preserve\"\n   style=\"enable-background:new 0 0 100 100;\"\n   viewBox=\"0 0 100 125\"\n   y=\"0px\"\n   x=\"0px\"\n   version=\"1.1\"><defs\n     id=\"defs24\" /><path\n     d=\"m 50.989762,26.749152 c 1.495836,0.111689 2.781856,-0.995628 2.893545,-2.491464 L 55.149118,7.3048794 C 55.260808,5.8090434 54.15349,4.5230232 52.657654,4.4113339 51.161818,4.2996447 49.875798,5.4069622 49.764109,6.9027983 L 48.498298,23.855607 c -0.11169,1.495836 0.995628,2.781856 2.491464,2.893545 z\"\n     id=\"path6\" /><path\n     d=\"m 63.651368,30.532827 c 0.3,0.1 0.7,0.2 1,0.2 1,0 2,-0.6 2.5,-1.7 3.1,-7.6 7.8,-12.5 13.9,-14.4 1.4,-0.4 2.2,-1.9 1.7,-3.3 -0.4,-1.4000003 -1.9,-2.2000003 -3.3,-1.7000003 -7.7,2.5000003 -13.5,8.3000003 -17.2,17.5000003 -0.6,1.3 0,2.9 1.4,3.4 z\"\n     id=\"path8\" /><path\n     d=\"m 90.2,47.2 c -5.9,-2.5 -14.9,-3 -24.8,8.8 -2,2.4 -3.7,5 -5.1,7.2 l -3,-15.7 c -0.3,-1.4 -1.7,-2.4 -3.1,-2.1 -1.4,0.3 -2.4,1.7 -2.1,3.1 l 4.3,22.7 c 0,0.5 0.1,1 0.3,1.4 l 0.1,0.6 -6.8,0 -6.8,0 0.1,-0.6 c 0.2,-0.4 0.3,-0.9 0.3,-1.4 l 4.3,-22.7 c 0.3,-1.4 -0.7,-2.8 -2.1,-3.1 -1.4,-0.3 -2.8,0.7 -3.1,2.1 l -3,15.7 C 38.3,60.9 36.6,58.4 34.6,56 24.8,44.2 15.7,44.7 9.8,47.2 c -1.4,0.6 -2,2.1 -1.4,3.5 0.6,1.4 2.1,2 3.5,1.4 13.4,-5.7 24,14.9 26.1,19.5 3.404884,8.298784 20.029396,10.199112 24,0 2.1,-4.5 12.7,-25.2 26.2,-19.5 1.4,0.6 2.9,-0.1 3.5,-1.4 0.5,-1.4 -0.1,-3 -1.5,-3.5 z\"\n     id=\"path10\" /><path\n     d=\"m 90.468389,27.811854 c -9.1,-1.2 -17.8,3.4 -25.7,13.4 -0.9,1.2 -0.7,2.8 0.4,3.7 0.5,0.4 1.1,0.6 1.6,0.6 0.8,0 1.6,-0.3 2.1,-1 6.7,-8.5 13.7,-12.4 20.9,-11.5 1.5,0.2 2.8,-0.8 3,-2.3 0.1,-1.4 -0.9,-2.8 -2.3,-2.9 z\"\n     id=\"path12\" /><path\n     d=\"m 22.9,19.8 c 6.1,2 10.8,6.8 13.9,14.4 0.4,1 1.4,1.7 2.5,1.7 0.3,0 0.7,-0.1 1,-0.2 1.4,-0.6 2,-2.1 1.5,-3.5 -3.8,-9.1 -9.5,-15 -17.2,-17.5 -1.4,-0.4 -2.9,0.3 -3.3,1.7 -0.5,1.5 0.2,3 1.6,3.4 z\"\n     id=\"path14\" /><path\n     d=\"m 28.6,43.6 c 0.5,0.7 1.3,1 2.1,1 0.6,0 1.2,-0.2 1.6,-0.6 1.2,-0.9 1.4,-2.6 0.4,-3.7 C 24.9,30.2 16.3,25.7 7.1,26.9 c -1.5,0.2 -2.5,1.5 -2.3,3 0.2,1.5 1.5,2.5 3,2.3 7.2,-1 14.2,2.9 20.8,11.4 z\"\n     id=\"path16\" /><path\n     d=\"m 48.006023,72.981759 c -8.772774,-2.699712 -18.117695,0.386131 -27.573701,8.929783 -1.087391,1.033236 -1.156824,2.644192 -0.222189,3.714919 0.42635,0.47773 0.98463,0.774922 1.477639,0.858246 0.788812,0.133318 1.62762,-0.02917 2.237282,-0.636057 8.022814,-7.264602 15.574855,-9.943535 22.524191,-7.856259 1.445696,0.447175 2.894164,-0.3222 3.341339,-1.767896 0.331908,-1.363758 -0.420806,-2.910827 -1.784561,-3.242736 z\"\n     id=\"path12-9\" /><path\n     d=\"M 83.226019,78.611756 C 76.88113,71.97908 67.217154,70.11963 54.796422,72.971899 c -1.453057,0.372321 -2.298755,1.7452 -2.004412,3.135653 0.139483,0.624936 0.482153,1.156516 0.87205,1.469535 0.623836,0.500827 1.435482,0.767717 2.263605,0.534878 10.545923,-2.433819 18.446025,-1.092771 23.497115,4.116499 1.044485,1.095011 2.684253,1.129062 3.779266,0.08457 0.954429,-1.029108 1.051079,-2.746857 0.02197,-3.701285 z\"\n     id=\"path12-9-9\" /></svg>`\n\n        case \"faithful-alternate\":\n            // Geyser by Nick Bluth\n            return `\n<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.0\" x=\"0px\" y=\"0px\" viewBox=\"0 0 170 211.25\" enable-background=\"new 0 0 170 169\" xml:space=\"preserve\"><g><g><g><defs><path id=\"c\" d=\"M304,72.5c0,0.6,0.4,1,1,1s1-0.4,1-1v-19c0-0.6-0.4-1-1-1s-1,0.4-1,1V72.5z M309,76.7      c0,0.4,0.5,0.8,1.1,0.8c0.6,0,1.1-0.4,1.1-0.8V58.3c0-0.4-0.5-0.8-1.1-0.8c-0.6,0-1.1,0.4-1.1,0.8V76.7z M290.6,21.2      c1.3,0.3,2.5,0.8,3.7,1.4c0.7,0.4,1.1,1.3,0.7,2c-0.4,0.7-1.3,1.1-2,0.7c-2.5-1.2-5.3-1.8-8.1-1.8c-4.9,0-9.7,2-13.2,5.6      c-7.1,7.3-6.9,19.1,0.5,26.2c7.3,7.1,19.1,6.9,26.2-0.5c0.6-0.6,1.5-0.6,2.1,0c0.5,0.5,0.5,0.9,0.5,1.2c0,0.2,0,0.4,0,0.7      c0,0.5,0,1.3,0,2.4c0,2,0,4.8,0,8.3c0,6.3,0-16.1,0-5.8c0,9.3,0-0.8,0,8.8c0,2.1,0,4.1,0,5.8c0,1,0,1,0,1.6c0,0.5,0,0.5,0,0.6      c0,0.8-0.7,1.5-1.5,1.5s-1.5-0.7-1.5-1.5c0-0.1,0-0.1,0-0.6c0-0.6,0-0.6,0-1.6c0-1.7,0-3.6,0-5.8c0-9.6,0,0.4,0-8.8      c0-10.3,0,12.1,0,5.8c0-3.6-0.1-8.4-0.1-8.4s0.3-0.1-0.9,0.8c-8.2,5.6-19.5,4.8-27-2.3c-8.5-8.2-8.8-21.9-0.5-30.4      c4.1-4.2,9.6-6.5,15.3-6.6c0.7,0,1.3,0,2,0.1c5.2-5.1,12.2-8.1,19.7-8.1c7.7,0,14.8,3.1,19.9,8.3c1.3-0.2,2.6-0.3,3.8-0.3      c5.7,0,11.2,2.4,15.3,6.6c8.2,8.5,8,22.2-0.5,30.4c-7.7,7.4-19.5,8-27.7,1.8c-0.1-0.1-0.2-0.1-0.2-0.1s0,4.7,0,8.3      c0,6.3,0-8.1,0,2.2c0,9.3,0-8.8,0,0.8c0,2.1,0,4.1,0,5.8c0,1,0,1,0,1.6c0,0.5,0,0.5,0,0.6c0,0.8-0.7,1.5-1.5,1.5      s-1.5-0.7-1.5-1.5c0-0.1,0-0.1,0-0.6c0-0.6,0-0.6,0-1.6c0-1.7,0-3.6,0-5.8c0-9.6,0,8.4,0-0.8c0-10.3,0,4.1,0-2.2      c0-3.6,0-6.4,0-8.3c0-1,0-1.8,0-2.4c0-0.3,0-0.5,0-0.7c0-0.5,0-0.8,0.5-1.2c0.6-0.6,1.5-0.6,2.1,0c7.1,7.3,18.8,7.6,26.2,0.5      c7.3-7.1,7.6-18.8,0.5-26.2c-3.5-3.6-8.2-5.6-13.2-5.6c-0.5,0-1,0-1.5,0c1,1.4,2,2.8,2.8,4.4c0.4,0.7,0.1,1.6-0.7,2      c-0.7,0.4-1.6,0.1-2-0.7c-4.2-8.4-12.8-13.8-22.4-13.8C300.6,15.5,295,17.6,290.6,21.2z\"/></defs><use xlink:href=\"#c\" overflow=\"visible\"/><clipPath><use xlink:href=\"#c\" overflow=\"visible\"/></clipPath></g></g><g><g><defs><path id=\"b\" d=\"M317.7,98.7l1-1l0.7-0.7l-1.4-1.4l-0.7,0.7l-1,1l-0.7,0.7l1.4,1.4L317.7,98.7z M317.7,103.7l4-4l0.7-0.7      l-1.4-1.4l-0.7,0.7l-4,4l-0.7,0.7l1.4,1.4L317.7,103.7z M297.7,98.7l0.7-0.7l-1.4-1.4l-0.7,0.7l-5,5l0.7,2.1l0.7-0.7L297.7,98.7      z M264.2,122.2l21.5-21.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-21.5,21.5l-0.7,0.7l1.4,1.4L264.2,122.2z M268.2,123.2l18.5-18.5l0.7-0.7      l-1.4-1.4l-0.7,0.7l-18.5,18.5l-0.7,0.7l1.4,1.4L268.2,123.2z M353.2,123.2l3.5-3.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-3.5,3.5      l-0.7,0.7l1.4,1.4L353.2,123.2z M347.2,124.2l7.5-7.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-7.5,7.5l-0.7,0.7l1.4,1.4L347.2,124.2z       M341.2,125.2l10.5-10.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-10.5,10.5l-0.7,0.7l1.4,1.4L341.2,125.2z M335.2,126.2l14.5-14.5l0.7-0.7      l-1.4-1.4l-0.7,0.7l-14.5,14.5l-0.7,0.7l1.4,1.4L335.2,126.2z M330.2,126.2l16.5-16.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-16.5,16.5      l-0.7,0.7l1.4,1.4L330.2,126.2z M325.2,126.2l18.5-18.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-18.5,18.5l-0.7,0.7l1.4,1.4L325.2,126.2z       M320.2,126.2l21.5-21.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-21.5,21.5l-0.7,0.7l1.4,1.4L320.2,126.2z M315.2,126.2l23.5-23.5l0.7-0.7      l-1.4-1.4l-0.7,0.7l-23.5,23.5l-0.7,0.7l1.4,1.4L315.2,126.2z M310.2,126.2l26.5-26.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-26.5,26.5      l-0.7,0.7l1.4,1.4L310.2,126.2z M305.2,126.2l28.5-28.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-28.5,28.5l-0.7,0.7l1.4,1.4L305.2,126.2z       M300.2,126.2l22.5-22.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-22.5,22.5l-0.7,0.7l1.4,1.4L300.2,126.2z M295.2,126.2l16.5-16.5l0.7-0.7      l-1.4-1.4l-0.7,0.7l-16.5,16.5l-0.7,0.7l1.4,1.4L295.2,126.2z M310.7,105.7l-0.7-2.1l-0.7,0.7l-20.5,20.5l-0.7,0.7l1.4,1.4      l0.7-0.7L310.7,105.7z M309.7,101.7l0.7-0.7l-1-1.9l-1.1,1.2l-23.5,23.5l-0.7,0.7l1.4,1.4l0.7-0.7L309.7,101.7z M281.2,125.2      l27.5-27.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-27.5,27.5l-0.7,0.7l1.4,1.4L281.2,125.2z M277.2,124.2l21.5-21.5l0.7-0.7l-1.4-1.4      l-0.7,0.7l-21.5,21.5l-0.7,0.7l1.4,1.4L277.2,124.2z M290.7,105.7l0.7-0.7l-2.1-0.7l-18.5,18.5l-0.7,0.7l1.4,1.4l0.7-0.7      L290.7,105.7z M283.2,97.1c1.1,0,1.9,0.9,1.9,2v3c0,2.2,1.8,4,4,4v-1v-1h-0.1v1v1c2.2,0,4-1.8,4-4v-3c0-1.1,0.9-2,2-2v-1v-1h0v1      v1c1.1,0,2,0.9,2,2h1h1v-0.1h-1h-1c0,2.2,1.8,4,4,4h0.3c2.2,0,4-1.8,4-4v-0.1c0-1.1,0.9-2,2-2c1.1,0,2,0.9,2,2v7.1      c0,2.2,1.8,4,4,4v-1v-1H313v1v1c2.2,0,4-1.8,4-4v-7c0-1.1,0.9-2,2-2v-1v-1h-0.1v1v1c1.1,0,2,0.9,2,2l0,0.8c-0.2,2.6,1.3,4.9,4,4      l0,0c2.2,0,4-1.8,4-4V99c0-1.1,0.9-2,2-2l2,0l0-2l-2,0c-2.2,0-4,1.8-4,4v0.7c0,1.1-0.9,2-2,2h0c-1.1,0-2-0.9-2-2V99      c0-2.2-1.8-4-4-4v2h0.1v-2c-2.2,0-4,1.8-4,4v7c0,1.1-0.9,2-2,2v2h0.1v-2c-1.1,0-2-0.9-2-2v-7.1c0-2.2-1.8-4-4-4      c-2.2,0-4,1.8-4,4v0.1c0,1.1-0.9,2-2,2h-0.3c-1.1,0-2-0.9-2-2h-2V99h2c0-2.2-1.8-4-4-4v2h0v-2c-2.2,0-4,1.8-4,4v3      c0,1.1-0.9,2-2,2v2h0.1v-2c-1.1,0-2-0.9-2-2v-3c0-2.2-1.8-4-3.9-4V97.1z M294.3,84.5c0.6-0.9,1.7-0.8,6.6,0.7      c2.9,0.9,4.7,1.3,6.7,1.4c0.3,0,0.6,0,0.9,0c2.1-0.1,3.9-0.4,6.6-1.3c4.8-1.5,5.8-1.6,7-0.2l-0.1-0.1c2.4,3,5,6.1,7.8,9.2      c5.1,5.7,10.5,11.1,16,16.2c1.9,1.8,3.7,3.4,5.3,4.8c0.6,0.5,1.1,0.9,1.5,1.3c0.3,0.2,0.4,0.4,0.5,0.5c2.4,2.1,1.9,3.8-1.2,4.4      l-0.1,0c-0.1,0-0.3,0.1-0.6,0.2c-0.6,0.1-1.2,0.3-2,0.5c-2.2,0.5-4.9,1-7.9,1.4c-9,1.4-19.7,2.2-31.8,2.1      c-11.8-0.1-22.6-0.9-32.1-2.2c-3.4-0.5-6.5-1-9-1.5c-0.9-0.2-1.7-0.3-2.3-0.5c-0.4-0.1-0.6-0.1-0.8-0.2      c-3.2-0.6-3.6-2.2-1.2-4.4c0.1,0,0.2-0.2,0.5-0.4c0.4-0.4,0.9-0.8,1.4-1.2c1.5-1.3,3.1-2.9,4.9-4.6c5.1-4.9,10.2-10.1,15-15.5      C288.8,91.5,291.7,88,294.3,84.5L294.3,84.5z M291.9,82.7c-2.5,3.4-5.4,6.9-8.4,10.4c-4.7,5.4-9.7,10.5-14.8,15.3      c-1.8,1.7-3.4,3.2-4.9,4.5c-0.5,0.5-1,0.9-1.4,1.2c-0.2,0.2-0.4,0.3-0.5,0.4c-4.2,3.8-3,8.4,2.6,9.6c0.1,0,0.4,0.1,0.8,0.2      c0.7,0.2,1.5,0.3,2.4,0.5c2.6,0.5,5.7,1,9.2,1.5c9.6,1.3,20.5,2.2,32.5,2.2c12.3,0.1,23.1-0.8,32.3-2.1c3.1-0.5,5.8-1,8.1-1.5      c0.8-0.2,1.5-0.3,2.1-0.5c0.4-0.1,0.6-0.2,0.7-0.2l-0.1,0c5.5-1.2,6.7-5.9,2.5-9.7c-0.1-0.1-0.3-0.2-0.5-0.5      c-0.4-0.4-0.9-0.8-1.5-1.3c-1.6-1.4-3.3-3-5.2-4.7c-5.4-5-10.8-10.4-15.8-16c-2.7-3-5.3-6.1-7.6-9l-0.1-0.1c-1.3-1.5-3-2-5-1.9      c-1.3,0.1-1.7,0.2-5.1,1.3c-2.5,0.8-4,1.1-5.8,1.2c-0.2,0-0.5,0-0.7,0c-1.7-0.1-3.3-0.4-6-1.2c-3.6-1.1-4-1.2-5.2-1.3      C294.5,80.7,292.9,81.2,291.9,82.7L291.9,82.7z\"/></defs><use xlink:href=\"#b\" overflow=\"visible\"/><clipPath><use xlink:href=\"#b\" overflow=\"visible\"/></clipPath></g></g></g><g><g><defs><path id=\"a\" d=\"M137.7,148.7l3-3l0.7-0.7l-1.4-1.4l-0.7,0.7l-3,3l-0.7,0.7l1.4,1.4L137.7,148.7z M132.2,149.2l4.5-4.5     l0.7-0.7l-1.4-1.4l-0.7,0.7l-4.5,4.5l-0.7,0.7l1.4,1.4L132.2,149.2z M127.2,149.2l5.5-5.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-5.5,5.5     l-0.7,0.7l1.4,1.4L127.2,149.2z M121.2,150.2l7.5-7.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-7.5,7.5l-0.7,0.7l1.4,1.4L121.2,150.2z      M81.2,150.2l14.5-14.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-14.5,14.5l-0.7,0.7l1.4,1.4L81.2,150.2z M96.2,150.2l12.5-12.5l0.7-0.7     l-1.4-1.4l-0.7,0.7l-12.5,12.5l-0.7,0.7l1.4,1.4L96.2,150.2z M86.2,150.2l13.5-13.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-13.5,13.5     l-0.7,0.7l1.4,1.4L86.2,150.2z M76.2,150.2l12.5-12.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-12.5,12.5l-0.7,0.7l1.4,1.4L76.2,150.2z      M71.2,150.2l12.5-12.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-12.5,12.5l-0.7,0.7l1.4,1.4L71.2,150.2z M66.2,150.2l12.5-12.5l0.7-0.7     l-1.4-1.4l-0.7,0.7l-12.5,12.5l-0.7,0.7l1.4,1.4L66.2,150.2z M61.2,150.2l12.5-12.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-12.5,12.5     l-0.7,0.7l1.4,1.4L61.2,150.2z M57.2,149.2l12.5-12.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-12.5,12.5l-0.7,0.7l1.4,1.4L57.2,149.2z      M52.2,149.2l12.5-12.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-12.5,12.5l-0.7,0.7l1.4,1.4L52.2,149.2z M47.2,149.2l10.5-10.5l0.7-0.7     l-1.4-1.4l-0.7,0.7l-10.5,10.5l-0.7,0.7l1.4,1.4L47.2,149.2z M91.2,150.2l13.5-13.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-13.5,13.5     l-0.7,0.7l1.4,1.4L91.2,150.2z M105.2,151.2l11.5-11.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-11.5,11.5l-0.7,0.7l1.4,1.4L105.2,151.2z      M101.2,150.2l11.5-11.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-11.5,11.5l-0.7,0.7l1.4,1.4L101.2,150.2z M116.2,150.2l8.5-8.5l0.7-0.7     l-1.4-1.4l-0.7,0.7l-8.5,8.5l-0.7,0.7l1.4,1.4L116.2,150.2z M112.2,149.2l8.5-8.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-8.5,8.5l-0.7,0.7     l1.4,1.4L112.2,149.2z M43.2,148.2l8.5-8.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-8.5,8.5l-0.7,0.7l1.4,1.4L43.2,148.2z M38.2,148.2     l7.5-7.5l0.7-0.7l-1.4-1.4l-0.7,0.7l-7.5,7.5l-0.7,0.7l1.4,1.4L38.2,148.2z M33.2,148.2l5.1-5.1l0.7-0.7l-1.4-1.4l-0.7,0.7     l-5.1,5.1l-0.7,0.7l1.4,1.4L33.2,148.2z M28.2,148.2l5.1-5.1l0.7-0.7l-1.4-1.4l-0.7,0.7l-5.1,5.1l-0.7,0.7l1.4,1.4L28.2,148.2z      M53.3,136.1c-0.9,0.2-1.9,0.4-2.8,0.6c-6.5,1.5-13.4,3.1-20.1,4.7c-2.4,0.6-4.5,1.1-6.5,1.6c-0.7,0.2-1.3,0.3-1.8,0.4     c-0.3,0.1-0.5,0.1-0.6,0.2c-3,0.7-4.4,1.4-4.3,3.1c0.1,1.7,1.7,2.1,4.7,2.4c0.1,0,0.2,0,0.5,0c0.4,0,0.8,0.1,1.3,0.1     c1.4,0.1,3.1,0.2,4.9,0.4c5.2,0.4,10.6,0.8,16.2,1.2c4.9,0.3,9.6,0.6,14.1,0.9c10,0.5,18.3,0.8,24.6,0.8c6.2,0,14.5-0.3,24.3-0.8     c4.4-0.2,9.1-0.5,13.9-0.9c5.5-0.4,10.9-0.8,16-1.2c1.8-0.1,3.4-0.3,4.8-0.4c0.5,0,0.9-0.1,1.3-0.1c0.4,0,0.4,0,0.5,0     c3.1-0.2,4.6-0.7,4.7-2.4c0.1-1.7-1.3-2.4-4.3-3.1c-0.1,0-0.3-0.1-0.7-0.2c-0.5-0.1-1.2-0.3-1.9-0.5c-2-0.5-4.3-1-6.8-1.6     c-7-1.7-14.2-3.4-21-4.9c-0.9-0.2-1.8-0.4-2.7-0.6c-5-1.1-9.6-2.2-13.7-3.1c-0.8-0.2-1.6,0-2.9,0.3c-0.3,0.1-2.6,0.8-3.4,1     c-2.8,0.8-5.5,1.3-8.7,1.3c-3.2,0-6-0.3-9.5-1.1c-0.1,0-3.3-0.8-4.1-0.9c-1.5-0.3-2.5-0.4-3.4-0.2     C62.2,134.1,57.9,135.1,53.3,136.1z M66.6,136.2c0.8-0.2-0.4-0.4,6.2,1.1c3.7,0.8,6.8,1.2,10.2,1.2c3.4-0.1,6.3-0.5,9.4-1.4     c0.8-0.2,3.1-1,3.4-1c0.8-0.2,1.3-0.3,1.4-0.3c4.1,0.9,8.6,1.9,13.6,3c0.9,0.2,1.8,0.4,2.7,0.6c6.8,1.6,13.9,3.2,20.9,4.9     c2.5,0.6,4.7,1.1,6.8,1.6c0.7,0.2,1.3,0.3,1.9,0.5c0.3,0.1,0.5,0.1,0.7,0.2c1,0.2,1.7,0.5,2.1,0.7c0.1,0.1,0.2,0.1,0.2,0.1     c-0.2-0.2-0.3-0.4-0.3-0.8c0-0.4,0.2-0.7,0.4-0.8c0,0-0.1,0-0.2,0.1c-0.4,0.1-1.2,0.3-2.2,0.3c-0.1,0-0.1,0-0.5,0     c-0.4,0-0.8,0.1-1.3,0.1c-1.4,0.1-3,0.2-4.8,0.4c-5.1,0.4-10.5,0.8-16,1.2c-4.8,0.3-9.4,0.6-13.9,0.8c-9.8,0.5-18,0.8-24.1,0.8     c-6.2,0-14.6-0.3-24.5-0.8c-4.5-0.2-9.2-0.5-14-0.8c-5.6-0.4-11-0.8-16.2-1.2c-1.8-0.1-3.4-0.3-4.9-0.4c-0.5,0-0.9-0.1-1.3-0.1     c-0.2,0-0.4,0-0.5,0c-1-0.1-1.7-0.2-2.2-0.3c-0.1,0-0.2-0.1-0.2-0.1c0.2,0.1,0.4,0.4,0.4,0.8c0,0.4-0.1,0.7-0.3,0.8     c0,0,0.1,0,0.2-0.1c0.4-0.2,1.1-0.4,2.1-0.7c0.1,0,0.3-0.1,0.6-0.2c0.5-0.1,1.1-0.3,1.8-0.4c1.9-0.5,4.1-1,6.5-1.6     c6.7-1.6,13.6-3.2,20.1-4.7c0.9-0.2,1.9-0.4,2.8-0.6C58.6,138,62.8,137.1,66.6,136.2z M79,56.5v49c0,0.6,0.4,1,1,1s1-0.4,1-1v-49     c0-0.6-0.4-1-1-1S79,55.9,79,56.5z M84,66.5v59c0,0.6,0.4,1,1,1s1-0.4,1-1v-59c0-0.6-0.4-1-1-1S84,65.9,84,66.5z M65.6,22.2     c1.3,0.3,2.5,0.8,3.7,1.4c0.7,0.4,1.1,1.3,0.7,2c-0.4,0.7-1.3,1.1-2,0.7c-2.5-1.2-5.3-1.8-8.1-1.8c-4.9,0-9.7,2-13.2,5.6     c-7.1,7.3-6.9,19.1,0.5,26.2c7.3,7.1,19.1,6.9,26.2-0.5c0.6-0.6,1.5-0.6,2.1,0c0.5,0.5,0.5,0.9,0.5,1.2c0,0.2,0,0.4,0,0.7     c0,0.5,0,1.3,0,2.4c0,2,0,4.8,0,8.3c0,6.3,0,14.9,0,25.2c0,9.3,0,19.2,0,28.8c0,2.1,0,4.1,0,5.8c0,1,0,1,0,1.6c0,0.5,0,0.5,0,0.6     c0,0.8-0.7,1.5-1.5,1.5c-0.8,0-1.5-0.7-1.5-1.5c0-0.1,0-0.1,0-0.6c0-0.6,0-0.6,0-1.6c0-1.7,0-3.6,0-5.8c0-9.6,0-19.6,0-28.8     c0-10.3,0-18.9,0-25.2c0-3.6-0.1-8.4-0.1-8.4s0.3-0.1-0.9,0.8c-8.2,5.6-19.5,4.8-27-2.3c-8.5-8.2-8.8-21.9-0.5-30.4     c4.1-4.2,9.6-6.5,15.3-6.6c0.7,0,1.3,0,2,0.1c5.2-5.1,12.2-8.1,19.7-8.1c7.7,0,14.8,3.1,19.9,8.3c1.3-0.2,2.6-0.3,3.8-0.3     c5.7,0,11.2,2.4,15.3,6.6c8.2,8.5,8,22.2-0.5,30.4c-7.7,7.4-19.5,8-27.7,1.8c-0.1-0.1-0.2-0.1-0.2-0.1s0,4.7,0,8.3     c0,6.3,0,14.9,0,25.2c0,9.3,0,19.2,0,28.8c0,2.1,0,4.1,0,5.8c0,1,0,1,0,1.6c0,0.5,0,0.5,0,0.6c0,0.8-0.7,1.5-1.5,1.5     c-0.8,0-1.5-0.7-1.5-1.5c0-0.1,0-0.1,0-0.6c0-0.6,0-0.6,0-1.6c0-1.7,0-3.6,0-5.8c0-9.6,0-19.6,0-28.8c0-10.3,0-18.9,0-25.2     c0-3.6,0-6.4,0-8.3c0-1,0-1.8,0-2.4c0-0.3,0-0.5,0-0.7c0-0.5,0-0.8,0.5-1.2c0.6-0.6,1.5-0.6,2.1,0c7.1,7.3,18.8,7.6,26.2,0.5     c7.3-7.1,7.6-18.8,0.5-26.2c-3.5-3.6-8.2-5.6-13.2-5.6c-0.5,0-1,0-1.5,0c1,1.4,2,2.8,2.8,4.4c0.4,0.7,0.1,1.6-0.7,2     c-0.7,0.4-1.6,0.1-2-0.7c-4.2-8.4-12.8-13.8-22.4-13.8C75.6,16.5,70,18.6,65.6,22.2z\"/></defs><use xlink:href=\"#a\" overflow=\"visible\"/><clipPath><use xlink:href=\"#a\" overflow=\"visible\"/></clipPath></g></g></svg>`\n\n    }\n};\n\nchartObject.switchDataset=function switchDataset(dataName) {\n    this.datasetsAvailable = Math.max(this.datasetsAvailable, this.datasetsForSwitching.indexOf(dataName)+1);\n    if (this.datasetsAvailable > 1) {\n        this.drawDataSelector({ instant: true });\n    }\n    this.privateSwitchDataset(dataName); // defined within drawDataSelector\n};\n\n    return chartObject;\n}\n"]}