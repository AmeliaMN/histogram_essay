!function(){var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;void 0===GLOBAL.lively&&(GLOBAL.lively={}),function(){this.lively=this.lively||{},function(exports){"use strict";function Empty(){return function(){}}function K(){return function(e){return e}}function Null(){return function(){return null}}function False(){return function(){return!1}}function True(){return function(){return!0}}function notYetImplemented(){return function(){throw new Error("Not yet implemented")}}function all(e){var r=[];for(var n in e)e.__lookupGetter__(n)||"function"!=typeof e[n]||r.push(n);return r}function own(e){var r=[];for(var n in e)!e.__lookupGetter__(n)&&e.hasOwnProperty(n)&&"function"==typeof e[n]&&r.push(n);return r}function argumentNames(e){if(e.superclass)return[];var r=e.toString(),n="",t=r.match(/(?:\(([^\)]*)\)|([^\(\)-+!]+))\s*=>/);if(t)n=t[1]||t[2]||"";else{var o=r.match(/^[\s\(]*function[^(]*\(([^)]*)\)/);o&&o[1]&&(n=o[1])}return n.replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",").map(function(e){return e.trim()}).filter(function(e){return!!e})}function qualifiedMethodName(e){var r="";return e.declaredClass?r+=e.declaredClass+">>":e.declaredObject&&(r+=e.declaredObject+"."),r+(e.methodName||e.displayName||e.name||"anonymous")}function extractBody(e){for(var r=String(e).replace(/^function[^\{]+\{\s*/,"").replace(/\}$/,"").trim(),n=r.split(/\n|\r/),t=void 0,o=0;o<n.length;o++){var i=n[o].match(/^(\s+)[^\s]/);i&&(void 0===t||i[1].length<t.length)&&(t=i[1])}return t?r.replace(new RegExp("^"+t,"gm"),""):r}function timeToRun(e){var r=Date.now();return e(),Date.now()-r}function timeToRunN$1(e,r){for(var n=Date.now(),t=0;t<r;t++)e();return(Date.now()-n)/r}function delay(e,r){var n=Array.prototype.slice.call(arguments),t=n.shift(),r=1e3*n.shift();return setTimeout(function(){return t.apply(t,n)},r)}function throttle(e,r){var n,t,o,i,a,u,c=debounce(r,function(){a=i=!1});return function(){n=this,t=arguments;var s=function(){o=null,a&&e.apply(n,t),c()};return o||(o=setTimeout(s,r)),i?a=!0:u=e.apply(n,t),c(),i=!0,u}}function debounce(e,r,n){var t;return function(){var o=this,i=arguments,a=function(){t=null,n||r.apply(o,i)};n&&!t&&r.apply(o,i),clearTimeout(t),t=setTimeout(a,e)}}function throttleNamed(e,r,n){function t(){debounceNamed(e,r,function(){delete o[e]})(),n.apply(this,arguments)}var o=_throttledByName;return o[e]?o[e]:o[e]=throttle(t,r)}function debounceNamed(e,r,n,t){function o(){delete i[e],n.apply(this,arguments)}var i=_debouncedByName;return i[e]?i[e]:i[e]=debounce(r,o,t)}function createQueue(e,r){var n=_queues,t=n[e]||(n[e]={_workerActive:!1,worker:r,tasks:[],drain:null,push:function(e){t.tasks.push(e),t.activateWorker()},pushAll:function(e){e.forEach(function(e){t.tasks.push(e)}),t.activateWorker()},pushNoActivate:function(e){t.tasks.push(e)},handleError:function(e){e&&console.error("Error in queue: "+e)},activateWorker:function(){function r(e){t.handleError(e),t.activateWorker()}var o=t.tasks,i=t._workerActive;if(0===o.length)i&&(t._workerActive=!1,"function"==typeof t.drain&&t.drain()),delete n[e];else{i||(t._workerActive=!0);try{t.worker(o.shift(),r)}catch(e){r(e)}}}});return t}function workerWithCallbackQueue(e,r,n){function t(){s&&clearTimeout(s),u=!0,delete i[e]}function o(r){u||(t(),a.callbacks.forEach(function(n){try{n.apply(null,r)}catch(r){console.error("Error when invoking callbacks in queueUntil ["+e+"]:\n"+String(r.stack||r))}}))}var i=_queueUntilCallbacks,a=i[e];if(!!a)return a;var u=!1,c=!1;if(n)var s=setTimeout(function(){u||o([new Error("timeout")])},n);return a=i[e]={callbacks:[],cancel:function(){c=!0,t()},whenDone:function(e){return a.callbacks.push(e),a}},setTimeout(function(){if(!c)try{r(function(){o(arguments)})}catch(e){o([e])}},0),a}function _composeAsyncDefaultEndCallback(e,r){e&&console.error("lively.lang.composeAsync error",e)}function composeAsync(){var e,r,n=Array.prototype.slice,t=n.call(arguments),o=_composeAsyncDefaultEndCallback,i=o,a=new Promise(function(n,t){e=n,r=t});return t.reverse().reduce(function(e,u,c){var s=!1;return function(){function l(){s=!0;var t=n.call(arguments),o=t.shift();o?(i(o),r(o)):e.apply(null,t)}var f=n.call(arguments);if(i===o&&c===t.length-1){for(;f.length&&"function"!=typeof f[f.length-1];)f.pop();"function"==typeof f[f.length-1]&&(i=f.pop())}if("function"==typeof u)try{var p=u.apply(this,f.concat([l]));p&&"function"==typeof p.then&&"function"==typeof p.catch&&p.then(function(e){return l(null,e)}).catch(function(e){return l(e)})}catch(e){console.error("composeAsync: ",e.stack||e),s||(i(e),r(e))}else if(u&&"function"==typeof u.then&&"function"==typeof u.catch)u.then(function(e){l(null,e)}).catch(function(e){l(e)});else{var h=new Error("Invalid argument to composeAsync: "+u);i(h),r(h)}return a}},function(){var r=n.call(arguments);i.apply(null,[null].concat(r)),e(r[0])})}function compose(){return Array.prototype.slice.call(arguments).reverse().reduce(function(e,r){return function(){return e(r.apply(this,arguments))}},function(e){return e})}function flip(e){return function(){var r=Array.prototype.slice.call(arguments),n=[r[1],r[0]].concat(r.slice(2));return e.apply(null,n)}}function withNull(e){return e=e||function(){},function(){var r=lively.lang.arr.from(arguments);e.apply(null,[null].concat(r))}}function waitFor(e,r,n){var t=Date.now(),o=50;n||(n=r,r=e,e=void 0),function i(){if(r())return n();if(e){var a=Date.now()-t,u=e-a;if(u<=0)return n(new Error("timeout"));u<o&&(o=u)}setTimeout(i,o)}()}function waitForAll(e,r,n){function t(e,r,t,a){if(i.length){var u=null,c=i.indexOf(e);c>-1&&i.splice(c,1),t?(i.length=0,u=new Error("in waitForAll at"+("number"==typeof r?" "+r:"")+": \n"+(t.stack||String(t)))):a&&(o[r]=a),i.length||setTimeout(function(){n(u,o)},0)}}n||(n=r,r=e,e=null),e=e||{};var o=r.map(function(){return null});if(!r.length)return void n(null,o);var i=Array.prototype.slice.call(r);r.forEach(function(e,r){try{e(function(){var n=Array.prototype.slice.call(arguments),o=n.shift();t(e,r,o,n)})}catch(n){t(e,r,n,null)}}),e.timeout&&setTimeout(function(){if(i.length){var e=o.map(function(e,r){return null===e&&r}).filter(function(e){return"number"==typeof e}).join(", ");t(null,null,new Error("waitForAll timed out, functions at "+e+" not done"),null)}},e.timeout)}function curry(e,r,n,t){function o(){return e.apply(this,i.concat(Array.prototype.slice.call(arguments)))}if(arguments.length<=1)return arguments[0];var i=Array.prototype.slice.call(arguments),e=i.shift();return o.isWrapper=!0,o.originalFunction=e,o}function wrap(e,r){var n=e,t=function(){var e=Array.prototype.slice.call(arguments),t=r.isWrapper?e:[n.bind(this)].concat(e);return r.apply(this,t)};return t.isWrapper=!0,t.originalFunction=n,t}function getOriginal(e){for(;e.originalFunction;)e=e.originalFunction;return e}function wrapperChain(e){var r=[];do{r.push(e),e=e.originalFunction}while(e);return r}function replaceMethodForOneCall(e,r,n){n.originalFunction=e[r];var t=e.hasOwnProperty(r);return e[r]=function(){return t?e[r]=n.originalFunction:delete e[r],n.apply(this,arguments)},e}function once(e){if(e){if("function"!=typeof e)throw new Error("once() expecting a function");var r,n=!1;return function(){return n?r:(n=!0,r=e.apply(this,arguments))}}}function either(){var e=Array.prototype.slice.call(arguments),r=!1;return e.map(function(e){return function(){if(!r)return r=!0,e.apply(this,arguments)}})}function eitherNamed(e,r){var n=Array.prototype.slice.call(arguments),t=_eitherNameRegistry,e=n.shift(),o=t[e]||(t[e]={wasCalled:!1,callsLeft:0});return o.callsLeft++,function(){if(o.callsLeft--,o.callsLeft<=0&&delete t[e],!o.wasCalled)return o.wasCalled=!0,r.apply(this,arguments)}}function evalJS(src){return eval(src)}function fromString(e){return evalJS("("+e.toString()+");")}function asScript(e,r){return Closure.fromFunction(e,r).recreateFunc()}function asScriptOf(e,r,n,t){var o=n||e.name;if(!o)throw Error("Function that wants to be a script needs a name: "+this);var i=Object.getPrototypeOf(r),a={this:r};if(t&&(a=merge([a,t])),i&&i[o]){var u=function(){try{return Object.getPrototypeOf(r)[o].apply(r,arguments)}catch(e){return void 0!==("undefined"==typeof $world?"undefined":_typeof($world))?$world.logError(e,"Error in $super call"):console.error("Error in $super call: "+e+"\n"+e.stack),null}};a.$super=Closure.fromFunction(u,{obj:r,name:o}).recreateFunc()}return addToObject(asScript(e,a),r,o)}function addToObject(e,r,n){e.displayName=n;var t=r.attributeConnections?r.attributeConnections.filter(function(e){return"update"===e.getSourceAttrName()}):[];return t&&t.forEach(function(e){e.disconnect()}),r[n]=e,(void 0===r?"undefined":_typeof(r))&&(e.declaredObject=safeToString(r)),"undefined"!=typeof lively&&r&&lively.Tracing&&lively.Tracing.stackTracingEnabled&&lively.Tracing.instrumentMethod(r,n,{declaredObject:safeToString(r)}),t&&t.forEach(function(e){e.connect()}),e}function binds(e,r){return Closure.fromFunction(e,r||{}).recreateFunc()}function setLocalVarValue(e,r,n){e.hasLivelyClosure&&(e.livelyClosure.funcProperties[r]=n)}function getVarMapping(e){return e.hasLivelyClosure?e.livelyClosure.varMapping:e.isWrapper?e.originalFunction.varMapping:e.varMapping?e.varMapping:{}}function setProperty(e,r,n){e[r]=n,e.hasLivelyClosure&&(e.livelyClosure.funcProperties[r]=n)}function functionNames(e){for(var r=[],n=e.prototype;n;)r=Object.keys(n).reduce(function(e,r){return"function"==typeof n[r]&&e.indexOf(r)===-1&&e.push(r),e},r),n=Object.getPrototypeOf(n);return r}function localFunctionNames(e){return Object.keys(e.prototype).filter(function(r){return"function"==typeof e.prototype[r]})}function logErrors(e,r){var n=function(n){var t=Array.prototype.slice.call(arguments);t.shift();try{return n.apply(e,t)}catch(n){if("undefined"!=typeof lively&&lively.morphic&&lively.morphic.World&&lively.morphic.World.current())throw lively.morphic.World.current().logError(n),n;throw r?console.warn("ERROR: %s.%s(%s): err: %s %s",e,r,t,n,n.stack||""):console.warn("ERROR: %s %s",n,n.stack||""),n}};n.methodName="$logErrorsAdvice";var t=wrap(e,n);return t.originalFunction=e,t.methodName="$logErrorsWrapper",t}function logCompletion(e,r){var n=function(n){var t=Array.prototype.slice.call(arguments);t.shift();try{var o=n.apply(e,t)}catch(e){throw console.warn("failed to load "+r+": "+e),"undefined"!=typeof lively&&lively.lang.Execution&&lively.lang.Execution.showStack(),e}return console.log("completed "+r),o};n.methodName="$logCompletionAdvice::"+r;var t=wrap(e,n);return t.methodName="$logCompletionWrapper::"+r,t.originalFunction=e,t}function logCalls(e,r){var n=e,t=function(t){var i=Array.prototype.slice.call(arguments);return i.shift(),o=t.apply(e,i),r?console.warn("%s(%s) -> %s",qualifiedMethodName(n),i,o):console.log("%s(%s) -> %s",qualifiedMethodName(n),i,o),o};t.methodName="$logCallsAdvice::"+qualifiedMethodName(e);var o=wrap(e,t);return o.originalFunction=e,o.methodName="$logCallsWrapper::"+qualifiedMethodName(e),o}function traceCalls(e,r){return wrap(e,function(n){var t=Array.prototype.slice.call(arguments);t.shift(),r.push(t);var o=n.apply(e,t);return r.pop(),o})}function webkitStack(){try{throw new Error}catch(e){return String(e.stack).split(/\n/).slice(2).map(function(e){return e.replace(/^\s*at\s*([^\s]+).*/,"$1")}).join("\n")}}function range(e,r,n){n=n||0;var t=[];if(e<=r){n<=0&&(n=-n||1);for(var o=e;o<=r;o+=n)t.push(o)}else{n>=0&&(n=-n||-1);for(var o=e;o>=r;o+=n)t.push(o)}return t}function withN(e,r){for(var n=new Array(e);e>0;)n[--e]=r;return n}function genN(e,r){for(var n=new Array(e);e>0;)n[--e]=r(e);return n}function filter(e,r,n){return e.filter(r,n)}function findAndGet(e,r){var n;return e.find(function(e,t){return n=r(e,t)}),n}function filterByKey(e,r){return e.filter(function(e){return!!e[r]})}function grep(e,r,n){return"string"==typeof r&&(r=new RegExp(r,"i")),e.filter(r.test.bind(r))}function mask(e,r){return e.filter(function(e,n){return!!r[n]})}function reject(e,r,n){function t(e,t){return!r.call(n,e,t)}return e.filter(t)}function rejectByKey(e,r){return e.filter(function(e){return!e[r]})}function without(e,r){return e.filter(function(e){return e!==r})}function withoutAll(e,r){return e.filter(function(e){return r.indexOf(e)===-1})}function uniq(e,r){var n=[e[0]];if(r)for(var t=1;t<e.length;t++){var o=e[t];o!==n[n.length]&&n.push(o)}else for(var i=1;i<e.length;i++){var a=e[i];n.indexOf(a)===-1&&n.push(a)}return n}function uniqBy(e,r,n){for(var t=e.slice(),o=t.length;o--;)for(var i=e[o],a=o+1;a<t.length;a++)r.call(n,i,t[a])&&t.splice(a--,1);return t}function uniqByKey(e,r){for(var n={},t=[],o=0;o<e.length;o++){var i=e[o];n[i[r]]||(n[i[r]]=!0,t.push(i))}return t}function compact(e){return e.filter(Boolean)}function mutableCompact(e){for(var r=0,n=0,t=e.length;r<t;)e.hasOwnProperty(r)&&(e[n++]=e[r]),r++;for(;n++<t;)e.pop();return e}function forEach$1(e,r,n){return e.forEach(r,n)}function zip(){var e=Array.from(arguments),r=e.shift(),n="function"==typeof last(e)?e.pop():function(e){return e},t=[r].concat(e).map(function(e){return Array.from(e)});return r.map(function(e,r){return n(pluck(t,r),r)})}function flatten(e,r){if("number"==typeof r){if(r<=0)return e;r--}return e.reduce(function(e,n){return e.concat(Array.isArray(n)?flatten(n,r):[n])},[])}function flatmap(e,r,n){for(var t=[],o=0;o<e.length;o++)t.push.apply(t,r.call(n,e[o],o));return t}function interpose(e,r){return e.reduce(function(e,n){return e.length>0&&e.push(r),e.push(n),e},[])}function delimWith(e,r){return interpose(e,r)}function map$1(e,r,n){return e.map(r,n)}function invoke(e,r,n,t,o,i,a,u){return e.map(function(e){return e[r](n,t,o,i,a,u)})}function pluck(e,r){return e.map(function(e){return e[r]})}function reduce(e,r,n,t){return e.reduce(r,n,t)}function reduceRight(e,r,n,t){return e.reduceRight(r,n,t)}function some(e,r,n){return e.some(r,n)}function every(e,r,n){return e.every(r,n)}function equals$2(e,r){var n=e.length;if(!r||n!==r.length)return!1;for(var t=0;t<n;t++){if(e[t]&&r[t]&&e[t].equals&&r[t].equals){if(e[t].equals(r[t]))continue;return!1}if(e[t]!=r[t])return!1}return!0}function deepEquals(e,r){var n=e.length;if(!r||n!==r.length)return!1;for(var t=0;t<n;t++)if(!equals$1(e[t],r[t]))return!1;return!0}function isSorted(e,r){if(r){for(var n=1;n<e.length;n++)if(e[n-1]<e[n])return!1}else for(var n=1;n<e.length;n++)if(e[n-1]>e[n])return!1;return!0}function sort(e,r){return e.sort(r)}function sortBy(e,r,n){return pluck(e.map(function(e,t){return{value:e,criteria:r.call(n,e,t)}}).sort(function(e,r){var n=e.criteria,t=r.criteria;return n<t?-1:n>t?1:0}),"value")}function sortByKey(e,r){return sortBy(e,function(e){return e[r]})}function reverse(e){return e.reverse()}function reversed(e){return e.slice().reverse()}function reMatches$1(e,r,n){return n=n||String,e.map(function(e){return n(e).match(r)})}function first(e){return e[0]}function last(e){return e[e.length-1]}function intersect(e,r){return uniq(e).filter(function(e){return r.indexOf(e)>-1})}function union(e,r){for(var n=e.slice(),t=0;t<r.length;t++){var o=r[t];n.indexOf(o)===-1&&n.push(o)}return n}function pushAt(e,r,n){e.splice(n,0,r)}function removeAt(e,r){e.splice(r,1)}function remove(e,r){var n=e.indexOf(r);return n>=0&&removeAt(e,n),r}function pushAll$1(e,r){return e.push.apply(e,r),e}function pushAllAt(e,r,n){e.splice.apply(e,[n,0].concat(r))}function pushIfNotIncluded(e,r){e.includes(r)||e.push(r)}function replaceAt(e,r,n){e.splice(n,1,r)}function clear(e){return e.length=0,e}function isSubset(e,r){for(var n=0;n<e.length;n++)if(!r.includes(e[n]))return!1;return!0}function doAndContinue(e,r,n,t){return n=n||Null,t=t||GLOBAL$1,r=r||function(e,r,n){r.call(t,e,n)},e.reduceRight(function(e,n,o){return function(){r.call(t,e,n,o)}},n)()}function nestedDelay(e,r,n,t,o,i){return t=t||function(){},e.clone().reverse().reduce(function(e,t,a){return function(){r.call(o||GLOBAL$1,t,a),i&&a%i!=0?e():e.delay(n)}},t)()}function forEachShowingProgress(){var e,r,n,t,o,i=Array.from(arguments),a=i.shift(),u=a.length,c=!1;if(1===i.length?(e=i[0].progressBar,r=i[0].iterator,n=i[0].labelFunction,t=i[0].whenDone,o=i[0].context):(e=i[0],r=i[1],n=i[2],t=i[3],o=i[4]),o||(o="undefined"!=typeof window?window:global),n||(n=function(e){return e}),!e){c=!0;var s="undefined"!=typeof window?window:global,l=s.lively&&lively.morphic&&lively.morphic.World.current();e=l?l.addProgressBar():{setValue:function(e){},setLabel:function(){},remove:function(){}}}return e.setValue(0),a.reduceRight(function(t,i,a){return function(){try{e.setValue(a/u),n&&e.setLabel(n.call(o,i,a)),r.call(o,i,a)}catch(e){console.error("Error in forEachShowingProgress at %s (%s)\n%s\n%s",a,i,e,e.stack)}t.delay(0)}},function(){e.setValue(1),c&&function(){e.remove()}.delay(0),t&&t.call(o)})(),a}function swap(e,r,n){r<0&&(r=e.length+r),n<0&&(n=e.length+n);var t=e[r];return e[r]=e[n],e[n]=t,e}function rotate(e,r){return r=r||1,e.slice(r).concat(e.slice(0,r))}function groupBy(e,r,n){return Group.fromArray(e,r,n)}function groupByKey(e,r){return groupBy(e,function(e){return e[r]})}function partition(e,r,n){r=r||function(e){return e};var t=[],o=[];return e.forEach(function(e,i){(r.call(n,e,i)?t:o).push(e)}),[t,o]}function batchify(e,r,n){function t(e,o){if(!o.length)return[e,[]];var i=o[0],a=o.slice(1),u=e.concat([i]);if(r.call(n,u))return t(u,a);var c=t(e,a);return[c[0],[i].concat(c[1])]}function o(e,r){if(!r.length)return e;var n=t([],r);if(!n[0].length)throw new Error("Batchify constrained does not ensure consumption of at least one item per batch!");return o(e.concat([n[0]]),n[1])}return o([],e)}function toTuples(e,r){return r=r||1,range(0,Math.ceil(e.length/r)-1).map(function(n){return e.slice(n*r,n*r+r)},e)}function combinationsPick(e,r){for(var n=e.map(function(e,n){return e[r[n]]}),t=r.slice(),o=e.length;o--;o>=0){var i=e[o],a=t[o]+1;if(i[a]){t[o]=a;break}if(0===o){t=void 0;break}t[o]=0}return[n,t]}function combinations(e){for(var r=e.reduce(function(e,r){return e*r.length},1),n=e.map(function(e){return 0}),t=new Array(r),o=0;o<r;o++){var i=combinationsPick(e,n);t[o]=i[0],n=i[1]}return t}function take(e,r){return e.slice(0,r)}function drop(e,r){return e.slice(r)}function takeWhile(e,r,n){for(var t=0;t<e.length&&r.call(n,e[t],t);t++);return e.slice(0,t)}function dropWhile(e,r,n){for(var t=0;t<e.length&&r.call(n,e[t],t);t++);return e.slice(t)}function shuffle(e){for(var r=range(0,e.length-1),n=Array(e.length),t=0;t<e.length;t++){n[r.splice(Math.round(Math.random()*(r.length-1)),1)]=e[t]}return n}function max(e,r,n){r=r||function(e){return e};var t;return e.reduce(function(e,o,i){var a=r.call(n,o,i);return"number"!=typeof a||a<=e?e:(t=o,a)},-(1/0)),t}function min(e,r,n){return r=r||function(e){return e},max(e,function(e,t){return-r.call(n,e,t)})}function sum(e){for(var r=0,n=0;n<e.length;n++)r+=e[n];return r}function count$1(e,r){return e.reduce(function(e,n){return n===r?e+1:e},0)}function size$1(e){return e.length}function histogram(e,r){if(void 0===r||"number"==typeof r){var n=r||function(){return Math.ceil(Math.log(e.length)/Math.log(2)+1)}(),t=Math.ceil(Math.round(e.length/n));return range(0,n-1).map(function(r){return e.slice(r*t,(r+1)*t)})}if(r instanceof Array){var o=r;return e.reduce(function(e,r){if(r<o[1])return e[0].push(r),e;for(var n=1;n<o.length;n++)if(r>=o[n]&&(!o[n+1]||r<=o[n+1]))return e[n].push(r),e;throw new Error("Histogram creation: Cannot group data "+r+" into thresholds "+o)},range(1,o.length).map(function(){return[]}))}}function clone$1(e){return[].concat(e)}function toArray$3(e){return from(e)}function each(e,r,n){return e.forEach(r,n)}function all$1(e,r,n){return e.every(r,n)}function any(e,r,n){return e.some(r,n)}function collect(e,r,n){return e.map(r,n)}function findAll(e,r,n){return e.filter(r,n)}function inject(e,r,n,t){return t&&(n=n.bind(t)),e.reduce(n,r)}function mapAsyncSeries(e,r,n){function t(e,r){if(!i&&(e||r)){i=!0;try{n(e,o)}catch(e){console.error("Error in mapAsyncSeries - callback invocation error:\n"+(e.stack||e))}}}var o=[],i=!1;return e.reduceRight(function(e,n,a){if(!i)return function(i,u){if(i)return t(i);a>0&&o.push(u);try{r(n,a,once(e))}catch(e){t(e)}}},function(e,r){o.push(r),t(e,!0)})()}function mapAsync(e,r,n,t){function o(){for(;l<r.parallel&&s<e.length;)f[s++]()}function i(r,n){if(!(u.indexOf(r)>-1||(u.push(r),l--,c))){if(!n&&u.length<e.length)return void o();c=!0;try{t&&t(n,a)}catch(e){console.error("Error in mapAsync - main callback invocation error:\n"+(e.stack||e))}}}if("function"==typeof r&&(t=n,n=r,r=null),r=r||{},!e.length)return t&&t(null,[]);r.parallel||(r.parallel=1/0);var a=[],u=[],c=!1,s=0,l=0,f=e.map(function(e,r){return function(){l++;try{n(e,r,once(function(e,n){a[r]=e||n,i(r,e)}))}catch(e){i(r,e)}}});return o()}function print$1(e){if(e&&Array.isArray(e))return"["+e.map(print$1)+"]";if("string"!=typeof e)return String(e);var r=String(e);return r=r.replace(/\n/g,"\\n\\\n"),r=r.replace(/(")/g,"\\$1"),r='"'+r+'"'}function indent$1(e,r,n){if(!n||n<=0)return e;for(;n>0;)n--,e=r+e;return e}function isArray$$1(e){return Array.isArray(e)}function isElement(e){return e&&1==e.nodeType}function isFunction(e){return e instanceof Function}function isBoolean(e){return"boolean"==typeof e}function isString(e){return"string"==typeof e}function isNumber(e){return"number"==typeof e}function isUndefined(e){return void 0===e}function isRegExp(e){return e instanceof RegExp}function isObject(e){return"object"==(void 0===e?"undefined":_typeof(e))}function isPrimitive(e){if(!e)return!0;switch(void 0===e?"undefined":_typeof(e)){case"string":case"number":case"boolean":return!0}return!1}function isEmpty(e){for(var r in e)if(e.hasOwnProperty(r))return!1;return!0}function equals$1(e,r){if(e===r)return!0;if(!e||!r)return e==r;if(Array.isArray(e))return deepEquals(e,r);switch(e.constructor){case String:case Date:case Boolean:case Number:return e==r}if("function"==typeof e.isEqualNode)return e.isEqualNode(r);if("function"==typeof e.equals)return e.equals(r);var n=[];for(var t in e)if(n.push(t),"function"!=typeof e[t]&&!equals$1(e[t],r[t]))return!1;for(var t in r)if(n.indexOf(t)===-1&&"function"!=typeof r[t]&&!equals$1(r[t],e[t]))return!1;return!0}function values(e){return e?Object.keys(e).map(function(r){return e[r]}):[]}function select(e,r){for(var n={},t=0;t<r.length;t++)n[r[t]]=e[r[t]];return n}function dissoc(e,r){var n={};for(var t in e)e.hasOwnProperty(t)&&r.indexOf(t)===-1&&(n[t]=e[t]);return n}function addScript(e,r,n,t){return asScriptOf(fromString(r),e,n,t)}function extend(e,r){for(var n=null,t=1;t<arguments.length;t++)if("string"!=typeof arguments[t]){var r=arguments[t];for(var o in r){var i=r.__lookupGetter__(o),a=r.__lookupSetter__(o);if(i&&e.__defineGetter__(o,i),a&&e.__defineSetter__(o,a),!i&&!a){var u=r[o];e[o]=u,n&&n.push(o),"function"==typeof u&&(u.displayName||(u.displayName=o),"undefined"!=typeof lively&&lively.Module&&lively.Module.current&&(u.sourceModule=lively.Module.current()))}}}else{var c=arguments[t];e.categories||(e.categories={}),e.categories[c]||(e.categories[c]=[]),n=e.categories[c]}return e}function clone$$1(e){if(isPrimitive(e))return e;if(Array.isArray(e))return Array.prototype.slice.call(e);var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return r}function extract(e,r,n){for(var t={},o=0;o<r.length;o++)r[o]in e&&(t[r[o]]=n?n(r[o],e[r[o]]):e[r[o]]);return t}function inspect(e,r,n){if(r=r||{},n=n||0,r.customPrinter){var t=r._ignoreSignal||(r._ignoreSignal={}),o=function(e){return inspect(e,r,n+1)},i=r.customPrinter(e,t,o);if(i!==t)return i}if(!e)return print$1(e);if("function"==typeof e)return r.printFunctionSource?String(e):"function"+(e.name?" "+e.name:"")+"("+argumentNames(e).join(",")+") {/*...*/}";switch(e.constructor){case String:case Boolean:case RegExp:case Number:return print$1(e)}if("function"==typeof e.serializeExpr)return e.serializeExpr();var a=e&&Array.isArray(e),u=a?"[":"{",c=a?"]":"}";if(r.maxDepth&&n>=r.maxDepth)return u+"/*...*/"+c;var s=[];if(s=a?e.map(function(e){return inspect(e,r,n+1)}):Object.keys(e).sort(function(r,n){var t="function"==typeof e[r];return t===("function"==typeof e[n])?r<n?-1:r>n?1:0:t?1:-1}).map(function(t,o){a&&inspect(e[t],r,n+1);var i=inspect(e[t],r,n+1);return r.escapeKeys?JSON.stringify(t):t+": "+i}),0===s.length)return u+c;var l=s.join(", "),f=(!a||r.newLineInArrays)&&(!r.minLengthForNewLine||l.length>=r.minLengthForNewLine),p=indent$1("",r.indent||"  ",n),h=indent$1("",r.indent||"  ",n+1),d=f&&!a?"\n"+h:"",g=f?"\n"+h:"",y=f&&!a?"\n"+p:"";return f&&(l=s.join(","+g)),u+d+l+y+c}function merge(e){return arguments.length>1?merge(Array.prototype.slice.call(arguments)):Array.isArray(e[0])?Array.prototype.concat.apply([],e):e.reduce(function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);return e},{})}function deepMerge(e,r){if(!e)return r;if(!r)return e;if(Array.isArray(e)){if(!Array.isArray(r))return r;var n=e.map(function(e,n){return deepMerge(e,r[n])});return r.length>e.length&&(n=n.concat(r.slice(e.length))),n}return"object"!==(void 0===e?"undefined":_typeof(e))||"object"!==(void 0===r?"undefined":_typeof(r))?r:Object.keys(e).concat(Object.keys(r)).reduce(function(n,t){return e[t]?r[t]?"object"!==_typeof(e[t])||"object"!==_typeof(r[t])?n[t]=r[t]:n[t]=deepMerge(e[t],r[t]):n[t]=e[t]:n[t]=r[t],n},{})}function sortKeysWithBeforeAndAfterConstraints(e){var r=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],[]),n=[],t=[];for(var o in e){var i=e[o],a=i.hasOwnProperty("before")?i.before:i.before=[],u=i.hasOwnProperty("after")?i.after:i.after=[];r.push(o),n.push(i);for(var c=a.length;c--;){var s=a[c],l=e[s];l?(l.hasOwnProperty("after")||(l.after=[]),l.after.push(o)):(console.warn("[initializeProperties] "+this+" sortProperties: Property "+o+" requires to be initialized before "+s+" but that property cannot be found."),a.splice(c,1))}for(var f=u.length;f--;){var p=u[f];e[p]||(console.warn("[initializeProperties] "+this+" sortProperties: Property "+o+" requires to be initialized after "+p+" but that property cannot be found."),u.splice(f,1))}t.push(o)}for(var h=[],d=[],g=t.length+1;t.length;){if(g===t.length)throw new Error("Circular dependencies in handler order, could not resolve properties "+t.map(function(r){var n=e[r].before,t=e[r].after;if(!(n&&n.length||t&&t.length))return"";var o=r+"\n";return n&&n.length&&(o+="  - before "+n.join(",")+"\n"),t&&t.length&&(o+="  - after "+t.join(",")+"\n"),o}).join(""));g=t.length;for(var y=[],m=t.length;m--;){var v=t[m];isSubset(e[v].after,d)&&(t.splice(m,1),d.push(v),y.push(v))}h.push(y)}return flatten(h,1)}function inherit(e){return Object.create(e)}function valuesInPropertyHierarchy(e,r){for(var n=[],t=e;t;)t.hasOwnProperty(r)&&n.unshift(t[r]),t=Object.getPrototypeOf(t);return n}function mergePropertyInHierarchy(e,r){return merge(valuesInPropertyHierarchy(e,r))}function deepCopy(e){if(!e||"object"!==(void 0===e?"undefined":_typeof(e))||e instanceof RegExp)return e;var r=Array.isArray(e)?Array(e.length):{};for(var n in e)e.hasOwnProperty(n)&&(r[n]=deepCopy(e[n]));return r}function typeStringOf(e){return null===e?"null":void 0===e?"undefined":e.constructor.name}function shortPrintStringOf(e){function r(e,r,t,o){e.constructor.name===r&&(n+=t,(e.length||Object.keys(e).length)&&(n+="..."),n+=o)}if(!isMutableType(e))return safeToString(e);if("Object"!==e.constructor.name&&!Array.isArray(e)&&e.constructor.name)return e.constructor.name?e.constructor.name:Object.prototype.toString.call(e).split(" ")[1].split("]")[0];var n="";return r(e,"Object","{","}"),r(e,"Array","[","]"),n}function isMutableType(e){return["null","undefined","Boolean","Number","String"].indexOf(typeStringOf(e))===-1}function safeToString(e){try{return(e?e.toString():String(e)).replace("\n","")}catch(e){return"<error printing object>"}}function asObject(e){switch(void 0===e?"undefined":_typeof(e)){case"string":return new String(e);case"boolean":return new Boolean(e);case"number":return new Number(e);default:return e}}function newKeyIn(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"_",t=1;do{r=n+"-"+t++}while(r in e);return r}function format(){return formatFromArray(Array.prototype.slice.call(arguments))}function formatFromArray(e){function r(e,r){return""+e}function n(e,r){return e.toString()}function t(e,r,n){return n>-1?e.toFixed(n):e.toString()}function o(e,r){return inspect(e)}var i=e.shift();i||console.log("Error in Strings>>formatFromArray, first arg is undefined");for(var a={s:r,d:n,i:n,f:t,o:o},u=/((^%|[^\\]%)(\d+)?(\.)([a-zA-Z]))|((^%|[^\\]%)([a-zA-Z]))/,c=(function(e){for(var r=[],n=u.exec(e);n;n=u.exec(e)){var t=n[8]||n[5],i=t in a?a[t]:o,c=n[3]?parseInt(n[3]):"."==n[4]?-1:0;r.push(e.substr(0,"%"==n[0][0]?n.index:n.index+1)),r.push({appender:i,precision:c}),e=e.substr(n.index+n[0].length)}return e&&r.push(e.toString()),r}(i)),s="",l=0,f=0;f<c.length;++f){var p=c[f];if(p&&"object"==(void 0===p?"undefined":_typeof(p))){var h=e[l++];s+=(p.appender||r)(h,s,p.precision)}else s+=r(p,s)}return s}function indent(e,r,n){if(!n||n<=0)return e;for(var t="";n>0;)n--,t+=r;return lines(e).map(function(e){return t+e}).join("\n")}function minIndent(e,r){r||(r="  ");var n=new RegExp("^("+r+")*","gm");return min(e.match(n).map(function(e){return Math.floor(e.length/r.length)}))}function changeIndent(e,r,n){r||(r="  "),n||(n=0);var t=minIndent(e,r);if(t===n)return e;if(t<n)return indent(e,r,n-t);var o=r.repeat(t-n);return lines(e).map(function(e){return e.slice(o.length)}).join("\n")}function quote(e){return'"'+e.replace(/"/g,'\\"')+'"'}function print(e){if(e&&Array.isArray(e))return"["+e.map(print)+"]";if("string"!=typeof e)return String(e);var r=String(e);return r=r.replace(/\n/g,"\\n\\\n"),r=r.replace(/(")/g,"\\$1"),r='"'+r+'"'}function printNested(e,r){return r=r||0,e.reduce(function(e,n){return e+=Array.isArray(n)?printNested(n,r+1):indent(n+"\n","  ",r)},"")}function pad(e,r,n){return n?" ".repeat(r)+e:e+" ".repeat(r)}function printTable(e,r){function n(e){return!i&&(!!a||r&&Array.isArray(r.align)&&"right"===r.align[e])}var t=[],o=r&&r.separator||" ",i=!r||!r.align||"left"===r.align,a=r&&"right"===r.align;return e.forEach(function(e){e.forEach(function(e,r){void 0===t[r]&&(t[r]=0),t[r]=Math.max(t[r],String(e).length)})}),e.map(function(e){return e.map(function(e,r){var o=String(e);return pad(o,t[r]-o.length,n(r))}).join(o)}).join("\n")}function printTree(e,r,n,t){function o(e,a,u){i[a]=t.repeat(e)+r(u,e);var c=n(u,e),s=a+1;if(!c||!c.length)return s;var l=s,f=c.length-1;return c.forEach(function(r,n){s=o(e+1,s,r);for(var a=f===n,u=i[l].split(""),c=e*t.length+1,p=e*t.length+t.length,n=c;n<p;n++)u[n]="-";a&&(u[e*t.length]="\\"),i[l]=u.join(""),a||i.slice(l,s).forEach(function(r,n){var o=r.split("");o[e*t.length]="|",i[l+n]=o.join("")}),l=s}),s}var i=[];return t=t||"  ",o(0,0,e),i.join("\n")}function toArray$1(e){return e.split("")}function lines(e){return e.split(/\n\r?/)}function paragraphs(e,r){function n(e){return/^\s*$/.test(e)}var t=r?r.sep:"\n\n";return r&&r.keepEmptyLines?e.split("\n").concat("").reduce(function(e,r){var t=e[0],o=e[1];return n(o)===n(r)?o+="\n"+r:(o.length&&t.push(o),o=r),[t,o]},[[],""])[0]:e.split(new RegExp(t+"+"))}function nonEmptyLines(e){return lines(e).compact()}function tokens(e,r){return e.split(r||/\s+/).filter(function(e){return!/^\s*$/.test(e)})}function tableize(e,r){r=r||{};for(var n=r.cellSplitter||/\s+/,t=!r.hasOwnProperty("convertTypes")||!!r.convertTypes,o=lines(e),i=[],a=0;a<o.length;a++){var u=tokens(o[a],n);t&&(u=u.map(function(e){if(e.match(/^\s*$/))return e;var r=Number(e);if(!isNaN(r))return r;var n=new Date(e);return isNaN(+n)?e.trim():n})),u.length>0&&i.push(u)}return i}function unescapeCharacterEntities(e){if("undefined"==typeof document)throw new Error("Cannot unescapeCharacterEntities");var r=document.createElement("div");return r.innerHTML=e,r.textContent}function toQueryParams(e,r){var n=e.trim().match(/([^?#]*)(#.*)?$/);return n?n[1].split(r||"&").inject({},function(e,r){if((r=r.split("="))[0]){
var n=decodeURIComponent(r.shift()),t=r.length>1?r.join("="):r[0];void 0!=t&&(t=decodeURIComponent(t)),n in e?(Array.isArray(e[n])||(e[n]=[e[n]]),e[n].push(t)):e[n]=t}return e}):{}}function joinPath(){return Array.prototype.slice.call(arguments).reduce(function(e,r){return"string"==typeof r?e.replace(/\/*$/,"")+"/"+r.replace(/^\/*/,""):e})}function newUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=16*Math.random()|0;return("x"==e?r:3&r|8).toString(16)}).toUpperCase()}function createDataURI(e,r){return"data:"+(r=r||"text/plain")+";base64,"+btoa(e)}function hashCode(e){var r=0,n=e.length;if(0==n)return r;for(var t=0;t<n;t++){r=(r<<5)-r+e.charCodeAt(t),r&=r}return r}function md5(e){function r(e,r,n,t,o,i){return r=s(s(r,e),s(t,i)),s(r<<o|r>>>32-o,n)}function n(e,n,t,o,i,a,u){return r(n&t|~n&o,e,n,i,a,u)}function t(e,n,t,o,i,a,u){return r(n&o|t&~o,e,n,i,a,u)}function o(e,n,t,o,i,a,u){return r(n^t^o,e,n,i,a,u)}function i(e,n,t,o,i,a,u){return r(t^(n|~o),e,n,i,a,u)}function a(e,r){var a=e[0],u=e[1],c=e[2],l=e[3];a=n(a,u,c,l,r[0],7,-680876936),l=n(l,a,u,c,r[1],12,-389564586),c=n(c,l,a,u,r[2],17,606105819),u=n(u,c,l,a,r[3],22,-1044525330),a=n(a,u,c,l,r[4],7,-176418897),l=n(l,a,u,c,r[5],12,1200080426),c=n(c,l,a,u,r[6],17,-1473231341),u=n(u,c,l,a,r[7],22,-45705983),a=n(a,u,c,l,r[8],7,1770035416),l=n(l,a,u,c,r[9],12,-1958414417),c=n(c,l,a,u,r[10],17,-42063),u=n(u,c,l,a,r[11],22,-1990404162),a=n(a,u,c,l,r[12],7,1804603682),l=n(l,a,u,c,r[13],12,-40341101),c=n(c,l,a,u,r[14],17,-1502002290),u=n(u,c,l,a,r[15],22,1236535329),a=t(a,u,c,l,r[1],5,-165796510),l=t(l,a,u,c,r[6],9,-1069501632),c=t(c,l,a,u,r[11],14,643717713),u=t(u,c,l,a,r[0],20,-373897302),a=t(a,u,c,l,r[5],5,-701558691),l=t(l,a,u,c,r[10],9,38016083),c=t(c,l,a,u,r[15],14,-660478335),u=t(u,c,l,a,r[4],20,-405537848),a=t(a,u,c,l,r[9],5,568446438),l=t(l,a,u,c,r[14],9,-1019803690),c=t(c,l,a,u,r[3],14,-187363961),u=t(u,c,l,a,r[8],20,1163531501),a=t(a,u,c,l,r[13],5,-1444681467),l=t(l,a,u,c,r[2],9,-51403784),c=t(c,l,a,u,r[7],14,1735328473),u=t(u,c,l,a,r[12],20,-1926607734),a=o(a,u,c,l,r[5],4,-378558),l=o(l,a,u,c,r[8],11,-2022574463),c=o(c,l,a,u,r[11],16,1839030562),u=o(u,c,l,a,r[14],23,-35309556),a=o(a,u,c,l,r[1],4,-1530992060),l=o(l,a,u,c,r[4],11,1272893353),c=o(c,l,a,u,r[7],16,-155497632),u=o(u,c,l,a,r[10],23,-1094730640),a=o(a,u,c,l,r[13],4,681279174),l=o(l,a,u,c,r[0],11,-358537222),c=o(c,l,a,u,r[3],16,-722521979),u=o(u,c,l,a,r[6],23,76029189),a=o(a,u,c,l,r[9],4,-640364487),l=o(l,a,u,c,r[12],11,-421815835),c=o(c,l,a,u,r[15],16,530742520),u=o(u,c,l,a,r[2],23,-995338651),a=i(a,u,c,l,r[0],6,-198630844),l=i(l,a,u,c,r[7],10,1126891415),c=i(c,l,a,u,r[14],15,-1416354905),u=i(u,c,l,a,r[5],21,-57434055),a=i(a,u,c,l,r[12],6,1700485571),l=i(l,a,u,c,r[3],10,-1894986606),c=i(c,l,a,u,r[10],15,-1051523),u=i(u,c,l,a,r[1],21,-2054922799),a=i(a,u,c,l,r[8],6,1873313359),l=i(l,a,u,c,r[15],10,-30611744),c=i(c,l,a,u,r[6],15,-1560198380),u=i(u,c,l,a,r[13],21,1309151649),a=i(a,u,c,l,r[4],6,-145523070),l=i(l,a,u,c,r[11],10,-1120210379),c=i(c,l,a,u,r[2],15,718787259),u=i(u,c,l,a,r[9],21,-343485551),e[0]=s(a,e[0]),e[1]=s(u,e[1]),e[2]=s(c,e[2]),e[3]=s(l,e[3])}function u(e){var r,n=[];for(r=0;r<64;r+=4)n[r>>2]=e.charCodeAt(r)+(e.charCodeAt(r+1)<<8)+(e.charCodeAt(r+2)<<16)+(e.charCodeAt(r+3)<<24);return n}function c(e){for(var r="",n=0;n<4;n++)r+=l[e>>8*n+4&15]+l[e>>8*n&15];return r}var s=function(e,r){var n=(65535&e)+(65535&r);return(e>>16)+(r>>16)+(n>>16)<<16|65535&n},l="0123456789abcdef".split("");return function(e){for(var r=e.length,n=0;n<r;n++)e[n]=c(e[n]);return e.join("")}(function(e){var r,n=e.length,t=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=n;r+=64)a(t,u(e.substring(r-64,r)));e=e.substring(r-64);var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=e.length;for(r=0;r<i;r++)o[r>>2]|=e.charCodeAt(r)<<(r%4<<3);if(o[r>>2]|=128<<(r%4<<3),r>55)for(a(t,o),r=16;r--;)o[r]=0;return o[14]=8*n,a(t,o),t}(e))}function reMatches$$1(e,r){var n=[];return e.replace(r,function(e,r){n.push({match:e,start:r,end:r+e.length})}),n}function stringMatch(e,r,n){function t(e,r,n,t,o){return t=t||0,o=o||0,[e.slice(0,r),e.slice(r+t,n-o),e.slice(n)]}function o(e,r){if(r.constructor!==RegExp){if(0===e.indexOf(r))return{match:r,rest:e.slice(r.length)};for(var n=0;n<r.length;n++)if(r[n]!=e[n])return{match:null,pos:n};return{match:null}}var t=reMatches$$1(e,r);return t&&t.length&&0===t[0].start?{match:t[0].match,rest:e.slice(t[0].end)}:{match:null}}function i(e,r){for(var n=0,t=0;t<r.length;t++){var i=r[t],a=o(e,i);if(!a.match)return{matched:!1,pos:n+(a.pos||0),pattern:i};n+=a.match.length,e=a.rest}return e.length?{matched:!1,pos:n}:{matched:!0}}function a(e){var r=reMatches$$1(e,/__\//g),n=reMatches$$1(e,/\/__/g);if(r.length!==n.length)throw new Error("pattern invalid: "+e+" cannot be split into __/.../__ embedded RegExps\nstarts: "+JSON.stringify(r)+"\nvs ends:\n"+JSON.stringify(n));var o=0;return r.reduce(function(e,r,i){var a=n[i],u=e.pop(),c=t(u,r.start-o,a.end-o,3,3);c[0].length&&(e.push(c[0]),o+=c[0].length);try{c[1].length&&(e.push(new RegExp(c[1])),o+=c[1].length+3+3)}catch(e){throw new Error("Cannot create pattern re from: "+inspect(c))}return c[2].length&&e.push(c[2]),e},[e])}return n=n||{},n.normalizeWhiteSpace&&(e=e.replace(/\s+/g," ")),n.ignoreIndent&&(e=e.replace(/^\s+/gm,""),r=r.replace(/^\s+/gm,"")),e==r?{matched:!0}:function(e,r){var n=a(r),t=i(e,n);return t.matched?t:(t.error=e.slice(0,t.pos)+"<--UNMATCHED-->"+e.slice(t.pos),t)}(e,r)}function peekRight(e,r,n){if(e=e.slice(r),"string"==typeof n){var t=e.indexOf(n);return t===-1?null:t+r}if(n.constructor===RegExp){var o=reMatches$$1(e,n);return o[0]?o[0].start:null}return null}function peekLeft(e,r,n){if(e=e.slice(0,r),"string"==typeof n){var t=e.lastIndexOf(n);return t===-1?null:t}if(n.constructor===RegExp){var o=reMatches$$1(e,n);return last(o)?last(o).start:null}return null}function lineIndexComputer(e){var r=lineRanges(e);return function(e){for(var n=0;n<r.length;n++){var t=r[n];if(e>=t[0]&&e<t[1])return n}return-1}}function lineNumberToIndexesComputer(e){return function(r){return lineRanges(e)[r]}}function lineRanges(e){for(var r=0,n=0,t=lines(e),o=[],i=0;i<t.length;i++){n=r+t[i].length+1,o.push([r,n]),r=n}return o}function findLineWithIndexInLineRanges(e,r){var n=e.length;if(0===n)return-1;for(var t=0,o=n;;){var i=t+Math.floor((o-t)/2),a=slicedToArray(e[i],2),u=a[0],c=a[1];if(r<u){if(0===i)return-1;o=i}else{if(!(r>c))return i;t=i}}return-1}function diff(e,r){return"undefined"==typeof JsDiff?"diff not supported":JsDiff.convertChangesToXML(JsDiff.diffWordsWithSpace(e,r))}function empty(e){return""==e}function startsWithVowel(e){var r=e[0];return"A"===r||"E"===r||"I"===r||"O"===r||"U"===r||"a"===r||"e"===r||"i"===r||"o"===r||"u"===r||!1}function withDecimalPrecision(e,r){var n=parseFloat(e);return isNaN(n)?e:n.toFixed(r)}function capitalize(e){return e.length?e.charAt(0).toUpperCase()+e.slice(1):e}function camelCaseString(e){return e.split(" ").invoke("capitalize").join("")}function camelize(e){var r=e.split("-"),n=r.length;if(1==n)return r[0];for(var t="-"==e.charAt(0)?r[0].charAt(0).toUpperCase()+r[0].substring(1):r[0],o=1;o<n;o++)t+=r[o].charAt(0).toUpperCase()+r[o].substring(1);return t}function truncate(e,r,n){return r=r||30,n=void 0===n?"...":n,e.length>r?e.slice(0,r-n.length)+n:String(e)}function truncateLeft(e,r,n){return r=r||30,n=void 0===n?"...":n,e.length>r?n+e.slice(-r):String(e)}function regExpEscape(e){return e.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")}function succ(e){return e.slice(0,e.length-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1)}function digitValue(e){return e.charCodeAt(0)-"0".charCodeAt(0)}function applyChange(e,r){return"insert"===r.action?e.slice(0,r.start)+r.lines.join("\n")+e.slice(r.start):"remove"===r.action?e.slice(0,r.start)+e.slice(r.end):e}function applyChanges(e,r){return r.reduce(function(r,n){return applyChange(e,n)},e)}function levenshtein(e,r){if(0===e.length)return r.length;if(0===r.length)return e.length;var n,t,o,i,a,u;for(e.length>r.length&&(n=e,e=r,r=n),u=Array(e.length+1),t=0;t<=e.length;t++)u[t]=t;for(t=1;t<=r.length;t++){for(i=t,o=1;o<=e.length;o++)a=r[t-1]===e[o-1]?u[o-1]:Math.min(u[o-1]+1,Math.min(i+1,u[o]+1)),u[o-1]=i,i=a;u[e.length]=i}return u[e.length]}function random(e,r){return e=e||0,r=r||100,Math.round(Math.random()*(r-e)+e)}function randomSmallerInteger(e){return Math.floor(Math.random()*e)}function humanReadableByteSize(e){function r(e){return Math.round(100*e)/100}return e<1e3?String(r(e))+"B":(e/=1024)<1e3?String(r(e))+"KB":(e/=1024,String(r(e))+"MB")}function average(e){return e.reduce(function(e,r){return e+r},0)/e.length}function median(e){var r=e.sort(function(e,r){return r-e}),n=e.length;return n%2==0?.5*(r[n/2-1]+r[n/2]):r[(n-1)/2]}function between(e,r,n,t){t=t||0;var o,i;return r<n?(o=r,i=n):(i=r,o=n),i-e+t>=0&&o-e-t<=0}function sort$1(e){return e.sort(function(e,r){return e-r})}function parseLength(e,r){r=r||"px";var n=e.match(/([0-9\.]+)\s*(.*)/);if(n&&n[1]){var t=parseFloat(n[1]),o=n[2];return convertLength(t,o,r)}}function roundTo(e,r){return r=1/r,Math.round(e*r)/r}function detent(e,r,n,t){var o=roundTo(e,n);return Math.abs(e-o)<r/2?o:t?e:o+(e-(e<o?o-r/2:o+r/2))*n/(n-r)}function toDegrees(e){return 180*e/Math.PI%360}function toRadians(e){return e/180*Math.PI}function all$2(e,r){var n=[];for(var t in e)!e.__lookupGetter__(t)&&"function"==typeof e[t]||r&&!r(t,e)||n.push(t);return n}function allOwnPropertiesOrFunctions(e,r){return Object.getOwnPropertyNames(e).reduce(function(n,t){return r&&!r(e,t)||n.push(t),n},[])}function own$1(e){var r=[];for(var n in e)e.hasOwnProperty(n)&&(e.__lookupGetter__(n)||"function"!==e[n])&&r.push(n);return r}function forEachOwn(e,r,n){var t=[];for(var o in e)if(e.hasOwnProperty(o)){var i=e[o];"function"!==i&&t.push(r.call(n||this,o,i))}return t}function nameFor(e,r){for(var n in e)if(e[n]===r)return n}function values$1(e){var r=[];for(var n in e)r.push(e[n]);return r}function ownValues(e){var r=[];for(var n in e)e.hasOwnProperty(n)&&r.push(e[n]);return r}function any$1(e,r){for(var n in e)if(r(e,n))return!0;return!1}function allProperties(e,r){var n=[];for(var t in e)r&&!r(e,t)||n.push(t);return n}function hash(e){return Object.keys(e).sort().join("").hashCode()}function format$1(e,r,n){return dateFormat(e,r,n)}function equals$3(e,r){return r&&r instanceof Date&&r.getTime()===e.getTime()}function relativeTo(e,r){if(!(r instanceof Date))return"";if(r<e)return"";if(r===e)return"now";var n="min",t="sec",o="hour",i="day",a=r-e,u=Math.round(a/1e3),c=u%60,s=Math.floor(u/60)%60,l=Math.floor(u/60/60)%24,f=Math.floor(u/60/60/24),p=[];return f>0&&(p.push(f),f>1&&(i+="s"),p.push(i)),l>0&&f<2&&(p.push(l),l>1&&(o+="s"),p.push(o)),s>0&&l<3&&0===f&&(p.push(s),s>1&&(n+="s"),p.push(n)),c>0&&s<3&&0===l&&0===f&&(p.push(c),c>1&&(t+="s"),p.push(t)),p.join(" ")}function promise(e){return"function"==typeof e?promise.convertCallbackFun(e):Promise.resolve(e)}function delay$1(e,r){return new Promise(function(n){return setTimeout(n,e,r)})}function delayReject(e,r){return new Promise(function(n,t){return setTimeout(t,e,r)})}function timeout(e,r){return new Promise(function(n,t){var o=!1;setTimeout(function(){return!o&&(o=!0)&&t(new Error("Promise timed out"))},e),r.then(function(e){return!o&&(o=!0)&&n(e)},function(e){return!o&&(o=!0)&&t(e)})})}function waitFor$1(e,r){return new Promise(function(n,t){"function"==typeof e&&(r=e,e=void 0);var o=!1,i=null,a=void 0,u=setInterval(function(){if(o)return void clearInterval(u);try{a=r()}catch(e){i=e}(a||i)&&(o=!0,clearInterval(u),i?t(i):n(a))},10);"number"==typeof e&&setTimeout(function(){i=new Error("timeout")},e)})}function deferred(){var e,r,n=new Promise(function(n,t){e=n,r=t});return{resolve:e,reject:r,promise:n}}function convertCallbackFun(e){return function(){var r=Array.from(arguments),n=this;return new Promise(function(t,o){r.push(function(e,r){return e?o(e):t(r)}),e.apply(n,r)})}}function convertCallbackFunWithManyArgs(e){return function(){var r=Array.from(arguments),n=this;return new Promise(function(t,o){r.push(function(){var e=Array.from(arguments),r=e.shift();return r?o(r):t(e)}),e.apply(n,r)})}}function _chainResolveNext(e,r,n,t,o){var i=e.shift();if(i)try{Promise.resolve(i(r,n)).then(function(r){return _chainResolveNext(e,r,n,t,o)}).catch(function(e){o(e)})}catch(e){o(e)}else t(r)}function chain$1(e){return new Promise(function(r,n){return _chainResolveNext(e.slice(),void 0,{},r,n)})}function promise_finally(e,r){return Promise.resolve(e).then(function(e){try{r()}catch(e){console.error("Error in promise finally: "+e.stack||e)}return e}).catch(function(e){try{r()}catch(e){console.error("Error in promise finally: "+e.stack||e)}throw e})}function Path(e,r){return e instanceof Path?e:this instanceof Path?(this.setSplitter(r||"."),void this.fromPath(e)):new Path(e,r)}function clone$2(e){var r={};for(var n in e)r[n]=e[n].slice();return r}function without$1(e,r){var n={};for(var t in e)if(!r.includes(t)){n[t]=[];for(var o=e[t],i=0;i<o.length;i++){var a=o[i];r.includes(a)||n[t].push(a)}}return n}function hull(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;if(!Array.isArray(e[r]))return[];for(var o=[],i={},a={},u=0;u<n.length;u++)a[n[u]]=!0;for(var c=e[r].slice(),s={},l=c.length;l--;){var f=c[l];f in a?c.splice(l,1):s[f]=1}if(n)for(;;){if(0===c.length)break;for(var p=0;p<c.length;p++){var h=c.shift();if(!(h in i||h in a)){var d=s[h]||0;if(!(d>t)){o.push(h),i[h]=!0;var g=e[h];if(g)for(var y=0;y<g.length;y++){var m=g[y];m in i||m in s||(s[m]=d+1,c.push(m))}}}}}return o}function subgraphReachableBy(e,r,n){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;n&&(e=without$1(e,n));for(var o=[r],i=0,a={};o.length&&i++<t;){var u=o.shift();if(!a[u]){var c=e[u]||[];a[u]=c,o.push.apply(o,toConsumableArray(c))}}return a}function invert(e){var r={};for(var n in e)for(var t=e[n],o=0;o<t.length;o++){var i=t[o];r[i]?r[i].push(n):r[i]=[n]}return r}function sortByReference(e,r){for(var n=[r].concat(hull(e,r)),t=[],o=[];t.length!==n.length;){var i=withoutAll(n,t).reduce(function(r,n){return r[n]=withoutAll(e[n]||[],t).length,r},{}),a=withoutAll(n,t).reduce(function(e,r){return i[r]<=i[e]?r:e});0===i[a]?o.push(Object.keys(i).filter(function(e){return 0===i[e]})):o.push([a]),t=flatten(o)}return o}function reduce$1(e,r,n,t,o,i){function a(n){if(!(u.indexOf(n)>-1)){t=e.call(i,t,n,c++),u=u.concat([n]);withoutAll(r[n]||[],u).forEach(function(e){return a(e)})}}var u=o||[],c=0;return a(n),t}function random$1(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,r={},n=range(1,e).map(String),t=0;t<n.length;t++){var o=Math.floor(Math.random()*e);r[n[t]]=shuffle(n).slice(0,o)}return r}function isInterval(e){return Array.isArray(e)&&e.length>=2&&e[0]<=e[1]}function sort$2(e){return e.sort(compare)}function compare(e,r){return e[0]<r[0]?e[1]<r[0]?-3:e[1]===r[0]?-2:-1:e[0]===r[0]?e[1]===r[1]?0:e[1]<r[1]?-1:1:-1*compare(r,e)}function coalesce(e,r,n){switch(this.compare(e,r)){case-3:case 3:return null;case 0:return n&&n(e,r,e),e;case 2:case 1:var t=e;e=r,r=t;case-2:case-1:var o=[e[0],Math.max(e[1],r[1])];return n&&n(e,r,o),o;default:throw new Error("Interval compare failed")}}function coalesceOverlapping(e,r){for(var n=[],t=e.length;t>0;){var o=e.shift();t--;for(var i=0;i<t;i++){var a=e[i],u=coalesce(o,a,r);u&&(o=u,e.splice(i,1),t--,i--)}n.push(o)}return this.sort(n)}function mergeOverlapping(e,r,n){for(var t=[];e.length>0;){var o=e.shift(),i=r.map(function(e){var r=compare(o,e);return r===-1||0===r||1===r});t.push(n(o,i[0])),t.push(o)}return t}function intervalsInRangeDo(e,r,n,t,o,i){i=i||GLOBAL$2,n=this.sort(n);for(var a,u=[];a=n.shift();)if(!(a[1]<e)){a[0]<e&&(a=Array.prototype.slice.call(a),a[0]=e);var c=r<a[0]?r:a[0];if(e<c&&u.push(t.call(i,[e,c],!0)),r<a[1]&&(a=Array.prototype.slice.call(a),a[1]=r),a[0]===a[1]){var s;o&&(s=u.slice(-1)[0])&&o.call(i,s,a,s)}else u.push(t.call(i,a,!1));if((e=a[1])>=r)break}return e<r&&u.push(t.call(i,[e,r],!0)),u}function intervalsInbetween(e,r,n){return intervalsInRangeDo(e,r,coalesceOverlapping(Array.prototype.slice.call(n)),function(e,r){return r?e:null}).filter(Boolean)}function mapToMatchingIndexes(e,r){var n,t,o=0;return r.map(function(r){for(;(t=e[o])&&t[0]<r[0];)o++;if(t&&t[0]===r[0]){for(n=o;(t=e[n])&&t[1]<r[1];)n++;if(t&&t[1]===r[1])return range(o,n)}return[]})}function create(e,r,n){var t=n||0;return t+r>e.length&&(t-=t+r-e.length),{array:e,from:t,to:t+r}}function toArray$4(e){return e.array.slice(e.from,e.to)}function originalToProjectedIndex(e,r){return r<e.from||r>=e.to?null:r-e.from}function projectedToOriginalIndex(e,r){return r<0||r>e.to-e.from?null:e.from+r}function transformToIncludeIndex(e,r){if(!(r in e.array))return null;var n=0;return r<e.from&&(n=-e.from+r),r>=e.to&&(n=r-e.to+1),0===n?e:create(e.array,e.to-e.from,e.from+n)}function get$2(e,r,n){var t=e[r];return t?t[n]:void 0}function set$2(e,r,n,t){var o=e[r];return o&&(o[n]=t),t}function getRow(e,r){return e[r]}function setRow(e,r,n){return e[r]=n}function getCol(e,r){return e.reduce(function(e,n){return e.push(n[r]),e},[])}function setCol(e,r,n){return e.map(function(e,t){return e[r]?e[r]=n[t]:void 0})}function create$1(e,r,n){for(var t=new Array(e);e>0;)t[--e]=withN(r,n);return t}function mapCreate(e,r,n,t){for(var o=new Array(e),i=0;i<e;i++){o[i]=new Array(r);for(var a=0;a<r;a++)o[i][a]=n.call(t||this,i,a)}return o}function forEach$2(e,r,n){e.forEach(function(e,t){e.forEach(function(e,o){r.call(n||this,e,t,o)})})}function map$2(e,r,n){var t=new Array(e.length);return e.forEach(function(e,o){t[o]=new Array(e.length),e.forEach(function(e,i){t[o][i]=r.call(n||this,e,o,i)})}),t}function toObjects(e){for(var r=e[0],n=new Array(e.length-1),t=1;t<e.length;t++)for(var o=n[t-1]={},i=0;i<r.length;i++)o[r[i]]=e[t][i];return n}function tableFromObjects(e,r){Array.isArray(e)||(e=[e]);var n=[[]],t=n[0],o=e.reduce(function(e,r){return e.concat([Object.keys(r).reduce(function(e,n){var o=t.indexOf(n);return o===-1&&(o=t.length,t.push(n)),e[o]=r[n],e},[])])},[]);return r=1===arguments.length?null:r,o.forEach(function(e){for(var n=0;n<t.length;n++)e[n]||(e[n]=r)}),n.concat(o)}function prewalk(e,r,n){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{i:0},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=t.i++;r(e,i,o),(n(e,i,o)||[]).forEach(function(e){return prewalk(e,r,n,t,o+1)})}function postwalk(e,r,n){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{i:0},o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=t.i++;(n(e,i,o)||[]).forEach(function(e){return postwalk(e,r,n,t,o)}),r(e,i,o)}function find(e,r,n){if(r(e))return e;var t=n(e);if(t&&t.length)for(var o=0;o<t.length;o++){var i=find(t[o],r,n);if(i)return i}}function filter$1(e,r,n){var t=[];return r(e)&&t.push(e),t.concat(flatten((n(e)||[]).map(function(e){return filter$1(e,r,n)})))}function map$3(e,r,n){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return[r(e,t)].concat(flatten((n(e)||[]).map(function(e){return map$3(e,r,n,t+1)})))}function mapTree(e,r,n){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=(n(e)||[]).map(function(e){return mapTree(e,r,n,t+1)});return r(e,o,t)}function create$2(e){var r=[{name:"send",args:["msg","callback"]},{name:"listen",args:["messenger","callback"]},{name:"close",args:["messenger","callback"]},{name:"isOnline",args:[]}],n=r.map(function(e){return e.name}).concat(["id","sendHeartbeat","heartbeatInterval","ignoreUnknownMessages","allowConcurrentSends","sendTimeout","services"]);r.forEach(function(r){if(!e[r.name]){var n="message implementation needs function "+r.name+"("+r.args.join(",")+")";throw new Error(n)}});var t=e.sendHeartbeat&&(e.heartbeatInterval||1e3),o=!!e.hasOwnProperty("ignoreUnknownMessages")&&e.ignoreUnknownMessages,i={_outgoing:[],_inflight:[],_id:e.id||newUUID(),_ignoreUnknownMessages:o,_services:{},_messageCounter:0,_messageResponseCallbacks:{},_whenOnlineCallbacks:[],_statusWatcherProc:null,_startHeartbeatProcessProc:null,_listenInProgress:null,_heartbeatInterval:t,_status:OFFLINE,_runWhenOnlineCallbacks:function(){var e=i._whenOnlineCallbacks.slice();i._whenOnlineCallbacks=[],e.forEach(function(e){try{e.call(null,null,i)}catch(e){console.error("error in _runWhenOnlineCallbacks: %s",e)}})},_ensureStatusWatcher:function(){i._statusWatcherProc||(i._statusWatcherProc=setInterval(function(){i.isOnline()&&i._whenOnlineCallbacks.length&&i._runWhenOnlineCallbacks();var e=i._status;i._status=i.isOnline()?ONLINE:OFFLINE,i._status!==ONLINE&&i._statusWatcherProc&&i.reconnect(),i._status!==e&&i.onStatusChange&&i.onStatusChange()},20))},_addMissingData:function(e){if(!e.target)throw new Error("Message needs target!");if(!e.action)throw new Error("Message needs action!");return e.data||(e.data=null),e.messageId||(e.messageId=newUUID()),e.sender=i.id(),e.messageIndex=i._messageCounter++,e},_queueSend:function(e,r){if(r&&"function"!=typeof r)throw new Error("Expecing a when send callback, got: "+r);i._outgoing.push([e,r])},_deliverMessageQueue:function(){function r(r){if(i._inflight.indexOf(r)!==-1){var t=r[0],o=r[1];o&&(i._messageResponseCallbacks[t.messageId]=o),e.send.call(i,t,function(e){remove(i._inflight,r),e&&n(e,r),i._deliverMessageQueue()})}}function n(e,r){var n=r[0],t=r[1];delete i._messageResponseCallbacks[n.messageId],console.error(e),t&&t(e)}if(e.allowConcurrentSends||!i._inflight.length){var t=i._outgoing.shift();t&&(i._inflight.push(t),i.isOnline()?r(t):i.whenOnline(function(){r(t)}),function(r){"number"==typeof e.sendTimeout&&setTimeout(function(){i._inflight.indexOf(r)!==-1&&(remove(i._inflight,r),n(new Error("Timeout sending message"),r),i._deliverMessageQueue())},e.sendTimeout)}(t),e.allowConcurrentSends&&i._outgoing.length&&i._deliverMessageQueue())}},_startHeartbeatProcess:function(){i._startHeartbeatProcessProc||(i._startHeartbeatProcessProc=setTimeout(function(){e.sendHeartbeat.call(i,function(e,r){i._startHeartbeatProcessProc=null,i._startHeartbeatProcess()})},i._heartbeatInterval))},id:function(){return i._id},isOnline:function(){return e.isOnline.call(i)},heartbeatEnabled:function(){return"number"==typeof i._heartbeatInterval},listen:function(r){if(!i._listenInProgress)return i._listenInProgress=!0,i._ensureStatusWatcher(),e.listen.call(i,function(e){i._listenInProgress=null,r&&r(e),i.heartbeatEnabled()&&i._startHeartbeatProcess()})},reconnect:function(){if(i._status!==ONLINE)return i.listen(),i},send:function(e,r){return i._addMissingData(e),i._queueSend(e,r),i._deliverMessageQueue(),e},sendTo:function(e,r,n,t){var o={target:e,action:r,data:n};return i.send(o,t)},onMessage:function(e){if(i.emit("message",e),e.inResponseTo){var r=i._messageResponseCallbacks[e.inResponseTo];r&&!e.expectMoreResponses&&delete i._messageResponseCallbacks[e.inResponseTo],r&&r(null,e)}else{var n=i._services[e.action];if(n)try{n.call(null,e,i)}catch(r){var t=String(r.stack||r);console.error("Error invoking service: "+t),i.answer(e,{error:t})}else if(!i._ignoreUnknownMessages){var o=new Error("messageNotUnderstood: "+e.action);i.answer(e,{error:String(o)})}}},answer:function e(r,n,t,o){"function"==typeof t&&(o=t,t=!1);var e={target:r.sender,action:r.action+"Result",inResponseTo:r.messageId,data:n};return t&&(e.expectMoreResponses=!0),i.send(e,o)},close:function(r){return clearInterval(i._statusWatcherProc),i._statusWatcherProc=null,e.close.call(i,function(e){i._status=OFFLINE,r&&r(e)}),i},whenOnline:function(e){return i._whenOnlineCallbacks.push(e),i.isOnline()&&i._runWhenOnlineCallbacks(),i},outgoingMessages:function(){return pluck(i._inflight.concat(i._outgoing),0)},addServices:function(e){return Object.assign(i._services,e),i}};e.services&&i.addServices(e.services),makeEmitter(i);for(var a in e)n.indexOf(a)===-1&&e.hasOwnProperty(a)&&(i[a]=e[a]);return i}function fork(e,r,n){n||(n=r,r=e,e=null),e=e||{};var t=e.args||[],o=create$3(e);return o.run.apply(o,[r].concat(t).concat(n)),o}function create$3(e){e=e||{},e.useMessenger=!0;var r=e.workerId||newUUID(),n=create$2({sendTimeout:5e3,send:function(e,r){n.worker.postMessage(e),r()},listen:function(r){var t=n.worker=isNodejs?NodejsWorker.create(e):BrowserWorker.create(e);t.on("message",function(e){n.onMessage(e)}),t.on("ready",function(){NodejsWorker.debug&&console.log("WORKER READY!!!")}),t.on("close",function(){NodejsWorker.debug&&console.log("WORKER CLOSED...!!!")}),t.once("ready",r)},close:function(e){return n.worker.ready?n.sendTo(r,"close",{},function(r,t){if(r=r||t.data.error,r&&console.error("Error in worker messenger close: "+r.stack||r),r)e(r);else{var o=!1;n.worker.once("close",function(){o=!0}),waitFor(1e3,function(){return!!o},e)}}):e(null)},isOnline:function(){return n.worker&&n.worker.ready}});return Object.assign(n,{eval:function(e,t){n.sendTo(r,"remoteEval",{expr:e},function(e,r){t(e,r?r.data.result:null)})},run:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),o=e.pop();if("function"!=typeof t)throw new Error("run: no function that should run in worker passed");if("function"!=typeof o)throw new Error("run: no callback passed");return n.sendTo(r,"run",{func:String(t),args:e},function(e,r){o(e||r.data.error,r?r.data.result:null)})}}),n.listen(),n}function createLivelyLangObject(){return{chain:chain$$1,noConflict:noConflict,installGlobals:installGlobals,uninstallGlobals:uninstallGlobals,globalInterfaceSpec:globalInterfaceSpec,toString:function(){return"[object lively.lang]"}}}function chain$$1(e){if(!e)return e;if(Array.isArray(e))return createChain(arr,e);if("Date"===e.constructor.name)return createChain(date,e);switch(void 0===e?"undefined":_typeof(e)){case"string":return createChain(string,e);case"object":return createChain(obj,e);case"function":return createChain(fun,e);case"number":return createChain(num,e)}throw new Error("Chain for object "+e+" ("+e.constructor.name+") no supported")}function createChain(e,r){return Object.keys(e).reduce(function(n,t){return n[t]=function(){var n=Array.prototype.slice.call(arguments);return chain$$1(e[t].apply(null,[r].concat(n)))},n},{value:function(){return r}})}function noConflict(){if(!isNode){livelyLang._prevLivelyGlobal?delete GLOBAL.lively.lang:delete GLOBAL.lively}return livelyLang}function installGlobals(){globalInterfaceSpec.forEach(function(e){if("installMethods"===e.action){var r=Path(e.target);r.isIn(GLOBAL)||r.set(GLOBAL,{},!0);var n=Path(e.sources[0]);e.methods.forEach(function(e){installProperty(n.concat([e]),r.concat([e]))}),e.alias&&e.alias.forEach(function(e){installProperty(n.concat([e[1]]),r.concat([e[0]]))})}else{if("installObject"!==e.action)throw new Error("Cannot deal with global setup action: "+e.action);var r=Path(e.target),t=Path(e.source).get(livelyLang);r.set(GLOBAL,t,!0)}})}function installProperty(e,r){if(!e.isIn(livelyLang)){var n=new Error("property not provided by lively.lang: "+e);throw console.error(n.stack||n),n}var t=e.get(livelyLang);if("function"==typeof t&&"prototype"===r.slice(-2,-1).toString()){var o=t;t=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),o.apply(null,e)},t.toString=function(){return o.toString()}}r.set(GLOBAL,t,!0)}function uninstallGlobals(){globalInterfaceSpec.forEach(function(e){if("installMethods"===e.action){var r=Path(e.target),n=Path(e.source).get(livelyLang),t=r.get(GLOBAL);if(!t)return;e.methods.filter(function(e){return n===t[e]}).forEach(function(e){delete t[e]}),e.alias&&e.alias.filter(function(e){return n===t[e]}).forEach(function(e){delete t[e[0]]})}else{if("installObject"!==e.action)throw new Error("Cannot deal with global setup action: "+e.action);var r=Path(e.target);r.del(GLOBAL)}})}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},classCallCheck=function(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")},createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var t=r[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,n,t){return n&&e(r.prototype,n),t&&e(r,t),r}}(),get$1=function e(r,n,t){null===r&&(r=Function.prototype);var o=Object.getOwnPropertyDescriptor(r,n);if(void 0===o){var i=Object.getPrototypeOf(r);return null===i?void 0:e(i,n,t)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(t)},set$1=function e(r,n,t,o){var i=Object.getOwnPropertyDescriptor(r,n);if(void 0===i){var a=Object.getPrototypeOf(r);null!==a&&e(a,n,t,o)}else if("value"in i&&i.writable)i.value=t;else{var u=i.set;void 0!==u&&u.call(o,t)}return t},slicedToArray=function(){function e(e,r){var n=[],t=!0,o=!1,i=void 0;try{for(var a,u=e[Symbol.iterator]();!(t=(a=u.next()).done)&&(n.push(a.value),!r||n.length!==r);t=!0);}catch(e){o=!0,i=e}finally{try{!t&&u.return&&u.return()}finally{if(o)throw i}}return n}return function(r,n){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var r=0,n=Array(e.length);r<e.length;r++)n[r]=e[r];return n}return Array.from(e)},parameterRegex=/function[^\(]*\(([^\)]*)\)|\(?([^\)=]*)\)?\s*=>/,Closure=function(){function e(r,n,t,o){classCallCheck(this,e),this.originalFunc=r,this.varMapping=n||{},this.setFuncSource(t||r),this.setFuncProperties(r||o)}return createClass(e,null,[{key:"fromFunction",value:function(e,r){return new this(e,r||{})}},{key:"fromSource",value:function(e,r){return new this(null,r||{},e)}}]),createClass(e,[{key:"setFuncSource",value:function(e){return e="undefined"!=typeof lively&&lively.sourceTransform&&"function"==typeof lively.sourceTransform.stringifyFunctionWithoutToplevelRecorder?lively.sourceTransform.stringifyFunctionWithoutToplevelRecorder(e):String(e),this.source=e}},{key:"getFuncSource",value:function(){return this.source||this.setFuncSource(this.originalFunc)}},{key:"hasFuncSource",value:function(){return this.source&&!0}},{key:"getFunc",value:function(){return this.originalFunc||this.recreateFunc()}},{key:"getFuncProperties",value:function(){return this.funcProperties||(this.funcProperties={})}},{key:"setFuncProperties",value:function(e){var r=this.getFuncProperties();for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n])}},{key:"lookup",value:function(e){return this.varMapping[e]}},{key:"parameterNames",value:function(e){if("undefined"!=typeof lively&&lively.ast)return(lively.ast.parseFunction(e).params||[]).map(function(e){return"Identifier"===e.type?e.name:e.left&&"Identifier"===e.left.type?e.left.name:null}).filter(Boolean);var r=parameterRegex.exec(e);return r?(r[1]||r[2]||"").split(",").map(function(e){return e.trim()}):[]}},{key:"firstParameter",value:function(e){return this.parameterNames(e)[0]||null}},{key:"recreateFunc",value:function(){return this.recreateFuncFromSource(this.getFuncSource(),this.originalFunc)}},{key:"recreateFuncFromSource",value:function(e,r){var n=[],t="$super"===this.firstParameter(e);for(var o in this.varMapping)this.varMapping.hasOwnProperty(o)&&("this"!=o?n.push("var "+o+" = this.varMapping."+o+";\n"):!0);var i="";n.length>0&&(i+=n.join("\n")),t&&(i+="(function superWrapperForClosure() { return "),i+="("+e+")",t&&(i+=".apply(this, [$super.bind(this)].concat(Array.from(arguments))) })");try{var a=evalJS.call(this,i)||this.couldNotCreateFunc(i);return this.addFuncProperties(a),this.originalFunc=a,a}catch(e){var u="Cannot create function "+e+" src: "+i;throw console.error(u),new Error(u)}}},{key:"addFuncProperties",value:function(e){var r=this.getFuncProperties();for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);this.addClosureInformation(e)}},{key:"couldNotCreateFunc",value:function(e){var r="Could not recreate closure from source: \n"+e
;return console.error(r),function(){throw new Error(r)}}},{key:"asFunction",value:function(){return this.recreateFunc()}},{key:"addClosureInformation",value:function(e){return e.hasLivelyClosure=!0,e.livelyClosure=this,e}},{key:"isLivelyClosure",get:function(){return!0}},{key:"doNotSerialize",get:function(){return["originalFunc"]}}]),e}(),_throttledByName={},_debouncedByName={},_queues={},_queueUntilCallbacks={},_eitherNameRegistry={},fun=Object.freeze({Empty:Empty,K:K,Null:Null,False:False,True:True,notYetImplemented:notYetImplemented,withNull:withNull,all:all,own:own,argumentNames:argumentNames,qualifiedMethodName:qualifiedMethodName,extractBody:extractBody,timeToRun:timeToRun,timeToRunN:timeToRunN$1,delay:delay,throttle:throttle,debounce:debounce,throttleNamed:throttleNamed,debounceNamed:debounceNamed,createQueue:createQueue,workerWithCallbackQueue:workerWithCallbackQueue,composeAsync:composeAsync,compose:compose,waitFor:waitFor,waitForAll:waitForAll,flip:flip,curry:curry,wrap:wrap,binds:binds,getOriginal:getOriginal,wrapperChain:wrapperChain,replaceMethodForOneCall:replaceMethodForOneCall,once:once,either:either,eitherNamed:eitherNamed,evalJS:evalJS,fromString:fromString,asScript:asScript,asScriptOf:asScriptOf,addToObject:addToObject,setLocalVarValue:setLocalVarValue,getVarMapping:getVarMapping,setProperty:setProperty,functionNames:functionNames,localFunctionNames:localFunctionNames,logErrors:logErrors,logCompletion:logCompletion,logCalls:logCalls,traceCalls:traceCalls,webkitStack:webkitStack}),Group=function(){function e(){classCallCheck(this,e)}return createClass(e,[{key:"toArray",value:function(){return this.reduceGroups(function(e,r,n){return e.concat([n])},[])}},{key:"forEach",value:function(e,r){var n=this;return Object.keys(n).forEach(function(t){n[t].forEach(e.bind(r,t))}),n}},{key:"forEachGroup",value:function(e,r){var n=this;return Object.keys(n).forEach(function(t){e.call(r,t,n[t])}),n}},{key:"map",value:function(r,n){var t=new e;return this.forEachGroup(function(e,o){t[e]=o.map(r.bind(n,e))}),t}},{key:"mapGroups",value:function(r,n){var t=new e;return this.forEachGroup(function(e,o){t[e]=r.call(n,e,o)}),t}},{key:"keys",value:function(){return Object.keys(this)}},{key:"reduceGroups",value:function(e,r,n){return this.forEachGroup(function(t,o){r=e.call(n,r,t,o)}),r}},{key:"count",value:function(){return this.reduceGroups(function(e,r,n){return e[r]=n.length,e},{})}}],[{key:"fromArray",value:function(r,n,t){for(var o=new e,i=0,a=r.length;i<a;i++){var u=n.call(t,r[i],i);o[u]||(o[u]=[]),o[u].push(r[i])}return o}},{key:"by",get:function(){return groupBy}}]),e}(),GLOBAL$1="undefined"!=typeof System?System.global:"undefined"!=typeof window?window:global,features$1={from:!!Array.from,filter:!!Array.prototype.filter,find:!!Array.prototype.find,findIndex:!!Array.prototype.findIndex,includes:!!Array.prototype.includes},from=features$1.from?Array.from:function(e){if(!e)return[];if(Array.isArray(e))return e;if(e.toArray)return e.toArray();for(var r=e.length,n=new Array(r);r--;)n[r]=e[r];return n},detect=features$1.find?function(e,r,n){return e.find(r,n)}:function(e,r,n){for(var t,o=0,i=e.length;o<i;o++)if(t=e[o],r.call(n,t,o))return t},findIndex=features$1.findIndex?function(e,r,n){return e.findIndex(r,n)}:function(e,r,n){var t=-1;return e.find(function(e,o){return t=o,r.call(e,n)})?t:-1},isArray$1=Array.isArray,includes$1=features$1.includes?function(e,r){return e.includes(r)}:function(e,r){return e.indexOf(r)!==-1},include$1=includes$1,permutations=function(){function e(r,n){return r.length?flatmap(r,function(t,o){return e(r.slice(0,o).concat(r.slice(o+1)),n.concat([t]))}):[n]}return function(r){return e(r,[])}}();features$1.from||(Array.from=from),features$1.filter||(Array.prototype.filter=function(e,r){return filter(this,e,r)}),features$1.find||(Array.prototype.find=function(e,r){return detect(this,e,r)}),features$1.findIndex||(Array.prototype.findIndex=function(e,r){return findIndex(this,e,r)}),features$1.includes||(Array.prototype.includes=function(e){return includes$1(this,e)});var arr=Object.freeze({range:range,from:from,withN:withN,genN:genN,filter:filter,detect:detect,findIndex:findIndex,findAndGet:findAndGet,filterByKey:filterByKey,grep:grep,mask:mask,reject:reject,rejectByKey:rejectByKey,without:without,withoutAll:withoutAll,uniq:uniq,uniqBy:uniqBy,uniqByKey:uniqByKey,compact:compact,mutableCompact:mutableCompact,forEach:forEach$1,zip:zip,flatten:flatten,flatmap:flatmap,interpose:interpose,delimWith:delimWith,map:map$1,invoke:invoke,pluck:pluck,reduce:reduce,reduceRight:reduceRight,isArray:isArray$1,includes:includes$1,include:include$1,some:some,every:every,equals:equals$2,deepEquals:deepEquals,isSorted:isSorted,sort:sort,sortBy:sortBy,sortByKey:sortByKey,reverse:reverse,reversed:reversed,reMatches:reMatches$1,first:first,last:last,intersect:intersect,union:union,pushAt:pushAt,removeAt:removeAt,remove:remove,pushAll:pushAll$1,pushAllAt:pushAllAt,pushIfNotIncluded:pushIfNotIncluded,replaceAt:replaceAt,clear:clear,isSubset:isSubset,doAndContinue:doAndContinue,nestedDelay:nestedDelay,forEachShowingProgress:forEachShowingProgress,swap:swap,rotate:rotate,groupBy:groupBy,groupByKey:groupByKey,partition:partition,batchify:batchify,toTuples:toTuples,permutations:permutations,combinationsPick:combinationsPick,combinations:combinations,take:take,drop:drop,takeWhile:takeWhile,dropWhile:dropWhile,shuffle:shuffle,max:max,min:min,sum:sum,count:count$1,size:size$1,histogram:histogram,clone:clone$1,toArray:toArray$3,each:each,all:all$1,any:any,collect:collect,findAll:findAll,inject:inject,mapAsyncSeries:mapAsyncSeries,mapAsync:mapAsync}),keys$1=Object.keys,obj=Object.freeze({isArray:isArray$$1,isElement:isElement,isFunction:isFunction,isBoolean:isBoolean,isString:isString,isNumber:isNumber,isUndefined:isUndefined,isRegExp:isRegExp,isObject:isObject,isPrimitive:isPrimitive,isEmpty:isEmpty,equals:equals$1,keys:keys$1,values:values,select:select,dissoc:dissoc,addScript:addScript,extend:extend,clone:clone$$1,extract:extract,inspect:inspect,merge:merge,deepMerge:deepMerge,inherit:inherit,valuesInPropertyHierarchy:valuesInPropertyHierarchy,mergePropertyInHierarchy:mergePropertyInHierarchy,sortKeysWithBeforeAndAfterConstraints:sortKeysWithBeforeAndAfterConstraints,deepCopy:deepCopy,typeStringOf:typeStringOf,shortPrintStringOf:shortPrintStringOf,isMutableType:isMutableType,safeToString:safeToString,asObject:asObject,newKeyIn:newKeyIn}),features={repeat:!!String.prototype.repeat,includes:!!String.prototype.includes,startsWith:!!String.prototype.startsWith,endsWith:!!String.prototype.endsWith},includes$$1=features.includes?function(e,r){return e.includes(r)}:function(e,r){return e.indexOf(r)>-1},include$$1=includes$$1,startsWith=features.startsWith?function(e,r){return e.startsWith(r)}:function(e,r){return 0===e.indexOf(r)},endsWith=features.endsWith?function(e,r){return e.endsWith(r)}:function(e,r){var n=e.length-r.length;return n>=0&&e.lastIndexOf(r)===n},times=features.repeat?function(e,r){return e.repeat(r)}:function(e,r){return r<1?"":new Array(r+1).join(e)},string=Object.freeze({format:format,formatFromArray:formatFromArray,indent:indent,minIndent:minIndent,changeIndent:changeIndent,quote:quote,print:print,printNested:printNested,pad:pad,printTable:printTable,printTree:printTree,toArray:toArray$1,lines:lines,paragraphs:paragraphs,nonEmptyLines:nonEmptyLines,tokens:tokens,tableize:tableize,unescapeCharacterEntities:unescapeCharacterEntities,toQueryParams:toQueryParams,joinPath:joinPath,newUUID:newUUID,createDataURI:createDataURI,hashCode:hashCode,md5:md5,reMatches:reMatches$$1,stringMatch:stringMatch,peekRight:peekRight,peekLeft:peekLeft,lineIndexComputer:lineIndexComputer,lineNumberToIndexesComputer:lineNumberToIndexesComputer,findLineWithIndexInLineRanges:findLineWithIndexInLineRanges,lineRanges:lineRanges,diff:diff,empty:empty,includes:includes$$1,include:include$$1,startsWith:startsWith,startsWithVowel:startsWithVowel,endsWith:endsWith,withDecimalPrecision:withDecimalPrecision,capitalize:capitalize,camelCaseString:camelCaseString,camelize:camelize,truncate:truncate,truncateLeft:truncateLeft,regExpEscape:regExpEscape,succ:succ,digitValue:digitValue,times:times,applyChange:applyChange,applyChanges:applyChanges,levenshtein:levenshtein}),normalRandom=function(e,r){var n,t=!1;return function(e,r){if(t)return t=!1,n*r+e;var o,i,a;do{o=2*Math.random()-1,i=2*Math.random()-1,a=o*o+i*i}while(a>=1||0==a);var u=Math.sqrt(-2*Math.log(a)/a);return n=i*u,t=!0,e+r*o*u}}(),convertLength=function(){function e(r,n){return"cm"===n?r:"mm"===n?.1*r:"in"===n?2.54*r:"px"===n?r*e(1/96,"in"):"pt"===n?r*e(1/72,"in"):"pc"===n?r*e(12,"pt"):void 0}return function r(n,t,o){return t===o?n:"cm"===o?e(n,t):"cm"===t?n/e(1,o):r(r(n,t,"cm"),"cm",o)}}(),num=Object.freeze({random:random,normalRandom:normalRandom,randomSmallerInteger:randomSmallerInteger,humanReadableByteSize:humanReadableByteSize,average:average,median:median,between:between,sort:sort$1,parseLength:parseLength,convertLength:convertLength,roundTo:roundTo,detent:detent,toDegrees:toDegrees,toRadians:toRadians}),properties=Object.freeze({all:all$2,allOwnPropertiesOrFunctions:allOwnPropertiesOrFunctions,own:own$1,forEachOwn:forEachOwn,nameFor:nameFor,values:values$1,ownValues:ownValues,any:any$1,allProperties:allProperties,hash:hash}),dateFormat=function(){var e=function(){var r=function(e,r){for(e=String(e),r=r||2;e.length<r;)e="0"+e;return e};return function(n,t,o){var i=e;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(n)||/\d/.test(n)||(t=n,n=void 0),n=n?new Date(n):new Date,isNaN(n))throw SyntaxError("invalid date");t=String(i.masks[t]||t||i.masks.default),"UTC:"==t.slice(0,4)&&(t=t.slice(4),o=!0);var a=o?"getUTC":"get",u=n[a+"Date"](),c=n[a+"Day"](),s=n[a+"Month"](),l=n[a+"FullYear"](),f=n[a+"Hours"](),p=n[a+"Minutes"](),h=n[a+"Seconds"](),d=n[a+"Milliseconds"](),g=o?0:n.getTimezoneOffset(),y={d:u,dd:r(u),ddd:i.i18n.dayNames[c],dddd:i.i18n.dayNames[c+7],m:s+1,mm:r(s+1),mmm:i.i18n.monthNames[s],mmmm:i.i18n.monthNames[s+12],yy:String(l).slice(2),yyyy:l,h:f%12||12,hh:r(f%12||12),H:f,HH:r(f),M:p,MM:r(p),s:h,ss:r(h),l:r(d,3),L:r(d>99?Math.round(d/10):d),t:f<12?"a":"p",tt:f<12?"am":"pm",T:f<12?"A":"P",TT:f<12?"AM":"PM",Z:o?"UTC":(String(n).match(/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g)||[""]).pop().replace(/[^-+\dA-Z]/g,""),o:(g>0?"-":"+")+r(100*Math.floor(Math.abs(g)/60)+Math.abs(g)%60,4),S:["th","st","nd","rd"][u%10>3?0:(u%100-u%10!=10)*u%10]};return t.replace(/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,function(e){return e in y?y[e]:e.slice(1,e.length-1)})}}();return e.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},e.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},e}(),date=Object.freeze({format:format$1,equals:equals$3,relativeTo:relativeTo});Object.assign(promise,{delay:delay$1,delayReject:delayReject,timeout:timeout,waitFor:waitFor$1,deferred:deferred,convertCallbackFun:convertCallbackFun,convertCallbackFunWithManyArgs:convertCallbackFunWithManyArgs,chain:chain$1,finally:promise_finally}),Object.assign(Path.prototype,{get isPathAccessor(){return!0},fromPath:function(e){return"string"==typeof e&&""!==e&&e!==this.splitter?(this._parts=e.split(this.splitter),this._path=e):Array.isArray(e)?(this._parts=[].concat(e),this._path=e.join(this.splitter)):(this._parts=[],this._path=""),this},setSplitter:function(e){return e&&(this.splitter=e),this},parts:function(){return this._parts},size:function(){return this._parts.length},slice:function(e,r){return Path(this.parts().slice(e,r))},normalizePath:function(){return this._path},isRoot:function(e){return 0===this._parts.length},isIn:function(e){if(this.isRoot())return!0;var r=this.get(e,-1);return r&&r.hasOwnProperty(this._parts[this._parts.length-1])},equals:function(e){return e&&e.isPathAccessor&&this.parts().equals(e.parts())},isParentPathOf:function(e){e=e&&e.isPathAccessor?e:Path(e);for(var r=this.parts(),n=e.parts(),t=0;t<r.length;t++)if(r[t]!=n[t])return!1;return!0},relativePathTo:function(e){return e=Path(e),this.isParentPathOf(e)?e.slice(this.size(),e.size()):void 0},del:function(e){if(this.isRoot())return!1;for(var r=e,n=0;n<this._parts.length-1;n++){var t=this._parts[n];if(!r.hasOwnProperty(t))return!1;r=r[t]}return delete r[this._parts[this._parts.length-1]]},withParentAndKeyDo:function(e,r,n){if(this.isRoot())return n(null,null);for(var t=e,o=0;o<this._parts.length-1;o++){var i=this._parts[o];if(!t.hasOwnProperty(i)||"object"!==_typeof(t[i])&&"function"!=typeof t[i]){if(!r)return n(null,i);t=t[i]={}}else t=t[i]}return n(t,this._parts[this._parts.length-1])},set:function(e,r,n){return this.withParentAndKeyDo(e,n,function(e,n){return e?e[n]=r:void 0})},defineProperty:function(e,r,n){return this.withParentAndKeyDo(e,n,function(e,n){return e?Object.defineProperty(e,n,r):void 0})},get:function(e,r){return(r?this._parts.slice(0,r):this._parts).reduce(function(e,r){return e?e[r]:e},e)},concat:function(e,r){return Path(this.parts().concat(Path(e,r).parts()))},toString:function(){return this.normalizePath()},serializeExpr:function(){return"lively.lang.Path("+inspect(this.parts())+")"},watch:function(e){if(e&&!this.isRoot()){var r=e.target,n=this.get(r,-1),t=this.parts().slice(-1)[0],o="propertyWatcher$"+t,i=n&&n.hasOwnProperty(o),a=e.uninstall,u=(e.haltWhenChanged,e.showStack),c=n.__lookupGetter__(t),s=n.__lookupSetter__(t);if(r&&t&&n){if(a){if(!i)return;delete n[t],n[t]=n[o],delete n[o];var l="Watcher for "+n+"."+t+" uninstalled";return void show(l)}if(i){var l="Watcher for "+n+"."+t+" already installed";return void show(l)}if(c||s){var l=n+'["'+t+'"] is a getter/setter, watching not support';return console.log(l),void("undefined"==typeof show&&show(l))}n[o]=n[t],n.__defineSetter__(t,function(r){var i=n[o];e.onSet&&e.onSet(r,i);var a=n+"."+t+" changed: "+i+" -> "+r;return u&&(a+="\n"+("undefined"!=typeof lively?lively.printStack():console.trace())),e.verbose&&(console.log(a),"undefined"!=typeof show&&show(a)),n[o]=r}),n.__defineGetter__(t,function(){return e.onGet&&e.onGet(n[o]),n[o]});var l="Watcher for "+n+"."+t+" installed";console.log(l),"undefined"!=typeof show&&show(l)}}},debugFunctionWrapper:function(e){var r=e.target,n=this.get(r,-1),t=this.parts().slice(-1)[0],o=e.uninstall,i=(void 0===e.haltWhenChanged||e.haltWhenChanged,e.showStack),a=n&&t&&n[t],u=a&&a.isDebugFunctionWrapper;if(r&&t&&a&&n){if(o){if(!u)return;n[t]=n[t].debugTargetFunction;var c="Uninstalled debugFunctionWrapper for "+n+"."+t;return console.log(c),"undefined"!=typeof show&&show(c),void show(c)}if(u){var c="debugFunctionWrapper for "+n+"."+t+" already installed";return console.log(c),void("undefined"!=typeof show&&show(c))}var s=n[t]=a.wrap(function(r){var o=Array.from(arguments);return i&&show(lively.printStack()),e.verbose&&show(t+" called"),o.shift().apply(n,o)});s.isDebugFunctionWrapper=!0,s.debugTargetFunction=a;var c="debugFunctionWrapper for "+n+"."+t+" installed";console.log(c),"undefined"!=typeof show&&show(c)}}});var graph=Object.freeze({clone:clone$2,without:without$1,hull:hull,subgraphReachableBy:subgraphReachableBy,invert:invert,sortByReference:sortByReference,reduce:reduce$1,random:random$1}),GLOBAL$2="undefined"!=typeof System?System.global:"undefined"!=typeof window?window:global,interval=Object.freeze({isInterval:isInterval,sort:sort$2,compare:compare,coalesce:coalesce,coalesceOverlapping:coalesceOverlapping,mergeOverlapping:mergeOverlapping,intervalsInRangeDo:intervalsInRangeDo,intervalsInbetween:intervalsInbetween,mapToMatchingIndexes:mapToMatchingIndexes}),arrayProjection=Object.freeze({create:create,toArray:toArray$4,originalToProjectedIndex:originalToProjectedIndex,projectedToOriginalIndex:projectedToOriginalIndex,transformToIncludeIndex:transformToIncludeIndex}),grid=Object.freeze({get:get$2,set:set$2,getRow:getRow,setRow:setRow,getCol:getCol,setCol:setCol,create:create$1,mapCreate:mapCreate,forEach:forEach$2,map:map$2,toObjects:toObjects,tableFromObjects:tableFromObjects}),detect$1=find,tree=Object.freeze({prewalk:prewalk,postwalk:postwalk,find:find,detect:detect$1,filter:filter$1,map:map$3,mapTree:mapTree}),isNode$1="undefined"!=typeof process&&process.versions&&process.versions.node,makeEmitter=isNode$1?function(e,r){if(e.on&&e.removeListener)return e;var n="undefined"!=typeof System?System._nodeRequire("events"):require("events");return Object.assign(e,n.EventEmitter.prototype),n.EventEmitter.call(e),r&&r.maxListenerLimit&&e.setMaxListeners(r.maxListenerLimit),e}:function(e){return e.on&&e.removeListener?e:(e.listeners={},e.on=function(r,n){n&&(e.listeners[r]||(e.listeners[r]=[]),e.listeners[r].push(n))},e.once=function(r,n){function t(){e.removeListener(r,t),n.apply(this,arguments)}n&&e.on(r,t)},e.removeListener=function(r,n){e.listeners[r]&&(e.listeners[r]=e.listeners[r].filter(function(e){return e!==n}))},e.removeAllListeners=function(r){e.listeners[r]&&(e.listeners[r]=[])},e.emit=function(){var r=Array.prototype.slice.call(arguments),n=r.shift(),t=e.listeners[n];t&&t.length&&t.forEach(function(e){try{e.apply(null,r)}catch(e){console.error("Error in event handler: %s",e.stack||String(e))}})},e)},events=Object.freeze({makeEmitter:makeEmitter}),OFFLINE="offline",ONLINE="online",messenger=Object.freeze({create:create$2}),isNodejs="undefined"!=typeof require&&"undefined"!=typeof process,WorkerSetup={loadDependenciesBrowser:function(e){var r="undefined"!=typeof self?self:this;importScripts.apply(r,e.scriptsToLoad||[])},loadDependenciesNodejs:function(e){(global.lively||(global.lively={})).lang=require(require("path").join(e.libLocation,"index"))},initBrowserGlobals:function(e){remoteWorker.send=function(e){postMessage(e)};var r="undefined"!=typeof self?self:this,n=r.Global=r;n.window=n,n.console=n.console||function(){var e={};return["log","error","warn"].forEach(function(r){e[r]=function(){for(var e=arguments[0],n=1;n<arguments.length;n++)e=e.replace("%s",arguments[n]);remoteWorker.send({type:r,message:["[",r.toUpperCase(),"] ",e].join("")})}}),e}()},initOnMessageHandler:function(e){function r(e){if(e=e.data.data?e.data:e,remoteWorker.messenger)remoteWorker.messenger.onMessage(e);else if("close"==e.action)return remoteWorker.send({type:"closed",workerReady:!1}),void remoteWorker.close()}remoteWorker.on?remoteWorker.on("message",r):remoteWorker.onmessage=r},initWorkerInterface:function initWorkerInterface(options){remoteWorker.callStringifiedFunction=function(stringifiedFunc,args,thenDo){var func;try{func=eval("("+stringifiedFunc+")")}catch(e){return void thenDo(new Error("Cannot create function from string: "+e.stack||e))}var usesCallback=func.length===args.length+1,whenDone=lively.lang.fun.once(function(e,r){remoteWorker.isBusy=!1,thenDo(e,r)});remoteWorker.isBusy=!0,usesCallback&&args.push(whenDone);try{var result=func.apply(remoteWorker,args.concat([whenDone]))}catch(e){return void whenDone(e,null)}usesCallback||whenDone(null,result)},remoteWorker.httpRequest=function(e){function r(){4===n.readyState&&e.done&&e.done(n)}if(!e.url)return void console.log("Error, httpRequest needs url");var n=new XMLHttpRequest,t=e.method||"GET";n.onreadystatechange=r,n.open(t,e.url),n.send()},remoteWorker.terminateIfNotBusyIn=function(e){setTimeout(function(){if(remoteWorker.isBusy)return void remoteWorker.terminateIfNotBusyIn(e);remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close()},e)}},initWorkerMessenger:function initWorkerMessenger(options){if(!options.useMessenger)return null;if(!lively.lang.messenger)throw new Error("worker.create requires messenger.js to be loaded!");if(!lively.lang.events)throw new Error("worker.create requires events.js to be loaded!");return remoteWorker.messenger=lively.lang.messenger.create({services:{remoteEval:function remoteEval(msg,messenger){var result;try{result=eval(msg.data.expr)}catch(e){result=e.stack||e}messenger.answer(msg,{result:String(result)})},run:function(e,r){var n=e.data.func,t=e.data.args;if(!n)return void r.answer(e,{error:"no funcString"});remoteWorker.callStringifiedFunction(n,t,function(n,t){r.answer(e,{error:n?String(n):null,result:t})})},close:function(e,r){r.answer(e,{status:"OK"}),remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close()}},isOnline:function(){return!0},send:function(e,r){remoteWorker.send(e),r()},listen:function(e){e()},close:function(e){remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close()}})}},BrowserWorker={create:function(e){function r(){self.onmessage=function(e){if("setup"!==e.data.action)throw new Error("expected setup to be first message but got "+JSON.stringify(e.data));var r=e.data.options||{};initBrowserGlobals(r),loadDependenciesBrowser(r),initOnMessageHandler(r),initWorkerInterface(r),initWorkerMessenger(r),postMessage({workerReady:!0})},__FUNCTIONDECLARATIONS__}if(e=e||{},!e.libLocation&&!e.scriptsToLoad){var n=document.querySelector('script[src$="worker.js"]');if(!n)throw new Error('Cannot find library path to start worker. Use worker.create({libLocation: "..."}) to explicitly define the path!');e.libLocation=n.src.replace(/worker.js$/,"")}var t=String(r).replace("__FUNCTIONDECLARATIONS__",[WorkerSetup.initBrowserGlobals,WorkerSetup.loadDependenciesBrowser,WorkerSetup.initOnMessageHandler,WorkerSetup.initWorkerInterface,WorkerSetup.initWorkerMessenger].join("\n")),o="("+t+")();",i=new Worker(function(e){var r;try{r=new Blob([e],{type:"text/javascript"})}catch(n){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,r=new BlobBuilder,r.append(e),r=r.getBlob()}return("undefined"!=typeof webkitURL?webkitURL:URL).createObjectURL(r)}(o));return function(e,r){makeEmitter(r),e.scriptsToLoad||(e.scriptsToLoad=["base.js","events.js","object.js","collection.js","function.js","string.js","number.js","date.js","messenger.js","worker.js"].map(function(r){return e.libLocation+r}));var n=Object.keys(e).reduce(function(r,n){return"function"!=typeof e[n]&&(r[n]=e[n]),r},{});r.onmessage=function(e){void 0!==e.data.workerReady?(r.ready=!!e.data.workerReady,r.ready?r.emit("ready"):r.emit("close")):r.emit("message",e.data)},r.errors=[],r.onerror=function(e){console.error(e),r.errors.push(e),r.emit("error",e)},r.postMessage({action:"setup",options:n})}(e,i),i}},NodejsWorker={debug:!1,initCodeFileCreated:!1,create:function(e){e=e||{};var r,n=makeEmitter({ready:!1,errors:[],postMessage:function(e){return r?n.ready?void r.send(e):void n.emit("error",new Error("nodejs worker process not ready or already closed")):void n.emit("error",new Error("nodejs worker process not yet created"))}});return NodejsWorker.startWorker(e,function(e,t){if(e)return n.ready=!1,void n.emit("error",e);r=t,r.on("message",function(e){NodejsWorker.debug&&console.log("[WORKER PARENT] got message:",e),n.emit("message",e)}),r.on("close",function(){console.log("[WORKER PARENT] worker closed"),n.emit("close")}),r.on("error",function(e){console.log("[WORKER PARENT] error ",e),n.errors.push(e),n.emit("error",e)}),n.ready=!0,n.emit("ready")}),n},workerSetupFunction:function(){var e=process;console.log("[WORKER] Starting init"),e.on("message",function(r){if("setup"!==r.action)throw new Error("expected setup to be first message but got "+JSON.stringify(r.data));e.removeAllListeners("message");var n=r.data.options||{};console.log("[WORKER] running setup with options",n),loadDependenciesNodejs(n),initOnMessageHandler(n),initWorkerInterface(n),initWorkerMessenger(n),e.send({workerReady:!0})}),__FUNCTIONDECLARATIONS__},ensureInitCodeFile:function(e,r,n){var t=require("path"),o=require("os"),i=require("fs"),a=t.join(o.tmpDir(),"lively-nodejs-workers/"),u=t.join(a,"nodejs-worker-init.js");NodejsWorker.initCodeFileCreated?i.exists(u,function(t){t?n(null,u):NodejsWorker.createWorkerCodeFile(e,u,r,n)}):NodejsWorker.createWorkerCodeFile(e,u,r,n)},createWorkerCodeFile:function(e,r,n,t){var o=require("path"),i=require("fs");(0,require("child_process").exec)("mkdir -p "+o.dirname(r),function(e,o,a){if(e)return void t(new Error(["[WORKER PARENT] Could not create worker temp dir:",o,a].join("\n")));i.writeFile(r,n,function(e){NodejsWorker.debug&&console.log("worker code file %s created",r),NodejsWorker.initCodeFileCreated=!0,t(e,r)})})},startWorker:function(e,r){var n=require("util"),t=require("child_process").fork,o=String(NodejsWorker.workerSetupFunction).replace("__FUNCTIONDECLARATIONS__",[WorkerSetup.loadDependenciesNodejs,WorkerSetup.initOnMessageHandler,WorkerSetup.initWorkerInterface,WorkerSetup.initWorkerMessenger].join("\n")),i=n.format("(%s)();\n",o);NodejsWorker.ensureInitCodeFile(e,i,function(n,o){if(n)return r(n);var i=t(o,{});NodejsWorker.debug&&console.log("worker forked"),i.on("message",function(e){"pong"===e.action?console.log("[WORKER pong] ",e):"log"===e.action&&console.log("[Message from WORKER] ",e.data)}),i.once("message",function(e){NodejsWorker.debug&&console.log("worker setup done"),r(null,i,e)}),i.on("close",function(){NodejsWorker.debug&&console.log("[WORKER PARENT] worker closed")}),i.send({action:"setup",data:{options:e}}),global.WORKER=i})}},worker=Object.freeze({fork:fork,create:create$3}),GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:void 0,isNode="undefined"!=typeof process&&process.env&&"function"==typeof process.exit,globalInterfaceSpec=[{action:"installMethods",target:"Array",sources:["arr"],methods:["from","genN","range","withN"]},{action:"installMethods",target:"Array.prototype",sources:["arr"],methods:["all","any","batchify","clear","clone","collect","compact","delimWith","detect","doAndContinue","each","equals","filterByKey","findAll","first","flatten","forEachShowingProgress","grep","groupBy","groupByKey","histogram","include","inject","intersect","invoke","last","mapAsync","mapAsyncSeries","mask","max","min","mutableCompact","nestedDelay","partition","pluck","pushAll","pushAllAt","pushAt","pushIfNotIncluded","reMatches","reject","rejectByKey","remove","removeAt","replaceAt","rotate","shuffle","size","sortBy","sortByKey","sum","swap","toArray","toTuples","union","uniq","uniqBy","without","withoutAll","zip"],alias:[["select","filter"]]},{action:"installMethods",target:"Date",sources:["date"],methods:[]},{action:"installMethods",target:"Date.prototype",sources:["date"],methods:["equals","format","relativeTo"]},{action:"installMethods",target:"Function",sources:["fun"],methods:["fromString"]},{action:"installMethods",target:"Function.prototype",sources:["fun"],methods:["addToObject","argumentNames","asScript","asScriptOf","binds","curry","delay","functionNames","localFunctionNames","getOriginal","getVarMapping","logCalls","logCompletion","logErrors","qualifiedMethodName","setProperty","traceCalls","wrap"]},{action:"installMethods",target:"Number",sources:["num"],methods:[]},{action:"installMethods",target:"Number.prototype",sources:["num"],methods:["detent","randomSmallerInteger","roundTo","toDegrees","toRadians"]},{action:"installMethods",target:"Object",sources:["obj"],methods:["addScript","clone","deepCopy","extend","inherit","isArray","isBoolean","isElement","isEmpty","isFunction","isNumber","isObject","isRegExp","isString","isUndefined","merge","mergePropertyInHierarchy","values","valuesInPropertyHierarchy"]},{action:"installMethods",target:"Object.prototype",sources:["obj"],methods:[]},{action:"installMethods",target:"String.prototype",sources:["string"],methods:["camelize","capitalize","digitValue","empty","hashCode","include","pad","regExpEscape","startsWithVowel","succ","times","toArray","toQueryParams","truncate"]},{action:"installMethods",target:"Function.prototype",sources:["klass"],methods:["create","addMethods","isSubclassOf","superclasses","categoryNameFor","remove"],alias:[["subclass","create"]]},{action:"installObject",target:"Numbers",source:"num",methods:["average","between","convertLength","humanReadableByteSize","median","normalRandom","parseLength","random","sort"]},{action:"installObject",target:"Properties",source:"properties",methods:["all","allOwnPropertiesOrFunctions","allProperties","any","forEachOwn","hash","nameFor","own","ownValues","values"]},{action:"installObject",target:"Strings",source:"string",methods:["camelCaseString","createDataURI","diff","format","formatFromArray","indent","lineIndexComputer","lines","md5","newUUID","nonEmptyLines","pad","paragraphs","peekLeft","peekRight","print","printNested","printTable","printTree","quote","reMatches","stringMatch","tableize","tokens","unescapeCharacterEntities","withDecimalPrecision"]},{action:"installObject",target:"Objects",source:"obj",methods:["asObject","equals","inspect","isMutableType","safeToString","shortPrintStringOf","typeStringOf"]},{action:"installObject",target:"Functions",source:"fun",methods:["all","compose","composeAsync","createQueue","debounce","debounceNamed","either","extractBody","flip","notYetImplemented","once","own","throttle","throttleNamed","timeToRun","timeToRunN","waitFor","workerWithCallbackQueue","wrapperChain"]},{action:"installObject",target:"Grid",source:"grid"},{action:"installObject",target:"Interval",source:"interval"},{action:"installObject",target:"lively.ArrayProjection",source:"arrayProjection"},{action:"installObject",target:"lively.Closure",source:"Closure"},{action:"installObject",target:"lively.Grouping",source:"Group"},{action:"installObject",target:"lively.PropertyPath",source:"Path"},{action:"installObject",target:"lively.Worker",source:"worker"},{action:"installObject",target:"lively.Class",source:"classHelper"}],livelyLang=createLivelyLangObject();exports.worker=worker,exports.messenger=messenger,exports.events=events,exports.tree=tree,exports.grid=grid,exports.arrayProjection=arrayProjection,exports.interval=interval,exports.graph=graph,exports.date=date,exports.properties=properties,exports.obj=obj,exports.arr=arr,exports.fun=fun,exports.num=num,exports.string=string,exports.Closure=Closure,exports.promise=promise,exports.Path=Path,exports.Group=Group,exports.livelyLang=livelyLang,exports.chain=chain$$1,exports.noConflict=noConflict,exports.installGlobals=installGlobals,exports.uninstallGlobals=uninstallGlobals}(this.lively.lang=this.lively.lang||{})}.call(GLOBAL),"undefined"!=typeof module&&module.exports&&(module.exports=GLOBAL.lively.lang)}();