!function(){var GLOBAL="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,lively=GLOBAL.lively=GLOBAL.lively||(GLOBAL.lively={});!function(Global){function createLivelyLangObject(){return{chain:chain,noConflict:noConflict,installGlobals:installGlobals,uninstallGlobals:uninstallGlobals,globalInterfaceSpec:globalInterfaceSpec,deprecatedLivelyPatches:deprecatedLivelyPatches,toString:function(){return"[object lively.lang]"}}}function chain(e){if(!e)return e;if(Array.isArray(e))return createChain(livelyLang.arr,e);if("Date"===e.constructor.name)return createChain(livelyLang.date,e);switch(typeof e){case"string":return createChain(livelyLang.string,e);case"object":return createChain(livelyLang.obj,e);case"function":return createChain(livelyLang.fun,e);case"number":return createChain(livelyLang.num,e)}throw new Error("Chain for object "+e+" ("+e.constructor.name+") no supported")}function createChain(e,r){return Object.keys(e).reduce(function(n,t){return n[t]=function(){var n=Array.prototype.slice.call(arguments),u=e[t].apply(null,[r].concat(n));return chain(u)},n},{value:function(){return r}})}function noConflict(){if(!isNode){var e=livelyLang._prevLivelyGlobal;e?delete Global.lively.lang:delete Global.lively}return livelyLang}function installGlobals(){globalInterfaceSpec.forEach(function(e){if("installMethods"===e.action){var r=livelyLang.Path(e.target);r.isIn(Global)||r.set(Global,{},!0);var n=livelyLang.Path(e.sources[0]);e.methods.forEach(function(e){installProperty(n.concat([e]),r.concat([e]))}),e.alias&&e.alias.forEach(function(e){installProperty(n.concat([e[1]]),r.concat([e[0]]))})}else{if("installObject"!==e.action)throw new Error("Cannot deal with global setup action: "+e.action);var r=livelyLang.Path(e.target),t=livelyLang.Path(e.source).get(livelyLang);r.set(Global,t,!0)}})}function installProperty(e,r){if(!e.isIn(livelyLang)){var n=new Error("property not provided by lively.lang: "+e);throw console.error(n.stack||n),n}var t=e.get(livelyLang);if("function"==typeof t&&"prototype"===r.slice(-2,-1).toString()){var u=t;t=function(){var e=Array.prototype.slice.call(arguments);return e.unshift(this),u.apply(null,e)},t.toString=function(){return u.toString()}}r.set(Global,t,!0)}function uninstallGlobals(){globalInterfaceSpec.forEach(function(e){if("installMethods"===e.action){var r=livelyLang.Path(e.target),n=livelyLang.Path(e.source).get(livelyLang),t=r.get(Global);if(!t)return;e.methods.filter(function(e){return n===t[e]}).forEach(function(e){delete t[e]}),e.alias&&e.alias.filter(function(e){return n===t[e]}).forEach(function(e){delete t[e[0]]})}else{if("installObject"!==e.action)throw new Error("Cannot deal with global setup action: "+e.action);var r=livelyLang.Path(e.target);r.del(Global)}})}function deprecatedLivelyPatches(){livelyLang.installGlobals(),Global.$A=Array.from,Function.evalJS=livelyLang.fun.evalJS=function(src){var fixVars="var Global = typeof System !== 'undefined' ? System.global :\n    typeof window !== 'undefined' ? window :\n    typeof global!=='undefined' ? global :\n    typeof self!=='undefined' ? self : this;\n";return Global.lively&&Global.lively!=lively&&(fixVars+="var lively = Global.lively;\n"),eval(fixVars+src)},livelyLang.Path.type=livelyLang.PropertyPath,livelyLang.Path.prototype.serializeExpr=function(){return"lively.PropertyPath("+livelyLang.obj.inspect(this.parts())+")"},livelyLang.Closure.type="lively.Closure",livelyLang.fun.methodChain=livelyLang.fun.wrapperChain,"undefined"!=typeof JSON&&(JSON.prettyPrint=function(e){return JSON.stringify(e,null,2)}),Global.NativeArrayFunctions=livelyLang.arrNative}var globalInterfaceSpec=[{action:"installMethods",target:"Array",sources:["arr"],methods:["from","genN","range","withN"]},{action:"installMethods",target:"Array.prototype",sources:["arr"],methods:["all","any","batchify","clear","clone","collect","compact","delimWith","detect","doAndContinue","each","equals","filterByKey","findAll","first","flatten","forEachShowingProgress","grep","groupBy","groupByKey","histogram","include","inject","intersect","invoke","last","mapAsync","mapAsyncSeries","mask","max","min","mutableCompact","nestedDelay","partition","pluck","pushAll","pushAllAt","pushAt","pushIfNotIncluded","reMatches","reject","rejectByKey","remove","removeAt","replaceAt","rotate","shuffle","size","sortBy","sortByKey","sum","swap","toArray","toTuples","union","uniq","uniqBy","without","withoutAll","zip"],alias:[["select","filter"]]},{action:"installMethods",target:"Date",sources:["date"],methods:[]},{action:"installMethods",target:"Date.prototype",sources:["date"],methods:["equals","format","relativeTo"]},{action:"installMethods",target:"Function",sources:["fun"],methods:["fromString"]},{action:"installMethods",target:"Function.prototype",sources:["fun"],methods:["addToObject","argumentNames","asScript","asScriptOf","binds","curry","delay","functionNames","localFunctionNames","getOriginal","getVarMapping","logCalls","logCompletion","logErrors","qualifiedMethodName","setProperty","traceCalls","wrap"]},{action:"installMethods",target:"Number",sources:["num"],methods:[]},{action:"installMethods",target:"Number.prototype",sources:["num"],methods:["detent","randomSmallerInteger","roundTo","toDegrees","toRadians"]},{action:"installMethods",target:"Object",sources:["obj"],methods:["addScript","clone","deepCopy","extend","inherit","isArray","isBoolean","isElement","isEmpty","isFunction","isNumber","isObject","isRegExp","isString","isUndefined","merge","mergePropertyInHierarchy","values","valuesInPropertyHierarchy"]},{action:"installMethods",target:"Object.prototype",sources:["obj"],methods:[]},{action:"installMethods",target:"String.prototype",sources:["string"],methods:["camelize","capitalize","digitValue","empty","hashCode","include","pad","regExpEscape","startsWithVowel","succ","times","toArray","toQueryParams","truncate"]},{action:"installMethods",target:"Function.prototype",sources:["klass"],methods:["create","addMethods","isSubclassOf","superclasses","categoryNameFor","remove"],alias:[["subclass","create"]]},{action:"installObject",target:"Numbers",source:"num",methods:["average","between","convertLength","humanReadableByteSize","median","normalRandom","parseLength","random","sort"]},{action:"installObject",target:"Properties",source:"properties",methods:["all","allOwnPropertiesOrFunctions","allProperties","any","forEachOwn","hash","nameFor","own","ownValues","values"]},{action:"installObject",target:"Strings",source:"string",methods:["camelCaseString","createDataURI","diff","format","formatFromArray","indent","lineIndexComputer","lines","md5","newUUID","nonEmptyLines","pad","paragraphs","peekLeft","peekRight","print","printNested","printTable","printTree","quote","reMatches","removeSurroundingWhitespaces","stringMatch","tableize","tokens","unescapeCharacterEntities","withDecimalPrecision"]},{action:"installObject",target:"Objects",source:"obj",methods:["asObject","equals","inspect","isMutableType","safeToString","shortPrintStringOf","typeStringOf"]},{action:"installObject",target:"Functions",source:"fun",methods:["all","compose","composeAsync","createQueue","debounce","debounceNamed","either","extractBody","flip","notYetImplemented","once","own","throttle","throttleNamed","timeToRun","timeToRunN","waitFor","workerWithCallbackQueue","wrapperChain"]},{action:"installObject",target:"Grid",source:"grid"},{action:"installObject",target:"Interval",source:"interval"},{action:"installObject",target:"lively.ArrayProjection",source:"arrayProjection"},{action:"installObject",target:"lively.Closure",source:"Closure"},{action:"installObject",target:"lively.Grouping",source:"Group"},{action:"installObject",target:"lively.PropertyPath",source:"Path"},{action:"installObject",target:"lively.Worker",source:"worker"},{action:"installObject",target:"lively.Class",source:"classHelper"}],isNode="undefined"!=typeof require&&"undefined"!=typeof exports,livelyLang=createLivelyLangObject();if(!isNode||(module.exports=livelyLang,Global.lively))if(livelyLang._prevLivelyGlobal=Global.lively,Global.lively||(Global.lively={}),Global.lively.lang)for(var name in livelyLang)Global.lively.lang[name]=livelyLang[name];else Global.lively.lang=livelyLang}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this),function(e){"use strict";function r(e){if(e&&t.isArray(e))return"["+e.map(r)+"]";if("string"!=typeof e)return String(e);var n=String(e);return n=n.replace(/\n/g,"\\n\\\n"),n=n.replace(/(")/g,"\\$1"),n='"'+n+'"'}function n(e,r,n){if(!n||0>=n)return e;for(;n>0;)n--,e=r+e;return e}var t=e.obj={isArray:function(e){return e&&Array.isArray(e)},isElement:function(e){return e&&1==e.nodeType},isFunction:function(e){return e instanceof Function},isBoolean:function(e){return"boolean"==typeof e},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isUndefined:function(e){return"undefined"==typeof e},isRegExp:function(e){return e instanceof RegExp},isObject:function(e){return"object"==typeof e},isPrimitive:function(e){if(!e)return!0;switch(typeof e){case"string":case"number":case"boolean":return!0}return!1},isEmpty:function(e){for(var r in e)if(e.hasOwnProperty(r))return!1;return!0},equals:function(r,n){if(r===n)return!0;if(!r&&!n)return!0;if(!r||!n)return!1;if(Array.isArray(r))return e.arr.deepEquals(r,n);switch(r.constructor){case String:case Date:case Boolean:case Number:return r==n}if("function"==typeof r.isEqualNode)return r.isEqualNode(n);if("function"==typeof r.equals)return r.equals(n);var u=[];for(var o in r)if(u.push(o),"function"!=typeof r[o]&&!t.equals(r[o],n[o]))return!1;for(var o in n)if(-1===u.indexOf(o)&&"function"!=typeof n[o]&&!t.equals(n[o],r[o]))return!1;return!0},keys:Object.keys||function(e){var r=[];for(var n in e)r.push(n);return r},values:function(e){return e?Object.keys(e).map(function(r){return e[r]}):[]},select:function(e,r){for(var n={},t=0;t<r.length;t++)n[r[t]]=e[r[t]];return n},dissoc:function(e,r){var n={};for(var t in e)e.hasOwnProperty(t)&&-1===r.indexOf(t)&&(n[t]=e[t]);return n},addScript:function(r,n,t,u){var o=e.fun.fromString(n);return e.fun.asScriptOf(o,r,t,u)},extend:function(e,r){for(var n=null,t=1;t<arguments.length;t++)if("string"!=typeof arguments[t]){var r=arguments[t];for(var u in r){var o=r.__lookupGetter__(u),a=r.__lookupSetter__(u);if(o&&e.__defineGetter__(u,o),a&&e.__defineSetter__(u,a),!o&&!a){var i=r[u];e[u]=i,n&&n.push(u),"function"==typeof i&&(i.displayName||(i.displayName=u),"undefined"!=typeof lively&&lively.Module&&lively.Module.current&&(i.sourceModule=lively.Module.current()))}}}else{var c=arguments[t];e.categories||(e.categories={}),e.categories[c]||(e.categories[c]=[]),n=e.categories[c]}return e},clone:function(e){if(t.isPrimitive(e))return e;if(Array.isArray(e))return Array.prototype.slice.call(e);var r={};for(var n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);return r},extract:function(e,r,n){for(var t={},u=0;u<r.length;u++)r[u]in e&&(t[r[u]]=n?n(r[u],e[r[u]]):e[r[u]]);return t},inspect:function o(t,u,a){if(u=u||{},a=a||0,u.customPrinter){var i=u._ignoreSignal||(u._ignoreSignal={}),c=u.customPrinter(t,i);if(c!==i)return c}if(!t)return r(t);if("function"==typeof t)return u.printFunctionSource?String(t):"function"+(t.name?" "+t.name:"")+"("+e.fun.argumentNames(t).join(",")+") {/*...*/}";switch(t.constructor){case String:case Boolean:case RegExp:case Number:return r(t)}if("function"==typeof t.serializeExpr)return t.serializeExpr();var s=t&&Array.isArray(t),l=s?"[":"{",f=s?"]":"}";if(u.maxDepth&&a>=u.maxDepth)return l+"/*...*/"+f;var d=[];if(d=s?t.map(function(e){return o(e,u,a+1)}):Object.keys(t).sort(function(e,r){var n="function"==typeof t[e],u="function"==typeof t[r];return n===u?r>e?-1:e>r?1:0:n?1:-1}).map(function(r,n){s&&o(t[r],u,a+1);var i=o(t[r],u,a+1);return u.escapeKeys?e.string.print(r):r+": "+i}),0===d.length)return l+f;var p=d.join(", "),h=(!s||u.newLineInArrays)&&(!u.minLengthForNewLine||p.length>=u.minLengthForNewLine),g=n("",u.indent||"  ",a),y=n("",u.indent||"  ",a+1),v=h&&!s?"\n"+y:"",m=h?"\n"+y:"",b=h&&!s?"\n"+g:"";return h&&(p=d.join(","+m)),l+v+p+b+f},merge:function(e){return arguments.length>1?t.merge(Array.prototype.slice.call(arguments)):Array.isArray(e[0])?Array.prototype.concat.apply([],e):e.reduce(function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);return e},{})},deepMerge:function(e,r){if(!e)return r;if(!r)return e;if(Array.isArray(e)){if(!Array.isArray(r))return r;var n=e.map(function(e,n){return t.deepMerge(e,r[n])});return r.length>e.length&&(n=n.concat(r.slice(e.length))),n}return"object"!=typeof e||"object"!=typeof r?r:Object.keys(e).concat(Object.keys(r)).reduce(function(n,u){return e[u]?r[u]?"object"!=typeof e[u]||"object"!=typeof r[u]?n[u]=r[u]:n[u]=t.deepMerge(e[u],r[u]):n[u]=e[u]:n[u]=r[u],n},{})},inherit:function(e){return Object.create(e)},valuesInPropertyHierarchy:function(e,r){for(var n=[],t=e;t;)t.hasOwnProperty(r)&&n.unshift(t[r]),t=Object.getPrototypeOf(t);return n},mergePropertyInHierarchy:function(e,r){return this.merge(this.valuesInPropertyHierarchy(e,r))},deepCopy:function(e){if(!e||"object"!=typeof e||e instanceof RegExp)return e;var r=Array.isArray(e)?Array(e.length):{};for(var n in e)e.hasOwnProperty(n)&&(r[n]=t.deepCopy(e[n]));return r},typeStringOf:function(e){return null===e?"null":"undefined"==typeof e?"undefined":e.constructor.name},shortPrintStringOf:function(e){function r(e,r,t,u){e.constructor.name===r&&(n+=t,(e.length||Object.keys(e).length)&&(n+="..."),n+=u)}if(!this.isMutableType(e))return this.safeToString(e);if("Object"!==e.constructor.name&&!Array.isArray(e)&&e.constructor.name)return e.constructor.name?e.constructor.name:Object.prototype.toString.call(e).split(" ")[1].split("]")[0];var n="";return r(e,"Object","{","}"),r(e,"Array","[","]"),n},isMutableType:function(e){var r=["null","undefined","Boolean","Number","String"];return-1===r.indexOf(this.typeStringOf(e))},safeToString:function(e){try{return(e?e.toString():String(e)).replace("\n","")}catch(r){return"<error printing object>"}},asObject:function(e){switch(typeof e){case"string":return new String(e);case"boolean":return new Boolean(e);case"number":return new Number(e);default:return e}}},u=(e.properties={all:function(e,r){var n=[];for(var t in e)!e.__lookupGetter__(t)&&"function"==typeof e[t]||(r?!r(t,e):0)||n.push(t);return n},allOwnPropertiesOrFunctions:function(e,r){return Object.getOwnPropertyNames(e).reduce(function(n,t){return(r?r(e,t):!0)&&n.push(t),n},[])},own:function(e){var r=[];for(var n in e)e.hasOwnProperty(n)&&(e.__lookupGetter__(n)||"function"!==e[n])&&r.push(n);return r},forEachOwn:function(e,r,n){var t=[];for(var u in e)if(e.hasOwnProperty(u)){var o=e[u];"function"!==o&&t.push(r.call(n||this,u,o))}return t},nameFor:function(e,r){for(var n in e)if(e[n]===r)return n},values:function(e){var r=[];for(var n in e)r.push(e[n]);return r},ownValues:function(e){var r=[];for(var n in e)e.hasOwnProperty(n)&&r.push(e[n]);return r},any:function(e,r){for(var n in e)if(r(e,n))return!0;return!1},allProperties:function(e,r){var n=[];for(var t in e)(r?r(e,t):!0)&&n.push(t);return n},hash:function(e){return Object.keys(e).sort().join("").hashCode()}},e.Path=function a(e,r){return e instanceof a?e:this instanceof a?(r&&this.setSplitter(r),this.fromPath(e)):new a(e,r)});t.extend(u,{superclass:Object,type:"Path",categories:{}}),t.extend(u.prototype,{isPathAccessor:!0,splitter:".",fromPath:function(e){return t.isString(e)&&""!==e&&e!==this.splitter?(this._parts=e.split(this.splitter),this._path=e):t.isArray(e)?(this._parts=[].concat(e),this._path=e.join(this.splitter)):(this._parts=[],this._path=""),this},setSplitter:function(e){return e&&(this.splitter=e),this},parts:function(){return this._parts},size:function(){return this._parts.length},slice:function(e,r){return u(this.parts().slice(e,r))},normalizePath:function(){return this._path},isRoot:function(e){return 0===this._parts.length},isIn:function(e){if(this.isRoot())return!0;var r=this.get(e,-1);return r&&r.hasOwnProperty(this._parts[this._parts.length-1])},equals:function(e){return e&&e.isPathAccessor&&this.parts().equals(e.parts())},isParentPathOf:function(e){e=e&&e.isPathAccessor?e:u(e);for(var r=this.parts(),n=e.parts(),t=0;t<r.length;t++)if(r[t]!=n[t])return!1;return!0},relativePathTo:function(e){return e=u(e),this.isParentPathOf(e)?e.slice(this.size(),e.size()):void 0},del:function(e){if(this.isRoot())return!1;for(var r=e,n=0;n<this._parts.length-1;n++){var t=this._parts[n];if(!r.hasOwnProperty(t))return!1;r=r[t]}return delete r[this._parts[this._parts.length-1]]},withParentAndKeyDo:function(e,r,n){if(this.isRoot())return n(null,null);for(var t=e,u=0;u<this._parts.length-1;u++){var o=this._parts[u];if(!t.hasOwnProperty(o)||"object"!=typeof t[o]&&"function"!=typeof t[o]){if(!r)return n(null,o);t=t[o]={}}else t=t[o]}return n(t,this._parts[this._parts.length-1])},set:function(e,r,n){return this.withParentAndKeyDo(e,n,function(e,n){return e?e[n]=r:void 0})},defineProperty:function(e,r,n){return this.withParentAndKeyDo(e,n,function(e,n){return e?Object.defineProperty(e,n,r):void 0})},get:function(e,r){var n=r?this._parts.slice(0,r):this._parts;return n.reduce(function(e,r){return e?e[r]:e},e)},concat:function(e,r){return u(this.parts().concat(u(e,r).parts()))},toString:function(){return this.normalizePath()},serializeExpr:function(){return"Path("+t.inspect(this.parts())+")"},watch:function(e){if(e&&!this.isRoot()){var r=e.target,n=this.get(r,-1),t=this.parts().slice(-1)[0],u="propertyWatcher$"+t,o=n&&n.hasOwnProperty(u),a=e.uninstall,i=(e.haltWhenChanged,e.showStack),c=n.__lookupGetter__(t),s=n.__lookupSetter__(t);if(r&&t&&n){if(a){if(!o)return;delete n[t],n[t]=n[u],delete n[u];var l="Watcher for "+n+"."+t+" uninstalled";return void show(l)}if(o){var l="Watcher for "+n+"."+t+" already installed";return void show(l)}if(c||s){var l=n+'["'+t+'"] is a getter/setter, watching not support';return console.log(l),void("undefined"==typeof show&&show(l))}n[u]=n[t],n.__defineSetter__(t,function(r){var o=n[u];e.onSet&&e.onSet(r,o);var a=n+"."+t+" changed: "+o+" -> "+r;return i&&(a+="\n"+("undefined"!=typeof lively?lively.printStack():console.trace())),e.verbose&&(console.log(a),"undefined"!=typeof show&&show(a)),n[u]=r}),n.__defineGetter__(t,function(){return e.onGet&&e.onGet(n[u]),n[u]});var l="Watcher for "+n+"."+t+" installed";console.log(l),"undefined"!=typeof show&&show(l)}}},debugFunctionWrapper:function(e){var r=e.target,n=this.get(r,-1),t=this.parts().slice(-1)[0],u=e.uninstall,o=(void 0===e.haltWhenChanged?!0:e.haltWhenChanged,e.showStack),a=n&&t&&n[t],i=a&&a.isDebugFunctionWrapper;if(r&&t&&a&&n){if(u){if(!i)return;n[t]=n[t].debugTargetFunction;var c="Uninstalled debugFunctionWrapper for "+n+"."+t;return console.log(c),"undefined"!=typeof show&&show(c),void show(c)}if(i){var c="debugFunctionWrapper for "+n+"."+t+" already installed";return console.log(c),void("undefined"!=typeof show&&show(c))}var s=n[t]=a.wrap(function(r){var u=Array.from(arguments);return o&&show(lively.printStack()),e.verbose&&show(t+" called"),u.shift().apply(n,u)});s.isDebugFunctionWrapper=!0,s.debugTargetFunction=a;var c="debugFunctionWrapper for "+n+"."+t+" installed";console.log(c),"undefined"!=typeof show&&show(c)}}})}("undefined"!=typeof lively&&lively.lang?lively.lang:{}),function(exports){"use strict";var isNode="undefined"!=typeof process&&process.versions&&process.versions.node,Global="undefined"!=typeof window?window:global,classHelper=exports.classHelper={anonymousCounter:0,defaultCategoryName:"default category",initializerTemplate:"undefined"!=typeof lively&&lively.Config&&lively.Config.loadRewrittenCode?function(){classHelper.initializer.apply(this,arguments)}.toStringRewritten().replace(/__0/g,"Global").replace(/__1/g,"__1"):function(){classHelper.initializer.apply(this,arguments)}.toString(),newInitializer:function(name){var src=classHelper.initializerTemplate.replace(/function\s*(CLASS)?\(\)/,"function "+name+"()");if("undefined"!=typeof lively&&lively.Config&&lively.Config.loadRewrittenCode){var idx=src.match(".*storeFrameInfo([^)]*, ([0-9]+))")[2];src='__createClosure("core/lively/Base.js", '+idx+", Global, "+src+");"}else src+=" "+name;var initializer=eval(src);return initializer.displayName=name,initializer},initializer:function(){var e=arguments[0];e&&e.isInstanceRestorer||this.initialize.apply(this,arguments)},isValidIdentifier:function(){var e=/^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc][$A-Z\_a-z\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc0-9\u0300-\u036f\u0483-\u0487\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u0669\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u06f0-\u06f9\u0711\u0730-\u074a\u07a6-\u07b0\u07c0-\u07c9\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0859-\u085b\u08e4-\u08fe\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u0966-\u096f\u0981-\u0983\u09bc\u09be-\u09c4\u09c7\u09c8\u09cb-\u09cd\u09d7\u09e2\u09e3\u09e6-\u09ef\u0a01-\u0a03\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a66-\u0a71\u0a75\u0a81-\u0a83\u0abc\u0abe-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ae2\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b3c\u0b3e-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b66-\u0b6f\u0b82\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c3e-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0cbc\u0cbe-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0ce6-\u0cef\u0d02\u0d03\u0d3e-\u0d44\u0d46-\u0d48\u0d4a-\u0d4d\u0d57\u0d62\u0d63\u0d66-\u0d6f\u0d82\u0d83\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0e50-\u0e59\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0ed0-\u0ed9\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e\u0f3f\u0f71-\u0f84\u0f86\u0f87\u0f8d-\u0f97\u0f99-\u0fbc\u0fc6\u102b-\u103e\u1040-\u1049\u1056-\u1059\u105e-\u1060\u1062-\u1064\u1067-\u106d\u1071-\u1074\u1082-\u108d\u108f-\u109d\u135d-\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b4-\u17d3\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u18a9\u1920-\u192b\u1930-\u193b\u1946-\u194f\u19b0-\u19c0\u19c8\u19c9\u19d0-\u19d9\u1a17-\u1a1b\u1a55-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1b00-\u1b04\u1b34-\u1b44\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1b82\u1ba1-\u1bad\u1bb0-\u1bb9\u1be6-\u1bf3\u1c24-\u1c37\u1c40-\u1c49\u1c50-\u1c59\u1cd0-\u1cd2\u1cd4-\u1ce8\u1ced\u1cf2-\u1cf4\u1dc0-\u1de6\u1dfc-\u1dff\u200c\u200d\u203f\u2040\u2054\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2cef-\u2cf1\u2d7f\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua620-\ua629\ua66f\ua674-\ua67d\ua69f\ua6f0\ua6f1\ua802\ua806\ua80b\ua823-\ua827\ua880\ua881\ua8b4-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f1\ua900-\ua909\ua926-\ua92d\ua947-\ua953\ua980-\ua983\ua9b3-\ua9c0\ua9d0-\ua9d9\uaa29-\uaa36\uaa43\uaa4c\uaa4d\uaa50-\uaa59\uaa7b\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uaaeb-\uaaef\uaaf5\uaaf6\uabe3-\uabea\uabec\uabed\uabf0-\uabf9\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\uff10-\uff19\uff3f]*$/;return function(r){return e.test(r)}}(),isClass:function(e){return e===Object||e===Array||e===Function||e===String||e===Boolean||e===Date||e===RegExp||e===Number?!0:e instanceof Function&&void 0!==e.superclass},className:function(e){return e===Object?"Object":e===Array?"Array":e===Function?"Function":e===String?"String":e===Boolean?"Boolean":e===Date?"Date":e===RegExp?"RegExp":e===Number?"Number":e.type;
},forName:function(e){var r=classHelper.namespaceFor(e),n=classHelper.unqualifiedNameFor(e);return r[n]},deleteObjectNamed:function(e){var r=classHelper.namespaceFor(e),n=classHelper.unqualifiedNameFor(e);delete r[n]},unqualifiedNameFor:function(e){var r=e.lastIndexOf("."),n=e.substring(r+1);if(!classHelper.isValidIdentifier(n))throw new Error("not a name "+n);return n},namespaceFor:function(e){var r=e?e.lastIndexOf("."):-1;if(0>r)return Global;var n=e.slice(0,r);if("undefined"!=typeof lively&&lively.module)return lively.module(n);var t=exports.Path(n),u=t.get(Global);return u||t.set(Global,{},!0)},withAllClassNames:function(e,r){for(var n in e)try{classHelper.isClass(e[n])&&r(n)}catch(t){}r("Object"),r("Global")},getConstructor:function(e){var r=e.constructor;return r&&r.getOriginal?r.getOriginal():r},getPrototype:function(e){return this.getConstructor(e).prototype},applyPrototypeMethod:function(e,r,n){var t=this.getPrototype(r);if(!t)throw new Error("method "+e+" not found");return t.apply(this,n)},getSuperConstructor:function(e){return this.getConstructor(e).superclass},getSuperPrototype:function(e){var r=this.getSuperConstructor(e);return r&&r.prototype},addPins:function(e,r){function n(e){return e.replace(/[\+|\-]?(.*)/,"$1")}function t(e){return!exports.string.startsWith(e,"-")}function u(e){return!exports.string.startsWith(e,"+")}if(Global.Relay)return void classHelper.addMixin(e,Relay.newDelegationMixin(r).prototype);if(!Object.isArray(r))throw new Error("Cannot deal with non-Array spec in addPins");var o={};r.forEach(function(e){var r=n(e);t(e)&&(o["set"+r]=function(e){return this["_"+r]=e}),u(e)&&(o["get"+r]=function(){return this["_"+r]})}),classHelper.addMixin(e,o)},addMixin:function(e,r){var n={};for(var t in r){var u=r[t];switch(t){case"constructor":case"initialize":case"deserialize":case"copyFrom":case"toString":case"definition":case"description":break;default:void 0===e.prototype[t]&&(n[t]=u)}}e.addMethods(n)}};exports.klass=exports["class"]={create:function(){var e,r=exports.arr.from(arguments),n=r.shift(),t=Global,u=null;n&&"string"!=typeof n?e=r.shift():(e=n,n=Object),e?(t=classHelper.namespaceFor(e),u=classHelper.unqualifiedNameFor(e)):(u="anonymous_"+classHelper.anonymousCounter++,e=u);var o;if(e&&t[u]&&t[u].superclass===n)o=t[u];else{o=classHelper.newInitializer(u),o.superclass=n;var a=function(){};a.prototype=n.prototype,o.prototype=new a,o.prototype.constructor=o,o.type=e,o.displayName=e,e&&(t[u]=o),"undefined"!=typeof lively&&lively.Module&&lively.Module.current&&(o.sourceModule=lively.Module.current()),o.toString=function(){var e=exports.arr.detect(Object.keys(o.categories||{}),function(e){return o.categories[e].indexOf("initialize")>-1})||"default category";return exports.string.format('lively.lang.class.create(%s, "%s",\n"%s", {\n  initialize: %s\n}/*...*/)',o.superclass.type||o.superclass.name,o.type,e,o.prototype.initialize)}}return exports.klass.addMethods.apply(Global,[o].concat(r)),o.prototype.initialize||(o.prototype.initialize=function(){}),o},addMethods:function(){for(var e=arguments[0],r=arguments,n=classHelper.defaultCategoryName,t=[],u=1;u<r.length;u++)"string"==typeof r[u]?n=r[u]:Global.RealTrait&&r[u]instanceof RealTrait?t.push(r[u]):exports.klass.addCategorizedMethods(e,n,r[u]instanceof Function?r[u]():r[u]);for(u=0;u<t.length;u++)t[u].applyTo(e);return e},addCategorizedMethods:function(e,r,n){e.categories||(e.categories={}),e.categories[r]||(e.categories[r]=[]);var t=e.categories[r];if(!n)throw dbgOn(new Error("no source in addCategorizedMethods!"));var u=e.superclass&&e.superclass.prototype,o=e.type||"Anonymous";for(var a in n)if("constructor"!==a){var i=n.__lookupGetter__(a);i&&e.prototype.__defineGetter__(a,i);var c=n.__lookupSetter__(a);if(c&&e.prototype.__defineSetter__(a,c),!i&&!c){t.push(a);var s=n[a],l=u&&"function"==typeof s&&"$super"==exports.fun.argumentNames(s)[0];if(l&&!function(){var r=s,n=function(e){var r=function(){var r=u[e];if(!r)throw new Error(exports.string.format("Trying to call super of%s>>%s but super method non existing in %s",o,e,u.constructor.type));return r.apply(this,arguments)};return r.varMapping={ancestor:u,m:e},r.isSuperCall=!0,r}(a);n.methodName="$super:"+(e.superclass?e.superclass.type+">>":"")+a,s=exports.obj.extend(exports.fun.wrap(n,r),{valueOf:function(){return r},toString:function(){return r.toString()},originalFunction:r,methodName:n.methodName,isSuperWrapper:!0}),r.varMapping={$super:n}}(),e.prototype[a]=s,"formals"===a)classHelper.addPins(e,s);else if("function"==typeof s)for(s.displayName=o+"$"+a,"undefined"!=typeof lively&&lively.Module&&lively.Module.current&&(s.sourceModule=lively.Module.current());s;s=s.originalFunction)s.declaredClass=e.prototype.constructor.type,s.methodName=a}}return e},addProperties:function(e,r,n){classHelper.addMixin(e,n.prototype.create(r).prototype)},isSubclassOf:function(e,r){return exports.klass.superclasses(e).indexOf(r)>-1},superclasses:function(e){return e.superclass?e.superclass===Object?[Object]:exports.klass.superclasses(e.superclass).concat([e.superclass]):[]},categoryNameFor:function(e,r){for(var n in e.categories)if(e.categories[n].indexOf(r)>-1)return n;return null},remove:function(e){var r=classHelper.namespaceFor(e.type),n=classHelper.unqualifiedNameFor(e.type);delete r[n]}}}("undefined"!=typeof lively&&lively.lang?lively.lang:{}),function(e){"use strict";var r={from:!!Array.from,filter:!!Array.prototype.filter,find:!!Array.prototype.find,findIndex:!!Array.prototype.findIndex,includes:!!Array.prototype.includes},n=e.arr={range:function(e,r,n){n=n||0;var t=[];if(r>=e){0>=n&&(n=-n||1);for(var u=e;r>=u;u+=n)t.push(u)}else{n>=0&&(n=-n||-1);for(var u=e;u>=r;u+=n)t.push(u)}return t},from:r.from?Array.from:function(e){if(!e)return[];if(Array.isArray(e))return e;if(e.toArray)return e.toArray();for(var r=e.length,n=new Array(r);r--;)n[r]=e[r];return n},withN:function(e,r){for(var n=new Array(e);e>0;)n[--e]=r;return n},genN:function(e,r){for(var n=new Array(e);e>0;)n[--e]=r(e);return n},filter:function(e,r,n){return e.filter(r,n)},detect:r.find?function(e,r,n){return e.find(r,n)}:function(e,r,n){for(var t,u=0,o=e.length;o>u;u++)if(t=e[u],r.call(n,t,u))return t},findIndex:r.findIndex?function(e,r,n){return e.findIndex(r,n)}:function(e,r,n){var t=-1;return e.find(function(e,u){return t=u,r.call(e,n)})?t:-1},findAndGet:function(e,r){var n;return e.find(function(e,t){return n=r(e,t)}),n},filterByKey:function(e,r){return e.filter(function(e){return!!e[r]})},grep:function(e,r,n){return"string"==typeof r&&(r=new RegExp(r,"i")),e.filter(r.test.bind(r))},mask:function(e,r){return e.filter(function(e,n){return!!r[n]})},reject:function(e,r,n){function t(e,t){return!r.call(n,e,t)}return e.filter(t)},rejectByKey:function(e,r){return e.filter(function(e){return!e[r]})},without:function(e,r){return e.filter(function(e){return e!==r})},withoutAll:function(e,r){return e.filter(function(e){return-1===r.indexOf(e)})},uniq:function(e,r){return e.reduce(function(e,t,u){return(0===u||(r?n.last(e)!=t:-1===e.indexOf(t)))&&e.push(t),e},[])},uniqBy:function(e,r,t){for(var u=n.clone(e),o=0;o<u.length;o++)for(var a=e[o],i=o+1;i<u.length;i++)r.call(t,a,u[i])&&(n.removeAt(u,i),i--);return u},compact:function(e){return e.filter(function(e){return!!e})},mutableCompact:function(e){for(var r=0,n=0,t=e.length;t>r;)e.hasOwnProperty(r)&&(e[n++]=e[r]),r++;for(;n++<t;)e.pop();return e},forEach:function(e,r,n){return e.forEach(r,n)},zip:function(){var e=Array.from(arguments),r=e.shift(),t="function"==typeof n.last(e)?e.pop():function(e){return e},u=[r].concat(e).map(function(e){return Array.from(e)});return r.map(function(e,r){return t(n.pluck(u,r),r)})},flatten:function i(e,r){if("number"==typeof r){if(0>=r)return e;r--}return e.reduce(function(e,n){return e.concat(Array.isArray(n)?i(n,r):[n])},[])},flatmap:function(e,r,n){for(var t=[],u=0;u<e.length;u++)t.push.apply(t,r.call(n,e[u],u));return t},interpose:function(e,r){return e.reduce(function(e,n){return e.length>0&&e.push(r),e.push(n),e},[])},delimWith:function(e,r){return n.interpose(e,r)},map:function(e,r,n){return e.map(r,n)},invoke:function(e,r,n,t,u,o,a,i){return e.map(function(e){return e[r](n,t,u,o,a,i)})},pluck:function(e,r){return e.map(function(e){return e[r]})},reduce:function(e,r,n,t){return e.reduce(r,n,t)},reduceRight:function(e,r,n,t){return e.reduceRight(r,n,t)},isArray:Array.isArray,include:r.includes?function(e,r){return e.includes(r)}:function(e,r){return-1!==e.indexOf(r)},some:function(e,r,n){return e.some(r,n)},every:function(e,r,n){return e.every(r,n)},equals:function(e,r){var n=e.length;if(!r||n!==r.length)return!1;for(var t=0;n>t;t++){if(e[t]&&r[t]&&e[t].equals&&r[t].equals){if(e[t].equals(r[t]))continue;return!1}if(e[t]!=r[t])return!1}return!0},deepEquals:function(r,n){var t=r.length;if(!n||t!==n.length)return!1;for(var u=0;t>u;u++)if(!e.obj.equals(r[u],n[u]))return!1;return!0},isSorted:function(e,r){for(var t=1;t<e.length;t++){if(!r&&n[t-1]>n[t])return!1;if(r&&n[t-1]<n[t])return!1}},sort:function(e,r){return e.sort(r)},sortBy:function(e,r,t){return n.pluck(e.map(function(e,n){return{value:e,criteria:r.call(t,e,n)}}).sort(function(e,r){var n=e.criteria,t=r.criteria;return t>n?-1:n>t?1:0}),"value")},sortByKey:function(e,r){return n.sortBy(e,function(e){return e[r]})},reverse:function(e){return e.reverse()},reversed:function(e){return n.clone(e).reverse()},reMatches:function(e,r,n){return n=n||String,e.map(function(e){return n(e).match(r)})},first:function(e){return e[0]},last:function(e){return e[e.length-1]},intersect:function(e,r){return n.uniq(e).filter(function(e){return r.indexOf(e)>-1})},union:function(e,r){for(var t=n.clone(e),u=0;u<r.length;u++){var o=r[u];-1===t.indexOf(o)&&t.push(o)}return t},pushAt:function(e,r,n){e.splice(n,0,r)},removeAt:function(e,r){e.splice(r,1)},remove:function(e,r){var t=e.indexOf(r);return t>=0&&n.removeAt(e,t),r},pushAll:function(e,r){return e.push.apply(e,r),e},pushAllAt:function(e,r,n){e.splice.apply(e,[n,0].concat(r))},pushIfNotIncluded:function(e,r){e.includes(r)||e.push(r)},replaceAt:function(e,r,n){e.splice(n,1,r)},clear:function(e){return e.length=0,e},doAndContinue:function(e,r,n,t){return n=n||Functions.Null,t=t||("undefined"!=typeof window?window:global),r=r||function(e,r,n){r.call(t,e,n)},e.reduceRight(function(e,n,u){return function(){r.call(t,e,n,u)}},n)()},nestedDelay:function(e,r,n,t,u,o){return t=t||function(){},e.clone().reverse().reduce(function(e,t,a){return function(){r.call(u||("undefined"!=typeof window?window:global),t,a),o&&a%o!==0?e():e.delay(n)}},t)()},forEachShowingProgress:function(){var e,r,n,t,u,o=Array.from(arguments),a=o.shift(),i=a.length,c=!1;if(1===o.length?(e=o[0].progressBar,r=o[0].iterator,n=o[0].labelFunction,t=o[0].whenDone,u=o[0].context):(e=o[0],r=o[1],n=o[2],t=o[3],u=o[4]),u||(u="undefined"!=typeof window?window:global),n||(n=function(e){return e}),!e){c=!0;var s="undefined"!=typeof window?window:global,l=s.lively&&lively.morphic&&lively.morphic.World.current();e=l?l.addProgressBar():{setValue:function(e){},setLabel:function(){},remove:function(){}}}return e.setValue(0),a.reduceRight(function(t,o,a){return function(){try{e.setValue(a/i),n&&e.setLabel(n.call(u,o,a)),r.call(u,o,a)}catch(c){console.error("Error in forEachShowingProgress at %s (%s)\n%s\n%s",a,o,c,c.stack)}t.delay(0)}},function(){e.setValue(1),c&&function(){e.remove()}.delay(0),t&&t.call(u)})(),a},swap:function(e,r,n){0>r&&(r=e.length+r),0>n&&(n=e.length+n);var t=e[r];return e[r]=e[n],e[n]=t,e},rotate:function(e,r){return r=r||1,e.slice(r).concat(e.slice(0,r))},groupBy:function(e,r,n){return t.fromArray(e,r,n)},groupByKey:function(e,r){return n.groupBy(e,function(e){return e[r]})},partition:function(e,r,n){r=r||function(e){return e};var t=[],u=[];return e.forEach(function(e,o){(r.call(n,e,o)?t:u).push(e)}),[t,u]},batchify:function(e,r,n){function t(e,u){if(!u.length)return[e,[]];var o=u[0],a=u.slice(1),i=e.concat([o]);if(r.call(n,i))return t(i,a);var c=t(e,a);return[c[0],[o].concat(c[1])]}function u(e,r){if(!r.length)return e;var n=t([],r);if(!n[0].length)throw new Error("Batchify constrained does not ensure consumption of at least one item per batch!");return u(e.concat([n[0]]),n[1])}return u([],e)},toTuples:function(e,r){return r=r||1,n.range(0,Math.ceil(e.length/r)-1).map(function(n){return e.slice(n*r,n*r+r)},e)},permutations:function(){function e(r,t){return r.length?n.flatmap(r,function(n,u){return e(r.slice(0,u).concat(r.slice(u+1)),t.concat([n]))}):[t]}return function(r){return e(r,[])}}(),combinationsPick:function(e,r){for(var n=e.map(function(e,n){return e[r[n]]}),t=r.slice(),u=e.length;u--;u>=0){var o=e[u],a=t[u]+1;if(o[a]){t[u]=a;break}if(0===u){t=void 0;break}t[u]=0}return[n,t]},combinations:function(e){for(var r=e.reduce(function(e,r){return e*r.length},1),t=e.map(function(e){return 0}),u=new Array(r),o=0;r>o;o++){var a=n.combinationsPick(e,t);u[o]=a[0],t=a[1]}return u},take:function(e,r){return e.slice(0,r)},drop:function(e,r){return e.slice(r)},takeWhile:function(e,r,n){for(var t=0;t<e.length&&r.call(n,e[t],t);t++);return e.slice(0,t)},dropWhile:function(e,r,n){for(var t=0;t<e.length&&r.call(n,e[t],t);t++);return e.slice(t)},shuffle:function(e){var r=n.range(0,e.length-1);return e.reduce(function(e,n,t){var u=r.splice(Math.round(Math.random()*(r.length-1)),1);return e[u]=n,e},Array(e.length))},max:function(e,r,n){r=r||function(e){return e};var t;return e.reduce(function(e,u,o){var a=r.call(n,u,o);return"number"!=typeof a||e>=a?e:(t=u,a)},-(1/0)),t},min:function(e,r,t){return r=r||function(e){return e},n.max(e,function(e,n){return-r.call(t,e,n)})},sum:function(e){for(var r=0,n=0;n<e.length;n++)r+=e[n];return r},count:function(e,r){return e.reduce(function(e,n){return n===r?e+1:e},0)},size:function(e){return e.length},histogram:function(e,r){if("undefined"==typeof r||"number"==typeof r){var t=r||function(){return Math.ceil(Math.log(e.length)/Math.log(2)+1)}(e),u=Math.ceil(Math.round(e.length/t));return n.range(0,t-1).map(function(r){return e.slice(r*u,(r+1)*u)})}if(r instanceof Array){var o=r;return e.reduce(function(e,r){if(r<o[1])return e[0].push(r),e;for(var n=1;n<o.length;n++)if(r>=o[n]&&(!o[n+1]||r<=o[n+1]))return e[n].push(r),e;throw new Error(Strings.format("Histogram creation: Cannot group data %s into thresholds %o",r,o))},n.range(1,o.length).map(function(){return[]}))}},clone:function(e){return[].concat(e)},toArray:function(e){return n.from(e)},each:function(e,r,n){return e.forEach(r,n)},all:function(e,r,n){return e.every(r,n)},any:function(e,r,n){return e.some(r,n)},collect:function(e,r,n){return e.map(r,n)},findAll:function(e,r,n){return e.filter(r,n)},inject:function(e,r,n,t){return t&&(n=n.bind(t)),e.reduce(n,r)},mapAsyncSeries:function(r,n,t){function u(e,r){if(!a&&(e||r)){a=!0;try{t(e,o)}catch(n){console.error("Error in mapAsyncSeries - callback invocation error:\n"+(n.stack||n))}}}var o=[],a=!1;return r.reduceRight(function(r,t,i){return a?void 0:function(a,c){if(a)return u(a);i>0&&o.push(c);try{n(t,i,e.fun.once(r))}catch(s){u(s)}}},function(e,r){o.push(r),u(e,!0)})()},mapAsync:function(r,n,t,u){function o(){for(;f<n.parallel&&l<r.length;)d[l++]()}function a(e,n){if(!(c.indexOf(e)>-1||(c.push(e),f--,s))){if(!n&&c.length<r.length)return void o();s=!0;try{u&&u(n,i)}catch(t){console.error("Error in mapAsync - main callback invocation error:\n"+(t.stack||t))}}}if("function"==typeof n&&(u=t,t=n,n=null),n=n||{},!r.length)return u&&u(null,[]);n.parallel||(n.parallel=1/0);var i=[],c=[],s=!1,l=0,f=0,d=r.map(function(r,n){return function(){f++;try{t(r,n,e.fun.once(function(e,r){i[n]=e||r,a(n,e)}))}catch(u){a(n,u)}}});return o()}};r.from||(Array.from=n.from),r.filter||(Array.prototype.filter=function(e,r){return n.filter(this,e,r)}),r.find||(Array.prototype.find=function(e,r){return n.find(this,e,r)}),r.findIndex||(Array.prototype.findIndex=function(e,r){return n.findIndex(this,e,r)}),r.includes||(Array.prototype.includes=function(e){return n.include(this,e)});var t=e.Group=function(){};t.by=e.arr.groupBy,t.fromArray=function(e,r,n){for(var u=new t,o=0,a=e.length;a>o;o++){var i=r.call(n,e[o],o);u[i]||(u[i]=[]),u[i].push(e[o])}return u},t.prototype.toArray=function(){return this.reduceGroups(function(e,r,n){return e.concat([n])},[])},t.prototype.forEach=function(e,r){var n=this;return Object.keys(n).forEach(function(t){n[t].forEach(e.bind(r,t))}),n},t.prototype.forEachGroup=function(e,r){var n=this;return Object.keys(n).forEach(function(t){e.call(r,t,n[t])}),n},t.prototype.map=function(e,r){var n=new t;return this.forEachGroup(function(t,u){n[t]=u.map(e.bind(r,t))}),n},t.prototype.mapGroups=function(e,r){var n=new t;return this.forEachGroup(function(t,u){n[t]=e.call(r,t,u)}),n},t.prototype.keys=function(){return Object.keys(this)},t.prototype.reduceGroups=function(e,r,n){return this.forEachGroup(function(t,u){r=e.call(n,r,t,u)}),r},t.prototype.count=function(){return this.reduceGroups(function(e,r,n){return e[r]=n.length,e},{})};var u=e.grid={get:function(e,r,n){var t=e[r];return t?t[n]:void 0},set:function(e,r,n,t){var u=e[r];return u&&(u[n]=t),t},getRow:function(e,r){return e[r]},setRow:function(e,r,n){return e[r]=n},getCol:function(e,r){return e.reduce(function(e,n){return e.push(n[r]),e},[])},setCol:function(e,r,n){return e.map(function(e,t){return e[r]?e[r]=n[t]:void 0})},create:function(e,r,t){for(var u=new Array(e);e>0;)u[--e]=n.withN(r,t);return u},mapCreate:function(e,r,n,t){for(var u=new Array(e),o=0;e>o;o++){u[o]=new Array(r);for(var a=0;r>a;a++)u[o][a]=n.call(t||this,o,a)}return u},forEach:function(e,r,n){e.forEach(function(e,t){e.forEach(function(e,u){r.call(n||this,e,t,u)})})},map:function(e,r,n){var t=new Array(e.length);return e.forEach(function(e,u){t[u]=new Array(e.length),e.forEach(function(e,o){t[u][o]=r.call(n||this,e,u,o)})}),t},toObjects:function(e){for(var r=e[0],n=new Array(e.length-1),t=1;t<e.length;t++)for(var u=n[t-1]={},o=0;o<r.length;o++)u[r[o]]=e[t][o];return n},tableFromObjects:function(e,r){Array.isArray(e)||(e=[e]);var n=[[]],t=n[0],u=e.reduce(function(e,r){return e.concat([Object.keys(r).reduce(function(e,n){var u=t.indexOf(n);return-1===u&&(u=t.length,t.push(n)),e[u]=r[n],e},[])])},[]);return r=1===arguments.length?null:r,u.forEach(function(e){for(var n=0;n<t.length;n++)e[n]||(e[n]=r)}),n.concat(u)},benchmark:function(){var r,n=[],t=u.create(1e3,200,1),o=0;r=lively.lang.fun.timeToRunN(function(){u.forEach(t,function(e){o+=e})},10),n.push(e.string.format("grid.forEach: %ims",r));var a;r=Functions.timeToRunN(function(){a=u.map(u,function(e,r,n){return r+n+Math.round(100*Math.random())})},10),n.push(e.string.format("grid.map: %ims",r));var i=u.create(1e3,2e3);return r=Functions.timeToRunN(function(){i=new Array(1e3);for(var e=0;1e3>e;e++)i[e]=new Array(2e3);u.forEach(t,function(e,r,n){i[r][n]=r+n+Math.round(100*Math.random())})},10),n.push("grid.map with forEach: "+r+"ms"),n.push("--= 2012-09-22 =--\ngrid.forEach: 14.9ms\ngrid.map: 19.8ms\ngrid.map with forEach: 38.7ms\n"),n.join("\n")}},o=e.interval={isInterval:function(e){return Array.isArray(e)&&e.length>=2&&e[0]<=e[1]},sort:function(e){return e.sort(o.compare)},compare:function(e,r){return e[0]<r[0]?e[1]<r[0]?-3:e[1]===r[0]?-2:-1:e[0]===r[0]?e[1]===r[1]?0:e[1]<r[1]?-1:1:-1*o.compare(r,e)},coalesce:function(e,r,n){var t=this.compare(e,r);switch(t){case-3:case 3:return null;case 0:return n&&n(e,r,e),e;case 2:case 1:var u=e;e=r,r=u;case-2:case-1:var o=[e[0],Math.max(e[1],r[1])];return n&&n(e,r,o),o;default:throw new Error("Interval compare failed")}},coalesceOverlapping:function(e,r){for(var n=[],t=e.length;t>0;){var u=e.shift();t--;for(var a=0;t>a;a++){var i=e[a],c=o.coalesce(u,i,r);c&&(u=c,e.splice(a,1),t--,a--)}n.push(u)}return this.sort(n)},mergeOverlapping:function(e,r,n){for(var t=[];e.length>0;){var u=e.shift(),a=r.map(function(e){var r=o.compare(u,e);return-1===r||0===r||1===r});t.push(n(u,a[0])),t.push(u)}return t},intervalsInRangeDo:function(e,r,n,t,u,o){o=o||("undefined"!=typeof window?window:global),n=this.sort(n);for(var a,i=[];a=n.shift();)if(!(a[1]<e)){a[0]<e&&(a=Array.prototype.slice.call(a),a[0]=e);var c=r<a[0]?r:a[0];if(c>e&&i.push(t.call(o,[e,c],!0)),r<a[1]&&(a=Array.prototype.slice.call(a),a[1]=r),a[0]===a[1]){var s;u&&(s=i.slice(-1)[0])&&u.call(o,s,a,s)}else i.push(t.call(o,a,!1));if(e=a[1],e>=r)break}return r>e&&i.push(t.call(o,[e,r],!0)),i},intervalsInbetween:function(e,r,n){return o.intervalsInRangeDo(e,r,o.coalesceOverlapping(Array.prototype.slice.call(n)),function(e,r){return r?e:null}).filter(function(e){return!!e})},mapToMatchingIndexes:function(e,r){var t,u,o=0;return r.map(function(r){for(;(u=e[o])&&u[0]<r[0];)o++;if(u&&u[0]===r[0]){for(t=o;(u=e[t])&&u[1]<r[1];)t++;if(u&&u[1]===r[1])return n.range(o,t)}return[]})},benchmark:function(){function e(e,r,n){return Strings.format("%s: %sms",e,Functions.timeToRunN(function(){o[e].apply(o,r,1e5)},n))}return["Friday, 20. July 2012:","coalesceOverlapping: 0.0003ms","intervalsInbetween: 0.002ms","mapToMatchingIndexes: 0.02ms","vs.\n"+new Date+":",e("coalesceOverlapping",[[[9,10],[1,8],[3,7],[15,20],[14,21]]],1e5),e("intervalsInbetween",[0,10,[[8,10],[0,2],[3,5]]],1e5),e("mapToMatchingIndexes",[Array.range(0,1e3).collect(function(e){return[e,e+1]}),[[4,8],[500,504],[900,1004]]],1e3)].join("\n")}},a=e.arrayProjection={create:function(e,r,n){var t=n||0;return t+r>e.length&&(t-=t+r-e.length),{array:e,from:t,to:t+r}},toArray:function(e){return e.array.slice(e.from,e.to)},originalToProjectedIndex:function(e,r){return r<e.from||r>=e.to?null:r-e.from},projectedToOriginalIndex:function(e,r){return 0>r||r>e.to-e.from?null:e.from+r},transformToIncludeIndex:function(e,r){if(!(r in e.array))return null;var n=0;return r<e.from&&(n=-e.from+r),r>=e.to&&(n=r-e.to+1),0===n?e:a.create(e.array,e.to-e.from,e.from+n)}}}("undefined"!=typeof lively&&lively.lang?lively.lang:{}),function(e){"use strict";e.seq={take:function(e,r){for(var n=e(),t=[],u=0;r>u;u++){var o=n.next();if(o.done)break;t.push(o.value)}return t}}}("undefined"!=typeof lively&&lively.lang?lively.lang:{}),function(e){"use strict";var r=e.tree={prewalk:function(e,n,t,u,o){u||(u={i:0}),o||(o=0);var a=u.i++;n(e,a,o),(t(e,a,o)||[]).forEach(function(e){r.prewalk(e,n,t,u,o+1)})},postwalk:function(e,n,t,u,o){u||(u={i:0}),o||(o=0);var a=u.i++;(t(e,a,o)||[]).forEach(function(e){r.postwalk(e,n,t)}),n(e,a,o)},detect:function(e,n,t){if(n(e))return e;var u=t(e);if(u&&u.length)for(var o=0;o<u.length;o++){var a=r.detect(u[o],n,t);if(a)return a}},filter:function(n,t,u){var o=[];return t(n)&&o.push(n),o.concat(e.arr.flatten((u(n)||[]).map(function(e){return r.filter(e,t,u)})))},map:function(n,t,u,o){o=o||0;var a=[t(n,o)];return a.concat(e.arr.flatten((u(n)||[]).map(function(e){return r.map(e,t,u,o)})))},mapTree:function(e,n,t,u){u=u||0;var o=(t(e)||[]).map(function(e){return r.mapTree(e,n,t,u)});return n(e,o,u)}}}("undefined"!=typeof lively&&lively.lang?lively.lang:{}),function(exports){"use strict";function Closure(){this.initialize.apply(this,arguments)}var fun=exports.fun={get Empty(){return function(){}},get K(){return function(e){return e}},get Null(){return function(){return null}},get False(){return function(){return!1}},get True(){return function(){return!0}},get notYetImplemented(){return function(){throw new Error("Not yet implemented")}},all:function(e){var r=[];for(var n in e)e.__lookupGetter__(n)||"function"!=typeof e[n]||r.push(n);return r},own:function(e){var r=[];for(var n in e)!e.__lookupGetter__(n)&&e.hasOwnProperty(n)&&"function"==typeof e[n]&&r.push(n);return r},argumentNames:function(e){if(e.superclass)return[];var r=e.toString(),n="",t=r.match(/(?:\(([^\)]*)\)|([^\(\)-+!]+))\s*=>/);if(t)n=t[1]||t[2]||"";else{var u=r.match(/^[\s\(]*function[^(]*\(([^)]*)\)/);u&&u[1]&&(n=u[1])}return n.replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",").map(function(e){return e.trim()}).filter(function(e){return!!e})},qualifiedMethodName:function(e){var r="";return e.declaredClass?r+=e.declaredClass+">>":e.declaredObject&&(r+=e.declaredObject+"."),r+(e.methodName||e.displayName||e.name||"anonymous")},extractBody:function(e){for(var r=String(e).replace(/^function[^\{]+\{\s*/,"").replace(/\}$/,"").trim(),n=r.split(/\n|\r/),t=void 0,u=0;u<n.length;u++){var o=n[u].match(/^(\s+)[^\s]/);o&&(void 0===t||o[1].length<t.length)&&(t=o[1])}return t?r.replace(new RegExp("^"+t,"gm"),""):r},timeToRun:function(e){var r=Date.now();return e(),Date.now()-r},timeToRunN:function(e,r){for(var n=Date.now(),t=0;r>t;t++)e();return(Date.now()-n)/r},delay:function(e,r){var n=Array.prototype.slice.call(arguments),t=n.shift(),r=1e3*n.shift();return setTimeout(function(){return t.apply(t,n)},r)},throttle:function(e,r){var n,t,u,o,a,i,c=fun.debounce(r,function(){a=o=!1});return function(){n=this,t=arguments;var s=function(){u=null,a&&e.apply(n,t),c()};return u||(u=setTimeout(s,r)),o?a=!0:i=e.apply(n,t),c(),o=!0,i}},debounce:function(e,r,n){var t;return function(){var u=this,o=arguments,a=function(){t=null,n||r.apply(u,o)};n&&!t&&r.apply(u,o),clearTimeout(t),t=setTimeout(a,e)}},throttleNamed:function(e,r,n){function t(){fun.debounceNamed(e,r,function(){delete u[e]})(),n.apply(this,arguments)}var u=fun._throttledByName||(fun._throttledByName={});return u[e]?u[e]:u[e]=fun.throttle(t,r)},debounceNamed:function(e,r,n,t){function u(){delete o[e],n.apply(this,arguments)}var o=fun._debouncedByName||(fun._debouncedByName={});return o[e]?o[e]:o[e]=fun.debounce(r,u,t)},createQueue:function(e,r){var n=fun._queues||(fun._queues={}),t=n[e]||(n[e]={_workerActive:!1,worker:r,tasks:[],drain:null,push:function(e){t.tasks.push(e),t.activateWorker()},pushAll:function(e){e.forEach(function(e){t.tasks.push(e)}),t.activateWorker()},pushNoActivate:function(e){t.tasks.push(e)},handleError:function(e){e&&console.error("Error in queue: "+e)},activateWorker:function(){function r(e){t.handleError(e),t.activateWorker()}var u=t.tasks,o=t._workerActive;if(0===u.length)o&&(t._workerActive=!1,"function"==typeof t.drain&&t.drain()),delete n[e];else{o||(t._workerActive=!0);try{t.worker(u.shift(),r)}catch(a){r(a)}}}});return t},workerWithCallbackQueue:function(e,r,n){function t(){l&&clearTimeout(l),c=!0,delete o[e]}function u(r){c||(t(),a.callbacks.forEach(function(n){try{n.apply(null,r)}catch(t){console.error("Error when invoking callbacks in queueUntil ["+e+"]:\n"+String(t.stack||t))}}))}var o=fun._queueUntilCallbacks||(fun._queueUntilCallbacks={}),a=o[e],i=!!a;if(i)return a;var c=!1,s=!1;if(n)var l=setTimeout(function(){c||u([new Error("timeout")])},n);return a=o[e]={callbacks:[],cancel:function(){s=!0,t()},whenDone:function(e){return a.callbacks.push(e),a}},setTimeout(function(){if(!s)try{r(function(){u(arguments)})}catch(e){u([e])}},0),a},_composeAsyncDefaultEndCallback:function(e,r){e&&console.error("lively.lang.fun.composeAsync error",e)},composeAsync:function(){var e,r,n=Array.prototype.slice,t=n.call(arguments),u=fun._composeAsyncDefaultEndCallback,o=u,a=new Promise(function(n,t){e=n,r=t});return t.reverse().reduce(function(e,i,c){var s=!1;return function(){function l(){s=!0;var t=n.call(arguments),u=t.shift();u?(o(u),r(u)):e.apply(null,t)}var f=n.call(arguments);if(o===u&&c===t.length-1){for(;f.length&&"function"!=typeof f[f.length-1];)f.pop();"function"==typeof f[f.length-1]&&(o=f.pop())}if("function"==typeof i)try{var d=i.apply(this,f.concat([l]));d&&"function"==typeof d.then&&"function"==typeof d["catch"]&&d.then(function(e){return l(null,e)})["catch"](function(e){return l(e)})}catch(p){console.error("composeAsync: ",p.stack||p),s||(o(p),r(p))}else if(i&&"function"==typeof i.then&&"function"==typeof i["catch"])i.then(function(e){l(null,e)})["catch"](function(e){l(e)});else{var h=new Error("Invalid argument to composeAsync: "+i);o(h),r(h)}return a}},function(){var r=n.call(arguments);o.apply(null,[null].concat(r)),e(r[0])})},compose:function(){var e=Array.prototype.slice.call(arguments);return e.reverse().reduce(function(e,r){return function(){return e(r.apply(this,arguments))}},function(e){return e})},flip:function(e){return function(){var r=Array.prototype.slice.call(arguments),n=[r[1],r[0]].concat(r.slice(2));return e.apply(null,n)}},withNull:function(e){return e=e||function(){},function(){var r=lively.lang.arr.from(arguments);e.apply(null,[null].concat(r))}},waitFor:function(e,r,n){var t=Date.now(),u=50;n||(n=r,r=e,e=void 0),function o(){if(r())return n();if(e){var a=Date.now()-t,i=e-a;if(0>=i)return n(new Error("timeout"));u>i&&(u=i)}setTimeout(o,u)}()},waitForAll:function(e,r,n){function t(e,r,t,a){if(o.length){var i=null,c=o.indexOf(e);c>-1&&o.splice(c,1),t?(o.length=0,i=new Error("in waitForAll at"+("number"==typeof r?" "+r:"")+": \n"+(t.stack||String(t)))):a&&(u[r]=a),o.length||setTimeout(function(){n(i,u)},0)}}n||(n=r,r=e,e=null),e=e||{};var u=r.map(function(){return null});if(!r.length)return void n(null,u);var o=Array.prototype.slice.call(r);r.forEach(function(e,r){try{e(function(){var n=Array.prototype.slice.call(arguments),u=n.shift();t(e,r,u,n)})}catch(n){t(e,r,n,null)}}),e.timeout&&setTimeout(function(){if(o.length){var e=u.map(function(e,r){return null===e&&r}).filter(function(e){return"number"==typeof e}).join(", "),r=new Error("waitForAll timed out, functions at "+e+" not done");t(null,null,r,null)}},e.timeout)},curry:function(e,r,n,t){function u(){return e.apply(this,o.concat(Array.prototype.slice.call(arguments)))}if(arguments.length<=1)return arguments[0];var o=Array.prototype.slice.call(arguments),e=o.shift();return u.isWrapper=!0,u.originalFunction=e,u},wrap:function(e,r){var n=e,t=function(){var e=Array.prototype.slice.call(arguments),t=r.isWrapper?e:[n.bind(this)].concat(e);return r.apply(this,t)};return t.isWrapper=!0,t.originalFunction=n,t},getOriginal:function(e){for(;e.originalFunction;)e=e.originalFunction;return e},wrapperChain:function(e){var r=[];do r.push(e),e=e.originalFunction;while(e);return r},replaceMethodForOneCall:function(e,r,n){n.originalFunction=e[r];var t=e.hasOwnProperty(r);return e[r]=function(){return t?e[r]=n.originalFunction:delete e[r],n.apply(this,arguments)},e},once:function(e){if(e){if("function"!=typeof e)throw new Error("fun.once() expecting a function");var r,n=!1;return function(){return n?r:(n=!0,r=e.apply(this,arguments))}}},either:function(){var e=Array.prototype.slice.call(arguments),r=!1;return e.map(function(e){return function(){return r?void 0:(r=!0,e.apply(this,arguments))}})},eitherNamed:function(e,r){var n=Array.prototype.slice.call(arguments),t=fun._eitherNameRegistry||(fun._eitherNameRegistry={}),e=n.shift(),u=t[e]||(t[e]={wasCalled:!1,callsLeft:0});return u.callsLeft++,function(){return u.callsLeft--,u.callsLeft<=0&&delete t[e],u.wasCalled?void 0:(u.wasCalled=!0,r.apply(this,arguments))}},evalJS:function(src){return eval(src)},fromString:function(e){return fun.evalJS("("+e.toString()+");")},asScript:function(e,r){return Closure.fromFunction(e,r).recreateFunc()},asScriptOf:function(e,r,n,t){var u=n||e.name;if(!u)throw Error("Function that wants to be a script needs a name: "+this);var o=Object.getPrototypeOf(r),a={"this":r};if(t&&(a=exports.obj.merge([a,t])),o&&o[u]){var i=function(){try{return Object.getPrototypeOf(r)[u].apply(r,arguments)}catch(e){return void 0!==typeof $world?$world.logError(e,"Error in $super call"):alert("Error in $super call: "+e+"\n"+e.stack),null}};a.$super=Closure.fromFunction(i,{obj:r,name:u}).recreateFunc()}return fun.addToObject(fun.asScript(e,a),r,u)},addToObject:function(e,r,n){e.displayName=n;var t=r.attributeConnections?r.attributeConnections.filter(function(e){return"update"===e.getSourceAttrName()}):[];return t&&t.forEach(function(e){e.disconnect()}),r[n]=e,e.declaredObject=exports.obj.safeToString(r),"undefined"!=typeof lively&&exports.obj&&lively.Tracing&&lively.Tracing.stackTracingEnabled&&lively.Tracing.instrumentMethod(r,n,{declaredObject:exports.obj.safeToString(r)}),t&&t.forEach(function(e){e.connect()}),e},binds:function(e,r){return Closure.fromFunction(e,r||{}).recreateFunc()},setLocalVarValue:function(e,r,n){
e.hasLivelyClosure&&(e.livelyClosure.funcProperties[r]=n)},getVarMapping:function(e){return e.hasLivelyClosure?e.livelyClosure.varMapping:e.isWrapper?e.originalFunction.varMapping:e.varMapping?e.varMapping:{}},setProperty:function(e,r,n){e[r]=n,e.hasLivelyClosure&&(e.livelyClosure.funcProperties[r]=n)},functionNames:function(e){for(var r=[],n=e.prototype;n;)r=Object.keys(n).reduce(function(e,r){return"function"==typeof n[r]&&-1===e.indexOf(r)&&e.push(r),e},r),n=Object.getPrototypeOf(n);return r},localFunctionNames:function(e){return Object.keys(e.prototype).filter(function(r){return"function"==typeof e.prototype[r]})},logErrors:function(e,r){var n=function(n){var t=Array.prototype.slice.call(arguments);t.shift();try{return n.apply(e,t)}catch(u){if("undefined"!=typeof lively&&lively.morphic&&lively.morphic.World&&lively.morphic.World.current())throw lively.morphic.World.current().logError(u),u;throw r?console.warn("ERROR: %s.%s(%s): err: %s %s",e,r,t,u,u.stack||""):console.warn("ERROR: %s %s",u,u.stack||""),"undefined"!=typeof logStack&&logStack(),"undefined"!=typeof printObject&&console.warn("details: "+printObject(u)),u}};n.methodName="$logErrorsAdvice";var t=fun.wrap(e,n);return t.originalFunction=e,t.methodName="$logErrorsWrapper",t},logCompletion:function(e,r){var n=function(n){var t=Array.prototype.slice.call(arguments);t.shift();try{var u=n.apply(e,t)}catch(o){throw console.warn("failed to load "+r+": "+o),"undefined"!=typeof lively&&lively.lang.Execution&&lively.lang.Execution.showStack(),o}return console.log("completed "+r),u};n.methodName="$logCompletionAdvice::"+r;var t=fun.wrap(e,n);return t.methodName="$logCompletionWrapper::"+r,t.originalFunction=e,t},logCalls:function(e,r){var n=e,t=function(t){var o=Array.prototype.slice.call(arguments);return o.shift(),u=t.apply(e,o),r?console.warn("%s(%s) -> %s",fun.qualifiedMethodName(n),o,u):console.log("%s(%s) -> %s",fun.qualifiedMethodName(n),o,u),u};t.methodName="$logCallsAdvice::"+fun.qualifiedMethodName(e);var u=fun.wrap(e,t);return u.originalFunction=e,u.methodName="$logCallsWrapper::"+fun.qualifiedMethodName(e),u},traceCalls:function(e,r){var n=function(n){var t=Array.prototype.slice.call(arguments);t.shift(),r.push(t);var u=n.apply(e,t);return r.pop(),u};return fun.wrap(e,n)},webkitStack:function(){try{throw new Error}catch(e){return String(e.stack).split(/\n/).slice(2).map(function(e){return e.replace(/^\s*at\s*([^\s]+).*/,"$1")}).join("\n")}}};exports.Closure=Closure,exports.obj.extend(Closure,{superclass:Object,type:"Closure",categories:{}}),Closure.prototype.isLivelyClosure=!0,Closure.prototype.doNotSerialize=["originalFunc"],Closure.prototype.initialize=function(e,r,n,t){this.originalFunc=e,this.varMapping=r||{},this.source=n,this.setFuncProperties(e||t)},Closure.prototype.setFuncSource=function(e){this.source=e},Closure.prototype.getFuncSource=function(){return this.source||String(this.originalFunc)},Closure.prototype.hasFuncSource=function(){return this.source&&!0},Closure.prototype.getFunc=function(){return this.originalFunc||this.recreateFunc()},Closure.prototype.getFuncProperties=function(){return this.funcProperties||(this.funcProperties={}),this.funcProperties},Closure.prototype.setFuncProperties=function(e){var r=this.getFuncProperties();for(var n in e)e.hasOwnProperty(n)&&"_cachedAst"!=n&&(r[n]=e[n])},Closure.prototype.lookup=function(e){return this.varMapping[e]},Closure.prototype.parameterNames=function(e){var r=/function\s*\(([^\)]*)\)/,n=r.exec(e);if(!n||!n[1])return[];var t=n[1];if(0==t.length)return[];var u=t.split(",").map(function(e){return exports.string.removeSurroundingWhitespaces(e)},this);return u},Closure.prototype.firstParameter=function(e){return this.parameterNames(e)[0]||null},Closure.prototype.recreateFunc=function(){return this.recreateFuncFromSource(this.getFuncSource(),this.originalFunc)},Closure.prototype.recreateFuncFromSource=function(e,r){var n=[],t=!1,u="$super"===this.firstParameter(e);for(var o in this.varMapping)this.varMapping.hasOwnProperty(o)&&("this"!=o?n.push(o+'=this.varMapping["'+o+'"]'):t=!0);var a=n.length>0?"var "+n.join(",")+";\n":"";if(u&&(a+="(function superWrapperForClosure() { return "),a+="("+e+")",u&&(a+=".apply(this, [$super.bind(this)].concat(Array.from(arguments))) })"),"undefined"!=typeof lively&&lively.Config&&lively.Config.loadRewrittenCode){module("lively.ast.Rewriting").load(!0);var i="[runtime]";r&&r.sourceModule&&(i=new URL(r.sourceModule.findUri()).relativePathFrom(URL.root));var c=lively.ast.acorn.parse(a),s=lively.ast.Rewriting.rewrite(c,lively.ast.Rewriting.getCurrentASTRegistry(),i),l=s.body[0].block.body.last();l.type="ReturnStatement",l.argument=l.expression,delete l.expression,a="(function() { "+escodegen.generate(s)+"}).bind(this)();"}try{var f=fun.evalJS.call(this,a)||this.couldNotCreateFunc(a);return this.addFuncProperties(f),this.originalFunc=f,"undefined"!=typeof lively&&lively.Config&&lively.Config.loadRewrittenCode&&(f._cachedAst.source=e,f._cachedAst.start++,f._cachedAst.end--),f}catch(d){var p="Cannot create function "+d+" src: "+a;throw console.error(p),new Error(p)}},Closure.prototype.addFuncProperties=function(e){var r=this.getFuncProperties();for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n]);this.addClosureInformation(e)},Closure.prototype.couldNotCreateFunc=function(e){var r="Could not recreate closure from source: \n"+e;return console.error(r),function(){throw new Error(r)}},Closure.prototype.asFunction=function(){return this.recreateFunc()},Closure.prototype.addClosureInformation=function(e){return e.hasLivelyClosure=!0,e.livelyClosure=this,e},Closure.fromFunction=function(e,r){return new Closure(e,r||{})},Closure.fromSource=function(e,r){return new Closure(null,r||{},e)}}("undefined"!=typeof lively&&lively.lang?lively.lang:{}),function(e){var r={repeat:!!String.prototype.repeat,includes:!!String.prototype.includes,startsWith:!!String.prototype.startsWith,endsWith:!!String.prototype.endsWith},n=e.string={format:function(){return n.formatFromArray(Array.prototype.slice.call(arguments))},formatFromArray:function(r){function n(e,r){return""+e}function t(e,r){return e.toString()}function u(e,r,n){return n>-1?e.toFixed(n):e.toString()}function o(r,n){return e.obj.inspect(r)}function a(e){for(var r=[],n=s.exec(e);n;n=s.exec(e)){var t=n[8]||n[5],u=t in c?c[t]:o,a=n[3]?parseInt(n[3]):"."==n[4]?-1:0;r.push(e.substr(0,"%"==n[0][0]?n.index:n.index+1)),r.push({appender:u,precision:a}),e=e.substr(n.index+n[0].length)}return e&&r.push(e.toString()),r}var i=r.shift();i||console.log("Error in Strings>>formatFromArray, first arg is undefined");for(var c={s:n,d:t,i:t,f:u,o:o},s=/((^%|[^\\]%)(\d+)?(\.)([a-zA-Z]))|((^%|[^\\]%)([a-zA-Z]))/,l=a(i),f="",d=0,p=0;p<l.length;++p){var h=l[p];if(h&&"object"==typeof h){var g=r[d++];f+=(h.appender||n)(g,f,h.precision)}else f+=n(h,f)}return f},indent:function(e,r,t){if(!t||0>=t)return e;for(var u="";t>0;)t--,u+=r;return n.lines(e).map(function(e){return u+e}).join("\n")},removeSurroundingWhitespaces:function(e){function r(e){for(;e.length>0&&/\s|\n|\r/.test(e[e.length-1]);)e=e.substring(0,e.length-1);return e}function n(e){return e.replace(/^[\n\s]*(.*)/,"$1")}return n(r(e))},quote:function(e){return'"'+e.replace(/"/g,'\\"')+'"'},print:function t(e){if(e&&Array.isArray(e))return"["+e.map(t)+"]";if("string"!=typeof e)return String(e);var r=String(e);return r=r.replace(/\n/g,"\\n\\\n"),r=r.replace(/(")/g,"\\$1"),r='"'+r+'"'},printNested:function(e,r){r=r||0;var t="";return e.forEach(function(e){t+=e instanceof Array?n.printNested(e,r+1):n.indent(e+"\n","  ",r)}),t},pad:function(e,r,n){return n?" ".repeat(r)+e:e+" ".repeat(r)},printTable:function(e,r){function t(e){return a?!1:i?!0:r&&Array.isArray(r.align)&&"right"===r.align[e]}var u=[],o=r&&r.separator||" ",a=!r||!r.align||"left"===r.align,i=r&&"right"===r.align;return e.forEach(function(e){e.forEach(function(e,r){void 0===u[r]&&(u[r]=0),u[r]=Math.max(u[r],String(e).length)})}),e.map(function(e){return e.map(function(e,r){var o=String(e);return n.pad(o,u[r]-o.length,t(r))}).join(o)}).join("\n")},printTree:function(e,r,n,t){function u(e,a,i){o[a]=t.repeat(e)+r(i,e);var c=n(i,e),s=a+1;if(!c||!c.length)return s;var l=s,f=c.length-1;return c.forEach(function(r,n){s=u(e+1,s,r);for(var a=f===n,i=o[l].split(""),c=e*t.length+1,d=e*t.length+t.length,n=c;d>n;n++)i[n]="-";a&&(i[e*t.length]="\\"),o[l]=i.join(""),a||o.slice(l,s).forEach(function(r,n){var u=r.split("");u[e*t.length]="|",o[l+n]=u.join("")}),l=s}),s}var o=[];return t=t||"  ",u(0,0,e),o.join("\n")},toArray:function(e){return e.split("")},lines:function(e){return e.split(/\n\r?/)},paragraphs:function(e,r){function n(e){return/^\s*$/.test(e)}var t=r?r.sep:"\n\n";return r&&r.keepEmptyLines?e.split("\n").concat("").reduce(function(e,r){var t=e[0],u=e[1];return n(u)===n(r)?u+="\n"+r:(u.length&&t.push(u),u=r),[t,u]},[[],""])[0]:e.split(new RegExp(t+"+"))},nonEmptyLines:function(e){return n.lines(e).compact()},tokens:function(e,r){return e.split(r||/\s+/).filter(function(e){return!/^\s*$/.test(e)})},tableize:function(e,r){r=r||{};for(var t=r.cellSplitter||/\s+/,u=/^\s*$/,o=r.hasOwnProperty("convertTypes")?!!r.convertTypes:!0,a=n.lines(e),i=[],c=0;c<a.length;c++){var s=n.tokens(a[c],t);o&&(s=s.map(function(e){if(e.match(u))return e;var r=Number(e);if(!isNaN(r))return r;var n=new Date(e);return isNaN(+n)?e.trim():n})),s.length>0&&i.push(s)}return i},unescapeCharacterEntities:function(e){if("undefined"==typeof document)throw new Error("Cannot unescapeCharacterEntities");var r=document.createElement("div");return r.innerHTML=e,r.textContent},toQueryParams:function(e,r){var n=e.trim().match(/([^?#]*)(#.*)?$/);if(!n)return{};var t=n[1].split(r||"&").inject({},function(e,r){if((r=r.split("="))[0]){var n=decodeURIComponent(r.shift()),t=r.length>1?r.join("="):r[0];void 0!=t&&(t=decodeURIComponent(t)),n in e?(Array.isArray(e[n])||(e[n]=[e[n]]),e[n].push(t)):e[n]=t}return e});return t},joinPath:function(){var e=Array.prototype.slice.call(arguments);return e.reduce(function(e,r){return"string"==typeof r?e.replace(/\/*$/,"")+"/"+r.replace(/^\/*/,""):e})},newUUID:function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=16*Math.random()|0,n="x"==e?r:3&r|8;return n.toString(16)}).toUpperCase();return e},createDataURI:function(e,r){return r=r||"text/plain","data:"+r+";base64,"+btoa(e)},hashCode:function(e){var r=0,n=e.length;if(0==n)return r;for(var t=0;n>t;t++){var u=e.charCodeAt(t);r=(r<<5)-r+u,r&=r}return r},md5:function(e){function r(e,r,n,t,u,o){return r=f(f(r,e),f(t,o)),f(r<<u|r>>>32-u,n)}function n(e,n,t,u,o,a,i){return r(n&t|~n&u,e,n,o,a,i)}function t(e,n,t,u,o,a,i){return r(n&u|t&~u,e,n,o,a,i)}function u(e,n,t,u,o,a,i){return r(n^t^u,e,n,o,a,i)}function o(e,n,t,u,o,a,i){return r(t^(n|~u),e,n,o,a,i)}function a(e,r){var a=e[0],i=e[1],c=e[2],s=e[3];a=n(a,i,c,s,r[0],7,-680876936),s=n(s,a,i,c,r[1],12,-389564586),c=n(c,s,a,i,r[2],17,606105819),i=n(i,c,s,a,r[3],22,-1044525330),a=n(a,i,c,s,r[4],7,-176418897),s=n(s,a,i,c,r[5],12,1200080426),c=n(c,s,a,i,r[6],17,-1473231341),i=n(i,c,s,a,r[7],22,-45705983),a=n(a,i,c,s,r[8],7,1770035416),s=n(s,a,i,c,r[9],12,-1958414417),c=n(c,s,a,i,r[10],17,-42063),i=n(i,c,s,a,r[11],22,-1990404162),a=n(a,i,c,s,r[12],7,1804603682),s=n(s,a,i,c,r[13],12,-40341101),c=n(c,s,a,i,r[14],17,-1502002290),i=n(i,c,s,a,r[15],22,1236535329),a=t(a,i,c,s,r[1],5,-165796510),s=t(s,a,i,c,r[6],9,-1069501632),c=t(c,s,a,i,r[11],14,643717713),i=t(i,c,s,a,r[0],20,-373897302),a=t(a,i,c,s,r[5],5,-701558691),s=t(s,a,i,c,r[10],9,38016083),c=t(c,s,a,i,r[15],14,-660478335),i=t(i,c,s,a,r[4],20,-405537848),a=t(a,i,c,s,r[9],5,568446438),s=t(s,a,i,c,r[14],9,-1019803690),c=t(c,s,a,i,r[3],14,-187363961),i=t(i,c,s,a,r[8],20,1163531501),a=t(a,i,c,s,r[13],5,-1444681467),s=t(s,a,i,c,r[2],9,-51403784),c=t(c,s,a,i,r[7],14,1735328473),i=t(i,c,s,a,r[12],20,-1926607734),a=u(a,i,c,s,r[5],4,-378558),s=u(s,a,i,c,r[8],11,-2022574463),c=u(c,s,a,i,r[11],16,1839030562),i=u(i,c,s,a,r[14],23,-35309556),a=u(a,i,c,s,r[1],4,-1530992060),s=u(s,a,i,c,r[4],11,1272893353),c=u(c,s,a,i,r[7],16,-155497632),i=u(i,c,s,a,r[10],23,-1094730640),a=u(a,i,c,s,r[13],4,681279174),s=u(s,a,i,c,r[0],11,-358537222),c=u(c,s,a,i,r[3],16,-722521979),i=u(i,c,s,a,r[6],23,76029189),a=u(a,i,c,s,r[9],4,-640364487),s=u(s,a,i,c,r[12],11,-421815835),c=u(c,s,a,i,r[15],16,530742520),i=u(i,c,s,a,r[2],23,-995338651),a=o(a,i,c,s,r[0],6,-198630844),s=o(s,a,i,c,r[7],10,1126891415),c=o(c,s,a,i,r[14],15,-1416354905),i=o(i,c,s,a,r[5],21,-57434055),a=o(a,i,c,s,r[12],6,1700485571),s=o(s,a,i,c,r[3],10,-1894986606),c=o(c,s,a,i,r[10],15,-1051523),i=o(i,c,s,a,r[1],21,-2054922799),a=o(a,i,c,s,r[8],6,1873313359),s=o(s,a,i,c,r[15],10,-30611744),c=o(c,s,a,i,r[6],15,-1560198380),i=o(i,c,s,a,r[13],21,1309151649),a=o(a,i,c,s,r[4],6,-145523070),s=o(s,a,i,c,r[11],10,-1120210379),c=o(c,s,a,i,r[2],15,718787259),i=o(i,c,s,a,r[9],21,-343485551),e[0]=f(a,e[0]),e[1]=f(i,e[1]),e[2]=f(c,e[2]),e[3]=f(s,e[3])}function i(e){var r,n=e.length,t=[1732584193,-271733879,-1732584194,271733878];for(r=64;n>=r;r+=64)a(t,c(e.substring(r-64,r)));e=e.substring(r-64);var u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=e.length;for(r=0;o>r;r++)u[r>>2]|=e.charCodeAt(r)<<(r%4<<3);if(u[r>>2]|=128<<(r%4<<3),r>55)for(a(t,u),r=16;r--;)u[r]=0;return u[14]=8*n,a(t,u),t}function c(e){var r,n=[];for(r=0;64>r;r+=4)n[r>>2]=e.charCodeAt(r)+(e.charCodeAt(r+1)<<8)+(e.charCodeAt(r+2)<<16)+(e.charCodeAt(r+3)<<24);return n}function s(e){for(var r="",n=0;4>n;n++)r+=d[e>>8*n+4&15]+d[e>>8*n&15];return r}function l(e){for(var r=e.length,n=0;r>n;n++)e[n]=s(e[n]);return e.join("")}var f=function(e,r){var n=(65535&e)+(65535&r),t=(e>>16)+(r>>16)+(n>>16);return t<<16|65535&n},d="0123456789abcdef".split("");return l(i(e))},reMatches:function(e,r){var n=[];return e.replace(r,function(e,r){n.push({match:e,start:r,end:r+e.length})}),n},stringMatch:function(r,t,u){function o(e,r,n,t,u){return t=t||0,u=u||0,[e.slice(0,r),e.slice(r+t,n-u),e.slice(n)]}function a(e,r){if(r.constructor!==RegExp){var t=e.indexOf(r);if(0===t)return{match:r,rest:e.slice(r.length)};for(var u=0;u<r.length;u++)if(r[u]!=e[u])return{match:null,pos:u};return{match:null}}var o=n.reMatches(e,r);return o&&o.length&&0===o[0].start?{match:o[0].match,rest:e.slice(o[0].end)}:{match:null}}function i(e,r){for(var n=0,t=0;t<r.length;t++){var u=r[t],o=a(e,u);if(!o.match)return{matched:!1,pos:n+(o.pos||0),pattern:u};n+=o.match.length,e=o.rest}return e.length?{matched:!1,pos:n}:{matched:!0}}function c(r){var t=n.reMatches(r,/__\//g),u=n.reMatches(r,/\/__/g);if(t.length!==u.length)throw new Error("pattern invalid: "+r+" cannot be split into __/.../__ embedded RegExps\nstarts: "+JSON.stringify(t)+"\nvs ends:\n"+JSON.stringify(u));var a=0;return t.reduce(function(r,n,t){var i=u[t],c=r.pop(),s=o(c,n.start-a,i.end-a,3,3);s[0].length&&(r.push(s[0]),a+=s[0].length);try{s[1].length&&(r.push(new RegExp(s[1])),a+=s[1].length+3+3)}catch(l){throw new Error("Cannot create pattern re from: "+e.obj.inspect(s))}return s[2].length&&r.push(s[2]),r},[r])}function s(e,r){var n=c(r),t=i(e,n);return t.matched?t:(t.error=e.slice(0,t.pos)+"<--UNMATCHED-->"+e.slice(t.pos),t)}return u=u||{},u.normalizeWhiteSpace&&(r=r.replace(/\s+/g," ")),u.ignoreIndent&&(r=r.replace(/^\s+/gm,""),t=t.replace(/^\s+/gm,"")),r==t?{matched:!0}:s(r,t)},peekRight:function(e,r,t){if(e=e.slice(r),"string"==typeof t){var u=e.indexOf(t);return-1===u?null:u+r}if(t.constructor===RegExp){var o=n.reMatches(e,t);return o[0]?o[0].start:null}return null},peekLeft:function(r,t,u){if(r=r.slice(0,t),"string"==typeof u){var o=r.lastIndexOf(u);return-1===o?null:o}if(u.constructor===RegExp){var a=n.reMatches(r,u);return e.arr.last(a)?e.arr.last(a).start:null}return null},lineIndexComputer:function(e){var r=n.lineRanges(e);return function(e){for(var n=0;n<r.length;n++){var t=r[n];if(e>=t[0]&&e<t[1])return n}return-1}},lineNumberToIndexesComputer:function(e){return function(r){return n.lineRanges(e)[r]}},lineRanges:function(e){return n.lines(e).reduce(function(e,r){var n=e.indexCount,t=e.indexCount+r.length+1;return e.lineRanges.push([n,t]),e.indexCount=t,e},{lineRanges:[],indexCount:0}).lineRanges},diff:function(e,r){return"undefined"==typeof JsDiff?"diff not supported":JsDiff.convertChangesToXML(JsDiff.diffWordsWithSpace(e,r))},empty:function(e){return""==e},include:r.includes?function(e,r){return e.includes(r)}:function(e,r){return e.indexOf(r)>-1},startsWith:r.startsWith?function(e,r){return e.startsWith(r)}:function(e,r){return 0===e.indexOf(r)},startsWithVowel:function(e){var r=e[0];return"A"===r||"E"===r||"I"===r||"O"===r||"U"===r||"a"===r||"e"===r||"i"===r||"o"===r||"u"===r||!1},endsWith:r.endsWith?function(e,r){return e.endsWith(r)}:function(e,r){var n=e.length-r.length;return n>=0&&e.lastIndexOf(r)===n},withDecimalPrecision:function(e,r){var n=parseFloat(e);return isNaN(n)?e:n.toFixed(r)},capitalize:function(e){return e.length?e.charAt(0).toUpperCase()+e.slice(1):e},camelCaseString:function(e){return e.split(" ").invoke("capitalize").join("")},camelize:function(e){var r=e.split("-"),n=r.length;if(1==n)return r[0];for(var t="-"==e.charAt(0)?r[0].charAt(0).toUpperCase()+r[0].substring(1):r[0],u=1;n>u;u++)t+=r[u].charAt(0).toUpperCase()+r[u].substring(1);return t},truncate:function(e,r,n){return r=r||30,n=void 0===n?"...":n,e.length>r?e.slice(0,r-n.length)+n:String(e)},truncateLeft:function(e,r,n){return r=r||30,n=void 0===n?"...":n,e.length>r?n+e.slice(-r):String(e)},regExpEscape:function(e){return e.replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},succ:function(e){return e.slice(0,e.length-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1)},digitValue:function(e){return e.charCodeAt(0)-"0".charCodeAt(0)},times:r.repeat?function(e,r){return e.repeat(r)}:function(e,r){return 1>r?"":new Array(r+1).join(e)},applyChange:function(e,r){return"insert"===r.action?e.slice(0,r.start)+r.lines.join("\n")+e.slice(r.start):"remove"===r.action?e.slice(0,r.start)+e.slice(r.end):e},applyChanges:function(e,r){return r.reduce(function(r,t){return n.applyChange(e,t)},e)}}}("undefined"!=typeof lively&&lively.lang?lively.lang:{}),function(e){"use strict";e.num={random:function(e,r){return e=e||0,r=r||100,Math.round(Math.random()*(r-e)+e)},normalRandom:function(e,r){var n,t=!1;return function(e,r){if(t)return t=!1,n*r+e;var u,o,a;do u=2*Math.random()-1,o=2*Math.random()-1,a=u*u+o*o;while(a>=1||0==a);var i=Math.sqrt(-2*Math.log(a)/a);return n=o*i,t=!0,e+r*u*i}}(),randomSmallerInteger:function(e){return Math.floor(Math.random()*e)},humanReadableByteSize:function(e){function r(e){return Math.round(100*e)/100}return 1e3>e?String(r(e))+"B":(e/=1024,1e3>e?String(r(e))+"KB":(e/=1024,String(r(e))+"MB"))},average:function(e){return e.reduce(function(e,r){return e+r},0)/e.length},median:function(e){var r=e.sort(function(e,r){return r-e}),n=e.length;return n%2===0?.5*(r[n/2-1]+r[n/2]):r[(n-1)/2]},between:function(e,r,n,t){t=t||0;var u,o;return n>r?(u=r,o=n):(o=r,u=n),o-e+t>=0&&0>=u-e-t},sort:function(e){return e.sort(function(e,r){return e-r})},parseLength:function(r,n){n=n||"px";var t=r.match(/([0-9\.]+)\s*(.*)/);if(t&&t[1]){var u=parseFloat(t[1]),o=t[2];return e.num.convertLength(u,o,n)}},convertLength:function(){function e(r,n){return"cm"===n?r:"mm"===n?.1*r:"in"===n?2.54*r:"px"===n?r*e(1/96,"in"):"pt"===n?r*e(1/72,"in"):"pc"===n?r*e(12,"pt"):void 0}return function r(n,t,u){return t===u?n:"cm"===u?e(n,t):"cm"===t?n/e(1,u):r(r(n,t,"cm"),"cm",u)}}(),roundTo:function(e,r){return r=1/r,Math.round(e*r)/r},detent:function(r,n,t,u){var o=e.num.roundTo(r,t);if(Math.abs(r-o)<n/2)return o;if(u)return r;var a=o>r?o-n/2:o+n/2;return o+(r-a)*t/(t-n)},toDegrees:function(e){return 180*e/Math.PI%360},toRadians:function(e){return e/180*Math.PI}}}("undefined"!=typeof lively&&lively.lang?lively.lang:{}),function(e){"use strict";var r=function(){var e=function(){var r=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,n=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,t=/[^-+\dA-Z]/g,u=function(e,r){for(e=String(e),r=r||2;e.length<r;)e="0"+e;return e};return function(o,a,i){var c=e;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(o)||/\d/.test(o)||(a=o,o=void 0),o=o?new Date(o):new Date,isNaN(o))throw SyntaxError("invalid date");a=String(c.masks[a]||a||c.masks["default"]),"UTC:"==a.slice(0,4)&&(a=a.slice(4),i=!0);var s=i?"getUTC":"get",l=o[s+"Date"](),f=o[s+"Day"](),d=o[s+"Month"](),p=o[s+"FullYear"](),h=o[s+"Hours"](),g=o[s+"Minutes"](),y=o[s+"Seconds"](),v=o[s+"Milliseconds"](),m=i?0:o.getTimezoneOffset(),b={d:l,dd:u(l),ddd:c.i18n.dayNames[f],dddd:c.i18n.dayNames[f+7],m:d+1,mm:u(d+1),mmm:c.i18n.monthNames[d],mmmm:c.i18n.monthNames[d+12],yy:String(p).slice(2),yyyy:p,h:h%12||12,hh:u(h%12||12),H:h,HH:u(h),M:g,MM:u(g),s:y,ss:u(y),l:u(v,3),L:u(v>99?Math.round(v/10):v),t:12>h?"a":"p",tt:12>h?"am":"pm",T:12>h?"A":"P",TT:12>h?"AM":"PM",Z:i?"UTC":(String(o).match(n)||[""]).pop().replace(t,""),o:(m>0?"-":"+")+u(100*Math.floor(Math.abs(m)/60)+Math.abs(m)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return a.replace(r,function(e){return e in b?b[e]:e.slice(1,e.length-1)})}}();return e.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},e.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},e}();e.date={format:function(e,n,t){return r}(),equals:function(e,r){return r&&r instanceof Date&&r.getTime()===e.getTime()},relativeTo:function(e,r){if(!(r instanceof Date))return"";if(e>r)return"";if(r===e)return"now";var n="min",t="sec",u="hour",o="day",a=r-e,i=Math.round(a/1e3),c=i%60,s=Math.floor(i/60)%60,l=Math.floor(i/60/60)%24,f=Math.floor(i/60/60/24),d=[];return f>0&&(d.push(f),f>1&&(o+="s"),d.push(o)),l>0&&2>f&&(d.push(l),l>1&&(u+="s"),d.push(u)),s>0&&3>l&&0===f&&(d.push(s),s>1&&(n+="s"),d.push(n)),c>0&&3>s&&0===l&&0===f&&(d.push(c),c>1&&(t+="s"),d.push(t)),d.join(" ")}}}("undefined"!=typeof lively&&lively.lang?lively.lang:{}),function(e){"use strict";var r=e.arr,n=e.obj;e.promise=function t(e){return"function"==typeof e?t.convertCallbackFun(e):Promise.resolve(e)},n.extend(e.promise,{delay:function(e,r){return new Promise(function(n){setTimeout(n,e,r)})},delayReject:function(e,r){return new Promise(function(n,t){setTimeout(t,e,r)})},timeout:function(e,r){return new Promise(function(n,t){var u=!1;setTimeout(function(){return!u&&(u=!0)&&t(new Error("Promise timed out"))},e),r.then(function(e){return!u&&(u=!0)&&n(e)},function(e){return!u&&(u=!0)&&t(e)})})},waitFor:function(e,r){return new Promise(function(n,t){"function"==typeof e&&(r=e,e=void 0);var u=!1,o=null,a=void 0,i=setInterval(function(){if(u)return void clearInterval(i);try{a=r()}catch(e){o=e}(a||o)&&(u=!0,clearInterval(i),o?t(o):n(a))},10);"number"==typeof e&&setTimeout(function(){o=new Error("timeout")},e)})},deferred:function(){var e,r,n=new Promise(function(n,t){e=n,r=t});return{resolve:e,reject:r,promise:n}},convertCallbackFun:function(e){return function(){var n=r.from(arguments),t=this;return new Promise(function(r,u){n.push(function(e,n){return e?u(e):r(n)}),e.apply(t,n)})}},convertCallbackFunWithManyArgs:function(e){return function(){var n=r.from(arguments),t=this;return new Promise(function(u,o){n.push(function(){var e=r.from(arguments),n=e.shift();return n?o(n):u(e)}),e.apply(t,n)})}},_chainResolveNext:function u(e,r,n,t,o){var a=e.shift();if(a)try{Promise.resolve(a(r,n)).then(function(r){u(e,r,n,t,o)})["catch"](function(e){o(e)})}catch(i){o(i)}else t(r)},chain:function(r){return new Promise(function(n,t){e.promise._chainResolveNext(r.slice(),void 0,{},n,t)})},"finally":function(e,r){return Promise.resolve(e).then(function(e){try{r()}catch(n){console.error("Error in promise finally: "+n.stack||n)}return e})["catch"](function(e){try{r()}catch(e){console.error("Error in promise finally: "+e.stack||e)}throw e})}})}("undefined"!=typeof lively&&lively.lang?lively.lang:{}),function(e){"use strict";var r="undefined"!=typeof process&&process.versions&&process.versions.node;e.events={makeEmitter:r?function(e,r){if(e.on&&e.removeListener)return e;var n=require("events");return require("util")._extend(e,n.EventEmitter.prototype),n.EventEmitter.call(e),r&&r.maxListenerLimit&&e.setMaxListeners(r.maxListenerLimit),e}:function(e){return e.on&&e.removeListener?e:(e.listeners={},e.on=function(r,n){n&&(e.listeners[r]||(e.listeners[r]=[]),e.listeners[r].push(n))},e.once=function(r,n){function t(){e.removeListener(r,t),n.apply(this,arguments)}n&&e.on(r,t)},e.removeListener=function(r,n){e.listeners[r]&&(e.listeners[r]=e.listeners[r].filter(function(e){return e!==n}))},e.removeAllListeners=function(r){e.listeners[r]&&(e.listeners[r]=[])},e.emit=function(){var r=Array.prototype.slice.call(arguments),n=r.shift(),t=e.listeners[n];t&&t.length&&t.forEach(function(e){try{e.apply(null,r)}catch(n){console.error("Error in event handler: %s",n.stack||String(n))}})},e)}}}("undefined"!=typeof lively&&lively.lang?lively.lang:{}),function(e){"use strict";var r=e.obj,n=e.arr,t=e.graph={clone:function(e){var r={};for(var n in e)r[n]=e[n].slice();return r},without:function(e,r){var n={};for(var t in e)r.indexOf(t)>-1||(n[t]=e[t].filter(function(e){return-1===r.indexOf(e)}));return n},hull:function(e,u,o,a){return n.uniq(n.flatten(r.values(t.subgraphReachableBy(e,u,o,a))))},subgraphReachableBy:function(e,r,n,u){u=u||10,n&&(e=t.without(e,n));for(var o=[r],a=0,i={};o.length&&a++<u;)o=o.reduce(function(r,n){return i[n]?r:r.concat(i[n]=e[n]||[])},[]);return i},invert:function(e){return Object.keys(e).reduce(function(r,n){return e[n].forEach(function(e){r[e]?r[e].push(n):r[e]=[n]}),r},{})},sortByReference:function(e,r){for(var u=[r].concat(t.hull(e,r)),o=[],a=[];o.length!==u.length;){var i=n.withoutAll(u,o).reduce(function(r,t){return r[t]=n.withoutAll(e[t]||[],o).length,r},{}),c=n.withoutAll(u,o).reduce(function(e,r){return i[r]<=i[e]?r:e});0===i[c]?a.push(Object.keys(i).filter(function(e){return 0===i[e]})):a.push([c]),o=n.flatten(a)}return a},reduce:function(e,r,t,u,o,a){function i(t){if(!(c.indexOf(t)>-1)){u=e.call(a,u,t,s++),c=c.concat([t]);var o=n.withoutAll(r[t]||[],c);o.forEach(function(e){return i(e)})}}var c=o||[],s=0;return i(t),u}}}("undefined"!=typeof lively&&lively.lang?lively.lang:{}),function(e){"use strict";var r=e.arr;if(!r)throw new Error("messenger.js needs collection.js!");var n=e.fun;if(!n)throw new Error("messenger.js needs function.js!");var t=e.string;if(!t)throw new Error("messenger.js needs string.js!");var u=e.events;if(!u)throw new Error("messenger.js needs events.js!");var o=e.obj;if(!o)throw new Error("messenger.js needs object.js!");var a="offline",i="online",c="connecting";e.messenger={OFFLINE:a,ONLINE:i,CONNECTING:c,create:function(e){var n=[{name:"send",args:["msg","callback"]},{name:"listen",args:["messenger","callback"]},{name:"close",args:["messenger","callback"]},{name:"isOnline",args:[]}],c=n.map(function(e){return e.name}).concat(["id","sendHeartbeat","heartbeatInterval","ignoreUnknownMessages","allowConcurrentSends","sendTimeout","services"]);n.forEach(function(r){if(!e[r.name]){var n="message implementation needs function "+r.name+"("+r.args.join(",")+")";throw new Error(n)}});var s=e.sendHeartbeat&&(e.heartbeatInterval||1e3),l=e.hasOwnProperty("ignoreUnknownMessages")?e.ignoreUnknownMessages:!1,f={_outgoing:[],_inflight:[],_id:e.id||t.newUUID(),_ignoreUnknownMessages:l,_services:{},_messageCounter:0,_messageResponseCallbacks:{},_whenOnlineCallbacks:[],_statusWatcherProc:null,_startHeartbeatProcessProc:null,_listenInProgress:null,_heartbeatInterval:s,_status:a,_runWhenOnlineCallbacks:function(){var e=r.clone(f._whenOnlineCallbacks);f._whenOnlineCallbacks=[],e.forEach(function(e){try{e.call(null,null,f)}catch(r){console.error("error in _runWhenOnlineCallbacks: %s",r)}})},_ensureStatusWatcher:function(){f._statusWatcherProc||(f._statusWatcherProc=setInterval(function(){f.isOnline()&&f._whenOnlineCallbacks.length&&f._runWhenOnlineCallbacks();var e=f._status;f._status=f.isOnline()?i:a,f._status!==i&&f._statusWatcherProc&&f.reconnect(),f._status!==e&&f.onStatusChange&&f.onStatusChange()},20))},_addMissingData:function(e){if(!e.target)throw new Error("Message needs target!");if(!e.action)throw new Error("Message needs action!");return e.data||(e.data=null),e.messageId||(e.messageId=t.newUUID()),e.sender=f.id(),e.messageIndex=f._messageCounter++,e},_queueSend:function(e,r){if(r&&"function"!=typeof r)throw new Error("Expecing a when send callback, got: "+r);f._outgoing.push([e,r])},_deliverMessageQueue:function(){function n(n){if(-1!==f._inflight.indexOf(n)){var t=n[0],o=n[1];o&&(f._messageResponseCallbacks[t.messageId]=o),e.send.call(f,t,function(e){r.remove(f._inflight,n),e&&u(e,n),f._deliverMessageQueue()})}}function t(n){"number"==typeof e.sendTimeout&&setTimeout(function(){-1!==f._inflight.indexOf(n)&&(r.remove(f._inflight,n),u(new Error("Timeout sending message"),n),f._deliverMessageQueue())},e.sendTimeout)}function u(e,r){var n=r[0],t=r[1];delete f._messageResponseCallbacks[n.messageId],console.error(e),t&&t(e)}if(e.allowConcurrentSends||!f._inflight.length){var o=f._outgoing.shift();o&&(f._inflight.push(o),f.isOnline()?n(o):f.whenOnline(function(){n(o)}),t(o),e.allowConcurrentSends&&f._outgoing.length&&f._deliverMessageQueue())}},_startHeartbeatProcess:function(){f._startHeartbeatProcessProc||(f._startHeartbeatProcessProc=setTimeout(function(){e.sendHeartbeat.call(f,function(e,r){f._startHeartbeatProcessProc=null,f._startHeartbeatProcess()})},f._heartbeatInterval))},id:function(){return f._id},isOnline:function(){return e.isOnline.call(f)},heartbeatEnabled:function(){return"number"==typeof f._heartbeatInterval},listen:function(r){return f._listenInProgress?void 0:(f._listenInProgress=!0,f._ensureStatusWatcher(),e.listen.call(f,function(e){f._listenInProgress=null,r&&r(e),f.heartbeatEnabled()&&f._startHeartbeatProcess()}))},reconnect:function(){return f._status!==i?(f.listen(),f):void 0},send:function(e,r){return f._addMissingData(e),f._queueSend(e,r),f._deliverMessageQueue(),e},sendTo:function(e,r,n,t){var u={target:e,action:r,data:n};return f.send(u,t)},onMessage:function(e){if(f.emit("message",e),e.inResponseTo){var r=f._messageResponseCallbacks[e.inResponseTo];r&&!e.expectMoreResponses&&delete f._messageResponseCallbacks[e.inResponseTo],r&&r(null,e)}else{var n=f._services[e.action];if(n)try{n.call(null,e,f)}catch(t){var u=String(t.stack||t);console.error("Error invoking service: "+u),f.answer(e,{error:u})}else if(!f._ignoreUnknownMessages){var o=new Error("messageNotUnderstood: "+e.action);f.answer(e,{error:String(o)})}}},answer:function(e,r,n,t){"function"==typeof n&&(t=n,n=!1);var u={target:e.sender,action:e.action+"Result",inResponseTo:e.messageId,data:r};return n&&(u.expectMoreResponses=!0),f.send(u,t)},close:function(r){return clearInterval(f._statusWatcherProc),f._statusWatcherProc=null,e.close.call(f,function(e){f._status=a,r&&r(e)}),f},whenOnline:function(e){return f._whenOnlineCallbacks.push(e),f.isOnline()&&f._runWhenOnlineCallbacks(),f},outgoingMessages:function(){return r.pluck(f._inflight.concat(f._outgoing),0)},addServices:function(e){return o.extend(f._services,e),f}};e.services&&f.addServices(e.services),u.makeEmitter(f);for(var d in e)-1===c.indexOf(d)&&e.hasOwnProperty(d)&&(f[d]=e[d]);return f}}}("undefined"!=typeof lively&&lively.lang?lively.lang:{}),function(exports){"use strict";var isNodejs="undefined"!=typeof require&&"undefined"!=typeof process,WorkerSetup={
loadDependenciesBrowser:function(e){var r="undefined"!=typeof self?self:this;importScripts.apply(r,e.scriptsToLoad||[])},loadDependenciesNodejs:function(e){var r=global.lively||(global.lively={});r.lang=require(require("path").join(e.libLocation,"index"))},initBrowserGlobals:function(e){remoteWorker.send=function(e){postMessage(e)};var r="undefined"!=typeof self?self:this,n=r.Global=r;n.window=n,n.console=n.console||function(){var e={};return["log","error","warn"].forEach(function(r){e[r]=function(){for(var e=arguments[0],n=1;n<arguments.length;n++)e=e.replace("%s",arguments[n]);remoteWorker.send({type:r,message:["[",r.toUpperCase(),"] ",e].join("")})}}),e}()},initOnMessageHandler:function(e){function r(e){if(e=e.data.data?e.data:e,remoteWorker.messenger)remoteWorker.messenger.onMessage(e);else if("close"==e.action)return remoteWorker.send({type:"closed",workerReady:!1}),void remoteWorker.close()}remoteWorker.on?remoteWorker.on("message",r):remoteWorker.onmessage=r},initWorkerInterface:function initWorkerInterface(options){remoteWorker.callStringifiedFunction=function(stringifiedFunc,args,thenDo){var func;try{func=eval("("+stringifiedFunc+")")}catch(e){return void thenDo(new Error("Cannot create function from string: "+e.stack||e))}var usesCallback=func.length===args.length+1,whenDone=lively.lang.fun.once(function(e,r){remoteWorker.isBusy=!1,thenDo(e,r)});remoteWorker.isBusy=!0,usesCallback&&args.push(whenDone);try{var result=func.apply(remoteWorker,args.concat([whenDone]))}catch(e){return void whenDone(e,null)}usesCallback||whenDone(null,result)},remoteWorker.httpRequest=function(e){function r(){4===n.readyState&&e.done&&e.done(n)}if(!e.url)return void console.log("Error, httpRequest needs url");var n=new XMLHttpRequest,t=e.method||"GET";n.onreadystatechange=r,n.open(t,e.url),n.send()},remoteWorker.terminateIfNotBusyIn=function(e){setTimeout(function(){return remoteWorker.isBusy?void remoteWorker.terminateIfNotBusyIn(e):(remoteWorker.send({type:"closed",workerReady:!1}),void remoteWorker.close())},e)}},initWorkerMessenger:function initWorkerMessenger(options){if(!options.useMessenger)return null;if(!lively.lang.messenger)throw new Error("worker.create requires messenger.js to be loaded!");if(!lively.lang.events)throw new Error("worker.create requires events.js to be loaded!");return remoteWorker.messenger=lively.lang.messenger.create({services:{remoteEval:function(msg,messenger){var result;try{result=eval(msg.data.expr)}catch(e){result=e.stack||e}messenger.answer(msg,{result:String(result)})},run:function(e,r){var n=e.data.func,t=e.data.args;return n?void remoteWorker.callStringifiedFunction(n,t,function(n,t){r.answer(e,{error:n?String(n):null,result:t})}):void r.answer(e,{error:"no funcString"})},close:function(e,r){r.answer(e,{status:"OK"}),remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close()}},isOnline:function(){return!0},send:function(e,r){remoteWorker.send(e),r()},listen:function(e){e()},close:function(e){remoteWorker.send({type:"closed",workerReady:!1}),remoteWorker.close()}})}},BrowserWorker={create:function(e){function r(e,r){exports.events.makeEmitter(r),e.scriptsToLoad||(e.scriptsToLoad=["base.js","events.js","object.js","collection.js","function.js","string.js","number.js","date.js","messenger.js","worker.js"].map(function(r){return e.libLocation+r}));var n=Object.keys(e).reduce(function(r,n){return"function"!=typeof e[n]&&(r[n]=e[n]),r},{});r.onmessage=function(e){void 0!==e.data.workerReady?(r.ready=!!e.data.workerReady,r.ready?r.emit("ready"):r.emit("close")):r.emit("message",e.data)},r.errors=[],r.onerror=function(e){console.error(e),r.errors.push(e),r.emit("error",e)},r.postMessage({action:"setup",options:n})}function n(){var e=self;e.onmessage=function(e){if("setup"!==e.data.action)throw new Error("expected setup to be first message but got "+JSON.stringify(e.data));var r=e.data.options||{};initBrowserGlobals(r),loadDependenciesBrowser(r),initOnMessageHandler(r),initWorkerInterface(r),initWorkerMessenger(r),postMessage({workerReady:!0})},__FUNCTIONDECLARATIONS__}function t(e){var r;try{r=new Blob([e],{type:"text/javascript"})}catch(n){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,r=new BlobBuilder,r.append(e),r=r.getBlob()}var t="undefined"!=typeof webkitURL?webkitURL:URL;return t.createObjectURL(r)}if(e=e||{},!e.libLocation&&!e.scriptsToLoad){var u=document.querySelector('script[src$="worker.js"]');if(!u)throw new Error('Cannot find library path to start worker. Use worker.create({libLocation: "..."}) to explicitly define the path!');e.libLocation=u.src.replace(/worker.js$/,"")}var o=String(n).replace("__FUNCTIONDECLARATIONS__",[WorkerSetup.initBrowserGlobals,WorkerSetup.loadDependenciesBrowser,WorkerSetup.initOnMessageHandler,WorkerSetup.initWorkerInterface,WorkerSetup.initWorkerMessenger].join("\n")),a="("+o+")();",i=new Worker(t(a));return r(e,i),i}},NodejsWorker={debug:!1,initCodeFileCreated:!1,create:function(e){e=e||{};var r,n=exports.events.makeEmitter({ready:!1,errors:[],postMessage:function(e){return r?n.ready?void r.send(e):void n.emit("error",new Error("nodejs worker process not ready or already closed")):void n.emit("error",new Error("nodejs worker process not yet created"))}});return NodejsWorker.startWorker(e,function(e,t){return e?(n.ready=!1,void n.emit("error",e)):(r=t,r.on("message",function(e){NodejsWorker.debug&&console.log("[WORKER PARENT] got message:",e),n.emit("message",e)}),r.on("close",function(){console.log("[WORKER PARENT] worker closed"),n.emit("close")}),r.on("error",function(e){console.log("[WORKER PARENT] error ",e),n.errors.push(e),n.emit("error",e)}),n.ready=!0,void n.emit("ready"))}),n},workerSetupFunction:function(){var e=process,r=!0;r&&console.log("[WORKER] Starting init"),e.on("message",function(n){if("setup"!==n.action)throw new Error("expected setup to be first message but got "+JSON.stringify(n.data));e.removeAllListeners("message");var t=n.data.options||{};r&&console.log("[WORKER] running setup with options",t),loadDependenciesNodejs(t),initOnMessageHandler(t),initWorkerInterface(t),initWorkerMessenger(t),e.send({workerReady:!0})}),__FUNCTIONDECLARATIONS__},ensureInitCodeFile:function(e,r,n){var t=require("path"),u=require("os"),o=require("fs"),a=t.join(u.tmpDir(),"lively-nodejs-workers/"),i=t.join(a,"nodejs-worker-init.js");NodejsWorker.initCodeFileCreated?o.exists(i,function(t){t?n(null,i):NodejsWorker.createWorkerCodeFile(e,i,r,n)}):NodejsWorker.createWorkerCodeFile(e,i,r,n)},createWorkerCodeFile:function(e,r,n,t){var u=require("path"),o=require("fs"),a=require("child_process").exec;a("mkdir -p "+u.dirname(r),function(e,u,a){return e?void t(new Error(["[WORKER PARENT] Could not create worker temp dir:",u,a].join("\n"))):void o.writeFile(r,n,function(e){NodejsWorker.debug&&console.log("worker code file %s created",r),NodejsWorker.initCodeFileCreated=!0,t(e,r)})})},startWorker:function(e,r){var n=require("util"),t=require("child_process").fork,u=String(NodejsWorker.workerSetupFunction).replace("__FUNCTIONDECLARATIONS__",[WorkerSetup.loadDependenciesNodejs,WorkerSetup.initOnMessageHandler,WorkerSetup.initWorkerInterface,WorkerSetup.initWorkerMessenger].join("\n")),o=n.format("(%s)();\n",u);NodejsWorker.ensureInitCodeFile(e,o,function(n,u){if(n)return r(n);var o=t(u,{});NodejsWorker.debug&&console.log("worker forked"),o.on("message",function(e){"pong"===e.action?console.log("[WORKER pong] ",e):"log"===e.action&&console.log("[Message from WORKER] ",e.data)}),o.once("message",function(e){NodejsWorker.debug&&console.log("worker setup done"),r(null,o,e)}),o.on("close",function(){NodejsWorker.debug&&console.log("[WORKER PARENT] worker closed")}),o.send({action:"setup",data:{options:e}}),global.WORKER=o})}},worker=exports.worker={fork:function(e,r,n){n||(n=r,r=e,e=null),e=e||{};var t=e.args||[],u=worker.create(e);return u.run.apply(u,[r].concat(t).concat(n)),u},create:function(e){if(e=e||{},e.useMessenger=!0,!exports.messenger)throw new Error("worker.create requires messenger.js to be loaded!");if(!exports.events)throw new Error("worker.create requires events.js to be loaded!");if(!exports.obj)throw new Error("worker.create requires object.js to be loaded!");var r=e.workerId||exports.string.newUUID(),n=exports.messenger.create({sendTimeout:5e3,send:function(e,r){n.worker.postMessage(e),r()},listen:function(r){var t=n.worker=isNodejs?NodejsWorker.create(e):BrowserWorker.create(e);t.on("message",function(e){n.onMessage(e)}),t.on("ready",function(){NodejsWorker.debug&&console.log("WORKER READY!!!")}),t.on("close",function(){NodejsWorker.debug&&console.log("WORKER CLOSED...!!!")}),t.once("ready",r)},close:function(e){return n.worker.ready?n.sendTo(r,"close",{},function(r,t){if(r=r||t.data.error,r&&console.error("Error in worker messenger close: "+r.stack||r),r)e(r);else{var u=!1;n.worker.once("close",function(){u=!0}),exports.fun.waitFor(1e3,function(){return!!u},e)}}):e(null)},isOnline:function(){return n.worker&&n.worker.ready}});return exports.obj.extend(n,{eval:function(e,t){n.sendTo(r,"remoteEval",{expr:e},function(e,r){t(e,r?r.data.result:null)})},run:function(){var e=Array.prototype.slice.call(arguments),t=e.shift(),u=e.pop();if("function"!=typeof t)throw new Error("run: no function that should run in worker passed");if("function"!=typeof u)throw new Error("run: no callback passed");return n.sendTo(r,"run",{func:String(t),args:e},function(e,r){u(e||r.data.error,r?r.data.result:null)})}}),n.listen(),n}}}("undefined"!=typeof lively&&lively.lang?lively.lang:{})}();